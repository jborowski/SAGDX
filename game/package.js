(function(){var h=h||{};h.WEBGL_RENDERER=0;h.CANVAS_RENDERER=1;h.VERSION="v2.2.8";h._UID=0;"undefined"!=typeof Float32Array?(h.Float32Array=Float32Array,h.Uint16Array=Uint16Array,h.Uint32Array=Uint32Array,h.ArrayBuffer=ArrayBuffer):(h.Float32Array=Array,h.Uint16Array=Array);h.PI_2=2*Math.PI;h.RAD_TO_DEG=180/Math.PI;h.DEG_TO_RAD=Math.PI/180;h.RETINA_PREFIX="@2x";h.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1};h.DisplayObject=
function(){this.position=new h.Point(0,0);this.scale=new h.Point(1,1);this.transformCallbackContext=this.transformCallback=null;this.pivot=new h.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.renderable=!1;this.stage=this.parent=null;this.worldAlpha=1;this.worldTransform=new h.Matrix;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new h.Rectangle(0,0,1,1);this._mask=this._currentBounds=null;this._cacheIsDirty=this._cacheAsBitmap=!1};h.DisplayObject.prototype.constructor=
h.DisplayObject;h.DisplayObject.prototype.destroy=function(){if(this.children){for(var a=this.children.length;a--;)this.children[a].destroy();this.children=[]}this._mask=this._currentBounds=this._bounds=this.filterArea=this.worldTransform=this.stage=this.parent=this.hitArea=this.transformCallbackContext=this.transformCallback=null;this.renderable=!1;this._destroyCachedSprite()};Object.defineProperty(h.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);
return!0}});Object.defineProperty(h.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1);(this._mask=a)&&(this._mask.isMask=!0)}});Object.defineProperty(h.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var g=[],h=0;h<a.length;h++)for(var l=a[h].passes,m=0;m<l.length;m++)g.push(l[m]);this._filterBlock={target:this,filterPasses:g}}this._filters=a}});Object.defineProperty(h.DisplayObject.prototype,
"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap!==a&&(a?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=a)}});h.DisplayObject.prototype.updateTransform=function(){if(this.parent){var a,g,p,l,m,b,c=this.parent.worldTransform,e=this.worldTransform;this.rotation%h.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),a=this._cr*this.scale.x,
g=this._sr*this.scale.x,p=-this._sr*this.scale.y,l=this._cr*this.scale.y,m=this.position.x,b=this.position.y,(this.pivot.x||this.pivot.y)&&(m-=this.pivot.x*a+this.pivot.y*p,b-=this.pivot.x*g+this.pivot.y*l),e.a=a*c.a+g*c.c,e.b=a*c.b+g*c.d,e.c=p*c.a+l*c.c,e.d=p*c.b+l*c.d,e.tx=m*c.a+b*c.c+c.tx,e.ty=m*c.b+b*c.d+c.ty):(a=this.scale.x,l=this.scale.y,m=this.position.x-this.pivot.x*a,b=this.position.y-this.pivot.y*l,e.a=a*c.a,e.b=a*c.b,e.c=l*c.c,e.d=l*c.d,e.tx=m*c.a+b*c.c+c.tx,e.ty=m*c.b+b*c.d+c.ty);this.worldAlpha=
this.alpha*this.parent.worldAlpha;this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,e,c)}};h.DisplayObject.prototype.displayObjectUpdateTransform=h.DisplayObject.prototype.updateTransform;h.DisplayObject.prototype.getBounds=function(a){return h.EmptyRectangle};h.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(h.identityMatrix)};h.DisplayObject.prototype.setStageReference=function(a){this.stage=a};h.DisplayObject.prototype.preUpdate=function(){};
h.DisplayObject.prototype.generateTexture=function(a,g,p){var l=this.getLocalBounds();a=new h.RenderTexture(0|l.width,0|l.height,p,g,a);return h.DisplayObject._tempMatrix.tx=-l.x,h.DisplayObject._tempMatrix.ty=-l.y,a.render(this,h.DisplayObject._tempMatrix),a};h.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};h.DisplayObject.prototype.toGlobal=function(a){return this.displayObjectUpdateTransform(),this.worldTransform.apply(a)};h.DisplayObject.prototype.toLocal=function(a,
g){return g&&(a=g.toGlobal(a)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(a)};h.DisplayObject.prototype._renderCachedSprite=function(a){this._cachedSprite.worldAlpha=this.worldAlpha;a.gl?h.Sprite.prototype._renderWebGL.call(this._cachedSprite,a):h.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)};h.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|
a.width,0|a.height);else{var g=new h.RenderTexture(0|a.width,0|a.height);this._cachedSprite=new h.Sprite(g);this._cachedSprite.worldTransform=this.worldTransform}g=this._filters;this._filters=null;this._cachedSprite.filters=g;h.DisplayObject._tempMatrix.tx=-a.x;h.DisplayObject._tempMatrix.ty=-a.y;this._cachedSprite.texture.render(this,h.DisplayObject._tempMatrix,!0);this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._filters=g;this._cacheAsBitmap=!0};h.DisplayObject.prototype._destroyCachedSprite=
function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)};h.DisplayObject.prototype._renderWebGL=function(a){};h.DisplayObject.prototype._renderCanvas=function(a){};Object.defineProperty(h.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}});Object.defineProperty(h.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}});h.DisplayObjectContainer=function(){h.DisplayObject.call(this);
this.children=[]};h.DisplayObjectContainer.prototype=Object.create(h.DisplayObject.prototype);h.DisplayObjectContainer.prototype.constructor=h.DisplayObjectContainer;Object.defineProperty(h.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){var g=this.getLocalBounds().width;this.scale.x=0!==g?a/g:1;this._width=a}});Object.defineProperty(h.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},
set:function(a){var g=this.getLocalBounds().height;this.scale.y=0!==g?a/g:1;this._height=a}});h.DisplayObjectContainer.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)};h.DisplayObjectContainer.prototype.addChildAt=function(a,g){if(0<=g&&g<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(g,0,a),this.stage&&a.setStageReference(this.stage),a;throw Error(a+"addChildAt: The index "+g+" supplied is out of bounds "+this.children.length);
};h.DisplayObjectContainer.prototype.swapChildren=function(a,g){if(a!==g){var h=this.getChildIndex(a),l=this.getChildIndex(g);if(0>h||0>l)throw Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[h]=g;this.children[l]=a}};h.DisplayObjectContainer.prototype.getChildIndex=function(a){a=this.children.indexOf(a);if(-1===a)throw Error("The supplied DisplayObject must be a child of the caller");return a};h.DisplayObjectContainer.prototype.setChildIndex=function(a,
g){if(0>g||g>=this.children.length)throw Error("The supplied index is out of bounds");var h=this.getChildIndex(a);this.children.splice(h,1);this.children.splice(g,0,a)};h.DisplayObjectContainer.prototype.getChildAt=function(a){if(0>a||a>=this.children.length)throw Error("getChildAt: Supplied index "+a+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[a]};h.DisplayObjectContainer.prototype.removeChild=function(a){a=this.children.indexOf(a);
if(-1!==a)return this.removeChildAt(a)};h.DisplayObjectContainer.prototype.removeChildAt=function(a){var g=this.getChildAt(a);return this.stage&&g.removeStageReference(),g.parent=void 0,this.children.splice(a,1),g};h.DisplayObjectContainer.prototype.removeChildren=function(a,g){var h=a||0,l="number"==typeof g?g:this.children.length,m=l-h;if(0<m&&l>=m){h=this.children.splice(h,m);for(l=0;l<h.length;l++)m=h[l],this.stage&&m.removeStageReference(),m.parent=void 0;return h}if(0===m&&0===this.children.length)return[];
throw Error("removeChildren: Range Error, numeric values are outside the acceptable range");};h.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var a=0,g=this.children.length;g>a;a++)this.children[a].updateTransform()};h.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=h.DisplayObjectContainer.prototype.updateTransform;h.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return h.EmptyRectangle;
for(var a,g,p,l=1/0,m=1/0,b=-1/0,c=-1/0,e=!1,d=0,f=this.children.length;f>d;d++)this.children[d].visible&&(e=!0,a=this.children[d].getBounds(),l=l<a.x?l:a.x,m=m<a.y?m:a.y,g=a.width+a.x,p=a.height+a.y,b=b>g?b:g,c=c>p?c:p);if(!e)return h.EmptyRectangle;a=this._bounds;return a.x=l,a.y=m,a.width=b-l,a.height=c-m,a};h.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=h.identityMatrix;for(var g=0,p=this.children.length;p>g;g++)this.children[g].updateTransform();
g=this.getBounds();return this.worldTransform=a,g};h.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a;for(var g=0;g<this.children.length;g++)this.children[g].setStageReference(a)};h.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeStageReference();this.stage=null};h.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(0>=this.alpha)){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);
var g;if(this._mask||this._filters){this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock));this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start());for(g=0;g<this.children.length;g++)this.children[g]._renderWebGL(a);a.spriteBatch.stop();this._mask&&a.maskManager.popMask(this._mask,a);this._filters&&a.filterManager.popFilter();a.spriteBatch.start()}else for(g=0;g<this.children.length;g++)this.children[g]._renderWebGL(a)}};h.DisplayObjectContainer.prototype._renderCanvas=
function(a){if(!1!==this.visible&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);this._mask&&a.maskManager.pushMask(this._mask,a);for(var g=0;g<this.children.length;g++)this.children[g]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}};h.Sprite=function(a){h.DisplayObjectContainer.call(this);this.anchor=new h.Point;this.texture=a||h.Texture.emptyTexture;this._height=this._width=0;this.tint=16777215;this.blendMode=h.blendModes.NORMAL;this.shader=null;this.texture.baseTexture.hasLoaded&&
this.onTextureUpdate();this.renderable=!0};h.Sprite.prototype=Object.create(h.DisplayObjectContainer.prototype);h.Sprite.prototype.constructor=h.Sprite;Object.defineProperty(h.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(h.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;
this._height=a}});h.Sprite.prototype.setTexture=function(a){this.texture=a;this.cachedTint=16777215};h.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);this._height&&(this.scale.y=this._height/this.texture.frame.height)};h.Sprite.prototype.getBounds=function(a){var g=this.texture.frame.width,h=this.texture.frame.height,l=g*(1-this.anchor.x),g=g*-this.anchor.x,m=h*(1-this.anchor.y),b=h*-this.anchor.y;a=a||this.worldTransform;var c=a.a,e=a.b,
d=a.c,f=a.d,k=a.tx,n=a.ty;a=-1/0;var h=-1/0,u=1/0,z=1/0;if(0===e&&0===d)0>c&&(c*=-1),0>f&&(f*=-1),u=c*g+k,a=c*l+k,z=f*b+n,h=f*m+n;else{var y=c*g+d*b+k,q=f*b+e*g+n,t=c*l+d*b+k,b=f*b+e*l+n,x=c*l+d*m+k,l=f*m+e*l+n,c=c*g+d*m+k,g=f*m+e*g+n,u=u>y?y:u,u=u>t?t:u,u=u>x?x:u,u=u>c?c:u,z=z>q?q:z,z=z>b?b:z,z=z>l?l:z,z=z>g?g:z;a=y>a?y:a;a=t>a?t:a;a=x>a?x:a;a=c>a?c:a;h=q>h?q:h;h=b>h?b:h;h=l>h?l:h;h=g>h?g:h}g=this._bounds;return g.x=u,g.width=a-u,g.y=z,g.height=h-z,this._currentBounds=g,g};h.Sprite.prototype._renderWebGL=
function(a){if(this.visible&&!(0>=this.alpha)&&this.renderable){var g;if(this._mask||this._filters){var h=a.spriteBatch;this._filters&&(h.flush(),a.filterManager.pushFilter(this._filterBlock));this._mask&&(h.stop(),a.maskManager.pushMask(this.mask,a),h.start());h.render(this);for(g=0;g<this.children.length;g++)this.children[g]._renderWebGL(a);h.stop();this._mask&&a.maskManager.popMask(this._mask,a);this._filters&&a.filterManager.popFilter();h.start()}else for(a.spriteBatch.render(this),g=0;g<this.children.length;g++)this.children[g]._renderWebGL(a)}};
h.Sprite.prototype._renderCanvas=function(a){if(!(!1===this.visible||0===this.alpha||!1===this.renderable||0>=this.texture.crop.width||0>=this.texture.crop.height)){if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=h.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a),this.texture.valid){var g=this.texture.baseTexture.resolution/a.resolution;a.context.globalAlpha=this.worldAlpha;a.smoothProperty&&a.scaleMode!==
this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,a.context[a.smoothProperty]=a.scaleMode===h.scaleModes.LINEAR);var p=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,l=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;a.roundPixels?(a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,
this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0),p|=0,l|=0):a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution);16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=h.CanvasTinter.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,
p/g,l/g,this.texture.crop.width/g,this.texture.crop.height/g)):a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,p/g,l/g,this.texture.crop.width/g,this.texture.crop.height/g)}for(g=0;g<this.children.length;g++)this.children[g]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}};h.Sprite.fromFrame=function(a){var g=h.TextureCache[a];if(!g)throw Error('The frameId "'+a+'" does not exist in the texture cache'+
this);return new h.Sprite(g)};h.Sprite.fromImage=function(a,g,p){a=h.Texture.fromImage(a,g,p);return new h.Sprite(a)};h.SpriteBatch=function(a){h.DisplayObjectContainer.call(this);this.textureThing=a;this.ready=!1};h.SpriteBatch.prototype=Object.create(h.DisplayObjectContainer.prototype);h.SpriteBatch.prototype.constructor=h.SpriteBatch;h.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new h.WebGLFastSpriteBatch(a);this.ready=!0};h.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};
h.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||!this.children.length||(this.ready||this.initWebGL(a.gl),this.fastSpriteBatch.gl!==a.gl&&this.fastSpriteBatch.setContext(a.gl),a.spriteBatch.stop(),a.shaderManager.setShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.spriteBatch.start())};h.SpriteBatch.prototype._renderCanvas=function(a){if(this.visible&&!(0>=this.alpha)&&this.children.length){var g=a.context;g.globalAlpha=
this.worldAlpha;this.displayObjectUpdateTransform();for(var h=this.worldTransform,l=!0,m=0;m<this.children.length;m++){var b=this.children[m];if(b.visible){var c=b.texture,e=c.frame;if(g.globalAlpha=this.worldAlpha*b.alpha,0===b.rotation%(2*Math.PI))l&&(g.setTransform(h.a,h.b,h.c,h.d,h.tx,h.ty),l=!1),g.drawImage(c.baseTexture.source,e.x,e.y,e.width,e.height,b.anchor.x*-e.width*b.scale.x+b.position.x+.5|0,b.anchor.y*-e.height*b.scale.y+b.position.y+.5|0,e.width*b.scale.x,e.height*b.scale.y);else{l||
(l=!0);b.displayObjectUpdateTransform();var d=b.worldTransform;a.roundPixels?g.setTransform(d.a,d.b,d.c,d.d,0|d.tx,0|d.ty):g.setTransform(d.a,d.b,d.c,d.d,d.tx,d.ty);g.drawImage(c.baseTexture.source,e.x,e.y,e.width,e.height,b.anchor.x*-e.width+.5|0,b.anchor.y*-e.height+.5|0,e.width,e.height)}}}}};h.Text=function(a,g){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=1;h.Sprite.call(this,h.Texture.fromCanvas(this.canvas));this.setText(a);this.setStyle(g)};
h.Text.prototype=Object.create(h.Sprite.prototype);h.Text.prototype.constructor=h.Text;Object.defineProperty(h.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(h.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=
a/this.texture.frame.height;this._height=a}});h.Text.prototype.setStyle=function(a){a=a||{};a.font=a.font||"bold 20pt Arial";a.fill=a.fill||"black";a.align=a.align||"left";a.stroke=a.stroke||"black";a.strokeThickness=a.strokeThickness||0;a.wordWrap=a.wordWrap||!1;a.wordWrapWidth=a.wordWrapWidth||100;a.dropShadow=a.dropShadow||!1;a.dropShadowAngle=a.dropShadowAngle||Math.PI/6;a.dropShadowDistance=a.dropShadowDistance||4;a.dropShadowColor=a.dropShadowColor||"black";this.style=a;this.dirty=!0};h.Text.prototype.setText=
function(a){this.text=a.toString()||" ";this.dirty=!0};h.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));for(var a=a.split(/(?:\r\n|\r|\n)/),g=[],h=0,l=this.determineFontProperties(this.style.font),m=0;m<a.length;m++){var b=this.context.measureText(a[m]).width;g[m]=b;h=Math.max(h,b)}m=h+this.style.strokeThickness;this.style.dropShadow&&(m+=this.style.dropShadowDistance);
this.canvas.width=(m+this.context.lineWidth)*this.resolution;b=l.fontSize+this.style.strokeThickness;m=b*a.length;this.style.dropShadow&&(m+=this.style.dropShadowDistance);this.canvas.height=m*this.resolution;this.context.scale(this.resolution,this.resolution);navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline=
"alphabetic";var c,e;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;for(var d=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,f=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance,m=0;m<a.length;m++)c=this.style.strokeThickness/2,e=this.style.strokeThickness/2+m*b+l.ascent,"right"===this.style.align?c+=h-g[m]:"center"===this.style.align&&(c+=(h-g[m])/2),this.style.fill&&this.context.fillText(a[m],c+d,e+f)}this.context.fillStyle=this.style.fill;
for(m=0;m<a.length;m++)c=this.style.strokeThickness/2,e=this.style.strokeThickness/2+m*b+l.ascent,"right"===this.style.align?c+=h-g[m]:"center"===this.style.align&&(c+=(h-g[m])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(a[m],c,e),this.style.fill&&this.context.fillText(a[m],c,e);this.updateTexture()};h.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=
this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.texture.baseTexture.dirty()};h.Text.prototype._renderWebGL=function(a){this.dirty&&(this.resolution=a.resolution,this.updateText(),this.dirty=!1);h.Sprite.prototype._renderWebGL.call(this,a)};h.Text.prototype._renderCanvas=function(a){this.dirty&&(this.resolution=a.resolution,this.updateText(),this.dirty=!1);h.Sprite.prototype._renderCanvas.call(this,
a)};h.Text.prototype.determineFontProperties=function(a){var g=h.Text.fontPropertiesCache[a];if(!g){var g={},p=h.Text.fontPropertiesCanvas,l=h.Text.fontPropertiesContext;l.font=a;var m=Math.ceil(l.measureText("|M\u00c9q").width),b=Math.ceil(l.measureText("|M\u00c9q").width),c=2*b,b=1.4*b|0;p.width=m;p.height=c;l.fillStyle="#f00";l.fillRect(0,0,m,c);l.font=a;l.textBaseline="alphabetic";l.fillStyle="#000";l.fillText("|M\u00c9q",0,b);for(var e,p=l.getImageData(0,0,m,c).data,l=p.length,d=4*m,f=0,k=!1,
m=0;b>m;m++){for(e=0;d>e;e+=4)if(255!==p[f+e]){k=!0;break}if(k)break;f+=d}g.ascent=b-m;f=l-d;k=!1;for(m=c;m>b;m--){for(e=0;d>e;e+=4)if(255!==p[f+e]){k=!0;break}if(k)break;f-=d}g.descent=m-b;g.descent+=6;g.fontSize=g.ascent+g.descent;h.Text.fontPropertiesCache[a]=g}return g};h.Text.prototype.wordWrap=function(a){var g="";a=a.split("\n");for(var h=0;h<a.length;h++){for(var l=this.style.wordWrapWidth,m=a[h].split(" "),b=0;b<m.length;b++){var c=this.context.measureText(m[b]).width,e=c+this.context.measureText(" ").width;
0===b||e>l?(0<b&&(g+="\n"),g+=m[b],l=this.style.wordWrapWidth-c):(l-=e,g+=" "+m[b])}h<a.length-1&&(g+="\n")}return g};h.Text.prototype.getBounds=function(a){return this.dirty&&(this.updateText(),this.dirty=!1),h.Sprite.prototype.getBounds.call(this,a)};h.Text.prototype.destroy=function(a){this.canvas=this.context=null;this.texture.destroy(void 0===a?!0:a)};h.Text.fontPropertiesCache={};h.Text.fontPropertiesCanvas=document.createElement("canvas");h.Text.fontPropertiesContext=h.Text.fontPropertiesCanvas.getContext("2d");
h.BitmapText=function(a,g){h.DisplayObjectContainer.call(this);this.maxWidth=this.textHeight=this.textWidth=0;this.anchor=new Phaser.Point(0,0);this._prevAnchor=new Phaser.Point(0,0);this._pool=[];this.setText(a);this.setStyle(g);this.updateText();this.dirty=!1};h.BitmapText.prototype=Object.create(h.DisplayObjectContainer.prototype);h.BitmapText.prototype.constructor=h.BitmapText;h.BitmapText.prototype.setText=function(a){this.text=a||" ";this.dirty=!0};h.BitmapText.prototype.setStyle=function(a){a=
a||{};a.align=a.align||"left";this.style=a;var g=a.font.split(" ");this.fontName=g[g.length-1];this.fontSize=2<=g.length?parseInt(g[g.length-2],10):h.BitmapText.fonts[this.fontName].size;this.dirty=!0;this.tint=a.tint};h.BitmapText.prototype.updateText=function(){for(var a=h.BitmapText.fonts[this.fontName],g=new h.Point,p=null,l=[],m=0,b=[],c=0,e=this.fontSize/a.size,d=0,f=0;f<this.text.length;f++){var k=this.text.charCodeAt(f);if(d=/(\s)/.test(this.text.charAt(f))?f:d,/(?:\r\n|\r|\n)/.test(this.text.charAt(f)))b.push(g.x),
m=Math.max(m,g.x),c++,g.x=0,g.y+=a.lineHeight,p=null;else if(-1!==d&&0<this.maxWidth&&g.x*e>this.maxWidth)l.splice(d,f-d),f=d,d=-1,b.push(lastLineWidth),m=Math.max(m,lastLineWidth),c++,g.x=0,g.y+=a.lineHeight,p=null;else{var n=a.chars[k];n&&(p&&n.kerning[p]&&(g.x+=n.kerning[p]),l.push({texture:n.texture,line:c,charCode:k,position:new h.Point(g.x+n.xOffset,g.y+n.yOffset)}),g.x+=n.xAdvance,p=k)}}b.push(g.x);m=Math.max(m,g.x);p=[];for(f=0;c>=f;f++)d=0,"right"===this.style.align?d=m-b[f]:"center"===this.style.align&&
(d=(m-b[f])/2),p.push(d);c=this.children.length;b=l.length;d=this.tint||16777215;this.textWidth=m*e;this.textHeight=(g.y+a.lineHeight)*e;a=this.textWidth*this.anchor.x;g=this.textHeight*this.anchor.y;for(f=0;b>f;f++)(m=c>f?this.children[f]:this._pool.pop())?m.setTexture(l[f].texture):m=new h.Sprite(l[f].texture),m.position.x=(l[f].position.x+p[l[f].line])*e-a,m.position.y=l[f].position.y*e-g,m.scale.x=m.scale.y=e,m.tint=d,m.parent||this.addChild(m);for(;this.children.length>b;)l=this.getChildAt(this.children.length-
1),this._pool.push(l),this.removeChild(l)};h.BitmapText.prototype.updateTransform=function(){!this.dirty&&this.anchor.equals(this._prevAnchor)||(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor));h.DisplayObjectContainer.prototype.updateTransform.call(this)};h.BitmapText.fonts={};h.Stage=function(a){h.DisplayObjectContainer.call(this);this.worldTransform=new h.Matrix;this.stage=this;this.setBackgroundColor(a)};h.Stage.prototype=Object.create(h.DisplayObjectContainer.prototype);
h.Stage.prototype.constructor=h.Stage;h.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0;a<this.children.length;a++)this.children[a].updateTransform()};h.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0;this.backgroundColorSplit=h.hex2rgb(this.backgroundColor);a=this.backgroundColor.toString(16);a="000000".substr(0,6-a.length)+a;this.backgroundColorString="#"+a};h.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]};h.rgb2hex=function(a){return(255*
a[0]<<16)+(255*a[1]<<8)+255*a[2]};h.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/AP804Oa6AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var g=new Image;g.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX//wCKxvRFAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var h=document.createElement("canvas");h.width=6;h.height=1;h=h.getContext("2d");
h.globalCompositeOperation="multiply";h.drawImage(a,0,0);h.drawImage(g,2,0);a=h.getImageData(2,0,1,1).data;return 255===a[0]&&0===a[1]&&0===a[2]};h.getNextPowerOfTwo=function(a){if(0<a&&0===(a&a-1))return a;for(var g=1;a>g;)g<<=1;return g};h.isPowerOfTwo=function(a,g){return 0<a&&0===(a&a-1)&&0<g&&0===(g&g-1)};h.PolyK={};h.PolyK.Triangulate=function(a){var g=!0,p=a.length>>1;if(3>p)return[];for(var l=[],m=[],b=0;p>b;b++)m.push(b);for(var b=0,c=p;3<c;){var e=m[(b+0)%c],d=m[(b+1)%c],f=m[(b+2)%c],k=
a[2*e],n=a[2*e+1],u=a[2*d],z=a[2*d+1],y=a[2*f],q=a[2*f+1],t=!1;if(h.PolyK._convex(k,n,u,z,y,q,g))for(var t=!0,x=0;c>x;x++){var v=m[x];if(v!==e&&v!==d&&v!==f&&h.PolyK._PointInTriangle(a[2*v],a[2*v+1],k,n,u,z,y,q)){t=!1;break}}if(t)l.push(e,d,f),m.splice((b+1)%c,1),c--,b=0;else if(b++>3*c){if(!g)return null;l=[];m=[];for(b=0;p>b;b++)m.push(b);b=0;c=p;g=!1}}return l.push(m[0],m[1],m[2]),l};h.PolyK._PointInTriangle=function(a,g,h,l,m,b,c,e){c-=h;e-=l;m-=h;b-=l;a-=h;h=g-l;g=c*c+e*e;l=c*m+e*b;c=c*a+e*h;
e=m*m+b*b;m=m*a+b*h;b=1/(g*e-l*l);e=(e*c-l*m)*b;c=(g*m-l*c)*b;return 0<=e&&0<=c&&1>e+c};h.PolyK._convex=function(a,g,h,l,m,b,c){return 0<=(g-l)*(m-h)+(h-a)*(b-l)===c};h.initDefaultShaders=function(){};h.CompileVertexShader=function(a,g){return h._CompileShader(a,g,a.VERTEX_SHADER)};h.CompileFragmentShader=function(a,g){return h._CompileShader(a,g,a.FRAGMENT_SHADER)};h._CompileShader=function(a,g,h){g=g.join("\n");h=a.createShader(h);return a.shaderSource(h,g),a.compileShader(h),a.getShaderParameter(h,
a.COMPILE_STATUS)?h:(window.console.log(a.getShaderInfoLog(h)),null)};h.compileProgram=function(a,g,p){p=h.CompileFragmentShader(a,p);g=h.CompileVertexShader(a,g);var l=a.createProgram();return a.attachShader(l,g),a.attachShader(l,p),a.linkProgram(l),a.getProgramParameter(l,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),l};h.PixiShader=function(a){this._UID=h._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;",
"uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.dirty=this.firstRun=!0;this.attributes=[];this.init()};h.PixiShader.prototype.constructor=h.PixiShader;h.PixiShader.prototype.init=function(){var a=this.gl,g=h.compileProgram(a,this.vertexSrc||h.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(g);this.uSampler=a.getUniformLocation(g,"uSampler");this.projectionVector=a.getUniformLocation(g,"projectionVector");
this.offsetVector=a.getUniformLocation(g,"offsetVector");this.dimensions=a.getUniformLocation(g,"dimensions");this.aVertexPosition=a.getAttribLocation(g,"aVertexPosition");this.aTextureCoord=a.getAttribLocation(g,"aTextureCoord");this.colorAttribute=a.getAttribLocation(g,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var p in this.uniforms)this.uniforms[p].uniformLocation=a.getUniformLocation(g,p);this.initUniforms();
this.program=g};h.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a,g=this.gl,h;for(h in this.uniforms){a=this.uniforms[h];var l=a.type;"sampler2D"===l?(a._init=!1,null!==a.value&&this.initSampler2D(a)):"mat2"===l||"mat3"===l||"mat4"===l?(a.glMatrix=!0,a.glValueLength=1,"mat2"===l?a.glFunc=g.uniformMatrix2fv:"mat3"===l?a.glFunc=g.uniformMatrix3fv:"mat4"===l&&(a.glFunc=g.uniformMatrix4fv)):(a.glFunc=g["uniform"+l],a.glValueLength="2f"===l||"2i"===l?2:"3f"===l||"3i"===l?3:"4f"===
l||"4i"===l?4:1)}};h.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var g=this.gl;if(g.activeTexture(g["TEXTURE"+this.textureCount]),g.bindTexture(g.TEXTURE_2D,a.value.baseTexture._glTextures[g.id]),a.textureData){var h=a.textureData,l=h.magFilter?h.magFilter:g.LINEAR,m=h.minFilter?h.minFilter:g.LINEAR,b=h.wrapS?h.wrapS:g.CLAMP_TO_EDGE,c=h.wrapT?h.wrapT:g.CLAMP_TO_EDGE,e=h.luminance?g.LUMINANCE:g.RGBA;(h.repeat&&(b=g.REPEAT,c=g.REPEAT),
g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!!h.flipY),h.width)?g.texImage2D(g.TEXTURE_2D,0,e,h.width?h.width:512,h.height?h.height:2,h.border?h.border:0,e,g.UNSIGNED_BYTE,null):g.texImage2D(g.TEXTURE_2D,0,e,g.RGBA,g.UNSIGNED_BYTE,a.value.baseTexture.source);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,l);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,m);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,b);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,c)}g.uniform1i(a.uniformLocation,this.textureCount);
a._init=!0;this.textureCount++}};h.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,g=this.gl,p;for(p in this.uniforms)a=this.uniforms[p],1===a.glValueLength?!0===a.glMatrix?a.glFunc.call(g,a.uniformLocation,a.transpose,a.value):a.glFunc.call(g,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(g,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(g,a.uniformLocation,a.value.x,a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(g,a.uniformLocation,
a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(g.activeTexture(g["TEXTURE"+this.textureCount]),a.value.baseTexture._dirty[g.id]?h.instances[g.id].updateTexture(a.value.baseTexture):g.bindTexture(g.TEXTURE_2D,a.value.baseTexture._glTextures[g.id]),g.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))};h.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};h.PixiShader.defaultVertexSrc=
["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];h.PixiFastShader=function(a){this._UID=h._UID++;
this.gl=a;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;",
"uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;",
"}"];this.textureCount=0;this.init()};h.PixiFastShader.prototype.constructor=h.PixiFastShader;h.PixiFastShader.prototype.init=function(){var a=this.gl,g=h.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(g);this.uSampler=a.getUniformLocation(g,"uSampler");this.projectionVector=a.getUniformLocation(g,"projectionVector");this.offsetVector=a.getUniformLocation(g,"offsetVector");this.dimensions=a.getUniformLocation(g,"dimensions");this.uMatrix=a.getUniformLocation(g,"uMatrix");this.aVertexPosition=
a.getAttribLocation(g,"aVertexPosition");this.aPositionCoord=a.getAttribLocation(g,"aPositionCoord");this.aScale=a.getAttribLocation(g,"aScale");this.aRotation=a.getAttribLocation(g,"aRotation");this.aTextureCoord=a.getAttribLocation(g,"aTextureCoord");this.colorAttribute=a.getAttribLocation(g,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=g};h.PixiFastShader.prototype.destroy=
function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};h.StripShader=function(a){this._UID=h._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;",
"uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};h.StripShader.prototype.constructor=h.StripShader;h.StripShader.prototype.init=function(){var a=this.gl,g=h.compileProgram(a,this.vertexSrc,this.fragmentSrc);
a.useProgram(g);this.uSampler=a.getUniformLocation(g,"uSampler");this.projectionVector=a.getUniformLocation(g,"projectionVector");this.offsetVector=a.getUniformLocation(g,"offsetVector");this.colorAttribute=a.getAttribLocation(g,"aColor");this.aVertexPosition=a.getAttribLocation(g,"aVertexPosition");this.aTextureCoord=a.getAttribLocation(g,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=a.getUniformLocation(g,"translationMatrix");this.alpha=a.getUniformLocation(g,
"alpha");this.program=g};h.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};h.PrimitiveShader=function(a){this._UID=h._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;",
"uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};h.PrimitiveShader.prototype.constructor=h.PrimitiveShader;h.PrimitiveShader.prototype.init=function(){var a=this.gl,g=h.compileProgram(a,
this.vertexSrc,this.fragmentSrc);a.useProgram(g);this.projectionVector=a.getUniformLocation(g,"projectionVector");this.offsetVector=a.getUniformLocation(g,"offsetVector");this.tintColor=a.getUniformLocation(g,"tint");this.flipY=a.getUniformLocation(g,"flipY");this.aVertexPosition=a.getAttribLocation(g,"aVertexPosition");this.colorAttribute=a.getAttribLocation(g,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=a.getUniformLocation(g,"translationMatrix");this.alpha=
a.getUniformLocation(g,"alpha");this.program=g};h.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};h.ComplexPrimitiveShader=function(a){this._UID=h._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;",
"uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};h.ComplexPrimitiveShader.prototype.constructor=h.ComplexPrimitiveShader;h.ComplexPrimitiveShader.prototype.init=
function(){var a=this.gl,g=h.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(g);this.projectionVector=a.getUniformLocation(g,"projectionVector");this.offsetVector=a.getUniformLocation(g,"offsetVector");this.tintColor=a.getUniformLocation(g,"tint");this.color=a.getUniformLocation(g,"color");this.flipY=a.getUniformLocation(g,"flipY");this.aVertexPosition=a.getAttribLocation(g,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=a.getUniformLocation(g,
"translationMatrix");this.alpha=a.getUniformLocation(g,"alpha");this.program=g};h.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};h.WebGLGraphics=function(){};h.WebGLGraphics.renderGraphics=function(a,g){var p,l=g.gl,m=g.projection,b=g.offset,c=g.shaderManager.primitiveShader;a.dirty&&h.WebGLGraphics.updateGraphics(a,l);for(var e=a._webGL[l.id],d=0;d<e.data.length;d++)1===e.data[d].mode?(p=e.data[d],g.stencilManager.pushStencil(a,
p,g),l.drawElements(l.TRIANGLE_FAN,4,l.UNSIGNED_SHORT,2*(p.indices.length-4)),g.stencilManager.popStencil(a,p,g)):(p=e.data[d],g.shaderManager.setShader(c),c=g.shaderManager.primitiveShader,l.uniformMatrix3fv(c.translationMatrix,!1,a.worldTransform.toArray(!0)),l.uniform1f(c.flipY,1),l.uniform2f(c.projectionVector,m.x,-m.y),l.uniform2f(c.offsetVector,-b.x,-b.y),l.uniform3fv(c.tintColor,h.hex2rgb(a.tint)),l.uniform1f(c.alpha,a.worldAlpha),l.bindBuffer(l.ARRAY_BUFFER,p.buffer),l.vertexAttribPointer(c.aVertexPosition,
2,l.FLOAT,!1,24,0),l.vertexAttribPointer(c.colorAttribute,4,l.FLOAT,!1,24,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,p.indexBuffer),l.drawElements(l.TRIANGLE_STRIP,p.indices.length,l.UNSIGNED_SHORT,0))};h.WebGLGraphics.updateGraphics=function(a,g){var p=a._webGL[g.id];p||(p=a._webGL[g.id]={lastIndex:0,data:[],gl:g});a.dirty=!1;var l;if(a.clearDirty){a.clearDirty=!1;for(l=0;l<p.data.length;l++){var m=p.data[l];m.reset();h.WebGLGraphics.graphicsDataPool.push(m)}p.data=[];p.lastIndex=0}var b;for(l=p.lastIndex;l<
a.graphicsData.length;l++){m=a.graphicsData[l];if(m.type===h.Graphics.POLY){if(m.points=m.shape.points.slice(),m.shape.closed&&(m.points[0]!==m.points[m.points.length-2]||m.points[1]!==m.points[m.points.length-1])&&m.points.push(m.points[0],m.points[1]),m.fill&&6<=m.points.length)12>m.points.length?(b=h.WebGLGraphics.switchMode(p,0),h.WebGLGraphics.buildPoly(m,b)||(b=h.WebGLGraphics.switchMode(p,1),h.WebGLGraphics.buildComplexPoly(m,b))):(b=h.WebGLGraphics.switchMode(p,1),h.WebGLGraphics.buildComplexPoly(m,
b));0<m.lineWidth&&(b=h.WebGLGraphics.switchMode(p,0),h.WebGLGraphics.buildLine(m,b))}else b=h.WebGLGraphics.switchMode(p,0),m.type===h.Graphics.RECT?h.WebGLGraphics.buildRectangle(m,b):m.type===h.Graphics.CIRC||m.type===h.Graphics.ELIP?h.WebGLGraphics.buildCircle(m,b):m.type===h.Graphics.RREC&&h.WebGLGraphics.buildRoundedRectangle(m,b);p.lastIndex++}for(l=0;l<p.data.length;l++)b=p.data[l],b.dirty&&b.upload()};h.WebGLGraphics.switchMode=function(a,g){var p;return a.data.length?(p=a.data[a.data.length-
1],(p.mode!==g||1===g)&&(p=h.WebGLGraphics.graphicsDataPool.pop()||new h.WebGLGraphicsData(a.gl),p.mode=g,a.data.push(p))):(p=h.WebGLGraphics.graphicsDataPool.pop()||new h.WebGLGraphicsData(a.gl),p.mode=g,a.data.push(p)),p.dirty=!0,p};h.WebGLGraphics.buildRectangle=function(a,g){var p=a.shape,l=p.x,m=p.y,b=p.width,p=p.height;if(a.fill){var c=h.hex2rgb(a.fillColor),e=a.fillAlpha,d=c[0]*e,f=c[1]*e,c=c[2]*e,k=g.points,n=g.indices,u=k.length/6;k.push(l,m);k.push(d,f,c,e);k.push(l+b,m);k.push(d,f,c,e);
k.push(l,m+p);k.push(d,f,c,e);k.push(l+b,m+p);k.push(d,f,c,e);n.push(u,u,u+1,u+2,u+3,u+3)}a.lineWidth&&(e=a.points,a.points=[l,m,l+b,m,l+b,m+p,l,m+p,l,m],h.WebGLGraphics.buildLine(a,g),a.points=e)};h.WebGLGraphics.buildRoundedRectangle=function(a,g){var p=a.shape,l=p.x,m=p.y,b=p.width,c=p.height,e=p.radius,p=[];if(p.push(l,m+e),p=p.concat(h.WebGLGraphics.quadraticBezierCurve(l,m+c-e,l,m+c,l+e,m+c)),p=p.concat(h.WebGLGraphics.quadraticBezierCurve(l+b-e,m+c,l+b,m+c,l+b,m+c-e)),p=p.concat(h.WebGLGraphics.quadraticBezierCurve(l+
b,m+e,l+b,m,l+b-e,m)),p=p.concat(h.WebGLGraphics.quadraticBezierCurve(l+e,m,l,m,l,m+e)),a.fill){for(var c=h.hex2rgb(a.fillColor),l=a.fillAlpha,m=c[0]*l,b=c[1]*l,c=c[2]*l,e=g.points,d=g.indices,f=e.length/6,k=h.PolyK.Triangulate(p),n=0,n=0;n<k.length;n+=3)d.push(k[n]+f),d.push(k[n]+f),d.push(k[n+1]+f),d.push(k[n+2]+f),d.push(k[n+2]+f);for(n=0;n<p.length;n++)e.push(p[n],p[++n],m,b,c,l)}a.lineWidth&&(l=a.points,a.points=p,h.WebGLGraphics.buildLine(a,g),a.points=l)};h.WebGLGraphics.quadraticBezierCurve=
function(a,g,h,l,m,b){for(var c,e,d,f,k=[],n=0,u=0;20>=u;u++)n=u/20,c=a+(h-a)*n,e=g+(l-g)*n,d=h+(m-h)*n,f=l+(b-l)*n,c+=(d-c)*n,e+=(f-e)*n,k.push(c,e);return k};h.WebGLGraphics.buildCircle=function(a,g){var p,l,m=a.shape,b=m.x,c=m.y;a.type===h.Graphics.CIRC?(p=m.radius,l=m.radius):(p=m.width,l=m.height);var m=2*Math.PI/40,e=0;if(a.fill){var e=h.hex2rgb(a.fillColor),d=a.fillAlpha,f=e[0]*d,k=e[1]*d,n=e[2]*d,u=g.points,z=g.indices,y=u.length/6;z.push(y);for(e=0;41>e;e++)u.push(b,c,f,k,n,d),u.push(b+Math.sin(m*
e)*p,c+Math.cos(m*e)*l,f,k,n,d),z.push(y++,y++);z.push(y-1)}if(a.lineWidth){d=a.points;a.points=[];for(e=0;41>e;e++)a.points.push(b+Math.sin(m*e)*p,c+Math.cos(m*e)*l);h.WebGLGraphics.buildLine(a,g);a.points=d}};h.WebGLGraphics.buildLine=function(a,g){var p=0,l=a.points;if(0!==l.length){if(a.lineWidth%2)for(p=0;p<l.length;p++)l[p]+=.5;var m=new h.Point(l[0],l[1]),b=new h.Point(l[l.length-2],l[l.length-1]);if(m.x===b.x&&m.y===b.y){l=l.slice();l.pop();l.pop();var b=new h.Point(l[l.length-2],l[l.length-
1]),c=b.x+.5*(m.x-b.x),m=b.y+.5*(m.y-b.y);l.unshift(c,m);l.push(c,m)}var e,d,f,k,n,u,z,y,q,t,x,v,w,r,F,C,D,I,A,c=g.points,m=g.indices,b=l.length/2,G=l.length,H=c.length/6,B=a.lineWidth/2,p=h.hex2rgb(a.lineColor),E=a.lineAlpha,K=p[0]*E,M=p[1]*E,L=p[2]*E;f=l[0];k=l[1];n=l[2];u=l[3];q=-(k-u);t=f-n;A=Math.sqrt(q*q+t*t);q=q/A*B;t=t/A*B;c.push(f-q,k-t,K,M,L,E);c.push(f+q,k+t,K,M,L,E);for(p=1;b-1>p;p++)f=l[2*(p-1)],k=l[2*(p-1)+1],n=l[2*p],u=l[2*p+1],z=l[2*(p+1)],y=l[2*(p+1)+1],q=-(k-u),t=f-n,A=Math.sqrt(q*
q+t*t),q/=A,t/=A,q*=B,t*=B,x=-(u-y),v=n-z,A=Math.sqrt(x*x+v*v),x/=A,v/=A,x*=B,v*=B,F=-t+k-(-t+u),C=-q+n-(-q+f),f=(-q+f)*(-t+u)-(-q+n)*(-t+k),k=-v+y-(-v+u),D=-x+n-(-x+z),z=(-x+z)*(-v+u)-(-x+n)*(-v+y),y=F*D-k*C,.1>Math.abs(y)?(c.push(n-q,u-t,K,M,L,E),c.push(n+q,u+t,K,M,L,E)):(e=(C*z-D*f)/y,d=(k*f-F*z)/y,I=(e-n)*(e-n)+(d-u)+(d-u),19600<I?(w=q-x,r=t-v,A=Math.sqrt(w*w+r*r),w/=A,r/=A,w*=B,r*=B,c.push(n-w,u-r),c.push(K,M,L,E),c.push(n+w,u+r),c.push(K,M,L,E),c.push(n-w,u-r),c.push(K,M,L,E),G++):(c.push(e,
d),c.push(K,M,L,E),c.push(n-(e-n),u-(d-u)),c.push(K,M,L,E)));f=l[2*(b-2)];k=l[2*(b-2)+1];n=l[2*(b-1)];u=l[2*(b-1)+1];q=-(k-u);t=f-n;A=Math.sqrt(q*q+t*t);q/=A;t/=A;q*=B;t*=B;c.push(n-q,u-t);c.push(K,M,L,E);c.push(n+q,u+t);c.push(K,M,L,E);m.push(H);for(p=0;G>p;p++)m.push(H++);m.push(H-1)}};h.WebGLGraphics.buildComplexPoly=function(a,g){var p=a.points.slice();if(!(6>p.length)){var l=g.indices;g.points=p;g.alpha=a.fillAlpha;g.color=h.hex2rgb(a.fillColor);for(var m,b,c=1/0,e=-1/0,d=1/0,f=-1/0,k=0;k<p.length;k+=
2)m=p[k],b=p[k+1],c=c>m?m:c,e=m>e?m:e,d=d>b?b:d,f=b>f?b:f;p.push(c,d,e,d,e,f,c,f);p=p.length/2;for(k=0;p>k;k++)l.push(k)}};h.WebGLGraphics.buildPoly=function(a,g){var p=a.points;if(!(6>p.length)){var l=g.points,m=g.indices,b=p.length/2,c=h.hex2rgb(a.fillColor),e=a.fillAlpha,d=c[0]*e,f=c[1]*e,c=c[2]*e,k=h.PolyK.Triangulate(p);if(!k)return!1;for(var n=l.length/6,u=0,u=0;u<k.length;u+=3)m.push(k[u]+n),m.push(k[u]+n),m.push(k[u+1]+n),m.push(k[u+2]+n),m.push(k[u+2]+n);for(u=0;b>u;u++)l.push(p[2*u],p[2*
u+1],d,f,c,e);return!0}};h.WebGLGraphics.graphicsDataPool=[];h.WebGLGraphicsData=function(a){this.gl=a;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.alpha=this.mode=1;this.dirty=!0};h.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};h.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new h.Float32Array(this.points);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.bufferData(a.ARRAY_BUFFER,
this.glPoints,a.STATIC_DRAW);this.glIndicies=new h.Uint16Array(this.indices);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW);this.dirty=!1};h.glContexts=[];h.instances=[];h.WebGLRenderer=function(a,g,p){if(p)for(var l in h.defaultRenderOptions)"undefined"==typeof p[l]&&(p[l]=h.defaultRenderOptions[l]);else p=h.defaultRenderOptions;h.defaultRenderer||(h.defaultRenderer=this);this.type=h.WEBGL_RENDERER;this.resolution=p.resolution;
this.transparent=p.transparent;this.autoResize=p.autoResize||!1;this.preserveDrawingBuffer=p.preserveDrawingBuffer;this.clearBeforeRender=p.clearBeforeRender;this.width=a||800;this.height=g||600;this.view=p.view||document.createElement("canvas");this.contextLostBound=this.handleContextLost.bind(this);this.contextRestoredBound=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLostBound,!1);this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,
!1);this._contextOptions={alpha:this.transparent,antialias:p.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:p.preserveDrawingBuffer};this.projection=new h.Point;this.offset=new h.Point(0,0);this.shaderManager=new h.WebGLShaderManager;this.spriteBatch=new h.WebGLSpriteBatch;this.maskManager=new h.WebGLMaskManager;this.filterManager=new h.WebGLFilterManager;this.stencilManager=new h.WebGLStencilManager;this.blendModeManager=new h.WebGLBlendModeManager;
this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};
h.WebGLRenderer.prototype.constructor=h.WebGLRenderer;h.WebGLRenderer.prototype.initContext=function(){var a=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=a,!a)throw Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=a.id=h.WebGLRenderer.glContextId++;h.glContexts[this.glContextId]=a;h.instances[this.glContextId]=this;a.disable(a.DEPTH_TEST);a.disable(a.CULL_FACE);a.enable(a.BLEND);
this.shaderManager.setContext(a);this.spriteBatch.setContext(a);this.maskManager.setContext(a);this.filterManager.setContext(a);this.blendModeManager.setContext(a);this.stencilManager.setContext(a);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};h.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(this.__stage=a);a.updateTransform();var g=this.gl;g.viewport(0,0,this.width,this.height);g.bindFramebuffer(g.FRAMEBUFFER,null);this.clearBeforeRender&&
(this.transparent?g.clearColor(0,0,0,0):g.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1),g.clear(g.COLOR_BUFFER_BIT));this.renderDisplayObject(a,this.projection)}};h.WebGLRenderer.prototype.renderDisplayObject=function(a,g,p){this.renderSession.blendModeManager.setBlendMode(h.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=p?-1:1;this.renderSession.projection=g;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);
this.filterManager.begin(this.renderSession,p);a._renderWebGL(this.renderSession);this.spriteBatch.end()};h.WebGLRenderer.prototype.resize=function(a,g){this.width=a*this.resolution;this.height=g*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px");this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=
-this.height/2/this.resolution};h.WebGLRenderer.prototype.updateTexture=function(a){if(a.hasLoaded){var g=this.gl;return a._glTextures[g.id]||(a._glTextures[g.id]=g.createTexture()),g.bindTexture(g.TEXTURE_2D,a._glTextures[g.id]),g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,a.source),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,a.scaleMode===h.scaleModes.LINEAR?g.LINEAR:g.NEAREST),a.mipmap&&h.isPowerOfTwo(a.width,
a.height)?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,a.scaleMode===h.scaleModes.LINEAR?g.LINEAR_MIPMAP_LINEAR:g.NEAREST_MIPMAP_NEAREST),g.generateMipmap(g.TEXTURE_2D)):g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,a.scaleMode===h.scaleModes.LINEAR?g.LINEAR:g.NEAREST),a._powerOf2?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT)):(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,
g.CLAMP_TO_EDGE)),a._dirty[g.id]=!1,a._glTextures[g.id]}};h.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault();this.contextLost=!0};h.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var a in h.TextureCache)h.TextureCache[a].baseTexture._glTextures=[];this.contextLost=!1};h.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound);this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound);
this.offset=this.projection=h.glContexts[this.glContextId]=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.renderSession=this.gl=this.filterManager=this.maskManager=this.spriteBatch=this.shaderManager=null;h.instances[this.glContextId]=null;h.WebGLRenderer.glContextId--};h.WebGLRenderer.prototype.mapBlendModes=function(){var a=this.gl;h.blendModesWebGL||(h.blendModesWebGL=[],h.blendModesWebGL[h.blendModes.NORMAL]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],
h.blendModesWebGL[h.blendModes.ADD]=[a.SRC_ALPHA,a.DST_ALPHA],h.blendModesWebGL[h.blendModes.MULTIPLY]=[a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.SCREEN]=[a.SRC_ALPHA,a.ONE],h.blendModesWebGL[h.blendModes.OVERLAY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.DARKEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.LIGHTEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.COLOR_DODGE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.COLOR_BURN]=
[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.HARD_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.SOFT_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.DIFFERENCE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.EXCLUSION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.HUE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.SATURATION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.COLOR]=[a.ONE,
a.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.LUMINOSITY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA])};h.WebGLRenderer.glContextId=0;h.WebGLBlendModeManager=function(){this.currentBlendMode=99999};h.WebGLBlendModeManager.prototype.constructor=h.WebGLBlendModeManager;h.WebGLBlendModeManager.prototype.setContext=function(a){this.gl=a};h.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;a=h.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(a[0],
a[1]),!0};h.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};h.WebGLMaskManager=function(){};h.WebGLMaskManager.prototype.constructor=h.WebGLMaskManager;h.WebGLMaskManager.prototype.setContext=function(a){this.gl=a};h.WebGLMaskManager.prototype.pushMask=function(a,g){var p=g.gl;a.dirty&&h.WebGLGraphics.updateGraphics(a,p);a._webGL[p.id].data.length&&g.stencilManager.pushStencil(a,a._webGL[p.id].data[0],g)};h.WebGLMaskManager.prototype.popMask=function(a,g){g.stencilManager.popStencil(a,
a._webGL[this.gl.id].data[0],g)};h.WebGLMaskManager.prototype.destroy=function(){this.gl=null};h.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=!0;this.count=0};h.WebGLStencilManager.prototype.setContext=function(a){this.gl=a};h.WebGLStencilManager.prototype.pushStencil=function(a,g,h){var l=this.gl;this.bindGraphics(a,g,h);0===this.stencilStack.length&&(l.enable(l.STENCIL_TEST),l.clear(l.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(g);a=this.count;l.colorMask(!1,
!1,!1,!1);l.stencilFunc(l.ALWAYS,0,255);l.stencilOp(l.KEEP,l.KEEP,l.INVERT);1===g.mode?(l.drawElements(l.TRIANGLE_FAN,g.indices.length-4,l.UNSIGNED_SHORT,0),this.reverse?(l.stencilFunc(l.EQUAL,255-a,255),l.stencilOp(l.KEEP,l.KEEP,l.DECR)):(l.stencilFunc(l.EQUAL,a,255),l.stencilOp(l.KEEP,l.KEEP,l.INCR)),l.drawElements(l.TRIANGLE_FAN,4,l.UNSIGNED_SHORT,2*(g.indices.length-4)),this.reverse?l.stencilFunc(l.EQUAL,255-(a+1),255):l.stencilFunc(l.EQUAL,a+1,255),this.reverse=!this.reverse):(this.reverse?(l.stencilFunc(l.EQUAL,
a,255),l.stencilOp(l.KEEP,l.KEEP,l.INCR)):(l.stencilFunc(l.EQUAL,255-a,255),l.stencilOp(l.KEEP,l.KEEP,l.DECR)),l.drawElements(l.TRIANGLE_STRIP,g.indices.length,l.UNSIGNED_SHORT,0),this.reverse?l.stencilFunc(l.EQUAL,a+1,255):l.stencilFunc(l.EQUAL,255-(a+1),255));l.colorMask(!0,!0,!0,!0);l.stencilOp(l.KEEP,l.KEEP,l.KEEP);this.count++};h.WebGLStencilManager.prototype.bindGraphics=function(a,g,p){this._currentGraphics=a;var l,m=this.gl,b=p.projection,c=p.offset;1===g.mode?(l=p.shaderManager.complexPrimitiveShader,
p.shaderManager.setShader(l),m.uniform1f(l.flipY,p.flipY),m.uniformMatrix3fv(l.translationMatrix,!1,a.worldTransform.toArray(!0)),m.uniform2f(l.projectionVector,b.x,-b.y),m.uniform2f(l.offsetVector,-c.x,-c.y),m.uniform3fv(l.tintColor,h.hex2rgb(a.tint)),m.uniform3fv(l.color,g.color),m.uniform1f(l.alpha,a.worldAlpha*g.alpha),m.bindBuffer(m.ARRAY_BUFFER,g.buffer),m.vertexAttribPointer(l.aVertexPosition,2,m.FLOAT,!1,8,0),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,g.indexBuffer)):(l=p.shaderManager.primitiveShader,
p.shaderManager.setShader(l),m.uniformMatrix3fv(l.translationMatrix,!1,a.worldTransform.toArray(!0)),m.uniform1f(l.flipY,p.flipY),m.uniform2f(l.projectionVector,b.x,-b.y),m.uniform2f(l.offsetVector,-c.x,-c.y),m.uniform3fv(l.tintColor,h.hex2rgb(a.tint)),m.uniform1f(l.alpha,a.worldAlpha),m.bindBuffer(m.ARRAY_BUFFER,g.buffer),m.vertexAttribPointer(l.aVertexPosition,2,m.FLOAT,!1,24,0),m.vertexAttribPointer(l.colorAttribute,4,m.FLOAT,!1,24,8),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,g.indexBuffer))};h.WebGLStencilManager.prototype.popStencil=
function(a,g,h){var l=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)l.disable(l.STENCIL_TEST);else{var m=this.count;this.bindGraphics(a,g,h);l.colorMask(!1,!1,!1,!1);1===g.mode?(this.reverse=!this.reverse,this.reverse?(l.stencilFunc(l.EQUAL,255-(m+1),255),l.stencilOp(l.KEEP,l.KEEP,l.INCR)):(l.stencilFunc(l.EQUAL,m+1,255),l.stencilOp(l.KEEP,l.KEEP,l.DECR)),l.drawElements(l.TRIANGLE_FAN,4,l.UNSIGNED_SHORT,2*(g.indices.length-4)),l.stencilFunc(l.ALWAYS,0,255),l.stencilOp(l.KEEP,
l.KEEP,l.INVERT),l.drawElements(l.TRIANGLE_FAN,g.indices.length-4,l.UNSIGNED_SHORT,0),this.reverse?l.stencilFunc(l.EQUAL,m,255):l.stencilFunc(l.EQUAL,255-m,255)):(this.reverse?(l.stencilFunc(l.EQUAL,m+1,255),l.stencilOp(l.KEEP,l.KEEP,l.DECR)):(l.stencilFunc(l.EQUAL,255-(m+1),255),l.stencilOp(l.KEEP,l.KEEP,l.INCR)),l.drawElements(l.TRIANGLE_STRIP,g.indices.length,l.UNSIGNED_SHORT,0),this.reverse?l.stencilFunc(l.EQUAL,m,255):l.stencilFunc(l.EQUAL,255-m,255));l.colorMask(!0,!0,!0,!0);l.stencilOp(l.KEEP,
l.KEEP,l.KEEP)}};h.WebGLStencilManager.prototype.destroy=function(){this.gl=this.stencilStack=null};h.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var a=0;a<this.maxAttibs;a++)this.attribState[a]=!1;this.stack=[]};h.WebGLShaderManager.prototype.constructor=h.WebGLShaderManager;h.WebGLShaderManager.prototype.setContext=function(a){this.gl=a;this.primitiveShader=new h.PrimitiveShader(a);this.complexPrimitiveShader=new h.ComplexPrimitiveShader(a);this.defaultShader=
new h.PixiShader(a);this.fastShader=new h.PixiFastShader(a);this.stripShader=new h.StripShader(a);this.setShader(this.defaultShader)};h.WebGLShaderManager.prototype.setAttribs=function(a){var g;for(g=0;g<this.tempAttribState.length;g++)this.tempAttribState[g]=!1;for(g=0;g<a.length;g++)this.tempAttribState[a[g]]=!0;a=this.gl;for(g=0;g<this.attribState.length;g++)this.attribState[g]!==this.tempAttribState[g]&&(this.attribState[g]=this.tempAttribState[g],this.tempAttribState[g]?a.enableVertexAttribArray(g):
a.disableVertexAttribArray(g))};h.WebGLShaderManager.prototype.setShader=function(a){return this._currentId===a._UID?!1:(this._currentId=a._UID,this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes),!0)};h.WebGLShaderManager.prototype.destroy=function(){this.tempAttribState=this.attribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};h.WebGLSpriteBatch=
function(){this.vertSize=5;this.size=2E3;var a=6*this.size;this.vertices=new h.ArrayBuffer(16*this.size*this.vertSize);this.positions=new h.Float32Array(this.vertices);this.colors=new h.Uint32Array(this.vertices);this.indices=new h.Uint16Array(a);for(var g=this.lastIndexCount=0,p=0;a>g;g+=6,p+=4)this.indices[g+0]=p+0,this.indices[g+1]=p+1,this.indices[g+2]=p+2,this.indices[g+3]=p+0,this.indices[g+4]=p+2,this.indices[g+5]=p+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=
!0;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new h.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};h.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,
this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW);this.currentBlendMode=99999;var g=new h.PixiShader(a);g.fragmentSrc=this.defaultShader.fragmentSrc;g.uniforms={};g.init();this.defaultShader.shaders[a.id]=g};h.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};h.WebGLSpriteBatch.prototype.end=function(){this.flush()};h.WebGLSpriteBatch.prototype.render=
function(a){var g=a.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=g.baseTexture);var h=g._uvs;if(h){var l,m,b,c;m=a.anchor.x;var e=a.anchor.y;g.trim?(b=g.trim,m=b.x-m*b.width,l=m+g.crop.width,c=b.y-e*b.height,b=c+g.crop.height):(l=g.frame.width*(1-m),m=g.frame.width*-m,b=g.frame.height*(1-e),c=g.frame.height*-e);var e=4*this.currentBatchSize*this.vertSize,d=g.baseTexture.resolution,f=a.worldTransform,g=f.a/d,k=f.b/d,n=f.c/d,d=f.d/d,u=f.tx,z=f.ty,f=this.colors,y=this.positions;
this.renderSession.roundPixels?(y[e]=g*m+n*c+u|0,y[e+1]=d*c+k*m+z|0,y[e+5]=g*l+n*c+u|0,y[e+6]=d*c+k*l+z|0,y[e+10]=g*l+n*b+u|0,y[e+11]=d*b+k*l+z|0,y[e+15]=g*m+n*b+u|0,y[e+16]=d*b+k*m+z|0):(y[e]=g*m+n*c+u,y[e+1]=d*c+k*m+z,y[e+5]=g*l+n*c+u,y[e+6]=d*c+k*l+z,y[e+10]=g*l+n*b+u,y[e+11]=d*b+k*l+z,y[e+15]=g*m+n*b+u,y[e+16]=d*b+k*m+z);y[e+2]=h.x0;y[e+3]=h.y0;y[e+7]=h.x1;y[e+8]=h.y1;y[e+12]=h.x2;y[e+13]=h.y2;y[e+17]=h.x3;y[e+18]=h.y3;h=a.tint;f[e+4]=f[e+9]=f[e+14]=f[e+19]=(h>>16)+(65280&h)+((255&h)<<16)+(255*
a.worldAlpha<<24);this.sprites[this.currentBatchSize++]=a}};h.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var g=a.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=g.baseTexture);a._uvs||(a._uvs=new h.TextureUvs);var p=a._uvs;a.tilePosition.x%=g.baseTexture.width*a.tileScaleOffset.x;a.tilePosition.y%=g.baseTexture.height*a.tileScaleOffset.y;var l=a.tilePosition.x/(g.baseTexture.width*a.tileScaleOffset.x),m=a.tilePosition.y/(g.baseTexture.height*a.tileScaleOffset.y),
b=a.width/g.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),c=a.height/g.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);p.x0=0-l;p.y0=0-m;p.x1=1*b-l;p.y1=0-m;p.x2=1*b-l;p.y2=1*c-m;p.x3=0-l;p.y3=1*c-m;var l=a.tint,l=(l>>16)+(65280&l)+((255&l)<<16)+(255*a.alpha<<24),m=this.positions,b=this.colors,e=a.width,d=a.height,f=a.anchor.x,k=a.anchor.y,c=e*(1-f),e=e*-f,f=d*(1-k),d=d*-k,k=4*this.currentBatchSize*this.vertSize,n=g.baseTexture.resolution,u=a.worldTransform,g=u.a/n,z=u.b/n,y=u.c/n,
n=u.d/n,q=u.tx,u=u.ty;m[k++]=g*e+y*d+q;m[k++]=n*d+z*e+u;m[k++]=p.x0;m[k++]=p.y0;b[k++]=l;m[k++]=g*c+y*d+q;m[k++]=n*d+z*c+u;m[k++]=p.x1;m[k++]=p.y1;b[k++]=l;m[k++]=g*c+y*f+q;m[k++]=n*f+z*c+u;m[k++]=p.x2;m[k++]=p.y2;b[k++]=l;m[k++]=g*e+y*f+q;m[k++]=n*f+z*e+u;m[k++]=p.x3;m[k++]=p.y3;b[k++]=l;this.sprites[this.currentBatchSize++]=a};h.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a,g=this.gl;if(this.dirty){this.dirty=!1;g.activeTexture(g.TEXTURE0);g.bindBuffer(g.ARRAY_BUFFER,
this.vertexBuffer);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a=this.defaultShader.shaders[g.id];var p=4*this.vertSize;g.vertexAttribPointer(a.aVertexPosition,2,g.FLOAT,!1,p,0);g.vertexAttribPointer(a.aTextureCoord,2,g.FLOAT,!1,p,8);g.vertexAttribPointer(a.colorAttribute,4,g.UNSIGNED_BYTE,!0,p,16)}this.currentBatchSize>.5*this.size?g.bufferSubData(g.ARRAY_BUFFER,0,this.vertices):(a=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize),g.bufferSubData(g.ARRAY_BUFFER,0,a));for(var l,
m,b,c,e=p=0,d=null,f=this.renderSession.blendModeManager.currentBlendMode,k=null,n=!1,u=!1,z=0,y=this.currentBatchSize;y>z;z++){if(c=this.sprites[z],l=c.texture.baseTexture,m=c.blendMode,b=c.shader||this.defaultShader,n=f!==m,u=k!==b,(d!==l||n||u)&&(this.renderBatch(d,p,e),e=z,p=0,d=l,n&&(f=m,this.renderSession.blendModeManager.setBlendMode(f)),u)){k=b;(a=k.shaders[g.id])||(a=new h.PixiShader(g),a.fragmentSrc=k.fragmentSrc,a.uniforms=k.uniforms,a.init(),k.shaders[g.id]=a);this.renderSession.shaderManager.setShader(a);
a.dirty&&a.syncUniforms();var q=this.renderSession.projection;g.uniform2f(a.projectionVector,q.x,q.y);q=this.renderSession.offset;g.uniform2f(a.offsetVector,q.x,q.y)}p++}this.renderBatch(d,p,e);this.currentBatchSize=0}};h.WebGLSpriteBatch.prototype.renderBatch=function(a,g,h){if(0!==g){var l=this.gl;a._dirty[l.id]?this.renderSession.renderer.updateTexture(a):l.bindTexture(l.TEXTURE_2D,a._glTextures[l.id]);l.drawElements(l.TRIANGLES,6*g,l.UNSIGNED_SHORT,12*h);this.renderSession.drawCount++}};h.WebGLSpriteBatch.prototype.stop=
function(){this.flush();this.dirty=!0};h.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0};h.WebGLSpriteBatch.prototype.destroy=function(){this.indices=this.vertices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.gl=this.currentBaseTexture=null};h.WebGLFastSpriteBatch=function(a){this.vertSize=10;this.size=this.maxSize=6E3;var g=6*this.maxSize;this.vertices=new h.Float32Array(4*this.size*this.vertSize);this.indices=new h.Uint16Array(g);this.indexBuffer=
this.vertexBuffer=null;for(var p=this.lastIndexCount=0,l=0;g>p;p+=6,l+=4)this.indices[p+0]=l+0,this.indices[p+1]=l+1,this.indices[p+2]=l+2,this.indices[p+3]=l+0,this.indices[p+4]=l+2,this.indices[p+5]=l+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.matrix=this.shader=this.renderSession=null;this.setContext(a)};h.WebGLFastSpriteBatch.prototype.constructor=h.WebGLFastSpriteBatch;h.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=
a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW)};h.WebGLFastSpriteBatch.prototype.begin=function(a,g){this.renderSession=g;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=a.worldTransform.toArray(!0);this.start()};h.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};
h.WebGLFastSpriteBatch.prototype.render=function(a){a=a.children;var g=a[0];if(g.texture._uvs){this.currentBaseTexture=g.texture.baseTexture;g.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(g.blendMode));for(var g=0,h=a.length;h>g;g++)this.renderSprite(a[g]);this.flush()}};h.WebGLFastSpriteBatch.prototype.renderSprite=function(a){if(a.visible&&(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=
a.texture.baseTexture,a.texture._uvs))){var g,h,l,m,b,c,e=this.vertices;(g=a.texture._uvs,a.texture.trim)?(m=a.texture.trim,l=m.x-a.anchor.x*m.width,h=l+a.texture.crop.width,b=m.y-a.anchor.y*m.height,m=b+a.texture.crop.height):(h=a.texture.frame.width*(1-a.anchor.x),l=a.texture.frame.width*-a.anchor.x,m=a.texture.frame.height*(1-a.anchor.y),b=a.texture.frame.height*-a.anchor.y);c=4*this.currentBatchSize*this.vertSize;e[c++]=l;e[c++]=b;e[c++]=a.position.x;e[c++]=a.position.y;e[c++]=a.scale.x;e[c++]=
a.scale.y;e[c++]=a.rotation;e[c++]=g.x0;e[c++]=g.y1;e[c++]=a.alpha;e[c++]=h;e[c++]=b;e[c++]=a.position.x;e[c++]=a.position.y;e[c++]=a.scale.x;e[c++]=a.scale.y;e[c++]=a.rotation;e[c++]=g.x1;e[c++]=g.y1;e[c++]=a.alpha;e[c++]=h;e[c++]=m;e[c++]=a.position.x;e[c++]=a.position.y;e[c++]=a.scale.x;e[c++]=a.scale.y;e[c++]=a.rotation;e[c++]=g.x2;e[c++]=g.y2;e[c++]=a.alpha;e[c++]=l;e[c++]=m;e[c++]=a.position.x;e[c++]=a.position.y;e[c++]=a.scale.x;e[c++]=a.scale.y;e[c++]=a.rotation;e[c++]=g.x3;e[c++]=g.y3;e[c++]=
a.alpha;this.currentBatchSize++;this.currentBatchSize>=this.size&&this.flush()}};h.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var g=this.vertices.subarray(0,4*this.currentBatchSize*
this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,g)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++}};h.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};h.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var g=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,
g.x,g.y);a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);g=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,g,0);a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,g,8);a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,g,16);a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,g,24);a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,g,28);a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,!1,g,36)};h.WebGLFilterManager=function(){this.filterStack=
[];this.offsetY=this.offsetX=0};h.WebGLFilterManager.prototype.constructor=h.WebGLFilterManager;h.WebGLFilterManager.prototype.setContext=function(a){this.gl=a;this.texturePool=[];this.initShaderBuffers()};h.WebGLFilterManager.prototype.begin=function(a,g){this.renderSession=a;this.defaultShader=a.shaderManager.defaultShader;var h=this.renderSession.projection;this.width=2*h.x;this.height=2*-h.y;this.buffer=g};h.WebGLFilterManager.prototype.pushFilter=function(a){var g=this.gl,p=this.renderSession.projection,
l=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds();this.filterStack.push(a);var m=a.filterPasses[0];this.offsetX+=a._filterArea.x;this.offsetY+=a._filterArea.y;var b=this.texturePool.pop();b?b.resize(this.width,this.height):b=new h.FilterTexture(this.gl,this.width,this.height);g.bindTexture(g.TEXTURE_2D,b.texture);var c=a._filterArea,m=m.padding;c.x-=m;c.y-=m;c.width+=2*m;c.height+=2*m;0>c.x&&(c.x=0);c.width>this.width&&(c.width=this.width);0>c.y&&(c.y=0);c.height>
this.height&&(c.height=this.height);g.bindFramebuffer(g.FRAMEBUFFER,b.frameBuffer);g.viewport(0,0,c.width,c.height);p.x=c.width/2;p.y=-c.height/2;l.x=-c.x;l.y=-c.y;g.colorMask(!0,!0,!0,!0);g.clearColor(0,0,0,0);g.clear(g.COLOR_BUFFER_BIT);a._glFilterTexture=b};h.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,g=this.filterStack.pop(),p=g._filterArea,l=g._glFilterTexture,m=this.renderSession.projection,b=this.renderSession.offset;if(1<g.filterPasses.length){a.viewport(0,0,p.width,p.height);
a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=p.height;this.vertexArray[2]=p.width;this.vertexArray[3]=p.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=p.width;this.vertexArray[7]=0;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=p.width/this.width;this.uvArray[5]=p.height/this.height;this.uvArray[6]=p.width/this.width;this.uvArray[7]=p.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,
0,this.uvArray);var c=this.texturePool.pop();c||(c=new h.FilterTexture(this.gl,this.width,this.height));c.resize(this.width,this.height);a.bindFramebuffer(a.FRAMEBUFFER,c.frameBuffer);a.clear(a.COLOR_BUFFER_BIT);a.disable(a.BLEND);for(var e=0;e<g.filterPasses.length-1;e++){var d=g.filterPasses[e];a.bindFramebuffer(a.FRAMEBUFFER,c.frameBuffer);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,l.texture);this.applyFilterPass(d,p,p.width,p.height);d=l;l=c;c=d}a.enable(a.BLEND);this.texturePool.push(c)}c=
g.filterPasses[g.filterPasses.length-1];this.offsetX-=p.x;this.offsetY-=p.y;var e=this.width,d=this.height,f=0,k=0,n=this.buffer;0===this.filterStack.length?a.colorMask(!0,!0,!0,!0):(n=this.filterStack[this.filterStack.length-1],p=n._filterArea,e=p.width,d=p.height,f=p.x,k=p.y,n=n._glFilterTexture.frameBuffer);m.x=e/2;m.y=-d/2;b.x=f;b.y=k;p=g._filterArea;m=p.x-f;b=p.y-k;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=m;this.vertexArray[1]=b+p.height;this.vertexArray[2]=m+p.width;
this.vertexArray[3]=b+p.height;this.vertexArray[4]=m;this.vertexArray[5]=b;this.vertexArray[6]=m+p.width;this.vertexArray[7]=b;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=p.width/this.width;this.uvArray[5]=p.height/this.height;this.uvArray[6]=p.width/this.width;this.uvArray[7]=p.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);a.viewport(0,0,e*this.renderSession.resolution,d*this.renderSession.resolution);a.bindFramebuffer(a.FRAMEBUFFER,
n);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,l.texture);this.applyFilterPass(c,p,e,d);this.texturePool.push(l);g._glFilterTexture=null};h.WebGLFilterManager.prototype.applyFilterPass=function(a,g,p,l){g=this.gl;var m=a.shaders[g.id];m||(m=new h.PixiShader(g),m.fragmentSrc=a.fragmentSrc,m.uniforms=a.uniforms,m.init(),a.shaders[g.id]=m);this.renderSession.shaderManager.setShader(m);g.uniform2f(m.projectionVector,p/2,-l/2);g.uniform2f(m.offsetVector,0,0);a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=
this.width,a.uniforms.dimensions.value[1]=this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],a.uniforms.dimensions.value[3]=this.vertexArray[5]);m.syncUniforms();g.bindBuffer(g.ARRAY_BUFFER,this.vertexBuffer);g.vertexAttribPointer(m.aVertexPosition,2,g.FLOAT,!1,0,0);g.bindBuffer(g.ARRAY_BUFFER,this.uvBuffer);g.vertexAttribPointer(m.aTextureCoord,2,g.FLOAT,!1,0,0);g.bindBuffer(g.ARRAY_BUFFER,this.colorBuffer);g.vertexAttribPointer(m.colorAttribute,2,g.FLOAT,!1,0,0);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,
this.indexBuffer);g.drawElements(g.TRIANGLES,6,g.UNSIGNED_SHORT,0);this.renderSession.drawCount++};h.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer();this.uvBuffer=a.createBuffer();this.colorBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.vertexArray=new h.Float32Array([0,0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW);this.uvArray=new h.Float32Array([0,
0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW);this.colorArray=new h.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)};h.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;
this.filterStack=null;for(var g=this.offsetY=this.offsetX=0;g<this.texturePool.length;g++)this.texturePool[g].destroy();this.texturePool=null;a.deleteBuffer(this.vertexBuffer);a.deleteBuffer(this.uvBuffer);a.deleteBuffer(this.colorBuffer);a.deleteBuffer(this.indexBuffer)};h.FilterTexture=function(a,g,p,l){this.gl=a;this.frameBuffer=a.createFramebuffer();this.texture=a.createTexture();l=l||h.scaleModes.DEFAULT;a.bindTexture(a.TEXTURE_2D,this.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,
l===h.scaleModes.LINEAR?a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,l===h.scaleModes.LINEAR?a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer);a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);this.renderBuffer=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,
this.renderBuffer);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderBuffer);this.resize(g,p)};h.FilterTexture.prototype.constructor=h.FilterTexture;h.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT)};h.FilterTexture.prototype.resize=function(a,g){if(this.width!==a||this.height!==g){this.width=a;this.height=g;var h=this.gl;h.bindTexture(h.TEXTURE_2D,this.texture);h.texImage2D(h.TEXTURE_2D,0,h.RGBA,a,
g,0,h.RGBA,h.UNSIGNED_BYTE,null);h.bindRenderbuffer(h.RENDERBUFFER,this.renderBuffer);h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,a,g)}};h.FilterTexture.prototype.destroy=function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer);a.deleteTexture(this.texture);this.texture=this.frameBuffer=null};h.CanvasBuffer=function(a,g){this.width=a;this.height=g;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=a;this.canvas.height=g};h.CanvasBuffer.prototype.constructor=
h.CanvasBuffer;h.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};h.CanvasBuffer.prototype.resize=function(a,g){this.width=this.canvas.width=a;this.height=this.canvas.height=g};h.CanvasMaskManager=function(){};h.CanvasMaskManager.prototype.constructor=h.CanvasMaskManager;h.CanvasMaskManager.prototype.pushMask=function(a,g){var p=g.context;p.save();var l=a.alpha,m=a.worldTransform,b=g.resolution;p.setTransform(m.a*b,
m.b*b,m.c*b,m.d*b,m.tx*b,m.ty*b);h.CanvasGraphics.renderGraphicsMask(a,p);p.clip();a.worldAlpha=l};h.CanvasMaskManager.prototype.popMask=function(a){a.context.restore()};h.CanvasTinter=function(){};h.CanvasTinter.getTintedTexture=function(a,g){var p=a.texture,l=h.CanvasTinter.canvas||document.createElement("canvas");(h.CanvasTinter.tintMethod(p,g,l),h.CanvasTinter.convertTintToImage)?(new Image).src=l.toDataURL():h.CanvasTinter.canvas=null;return l};h.CanvasTinter.tintWithMultiply=function(a,g,h){var l=
h.getContext("2d"),m=a.crop;h.width=m.width;h.height=m.height;l.fillStyle="#"+("00000"+(0|g).toString(16)).substr(-6);l.fillRect(0,0,m.width,m.height);l.globalCompositeOperation="multiply";l.drawImage(a.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height);l.globalCompositeOperation="destination-atop";l.drawImage(a.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height)};h.CanvasTinter.tintWithOverlay=function(a,g,h){var l=h.getContext("2d"),m=a.crop;h.width=m.width;h.height=
m.height;l.globalCompositeOperation="copy";l.fillStyle="#"+("00000"+(0|g).toString(16)).substr(-6);l.fillRect(0,0,m.width,m.height);l.globalCompositeOperation="destination-atop";l.drawImage(a.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height)};h.CanvasTinter.tintWithPerPixel=function(a,g,p){var l=p.getContext("2d"),m=a.crop;p.width=m.width;p.height=m.height;l.globalCompositeOperation="copy";l.drawImage(a.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height);p=h.hex2rgb(g);
a=p[0];g=p[1];p=p[2];for(var m=l.getImageData(0,0,m.width,m.height),b=m.data,c=0;c<b.length;c+=4)if(b[c+0]*=a,b[c+1]*=g,b[c+2]*=p,!h.CanvasTinter.canHandleAlpha){var e=b[c+3];b[c+0]/=255/e;b[c+1]/=255/e;b[c+2]/=255/e}l.putImageData(m,0,0)};h.CanvasTinter.roundColor=function(a){var g=h.CanvasTinter.cacheStepsPerColorChannel;a=h.hex2rgb(a);return a[0]=Math.min(255,a[0]/g*g),a[1]=Math.min(255,a[1]/g*g),a[2]=Math.min(255,a[2]/g*g),h.rgb2hex(a)};h.CanvasTinter.checkInverseAlpha=function(){var a=new h.CanvasBuffer(2,
1);a.context.fillStyle="rgba(10, 20, 30, 0.5)";a.context.fillRect(0,0,1,1);var g=a.context.getImageData(0,0,1,1);a.context.putImageData(g,1,0);a=a.context.getImageData(1,0,1,1);return a.data[0]===g.data[0]&&a.data[1]===g.data[1]&&a.data[2]===g.data[2]&&a.data[3]===g.data[3]};h.CanvasTinter.cacheStepsPerColorChannel=8;h.CanvasTinter.convertTintToImage=!1;h.CanvasTinter.canHandleAlpha=h.CanvasTinter.checkInverseAlpha();h.CanvasTinter.canUseMultiply=h.canUseNewCanvasBlendModes();h.CanvasTinter.tintMethod=
h.CanvasTinter.canUseMultiply?h.CanvasTinter.tintWithMultiply:h.CanvasTinter.tintWithPerPixel;h.CanvasRenderer=function(a,g,p){if(p)for(var l in h.defaultRenderOptions)"undefined"==typeof p[l]&&(p[l]=h.defaultRenderOptions[l]);else p=h.defaultRenderOptions;h.defaultRenderer||(h.defaultRenderer=this);this.type=h.CANVAS_RENDERER;this.resolution=p.resolution;this.clearBeforeRender=p.clearBeforeRender;this.transparent=p.transparent;this.autoResize=p.autoResize||!1;this.width=a||800;this.height=g||600;
this.width*=this.resolution;this.height*=this.resolution;this.view=p.view||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.view.width=this.width*this.resolution;this.view.height=this.height*this.resolution;this.count=0;this.maskManager=new h.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1};this.mapBlendModes();this.resize(a,g);"imageSmoothingEnabled"in
this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")};h.CanvasRenderer.prototype.constructor=
h.CanvasRenderer;h.CanvasRenderer.prototype.render=function(a){a.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=h.blendModes.NORMAL;this.context.globalCompositeOperation=h.blendModesCanvas[h.blendModes.NORMAL];navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=a.backgroundColorString,
this.context.fillRect(0,0,this.width,this.height)));this.renderDisplayObject(a)};h.CanvasRenderer.prototype.destroy=function(a){"undefined"==typeof a&&(a=!0);a&&this.view.parent&&this.view.parent.removeChild(this.view);this.renderSession=this.maskManager=this.context=this.view=null};h.CanvasRenderer.prototype.resize=function(a,g){this.width=a*this.resolution;this.height=g*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+
"px",this.view.style.height=this.height/this.resolution+"px")};h.CanvasRenderer.prototype.renderDisplayObject=function(a,g){this.renderSession.context=g||this.context;this.renderSession.resolution=this.resolution;a._renderCanvas(this.renderSession)};h.CanvasRenderer.prototype.mapBlendModes=function(){h.blendModesCanvas||(h.blendModesCanvas=[],h.canUseNewCanvasBlendModes()?(h.blendModesCanvas[h.blendModes.NORMAL]="source-over",h.blendModesCanvas[h.blendModes.ADD]="lighter",h.blendModesCanvas[h.blendModes.MULTIPLY]=
"multiply",h.blendModesCanvas[h.blendModes.SCREEN]="screen",h.blendModesCanvas[h.blendModes.OVERLAY]="overlay",h.blendModesCanvas[h.blendModes.DARKEN]="darken",h.blendModesCanvas[h.blendModes.LIGHTEN]="lighten",h.blendModesCanvas[h.blendModes.COLOR_DODGE]="color-dodge",h.blendModesCanvas[h.blendModes.COLOR_BURN]="color-burn",h.blendModesCanvas[h.blendModes.HARD_LIGHT]="hard-light",h.blendModesCanvas[h.blendModes.SOFT_LIGHT]="soft-light",h.blendModesCanvas[h.blendModes.DIFFERENCE]="difference",h.blendModesCanvas[h.blendModes.EXCLUSION]=
"exclusion",h.blendModesCanvas[h.blendModes.HUE]="hue",h.blendModesCanvas[h.blendModes.SATURATION]="saturation",h.blendModesCanvas[h.blendModes.COLOR]="color",h.blendModesCanvas[h.blendModes.LUMINOSITY]="luminosity"):(h.blendModesCanvas[h.blendModes.NORMAL]="source-over",h.blendModesCanvas[h.blendModes.ADD]="lighter",h.blendModesCanvas[h.blendModes.MULTIPLY]="source-over",h.blendModesCanvas[h.blendModes.SCREEN]="source-over",h.blendModesCanvas[h.blendModes.OVERLAY]="source-over",h.blendModesCanvas[h.blendModes.DARKEN]=
"source-over",h.blendModesCanvas[h.blendModes.LIGHTEN]="source-over",h.blendModesCanvas[h.blendModes.COLOR_DODGE]="source-over",h.blendModesCanvas[h.blendModes.COLOR_BURN]="source-over",h.blendModesCanvas[h.blendModes.HARD_LIGHT]="source-over",h.blendModesCanvas[h.blendModes.SOFT_LIGHT]="source-over",h.blendModesCanvas[h.blendModes.DIFFERENCE]="source-over",h.blendModesCanvas[h.blendModes.EXCLUSION]="source-over",h.blendModesCanvas[h.blendModes.HUE]="source-over",h.blendModesCanvas[h.blendModes.SATURATION]=
"source-over",h.blendModesCanvas[h.blendModes.COLOR]="source-over",h.blendModesCanvas[h.blendModes.LUMINOSITY]="source-over"))};h.CanvasGraphics=function(){};h.CanvasGraphics.renderGraphics=function(a,g){var p=a.worldAlpha;a.dirty&&(this.updateGraphicsTint(a),a.dirty=!1);for(var l=0;l<a.graphicsData.length;l++){var m=a.graphicsData[l],b=m.shape,c=m._fillTint,e=m._lineTint;if(g.lineWidth=m.lineWidth,m.type===h.Graphics.POLY){g.beginPath();var d=b.points;g.moveTo(d[0],d[1]);for(var f=1;f<d.length/2;f++)g.lineTo(d[2*
f],d[2*f+1]);b.closed&&g.lineTo(d[0],d[1]);d[0]===d[d.length-2]&&d[1]===d[d.length-1]&&g.closePath();m.fill&&(g.globalAlpha=m.fillAlpha*p,g.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),g.fill());m.lineWidth&&(g.globalAlpha=m.lineAlpha*p,g.strokeStyle="#"+("00000"+(0|e).toString(16)).substr(-6),g.stroke())}else if(m.type===h.Graphics.RECT)(m.fillColor||0===m.fillColor)&&(g.globalAlpha=m.fillAlpha*p,g.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),g.fillRect(b.x,b.y,b.width,b.height)),
m.lineWidth&&(g.globalAlpha=m.lineAlpha*p,g.strokeStyle="#"+("00000"+(0|e).toString(16)).substr(-6),g.strokeRect(b.x,b.y,b.width,b.height));else if(m.type===h.Graphics.CIRC)g.beginPath(),g.arc(b.x,b.y,b.radius,0,2*Math.PI),g.closePath(),m.fill&&(g.globalAlpha=m.fillAlpha*p,g.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),g.fill()),m.lineWidth&&(g.globalAlpha=m.lineAlpha*p,g.strokeStyle="#"+("00000"+(0|e).toString(16)).substr(-6),g.stroke());else if(m.type===h.Graphics.ELIP){var k=2*b.width,
f=2*b.height,d=b.x-k/2,b=b.y-f/2;g.beginPath();var n=k/2*.5522848,u=f/2*.5522848,z=d+k,y=b+f,k=d+k/2,f=b+f/2;g.moveTo(d,f);g.bezierCurveTo(d,f-u,k-n,b,k,b);g.bezierCurveTo(k+n,b,z,f-u,z,f);g.bezierCurveTo(z,f+u,k+n,y,k,y);g.bezierCurveTo(k-n,y,d,f+u,d,f);g.closePath();m.fill&&(g.globalAlpha=m.fillAlpha*p,g.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),g.fill());m.lineWidth&&(g.globalAlpha=m.lineAlpha*p,g.strokeStyle="#"+("00000"+(0|e).toString(16)).substr(-6),g.stroke())}else m.type===h.Graphics.RREC&&
(d=b.x,f=b.y,n=b.width,u=b.height,b=b.radius,z=Math.min(n,u)/2|0,b=b>z?z:b,g.beginPath(),g.moveTo(d,f+b),g.lineTo(d,f+u-b),g.quadraticCurveTo(d,f+u,d+b,f+u),g.lineTo(d+n-b,f+u),g.quadraticCurveTo(d+n,f+u,d+n,f+u-b),g.lineTo(d+n,f+b),g.quadraticCurveTo(d+n,f,d+n-b,f),g.lineTo(d+b,f),g.quadraticCurveTo(d,f,d,f+b),g.closePath(),(m.fillColor||0===m.fillColor)&&(g.globalAlpha=m.fillAlpha*p,g.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),g.fill()),m.lineWidth&&(g.globalAlpha=m.lineAlpha*p,g.strokeStyle=
"#"+("00000"+(0|e).toString(16)).substr(-6),g.stroke()))}};h.CanvasGraphics.renderGraphicsMask=function(a,g){var p=a.graphicsData.length;if(0!==p){g.beginPath();for(var l=0;p>l;l++){var m=a.graphicsData[l],b=m.shape;if(m.type===h.Graphics.POLY){m=b.points;g.moveTo(m[0],m[1]);for(var c=1;c<m.length/2;c++)g.lineTo(m[2*c],m[2*c+1]);m[0]===m[m.length-2]&&m[1]===m[m.length-1]&&g.closePath()}else if(m.type===h.Graphics.RECT)g.rect(b.x,b.y,b.width,b.height),g.closePath();else if(m.type===h.Graphics.CIRC)g.arc(b.x,
b.y,b.radius,0,2*Math.PI),g.closePath();else if(m.type===h.Graphics.ELIP){var e=2*b.width,c=2*b.height,m=b.x-e/2,b=b.y-c/2,d=e/2*.5522848,f=c/2*.5522848,k=m+e,n=b+c,e=m+e/2,c=b+c/2;g.moveTo(m,c);g.bezierCurveTo(m,c-f,e-d,b,e,b);g.bezierCurveTo(e+d,b,k,c-f,k,c);g.bezierCurveTo(k,c+f,e+d,n,e,n);g.bezierCurveTo(e-d,n,m,c+f,m,c);g.closePath()}else m.type===h.Graphics.RREC&&(m=b.x,c=b.y,d=b.width,f=b.height,b=b.radius,k=Math.min(d,f)/2|0,b=b>k?k:b,g.moveTo(m,c+b),g.lineTo(m,c+f-b),g.quadraticCurveTo(m,
c+f,m+b,c+f),g.lineTo(m+d-b,c+f),g.quadraticCurveTo(m+d,c+f,m+d,c+f-b),g.lineTo(m+d,c+b),g.quadraticCurveTo(m+d,c,m+d-b,c),g.lineTo(m+b,c),g.quadraticCurveTo(m,c,m,c+b),g.closePath())}}};h.CanvasGraphics.updateGraphicsTint=function(a){if(16777215!==a.tint)for(var g=(a.tint>>16&255)/255,h=(a.tint>>8&255)/255,l=(255&a.tint)/255,m=0;m<a.graphicsData.length;m++){var b=a.graphicsData[m],c=0|b.fillColor,e=0|b.lineColor;b._fillTint=((c>>16&255)/255*g*255<<16)+((c>>8&255)/255*h*255<<8)+(255&c)/255*l*255;
b._lineTint=((e>>16&255)/255*g*255<<16)+((e>>8&255)/255*h*255<<8)+(255&e)/255*l*255}};h.Graphics=function(){h.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineColor=this.lineWidth=0;this.graphicsData=[];this.tint=16777215;this.blendMode=h.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=!1;this.boundsPadding=0;this._localBounds=new h.Rectangle(0,0,1,1);this.dirty=!0;this.cachedSpriteDirty=this.webGLDirty=!1};h.Graphics.prototype=Object.create(h.DisplayObjectContainer.prototype);
h.Graphics.prototype.constructor=h.Graphics;h.Graphics.prototype.lineStyle=function(a,g,p){return this.lineWidth=a||0,this.lineColor=g||0,this.lineAlpha=void 0===p?1:p,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new h.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this};h.Graphics.prototype.moveTo=function(a,g){return this.drawShape(new h.Polygon([a,
g])),this};h.Graphics.prototype.lineTo=function(a,g){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(a,g),this.dirty=!0,this};h.Graphics.prototype.quadraticCurveTo=function(a,g,h,l){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var m,b,c=this.currentPath.shape.points;0===c.length&&this.moveTo(0,0);for(var e=c[c.length-2],d=c[c.length-1],f=0,k=1;20>=k;++k)f=k/20,m=e+(a-e)*f,b=d+(g-d)*f,c.push(m+(a+(h-a)*
f-m)*f,b+(g+(l-g)*f-b)*f);return this.dirty=!0,this};h.Graphics.prototype.bezierCurveTo=function(a,g,h,l,m,b){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var c,e,d,f,k,n=this.currentPath.shape.points,u=n[n.length-2],z=n[n.length-1],y=0,q=1;20>=q;++q)y=q/20,c=1-y,e=c*c,d=e*c,f=y*y,k=f*y,n.push(d*u+3*e*y*a+3*c*f*h+k*m,d*z+3*e*y*g+3*c*f*l+k*b);return this.dirty=!0,this};h.Graphics.prototype.arcTo=function(a,g,h,l,m){this.currentPath?
0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(a,g):this.moveTo(a,g);var b=this.currentPath.shape.points,c=b[b.length-1]-g,e=b[b.length-2]-a;l-=g;h-=a;var d=Math.abs(c*h-e*l);if(1E-8>d||0===m)b[b.length-2]===a&&b[b.length-1]===g||b.push(a,g);else{var f=c*c+e*e,k=l*l+h*h,n=c*l+e*h,b=m*Math.sqrt(f)/d,d=m*Math.sqrt(k)/d,f=b*n/f,u=d*n/k,k=b*h+d*e,n=b*l+d*c,z=h*(b+u),b=l*(b+u),d=Math.atan2(c*(d+f)-n,e*(d+f)-k),b=Math.atan2(b-n,z-k);this.arc(k+a,n+g,m,d,b,e*l>h*c)}return this.dirty=
!0,this};h.Graphics.prototype.arc=function(a,g,h,l,m,b){if(l===m)return this;"undefined"==typeof b&&(b=!1);!b&&l>=m?m+=2*Math.PI:b&&m>=l&&(l+=2*Math.PI);m=b?-1*(l-m):m-l;var c=40*Math.ceil(Math.abs(m)/(2*Math.PI));if(0===m)return this;var e=a+Math.cos(l)*h,d=g+Math.sin(l)*h;b&&this.filling?this.moveTo(a,g):this.moveTo(e,d);b=this.currentPath.shape.points;m/=2*c;for(var e=2*m,d=Math.cos(m),f=Math.sin(m),c=c-1,k=c%1/c,n=0;c>=n;n++){var u=m+l+e*(n+k*n),z=Math.cos(u),u=-Math.sin(u);b.push((d*z+f*u)*h+
a,(d*-u+f*z)*h+g)}return this.dirty=!0,this};h.Graphics.prototype.beginFill=function(a,g){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=void 0===g?1:g,this.currentPath&&2>=this.currentPath.shape.points.length&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this};h.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this};h.Graphics.prototype.drawRect=function(a,g,p,l){return this.drawShape(new h.Rectangle(a,
g,p,l)),this};h.Graphics.prototype.drawRoundedRect=function(a,g,p,l,m){return this.drawShape(new h.RoundedRectangle(a,g,p,l,m)),this};h.Graphics.prototype.drawCircle=function(a,g,p){return this.drawShape(new h.Circle(a,g,p)),this};h.Graphics.prototype.drawEllipse=function(a,g,p,l){return this.drawShape(new h.Ellipse(a,g,p,l)),this};h.Graphics.prototype.drawPolygon=function(a){var g=a;if(!Array.isArray(g))for(var g=Array(arguments.length),h=0;h<g.length;++h)g[h]=arguments[h];return this.drawShape(new Phaser.Polygon(g)),
this};h.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this};h.Graphics.prototype.generateTexture=function(a,g){a=a||1;var p=this.getBounds(),l=new h.CanvasBuffer(p.width*a,p.height*a),m=h.Texture.fromCanvas(l.canvas,g);return m.baseTexture.resolution=a,l.context.scale(a,a),l.context.translate(-p.x,-p.y),h.CanvasGraphics.renderGraphics(this,l.context),m};h.Graphics.prototype._renderWebGL=function(a){if(!1!==this.visible&&
0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void h.Sprite.prototype._renderWebGL.call(this._cachedSprite,a);if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==
a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var g=h.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(g[0],g[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),h.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(g=0;g<this.children.length;g++)this.children[g]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(this.mask,a);a.drawCount++;
a.spriteBatch.start()}};h.Graphics.prototype._renderCanvas=function(a){if(!0!==this.isMask){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void h.Sprite.prototype._renderCanvas.call(this._cachedSprite,a);var g=a.context,p=this.worldTransform;this.blendMode!==a.currentBlendMode&&
(a.currentBlendMode=this.blendMode,g.globalCompositeOperation=h.blendModesCanvas[a.currentBlendMode]);this._mask&&a.maskManager.pushMask(this._mask,a);var l=a.resolution;g.setTransform(p.a*l,p.b*l,p.c*l,p.d*l,p.tx*l,p.ty*l);h.CanvasGraphics.renderGraphics(this,g);for(g=0;g<this.children.length;g++)this.children[g]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}};h.Graphics.prototype.getBounds=function(a){if(!this._currentBounds){if(!this.renderable)return h.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),
this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var g=this._localBounds,p=g.x,l=g.width+g.x,m=g.y,b=g.height+g.y;a=a||this.worldTransform;var c=a.a,e=a.b,d=a.c,f=a.d,k=a.tx,n=a.ty,u=c*l+d*b+k,g=f*b+e*l+n;a=c*p+d*b+k;var b=f*b+e*p+n,z=c*p+d*m+k,p=f*m+e*p+n,c=c*l+d*m+k,l=f*m+e*l+n,m=u,e=g,u=u>a?a:u,u=u>z?z:u,u=u>c?c:u,g=g>b?b:g,g=g>p?p:g,g=g>l?l:g,m=a>m?a:m,m=z>m?z:m,e=b>e?b:e,e=p>e?p:e;this._bounds.x=u;this._bounds.width=(c>m?c:m)-u;this._bounds.y=g;this._bounds.height=(l>e?l:e)-g;this._currentBounds=
this._bounds}return this._currentBounds};h.Graphics.prototype.containsPoint=function(a){this.worldTransform.applyInverse(a,tempPoint);a=this.graphicsData;for(var g=0;g<a.length;g++){var h=a[g];if(h.fill&&h.shape&&h.shape.contains(tempPoint.x,tempPoint.y))return!0}return!1};h.Graphics.prototype.updateLocalBounds=function(){var a=1/0,g=-1/0,p=1/0,l=-1/0;if(this.graphicsData.length)for(var m,b,c,e,d,f=0;f<this.graphicsData.length;f++)if(m=this.graphicsData[f],e=m.type,d=m.lineWidth,m=m.shape,e===h.Graphics.RECT||
e===h.Graphics.RREC)b=m.x-d/2,c=m.y-d/2,e=m.width+d,d=m.height+d,a=a>b?b:a,g=b+e>g?b+e:g,p=p>c?c:p,l=c+d>l?c+d:l;else if(e===h.Graphics.CIRC)b=m.x,c=m.y,e=m.radius+d/2,d=m.radius+d/2,a=a>b-e?b-e:a,g=b+e>g?b+e:g,p=p>c-d?c-d:p,l=c+d>l?c+d:l;else if(e===h.Graphics.ELIP)b=m.x,c=m.y,e=m.width+d/2,d=m.height+d/2,a=a>b-e?b-e:a,g=b+e>g?b+e:g,p=p>c-d?c-d:p,l=c+d>l?c+d:l;else for(m=m.points,e=0;e<m.length;e++)m[e]instanceof Phaser.Point?(b=m[e].x,c=m[e].y):(b=m[e],c=m[e+1],e<m.length-1&&e++),a=a>b-d?b-d:a,
g=b+d>g?b+d:g,p=p>c-d?c-d:p,l=c+d>l?c+d:l;else l=p=g=a=0;b=this.boundsPadding;this._localBounds.x=a-b;this._localBounds.width=g-a+2*b;this._localBounds.y=p-b;this._localBounds.height=l-p+2*b};h.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var g=new h.CanvasBuffer(a.width,a.height),p=h.Texture.fromCanvas(g.canvas);this._cachedSprite=new h.Sprite(p);this._cachedSprite.buffer=g;this._cachedSprite.worldTransform=
this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._cachedSprite.buffer.context.translate(-a.x,-a.y);this.worldAlpha=1;h.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};h.Graphics.prototype.updateCachedSpriteTexture=function(){var a=this._cachedSprite,g=a.texture,h=a.buffer.canvas;g.baseTexture.width=h.width;g.baseTexture.height=h.height;g.crop.width=g.frame.width=h.width;g.crop.height=
g.frame.height=h.height;a._width=h.width;a._height=h.height;g.baseTexture.dirty()};h.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};h.Graphics.prototype.drawShape=function(a){this.currentPath&&2>=this.currentPath.shape.points.length&&this.graphicsData.pop();this.currentPath=null;a instanceof h.Polygon&&a.flatten();a=new h.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,a);return this.graphicsData.push(a),
a.type===h.Graphics.POLY&&(a.shape.closed=this.filling,this.currentPath=a),this.dirty=!0,a};Object.defineProperty(h.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){(this._cacheAsBitmap=a)?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}});h.GraphicsData=function(a,g,h,l,m,b,c){this.lineWidth=a;this.lineColor=g;this.lineAlpha=h;this._lineTint=g;this.fillColor=l;this.fillAlpha=m;this._fillTint=l;this.fill=b;this.shape=c;this.type=
c.type};h.GraphicsData.prototype.constructor=h.GraphicsData;h.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};h.Strip=function(a){h.DisplayObjectContainer.call(this);this.texture=a;this.uvs=new h.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new h.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new h.Float32Array([1,1,1,1]);this.indices=new h.Uint16Array([0,1,2,3]);this.dirty=!0;this.blendMode=
h.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=h.Strip.DrawModes.TRIANGLE_STRIP};h.Strip.prototype=Object.create(h.DisplayObjectContainer.prototype);h.Strip.prototype.constructor=h.Strip;h.Strip.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||(a.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(a),a.shaderManager.setShader(a.shaderManager.stripShader),this._renderStrip(a),a.spriteBatch.start())};h.Strip.prototype._initWebGL=function(a){a=a.gl;this._vertexBuffer=a.createBuffer();
this._indexBuffer=a.createBuffer();this._uvBuffer=a.createBuffer();this._colorBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvs,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colors,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,
a.STATIC_DRAW)};h.Strip.prototype._renderStrip=function(a){var g=a.gl,p=a.projection,l=a.offset,m=a.shaderManager.stripShader,b=this.drawMode===h.Strip.DrawModes.TRIANGLE_STRIP?g.TRIANGLE_STRIP:g.TRIANGLES;a.blendModeManager.setBlendMode(this.blendMode);g.uniformMatrix3fv(m.translationMatrix,!1,this.worldTransform.toArray(!0));g.uniform2f(m.projectionVector,p.x,-p.y);g.uniform2f(m.offsetVector,-l.x,-l.y);g.uniform1f(m.alpha,this.worldAlpha);this.dirty?(this.dirty=!1,g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer),
g.bufferData(g.ARRAY_BUFFER,this.vertices,g.STATIC_DRAW),g.vertexAttribPointer(m.aVertexPosition,2,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,this._uvBuffer),g.bufferData(g.ARRAY_BUFFER,this.uvs,g.STATIC_DRAW),g.vertexAttribPointer(m.aTextureCoord,2,g.FLOAT,!1,0,0),g.activeTexture(g.TEXTURE0),this.texture.baseTexture._dirty[g.id]?a.renderer.updateTexture(this.texture.baseTexture):g.bindTexture(g.TEXTURE_2D,this.texture.baseTexture._glTextures[g.id]),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBuffer),
g.bufferData(g.ELEMENT_ARRAY_BUFFER,this.indices,g.STATIC_DRAW)):(g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer),g.bufferSubData(g.ARRAY_BUFFER,0,this.vertices),g.vertexAttribPointer(m.aVertexPosition,2,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,this._uvBuffer),g.vertexAttribPointer(m.aTextureCoord,2,g.FLOAT,!1,0,0),g.activeTexture(g.TEXTURE0),this.texture.baseTexture._dirty[g.id]?a.renderer.updateTexture(this.texture.baseTexture):g.bindTexture(g.TEXTURE_2D,this.texture.baseTexture._glTextures[g.id]),
g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBuffer));g.drawElements(b,this.indices.length,g.UNSIGNED_SHORT,0)};h.Strip.prototype._renderCanvas=function(a){var g=a.context,p=this.worldTransform;a.roundPixels?g.setTransform(p.a,p.b,p.c,p.d,0|p.tx,0|p.ty):g.setTransform(p.a,p.b,p.c,p.d,p.tx,p.ty);this.drawMode===h.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(g):this._renderCanvasTriangles(g)};h.Strip.prototype._renderCanvasTriangleStrip=function(a){var g=this.vertices,h=this.uvs,
l=g.length/2;this.count++;for(var m=0;l-2>m;m++){var b=2*m;this._renderCanvasDrawTriangle(a,g,h,b,b+2,b+4)}};h.Strip.prototype._renderCanvasTriangles=function(a){var g=this.vertices,h=this.uvs,l=this.indices,m=l.length;this.count++;for(var b=0;m>b;b+=3)this._renderCanvasDrawTriangle(a,g,h,2*l[b],2*l[b+1],2*l[b+2])};h.Strip.prototype._renderCanvasDrawTriangle=function(a,g,h,l,m,b){var c=this.texture.baseTexture.source,e=this.texture.width,d=this.texture.height,f=g[l],k=g[m],n=g[b],u=g[l+1],z=g[m+1];
g=g[b+1];var y=h[l]*e,q=h[m]*e,e=h[b]*e;l=h[l+1]*d;m=h[m+1]*d;h=h[b+1]*d;if(0<this.canvasPadding){b=this.canvasPadding/this.worldTransform.a;var d=this.canvasPadding/this.worldTransform.d,t=(f+k+n)/3,x=(u+z+g)/3,v=f-t,w=u-x,r=Math.sqrt(v*v+w*w),f=t+v/r*(r+b),u=x+w/r*(r+d),v=k-t,w=z-x,r=Math.sqrt(v*v+w*w),k=t+v/r*(r+b),z=x+w/r*(r+d),v=n-t,w=g-x,r=Math.sqrt(v*v+w*w),n=t+v/r*(r+b);g=x+w/r*(r+d)}a.save();a.beginPath();a.moveTo(f,u);a.lineTo(k,z);a.lineTo(n,g);a.closePath();a.clip();b=y*m+l*e+q*h-m*e-
l*q-y*h;a.transform((f*m+l*n+k*h-m*n-l*k-f*h)/b,(u*m+l*g+z*h-m*g-l*z-u*h)/b,(y*k+f*e+q*n-k*e-f*q-y*n)/b,(y*z+u*e+q*g-z*e-u*q-y*g)/b,(y*m*n+l*k*e+f*q*h-f*m*e-l*q*n-y*k*h)/b,(y*m*g+l*z*e+u*q*h-u*m*e-l*q*g-y*z*h)/b);a.drawImage(c,0,0);a.restore()};h.Strip.prototype.renderStripFlat=function(a){var g=this.context;a=a.vertices;var h=a.length/2;this.count++;g.beginPath();for(var l=1;h-2>l;l++){var m=2*l,b=a[m+2],c=a[m+4],e=a[m+3],d=a[m+5];g.moveTo(a[m],a[m+1]);g.lineTo(b,e);g.lineTo(c,d)}g.fillStyle="#FF0000";
g.fill();g.closePath()};h.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0};h.Strip.prototype.getBounds=function(a){var g=a||this.worldTransform;a=g.a;for(var p=g.b,l=g.c,m=g.d,b=g.tx,c=g.ty,g=-1/0,e=-1/0,d=1/0,f=1/0,k=this.vertices,n=0,u=k.length;u>n;n+=2)var z=k[n],y=k[n+1],q=a*z+l*y+b,z=m*y+p*z+c,d=d>q?q:d,f=f>z?z:f,g=q>g?q:g,e=z>e?z:e;if(d===-1/0||1/0===e)return h.EmptyRectangle;a=this._bounds;return a.x=d,a.width=g-d,a.y=f,a.height=e-f,this._currentBounds=a,a};h.Strip.DrawModes=
{TRIANGLE_STRIP:0,TRIANGLES:1};h.Rope=function(a,g){h.Strip.call(this,a);this.points=g;this.vertices=new h.Float32Array(4*g.length);this.uvs=new h.Float32Array(4*g.length);this.colors=new h.Float32Array(2*g.length);this.indices=new h.Uint16Array(2*g.length);this.refresh()};h.Rope.prototype=Object.create(h.Strip.prototype);h.Rope.prototype.constructor=h.Rope;h.Rope.prototype.refresh=function(){var a=this.points;if(!(1>a.length)){var g=this.uvs,h=this.indices,l=this.colors;this.count-=.2;g[0]=0;g[1]=
0;g[2]=0;g[3]=1;l[0]=1;l[1]=1;h[0]=0;h[1]=1;for(var m,b=a.length,c=1;b>c;c++)a=4*c,m=c/(b-1),g[a]=m,g[a+1]=0,g[a+2]=m,g[a+3]=1,a=2*c,l[a]=1,l[a+1]=1,a=2*c,h[a]=a,h[a+1]=a+1}};h.Rope.prototype.updateTransform=function(){var a=this.points;if(!(1>a.length)){var g,p=a[0],l=g=0;this.count-=.2;for(var m,b,c,e=this.vertices,d=a.length,f=0;d>f;f++)m=a[f],b=4*f,g=f<a.length-1?a[f+1]:m,l=-(g.x-p.x),g=g.y-p.y,p=Math.sqrt(g*g+l*l),c=this.texture.height/2,g/=p,l/=p,g*=c,l*=c,e[b]=m.x+g,e[b+1]=m.y+l,e[b+2]=m.x-
g,e[b+3]=m.y-l,p=m;h.DisplayObjectContainer.prototype.updateTransform.call(this)}};h.Rope.prototype.setTexture=function(a){this.texture=a};h.TilingSprite=function(a,g,p){h.Sprite.call(this,a);this._width=g||100;this._height=p||100;this.tileScale=new h.Point(1,1);this.tileScaleOffset=new h.Point(1,1);this.tilePosition=new h.Point(0,0);this.renderable=!0;this.tint=16777215;this.blendMode=h.blendModes.NORMAL};h.TilingSprite.prototype=Object.create(h.Sprite.prototype);h.TilingSprite.prototype.constructor=
h.TilingSprite;Object.defineProperty(h.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}});Object.defineProperty(h.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}});h.TilingSprite.prototype.setTexture=function(a){this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215)};h.TilingSprite.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha){var g,h;this._mask&&
(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start());this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock));!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(a.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)):a.spriteBatch.renderTilingSprite(this);g=0;for(h=this.children.length;h>g;g++)this.children[g]._renderWebGL(a);a.spriteBatch.stop();
this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(this._mask,a);a.spriteBatch.start()}};h.TilingSprite.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){var g=a.context;this._mask&&a.maskManager.pushMask(this._mask,a);g.globalAlpha=this.worldAlpha;var p;p=this.worldTransform;var l=a.resolution;if(g.setTransform(p.a*l,p.b*l,p.c*l,p.d*l,p.tx*l,p.ty*l),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;
this.__tilePattern=g.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,g.globalCompositeOperation=h.blendModesCanvas[a.currentBlendMode]);p=this.tilePosition;l=this.tileScale;p.x%=this.tilingTexture.baseTexture.width;p.y%=this.tilingTexture.baseTexture.height;g.scale(l.x,l.y);g.translate(p.x+this.anchor.x*-this._width,p.y+this.anchor.y*-this._height);g.fillStyle=this.__tilePattern;g.fillRect(-p.x,-p.y,this._width/
l.x,this._height/l.y);g.scale(1/l.x,1/l.y);g.translate(-p.x+this.anchor.x*this._width,-p.y+this.anchor.y*this._height);this._mask&&a.maskManager.popMask(a);g=0;for(p=this.children.length;p>g;g++)this.children[g]._renderCanvas(a)}};h.TilingSprite.prototype.getBounds=function(){var a=this._width,g=this._height,h=a*(1-this.anchor.x),l=a*-this.anchor.x,m=g*(1-this.anchor.y),b=g*-this.anchor.y,g=this.worldTransform,c=g.a,e=g.b,d=g.c,f=g.d,k=g.tx,n=g.ty,g=c*l+d*b+k,a=f*b+e*l+n,u=c*h+d*b+k,b=f*b+e*h+n,z=
c*h+d*m+k,h=f*m+e*h+n,c=c*l+d*m+k,l=f*m+e*l+n,m=-1/0,e=-1/0,f=1/0,d=1/0,f=f>g?g:f,f=f>u?u:f,f=f>z?z:f,f=f>c?c:f,d=d>a?a:d,d=d>b?b:d,d=d>h?h:d,d=d>l?l:d,m=g>m?g:m,m=u>m?u:m,m=z>m?z:m,e=a>e?a:e,e=b>e?b:e,e=h>e?h:e,g=this._bounds;return g.x=f,g.width=(c>m?c:m)-f,g.y=d,g.height=(l>e?l:e)-d,this._currentBounds=g,g};h.TilingSprite.prototype.onTextureUpdate=function(){};h.TilingSprite.prototype.generateTilingTexture=function(a){if(this.texture.baseTexture.hasLoaded){var g,p,l=this.originalTexture||this.texture,
m=l.frame,b=m.width!==l.baseTexture.width||m.height!==l.baseTexture.height,c=!1;if(a?(l.crop?(g=h.getNextPowerOfTwo(l.crop.width),p=h.getNextPowerOfTwo(l.crop.height)):(g=h.getNextPowerOfTwo(m.width),p=h.getNextPowerOfTwo(m.height)),c=!0):b&&(l.crop?(g=l.crop.width,p=l.crop.height):(g=m.width,p=m.height),c=!0),c){var e;this.tilingTexture&&this.tilingTexture.isTiling?(e=this.tilingTexture.canvasBuffer,e.resize(g,p),this.tilingTexture.baseTexture.width=g,this.tilingTexture.baseTexture.height=p,this.tilingTexture.needsUpdate=
!0):(e=new h.CanvasBuffer(g,p),this.tilingTexture=h.Texture.fromCanvas(e.canvas),this.tilingTexture.canvasBuffer=e,this.tilingTexture.isTiling=!0);e.context.drawImage(l.baseTexture.source,l.crop.x,l.crop.y,l.crop.width,l.crop.height,0,0,g,p);this.tileScaleOffset.x=m.width/g;this.tileScaleOffset.y=m.height/p}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=l;this.refreshTexture=!1;this.originalTexture=
this.texture;this.texture=this.tilingTexture;this.tilingTexture.baseTexture._powerOf2=!0}};h.TilingSprite.prototype.destroy=function(){h.Sprite.prototype.destroy.call(this);this.tilePosition=this.tileScaleOffset=this.tileScale=null;this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)};h.BaseTextureCache={};h.BaseTextureCacheIdGenerator=0;h.BaseTexture=function(a,g){this.resolution=1;this.height=this.width=100;this.scaleMode=g||h.scaleModes.DEFAULT;this.hasLoaded=!1;this.source=
a;this._UID=h._UID++;this.premultipliedAlpha=!0;this._glTextures=[];this.mipmap=!1;this._dirty=[!0,!0,!0,!0];a&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.imageUrl=null,this._powerOf2=!1)};h.BaseTexture.prototype.constructor=h.BaseTexture;h.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete h.BaseTextureCache[this.imageUrl],
delete h.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete h.BaseTextureCache[this.source._pixiId];this.source=null;this.unloadFromGPU()};h.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1;this.source.src=null;this.source.src=a};h.BaseTexture.prototype.dirty=function(){for(var a=0;a<this._glTextures.length;a++)this._dirty[a]=!0};h.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var a=
this._glTextures.length-1;0<=a;a--){var g=this._glTextures[a],p=h.glContexts[a];p&&g&&p.deleteTexture(g)}this._glTextures.length=0;this.dirty()};h.BaseTexture.fromImage=function(a,g,p){var l=h.BaseTextureCache[a];(void 0===g&&-1===a.indexOf("data:")&&(g=!0),l)||(l=new Image,g&&(l.crossOrigin=""),l.src=a,l=new h.BaseTexture(l,p),l.imageUrl=a,h.BaseTextureCache[a]=l,-1!==a.indexOf(h.RETINA_PREFIX+".")&&(l.resolution=2));return l};h.BaseTexture.fromCanvas=function(a,g){a._pixiId||(a._pixiId="canvas_"+
h.TextureCacheIdGenerator++);var p=h.BaseTextureCache[a._pixiId];return p||(p=new h.BaseTexture(a,g),h.BaseTextureCache[a._pixiId]=p),p};h.TextureCache={};h.FrameCache={};h.TextureSilentFail=!1;h.TextureCacheIdGenerator=0;h.Texture=function(a,g,p,l){this.noFrame=!1;g||(this.noFrame=!0,g=new h.Rectangle(0,0,1,1));a instanceof h.Texture&&(a=a.baseTexture);this.baseTexture=a;this.frame=g;this.trim=l;this.requiresUpdate=this.valid=!1;this._uvs=null;this.height=this.width=0;this.crop=p||new h.Rectangle(0,
0,1,1);a.hasLoaded&&(this.noFrame&&(g=new h.Rectangle(0,0,a.width,a.height)),this.setFrame(g))};h.Texture.prototype.constructor=h.Texture;h.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;this.noFrame&&(this.frame=new h.Rectangle(0,0,a.width,a.height));this.setFrame(this.frame)};h.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy();this.valid=!1};h.Texture.prototype.setFrame=function(a){if(this.noFrame=!1,this.frame=a,this.width=a.width,this.height=a.height,
this.crop.x=a.x,this.crop.y=a.y,this.crop.width=a.width,this.crop.height=a.height,!this.trim&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height)){if(!h.TextureSilentFail)throw Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);return void(this.valid=!1)}this.valid=a&&a.width&&a.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=
this.trim.height);this.valid&&this._updateUvs()};h.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new h.TextureUvs);var a=this.crop,g=this.baseTexture.width,p=this.baseTexture.height;this._uvs.x0=a.x/g;this._uvs.y0=a.y/p;this._uvs.x1=(a.x+a.width)/g;this._uvs.y1=a.y/p;this._uvs.x2=(a.x+a.width)/g;this._uvs.y2=(a.y+a.height)/p;this._uvs.x3=a.x/g;this._uvs.y3=(a.y+a.height)/p};h.Texture.fromImage=function(a,g,p){var l=h.TextureCache[a];return l||(l=new h.Texture(h.BaseTexture.fromImage(a,
g,p)),h.TextureCache[a]=l),l};h.Texture.fromFrame=function(a){var g=h.TextureCache[a];if(!g)throw Error('The frameId "'+a+'" does not exist in the texture cache ');return g};h.Texture.fromCanvas=function(a,g){var p=h.BaseTexture.fromCanvas(a,g);return new h.Texture(p)};h.Texture.addTextureToCache=function(a,g){h.TextureCache[g]=a};h.Texture.removeTextureFromCache=function(a){var g=h.TextureCache[a];return delete h.TextureCache[a],delete h.BaseTextureCache[a],g};h.TextureUvs=function(){this.y3=this.x3=
this.y2=this.x2=this.y1=this.x1=this.y0=this.x0=0};h.RenderTexture=function(a,g,p,l,m){(this.width=a||100,this.height=g||100,this.resolution=m||1,this.frame=new h.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new h.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new h.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=
this.resolution,this.baseTexture.scaleMode=l||h.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,h.Texture.call(this,this.baseTexture,new h.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=p||h.defaultRenderer,this.renderer.type===h.WEBGL_RENDERER)?(a=this.renderer.gl,this.baseTexture._dirty[a.id]=!1,this.textureBuffer=new h.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[a.id]=this.textureBuffer.texture,this.render=
this.renderWebGL,this.projection=new h.Point(.5*this.width,.5*-this.height)):(this.render=this.renderCanvas,this.textureBuffer=new h.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas);this.valid=!0;this._updateUvs()};h.RenderTexture.prototype=Object.create(h.Texture.prototype);h.RenderTexture.prototype.constructor=h.RenderTexture;h.RenderTexture.prototype.resize=function(a,g,p){(a!==this.width||g!==this.height)&&(this.valid=0<a&&
0<g,this.width=a,this.height=g,this.frame.width=this.crop.width=a*this.resolution,this.frame.height=this.crop.height=g*this.resolution,p&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===h.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))};h.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===h.WEBGL_RENDERER&&
this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())};h.RenderTexture.prototype.renderWebGL=function(a,g,h){if(this.valid){var l=a.worldTransform;l.identity();l.translate(0,2*this.projection.y);g&&l.append(g);l.scale(1,-1);a.worldAlpha=1;g=a.children;for(var l=0,m=g.length;m>l;l++)g[l].updateTransform();g=this.renderer.gl;g.viewport(0,0,this.width*this.resolution,this.height*this.resolution);g.bindFramebuffer(g.FRAMEBUFFER,this.textureBuffer.frameBuffer);
h&&this.textureBuffer.clear();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer);this.renderer.spriteBatch.dirty=!0}};h.RenderTexture.prototype.renderCanvas=function(a,g,h){if(this.valid){var l=a.worldTransform;l.identity();g&&l.append(g);a.worldAlpha=1;g=a.children;for(var l=0,m=g.length;m>l;l++)g[l].updateTransform();h&&this.textureBuffer.clear();h=this.textureBuffer.context;g=this.renderer.resolution;this.renderer.resolution=this.resolution;
this.renderer.renderDisplayObject(a,h);this.renderer.resolution=g}};h.RenderTexture.prototype.getImage=function(){var a=new Image;return a.src=this.getBase64(),a};h.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};h.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===h.WEBGL_RENDERER){var a=this.renderer.gl,g=this.textureBuffer.width,p=this.textureBuffer.height,l=new Uint8Array(4*g*p);a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer);
a.readPixels(0,0,g,p,a.RGBA,a.UNSIGNED_BYTE,l);a.bindFramebuffer(a.FRAMEBUFFER,null);a=new h.CanvasBuffer(g,p);g=a.context.getImageData(0,0,g,p);return g.data.set(l),a.context.putImageData(g,0,0),a.canvas}return this.textureBuffer.canvas};h.AbstractFilter=function(a,g){this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms=g||{};this.fragmentSrc=a||[]};h.AbstractFilter.prototype.constructor=h.AbstractFilter;h.AbstractFilter.prototype.syncUniforms=function(){for(var a=0,g=this.shaders.length;g>
a;a++)this.shaders[a].dirty=!0};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports.PIXI=h):"undefined"!=typeof define&&define.amd?define("PIXI",this.PIXI=h):this.PIXI=h}).call(this);
(function(){function h(b,c){this._scaleFactor=b;this._deltaMode=c;this.originalEvent=null}var a=a||{VERSION:"2.3.0",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,
blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};if(Math.trunc||(Math.trunc=function(b){return 0>b?Math.ceil(b):Math.floor(b)}),Function.prototype.bind||(Function.prototype.bind=function(){var b=Array.prototype.slice;return function(c){function a(){var k=f.concat(b.call(arguments));d.apply(this instanceof
a?this:c,k)}var d=this,f=b.call(arguments,1);if("function"!=typeof d)throw new TypeError;return a.prototype=function n(b){return b&&(n.prototype=b),this instanceof n?void 0:new n}(d.prototype),a}}()),Array.isArray||(Array.isArray=function(b){return"[object Array]"==Object.prototype.toString.call(b)}),Array.prototype.forEach||(Array.prototype.forEach=function(b){if(void 0===this||null===this)throw new TypeError;var c=Object(this),a=c.length>>>0;if("function"!=typeof b)throw new TypeError;for(var d=
2<=arguments.length?arguments[1]:void 0,f=0;a>f;f++)f in c&&b.call(d,c[f],f,c)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array){var g=function(b){window[b]=function(b){if("number"==typeof b){Array.call(this,b);this.length=b;for(var a=0;a<this.length;a++)this[a]=0}else for(Array.call(this,b.length),this.length=b.length,a=0;a<this.length;a++)this[a]=b[a]};window[b].prototype=[];window[b].constructor=window[b]};g("Uint32Array");g("Int16Array")}window.console||(window.console=
{},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){});a.Utils={getProperty:function(b,c){for(var a=c.split("."),d=a.pop(),f=a.length,k=1,n=a[0];f>k&&(b=b[n]);)n=a[k],k++;return b?b[d]:null},setProperty:function(b,c,a){c=c.split(".");for(var d=c.pop(),f=c.length,k=1,n=c[0];f>k&&(b=b[n]);)n=c[k],k++;return b&&(b[d]=a),b},chanceRoll:function(b){return"undefined"==typeof b&&(b=50),0<b&&100*Math.random()<=b},randomChoice:function(b,c){return.5>
Math.random()?b:c},transposeArray:function(b){return a.ArrayUtils.transposeMatrix(b)},rotateArray:function(b,c){return a.ArrayUtils.rotateMatrix(b,c)},shuffle:function(b){return a.ArrayUtils.shuffle(b)},parseDimension:function(b,c){var a=0,d=0;return"string"==typeof b?"%"===b.substr(-1)?(a=parseInt(b,10)/100,d=0===c?window.innerWidth*a:window.innerHeight*a):d=parseInt(b,10):d=b,d},pad:function(b,c,a,d){"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a=" ");"undefined"==typeof d&&(d=3);var f=
0;if(c+1>=b.length)switch(d){case 1:b=Array(c+1-b.length).join(a)+b;break;case 3:c=Math.ceil((f=c-b.length)/2);b=Array(f-c+1).join(a)+b+Array(c+1).join(a);break;default:b+=Array(c+1-b.length).join(a)}return b},isPlainObject:function(b){if("object"!=typeof b||b.nodeType||b===b.window)return!1;try{if(b.constructor&&!{}.hasOwnProperty.call(b.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}return!0},extend:function(){var b,c,e,d,f,k,n=arguments[0]||{},g=1,h=arguments.length,l=!1;"boolean"==
typeof n&&(l=n,n=arguments[1]||{},g=2);for(h===g&&(n=this,--g);h>g;g++)if(null!=(b=arguments[g]))for(c in b)e=n[c],d=b[c],n!==d&&(l&&d&&(a.Utils.isPlainObject(d)||(f=Array.isArray(d)))?(f?(f=!1,k=e&&Array.isArray(e)?e:[]):k=e&&a.Utils.isPlainObject(e)?e:{},n[c]=a.Utils.extend(l,k,d)):void 0!==d&&(n[c]=d));return n},mixinPrototype:function(b,c,a){"undefined"==typeof a&&(a=!1);for(var d=Object.keys(c),f=0;f<d.length;f++){var k=d[f],n=c[k];!a&&k in b||(!n||"function"!=typeof n.get&&"function"!=typeof n.set?
b[k]=n:"function"==typeof n.clone?b[k]=n.clone():Object.defineProperty(b,k,n))}},mixin:function(b,c){if(!b||"object"!=typeof b)return c;for(var e in b){var d=b[e];if(!d.childNodes&&!d.cloneNode){var f=typeof b[e];c[e]=b[e]&&"object"===f?typeof c[e]===f?a.Utils.mixin(b[e],c[e]):a.Utils.mixin(b[e],new d.constructor):b[e]}}return c}};a.Circle=function(b,c,e){e=e||0;this.x=b||0;this.y=c||0;this._diameter=e;this._radius=0;0<e&&(this._radius=.5*e);this.type=a.CIRCLE};a.Circle.prototype={circumference:function(){return 2*
Math.PI*this._radius},getBounds:function(){return new a.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(b,c,a){return this.x=b,this.y=c,this._diameter=a,this._radius=.5*a,this},copyFrom:function(b){return this.setTo(b.x,b.y,b.diameter)},copyTo:function(b){return b.x=this.x,b.y=this.y,b.diameter=this._diameter,b},distance:function(b,c){var e=a.Math.distance(this.x,this.y,b.x,b.y);return c?Math.round(e):e},clone:function(b){return"undefined"==typeof b||null===
b?b=new a.Circle(this.x,this.y,this.diameter):b.setTo(this.x,this.y,this.diameter),b},contains:function(b,c){return a.Circle.contains(this,b,c)},circumferencePoint:function(b,c,e){return a.Circle.circumferencePoint(this,b,c,e)},offset:function(b,c){return this.x+=b,this.y+=c,this},offsetPoint:function(b){return this.offset(b.x,b.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};a.Circle.prototype.constructor=a.Circle;
Object.defineProperty(a.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(b){0<b&&(this._diameter=b,this._radius=.5*b)}});Object.defineProperty(a.Circle.prototype,"radius",{get:function(){return this._radius},set:function(b){0<b&&(this._radius=b,this._diameter=2*b)}});Object.defineProperty(a.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(b){b>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-b}});Object.defineProperty(a.Circle.prototype,
"right",{get:function(){return this.x+this._radius},set:function(b){b<this.x?(this._radius=0,this._diameter=0):this.radius=b-this.x}});Object.defineProperty(a.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(b){b>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-b}});Object.defineProperty(a.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(b){b<this.y?(this._radius=0,this._diameter=0):this.radius=b-this.y}});Object.defineProperty(a.Circle.prototype,
"area",{get:function(){return 0<this._radius?Math.PI*this._radius*this._radius:0}});Object.defineProperty(a.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(b){!0===b&&this.setTo(0,0,0)}});a.Circle.contains=function(b,c,a){return 0<b.radius&&c>=b.left&&c<=b.right&&a>=b.top&&a<=b.bottom?(b.x-c)*(b.x-c)+(b.y-a)*(b.y-a)<=b.radius*b.radius:!1};a.Circle.equals=function(b,c){return b.x==c.x&&b.y==c.y&&b.diameter==c.diameter};a.Circle.intersects=function(b,c){return a.Math.distance(b.x,
b.y,c.x,c.y)<=b.radius+c.radius};a.Circle.circumferencePoint=function(b,c,e,d){return"undefined"==typeof e&&(e=!1),"undefined"==typeof d&&(d=new a.Point),!0===e&&(c=a.Math.degToRad(c)),d.x=b.x+b.radius*Math.cos(c),d.y=b.y+b.radius*Math.sin(c),d};a.Circle.intersectsRectangle=function(b,c){var a=Math.abs(b.x-c.x-c.halfWidth);if(a>c.halfWidth+b.radius)return!1;var d=Math.abs(b.y-c.y-c.halfHeight);if(d>c.halfHeight+b.radius)return!1;if(a<=c.halfWidth||d<=c.halfHeight)return!0;a-=c.halfWidth;d-=c.halfHeight;
return b.radius*b.radius>=a*a+d*d};PIXI.Circle=a.Circle;a.Ellipse=function(b,c,e,d){this.x=b||0;this.y=c||0;this.width=e||0;this.height=d||0;this.type=a.ELLIPSE};a.Ellipse.prototype={setTo:function(b,c,a,d){return this.x=b,this.y=c,this.width=a,this.height=d,this},getBounds:function(){return new a.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(b){return this.setTo(b.x,b.y,b.width,b.height)},copyTo:function(b){return b.x=this.x,b.y=this.y,b.width=this.width,
b.height=this.height,b},clone:function(b){return"undefined"==typeof b||null===b?b=new a.Ellipse(this.x,this.y,this.width,this.height):b.setTo(this.x,this.y,this.width,this.height),b},contains:function(b,c){return a.Ellipse.contains(this,b,c)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};a.Ellipse.prototype.constructor=a.Ellipse;Object.defineProperty(a.Ellipse.prototype,"left",{get:function(){return this.x},set:function(b){this.x=
b}});Object.defineProperty(a.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(b){this.width=b<this.x?0:b-this.x}});Object.defineProperty(a.Ellipse.prototype,"top",{get:function(){return this.y},set:function(b){this.y=b}});Object.defineProperty(a.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(b){this.height=b<this.y?0:b-this.y}});Object.defineProperty(a.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},
set:function(b){!0===b&&this.setTo(0,0,0,0)}});a.Ellipse.contains=function(b,c,a){if(0>=b.width||0>=b.height)return!1;c=(c-b.x)/b.width-.5;b=(a-b.y)/b.height-.5;return c*=c,b*=b,.25>c+b};PIXI.Ellipse=a.Ellipse;a.Line=function(b,c,e,d){e=e||0;d=d||0;this.start=new a.Point(b||0,c||0);this.end=new a.Point(e,d);this.type=a.LINE};a.Line.prototype={setTo:function(b,c,a,d){return this.start.setTo(b,c),this.end.setTo(a,d),this},fromSprite:function(b,c,a){return"undefined"==typeof a&&(a=!1),a?this.setTo(b.center.x,
b.center.y,c.center.x,c.center.y):this.setTo(b.x,b.y,c.x,c.y)},fromAngle:function(b,c,a,d){return this.start.setTo(b,c),this.end.setTo(b+Math.cos(a)*d,c+Math.sin(a)*d),this},intersects:function(b,c,e){return a.Line.intersectsPoints(this.start,this.end,b.start,b.end,c,e)},reflect:function(b){return a.Line.reflect(this,b)},pointOnLine:function(b,c){return(b-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(c-this.start.y)},pointOnSegment:function(b,c){var a=Math.min(this.start.x,
this.end.x),d=Math.max(this.start.x,this.end.x),f=Math.min(this.start.y,this.end.y),k=Math.max(this.start.y,this.end.y);return this.pointOnLine(b,c)&&b>=a&&d>=b&&c>=f&&k>=c},coordinatesOnLine:function(b,c){"undefined"==typeof b&&(b=1);"undefined"==typeof c&&(c=[]);var a=Math.round(this.start.x),d=Math.round(this.start.y),f=Math.round(this.end.x),k=Math.round(this.end.y),n=Math.abs(f-a),g=Math.abs(k-d),h=f>a?1:-1,l=k>d?1:-1,m=n-g;c.push([a,d]);for(var p=1;a!=f||d!=k;){var x=m<<1;x>-g&&(m-=g,a+=h);
n>x&&(m+=n,d+=l);0===p%b&&c.push([a,d]);p++}return c},clone:function(b){return"undefined"==typeof b||null===b?b=new a.Line(this.start.x,this.start.y,this.end.x,this.end.y):b.setTo(this.start.x,this.start.y,this.end.x,this.end.y),b}};Object.defineProperty(a.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(a.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-
this.start.y,this.end.x-this.start.x)}});Object.defineProperty(a.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(a.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(a.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(a.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});
Object.defineProperty(a.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(a.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(a.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(a.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(a.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-
this.end.x)}});Object.defineProperty(a.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(a.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(a.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(a.Line.prototype,"normalAngle",{get:function(){return a.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});a.Line.intersectsPoints=
function(b,c,e,d,f,k){"undefined"==typeof f&&(f=!0);"undefined"==typeof k&&(k=new a.Point);var n=c.y-b.y,g=d.y-e.y,h=b.x-c.x,l=e.x-d.x,m=c.x*b.y-b.x*c.y,p=d.x*e.y-e.x*d.y,x=n*l-g*h;return 0===x?null:(k.x=(h*p-l*m)/x,k.y=(g*m-n*p)/x,f)?(f=(d.y-e.y)*(c.x-b.x)-(d.x-e.x)*(c.y-b.y),d=((d.x-e.x)*(b.y-e.y)-(d.y-e.y)*(b.x-e.x))/f,b=((c.x-b.x)*(b.y-e.y)-(c.y-b.y)*(b.x-e.x))/f,0<=d&&1>=d&&0<=b&&1>=b?k:null):k};a.Line.intersects=function(b,c,e,d){return a.Line.intersectsPoints(b.start,b.end,c.start,c.end,e,
d)};a.Line.reflect=function(b,c){return 2*c.normalAngle-3.141592653589793-b.angle};a.Matrix=function(){this.a=1;this.c=this.b=0;this.d=1;this.ty=this.tx=0;this.type=a.MATRIX};a.Matrix.prototype.fromArray=function(b){this.a=b[0];this.b=b[1];this.c=b[3];this.d=b[4];this.tx=b[2];this.ty=b[5]};a.Matrix.prototype.toArray=function(b){this.array||(this.array=new PIXI.Float32Array(9));var c=this.array;return b?(c[0]=this.a,c[1]=this.b,c[2]=0,c[3]=this.c,c[4]=this.d,c[5]=0,c[6]=this.tx,c[7]=this.ty,c[8]=1):
(c[0]=this.a,c[1]=this.c,c[2]=this.tx,c[3]=this.b,c[4]=this.d,c[5]=this.ty,c[6]=0,c[7]=0,c[8]=1),c};a.Matrix.prototype.apply=function(b,c){c=c||new a.Point;var e=b.x,d=b.y;return c.x=this.a*e+this.c*d+this.tx,c.y=this.b*e+this.d*d+this.ty,c};a.Matrix.prototype.applyInverse=function(b,c){c=c||new a.Point;var e=1/(this.a*this.d+this.c*-this.b),d=b.x,f=b.y;return c.x=this.d*e*d+-this.c*e*f+(this.ty*this.c-this.tx*this.d)*e,c.y=this.a*e*f+-this.b*e*d+(-this.ty*this.a+this.tx*this.b)*e,c};a.Matrix.prototype.translate=
function(b,c){return this.tx+=b,this.ty+=c,this};a.Matrix.prototype.scale=function(b,c){return this.a*=b,this.d*=c,this.c*=b,this.b*=c,this.tx*=b,this.ty*=c,this};a.Matrix.prototype.rotate=function(b){var c=Math.cos(b);b=Math.sin(b);var a=this.a,d=this.c,f=this.tx;return this.a=a*c-this.b*b,this.b=a*b+this.b*c,this.c=d*c-this.d*b,this.d=d*b+this.d*c,this.tx=f*c-this.ty*b,this.ty=f*b+this.ty*c,this};a.Matrix.prototype.append=function(b){var c=this.a,a=this.b,d=this.c,f=this.d;return this.a=b.a*c+b.b*
d,this.b=b.a*a+b.b*f,this.c=b.c*c+b.d*d,this.d=b.c*a+b.d*f,this.tx=b.tx*c+b.ty*d+this.tx,this.ty=b.tx*a+b.ty*f+this.ty,this};a.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this};a.identityMatrix=new a.Matrix;PIXI.Matrix=a.Matrix;PIXI.identityMatrix=a.identityMatrix;a.Point=function(b,c){this.x=b||0;this.y=c||0;this.type=a.POINT};a.Point.prototype={copyFrom:function(b){return this.setTo(b.x,b.y)},invert:function(){return this.setTo(this.y,this.x)},
setTo:function(b,c){return this.x=b||0,this.y=c||(0!==c?this.x:0),this},set:function(b,c){return this.x=b||0,this.y=c||(0!==c?this.x:0),this},add:function(b,c){return this.x+=b,this.y+=c,this},subtract:function(b,c){return this.x-=b,this.y-=c,this},multiply:function(b,c){return this.x*=b,this.y*=c,this},divide:function(b,c){return this.x/=b,this.y/=c,this},clampX:function(b,c){return this.x=a.Math.clamp(this.x,b,c),this},clampY:function(b,c){return this.y=a.Math.clamp(this.y,b,c),this},clamp:function(b,
c){return this.x=a.Math.clamp(this.x,b,c),this.y=a.Math.clamp(this.y,b,c),this},clone:function(b){return"undefined"==typeof b||null===b?b=new a.Point(this.x,this.y):b.setTo(this.x,this.y),b},copyTo:function(b){return b.x=this.x,b.y=this.y,b},distance:function(b,c){return a.Point.distance(this,b,c)},equals:function(b){return b.x===this.x&&b.y===this.y},angle:function(b,c){return"undefined"==typeof c&&(c=!1),c?a.Math.radToDeg(Math.atan2(b.y-this.y,b.x-this.x)):Math.atan2(b.y-this.y,b.x-this.x)},rotate:function(b,
c,e,d,f){return a.Point.rotate(this,b,c,e,d,f)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(b){return this.normalize().multiply(b,b)},normalize:function(){if(!this.isZero()){var b=this.getMagnitude();this.x/=b;this.y/=b}return this},isZero:function(){return 0===this.x&&0===this.y},dot:function(b){return this.x*b.x+this.y*b.y},cross:function(b){return this.x*b.y-this.y*b.x},perp:function(){return this.setTo(-this.y,
this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};a.Point.prototype.constructor=a.Point;a.Point.add=function(b,c,e){return"undefined"==typeof e&&(e=new a.Point),e.x=b.x+c.x,e.y=b.y+c.y,e};a.Point.subtract=function(b,
c,e){return"undefined"==typeof e&&(e=new a.Point),e.x=b.x-c.x,e.y=b.y-c.y,e};a.Point.multiply=function(b,c,e){return"undefined"==typeof e&&(e=new a.Point),e.x=b.x*c.x,e.y=b.y*c.y,e};a.Point.divide=function(b,c,e){return"undefined"==typeof e&&(e=new a.Point),e.x=b.x/c.x,e.y=b.y/c.y,e};a.Point.equals=function(b,c){return b.x===c.x&&b.y===c.y};a.Point.angle=function(b,c){return Math.atan2(b.y-c.y,b.x-c.x)};a.Point.negative=function(b,c){return"undefined"==typeof c&&(c=new a.Point),c.setTo(-b.x,-b.y)};
a.Point.multiplyAdd=function(b,c,e,d){return"undefined"==typeof d&&(d=new a.Point),d.setTo(b.x+c.x*e,b.y+c.y*e)};a.Point.interpolate=function(b,c,e,d){return"undefined"==typeof d&&(d=new a.Point),d.setTo(b.x+(c.x-b.x)*e,b.y+(c.y-b.y)*e)};a.Point.perp=function(b,c){return"undefined"==typeof c&&(c=new a.Point),c.setTo(-b.y,b.x)};a.Point.rperp=function(b,c){return"undefined"==typeof c&&(c=new a.Point),c.setTo(b.y,-b.x)};a.Point.distance=function(b,c,e){b=a.Math.distance(b.x,b.y,c.x,c.y);return e?Math.round(b):
b};a.Point.project=function(b,c,e){"undefined"==typeof e&&(e=new a.Point);b=b.dot(c)/c.getMagnitudeSq();return 0!==b&&e.setTo(b*c.x,b*c.y),e};a.Point.projectUnit=function(b,c,e){"undefined"==typeof e&&(e=new a.Point);b=b.dot(c);return 0!==b&&e.setTo(b*c.x,b*c.y),e};a.Point.normalRightHand=function(b,c){return"undefined"==typeof c&&(c=new a.Point),c.setTo(-1*b.y,b.x)};a.Point.normalize=function(b,c){"undefined"==typeof c&&(c=new a.Point);var e=b.getMagnitude();return 0!==e&&c.setTo(b.x/e,b.y/e),c};
a.Point.rotate=function(b,c,e,d,f,k){k=k||null;f&&(d=a.Math.degToRad(d));null===k&&(k=Math.sqrt((c-b.x)*(c-b.x)+(e-b.y)*(e-b.y)));d+=Math.atan2(b.y-e,b.x-c);return b.setTo(c+k*Math.cos(d),e+k*Math.sin(d))};a.Point.centroid=function(b,c){if("undefined"==typeof c&&(c=new a.Point),"[object Array]"!==Object.prototype.toString.call(b))throw Error("Phaser.Point. Parameter 'points' must be an array");var e=b.length;if(1>e)throw Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===e)return c.copyFrom(b[0]),
c;for(var d=0;e>d;d++)a.Point.add(c,b[d],c);return c.divide(e,e),c};a.Point.parse=function(b,c,e){c=c||"x";e=e||"y";var d=new a.Point;return b[c]&&(d.x=parseInt(b[c],10)),b[e]&&(d.y=parseInt(b[e],10)),d};PIXI.Point=a.Point;a.Polygon=function(){this.area=0;this._points=[];0<arguments.length&&this.setTo.apply(this,arguments);this.closed=!0;this.type=a.POLYGON};a.Polygon.prototype={toNumberArray:function(b){"undefined"==typeof b&&(b=[]);for(var c=0;c<this._points.length;c++)"number"==typeof this._points[c]?
(b.push(this._points[c]),b.push(this._points[c+1]),c++):(b.push(this._points[c].x),b.push(this._points[c].y));return b},flatten:function(){return this._points=this.toNumberArray(),this},clone:function(b){var c=this._points.slice();return"undefined"==typeof b||null===b?b=new a.Polygon(c):b.setTo(c),b},contains:function(b,c){for(var a=this._points.length,d=!1,f=-1,k=a-1;++f<a;k=f){var n=this._points[f].x,g=this._points[f].y,h=this._points[k].x,k=this._points[k].y;(c>=g&&k>c||c>=k&&g>c)&&(h-n)*(c-g)/
(k-g)+n>b&&(d=!d)}return d},setTo:function(b){if(this.area=0,this._points=[],0<arguments.length){Array.isArray(b)||(b=Array.prototype.slice.call(arguments));for(var c=Number.MAX_VALUE,a=0,d=b.length;d>a;a++){if("number"==typeof b[a]){var f=new PIXI.Point(b[a],b[a+1]);a++}else f=new PIXI.Point(b[a].x,b[a].y);this._points.push(f);f.y<c&&(c=f.y)}this.calculateArea(c)}return this},calculateArea:function(b){for(var c,a,d,f=0,k=this._points.length;k>f;f++)c=this._points[f],a=f===k-1?this._points[0]:this._points[f+
1],d=(c.y-b+(a.y-b))/2,c=c.x-a.x,this.area+=d*c;return this.area}};a.Polygon.prototype.constructor=a.Polygon;Object.defineProperty(a.Polygon.prototype,"points",{get:function(){return this._points},set:function(b){null!=b?this.setTo(b):this.setTo()}});PIXI.Polygon=a.Polygon;a.Rectangle=function(b,c,e,d){this.x=b||0;this.y=c||0;this.width=e||0;this.height=d||0;this.type=a.RECTANGLE};a.Rectangle.prototype={offset:function(b,c){return this.x+=b,this.y+=c,this},offsetPoint:function(b){return this.offset(b.x,
b.y)},setTo:function(b,c,a,d){return this.x=b,this.y=c,this.width=a,this.height=d,this},scale:function(b,c){return"undefined"==typeof c&&(c=b),this.width*=b,this.height*=c,this},centerOn:function(b,c){return this.centerX=b,this.centerY=c,this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(b){return this.setTo(b.x,b.y,
b.width,b.height)},copyTo:function(b){return b.x=this.x,b.y=this.y,b.width=this.width,b.height=this.height,b},inflate:function(b,c){return a.Rectangle.inflate(this,b,c)},size:function(b){return a.Rectangle.size(this,b)},clone:function(b){return a.Rectangle.clone(this,b)},contains:function(b,c){return a.Rectangle.contains(this,b,c)},containsRect:function(b){return a.Rectangle.containsRect(b,this)},equals:function(b){return a.Rectangle.equals(this,b)},intersection:function(b,c){return a.Rectangle.intersection(this,
b,c)},intersects:function(b){return a.Rectangle.intersects(this,b)},intersectsRaw:function(b,c,e,d,f){return a.Rectangle.intersectsRaw(this,b,c,e,d,f)},union:function(b,c){return a.Rectangle.union(this,b,c)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(a.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(a.Rectangle.prototype,"halfHeight",
{get:function(){return Math.round(this.height/2)}});Object.defineProperty(a.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(b){this.height=b<=this.y?0:b-this.y}});Object.defineProperty(a.Rectangle.prototype,"bottomRight",{get:function(){return new a.Point(this.right,this.bottom)},set:function(b){this.right=b.x;this.bottom=b.y}});Object.defineProperty(a.Rectangle.prototype,"left",{get:function(){return this.x},set:function(b){this.width=b>=this.right?0:this.right-
b;this.x=b}});Object.defineProperty(a.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(b){this.width=b<=this.x?0:b-this.x}});Object.defineProperty(a.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(a.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}});Object.defineProperty(a.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(b){this.x=b-this.halfWidth}});
Object.defineProperty(a.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(b){this.y=b-this.halfHeight}});Object.defineProperty(a.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}});Object.defineProperty(a.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}});Object.defineProperty(a.Rectangle.prototype,"top",{get:function(){return this.y},set:function(b){b>=this.bottom?(this.height=0,this.y=
b):this.height=this.bottom-b}});Object.defineProperty(a.Rectangle.prototype,"topLeft",{get:function(){return new a.Point(this.x,this.y)},set:function(b){this.x=b.x;this.y=b.y}});Object.defineProperty(a.Rectangle.prototype,"topRight",{get:function(){return new a.Point(this.x+this.width,this.y)},set:function(b){this.right=b.x;this.y=b.y}});Object.defineProperty(a.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(b){!0===b&&this.setTo(0,0,0,0)}});a.Rectangle.prototype.constructor=
a.Rectangle;a.Rectangle.inflate=function(b,c,a){return b.x-=c,b.width+=2*c,b.y-=a,b.height+=2*a,b};a.Rectangle.inflatePoint=function(b,c){return a.Rectangle.inflate(b,c.x,c.y)};a.Rectangle.size=function(b,c){return"undefined"==typeof c||null===c?c=new a.Point(b.width,b.height):c.setTo(b.width,b.height),c};a.Rectangle.clone=function(b,c){return"undefined"==typeof c||null===c?c=new a.Rectangle(b.x,b.y,b.width,b.height):c.setTo(b.x,b.y,b.width,b.height),c};a.Rectangle.contains=function(b,c,a){return 0>=
b.width||0>=b.height?!1:c>=b.x&&c<b.right&&a>=b.y&&a<b.bottom};a.Rectangle.containsRaw=function(b,c,a,d,f,k){return f>=b&&b+a>f&&k>=c&&c+d>k};a.Rectangle.containsPoint=function(b,c){return a.Rectangle.contains(b,c.x,c.y)};a.Rectangle.containsRect=function(b,c){return b.volume>c.volume?!1:b.x>=c.x&&b.y>=c.y&&b.right<c.right&&b.bottom<c.bottom};a.Rectangle.equals=function(b,c){return b.x==c.x&&b.y==c.y&&b.width==c.width&&b.height==c.height};a.Rectangle.sameDimensions=function(b,c){return b.width===
c.width&&b.height===c.height};a.Rectangle.intersection=function(b,c,e){return"undefined"==typeof e&&(e=new a.Rectangle),a.Rectangle.intersects(b,c)&&(e.x=Math.max(b.x,c.x),e.y=Math.max(b.y,c.y),e.width=Math.min(b.right,c.right)-e.x,e.height=Math.min(b.bottom,c.bottom)-e.y),e};a.Rectangle.intersects=function(b,c){return 0>=b.width||0>=b.height||0>=c.width||0>=c.height?!1:!(b.right<c.x||b.bottom<c.y||b.x>c.right||b.y>c.bottom)};a.Rectangle.intersectsRaw=function(b,c,a,d,f,k){return"undefined"==typeof k&&
(k=0),!(c>b.right+k||a<b.left-k||d>b.bottom+k||f<b.top-k)};a.Rectangle.union=function(b,c,e){return"undefined"==typeof e&&(e=new a.Rectangle),e.setTo(Math.min(b.x,c.x),Math.min(b.y,c.y),Math.max(b.right,c.right)-Math.min(b.left,c.left),Math.max(b.bottom,c.bottom)-Math.min(b.top,c.top))};a.Rectangle.aabb=function(b,c){"undefined"==typeof c&&(c=new a.Rectangle);var e=Number.MIN_VALUE,d=Number.MAX_VALUE,f=Number.MIN_VALUE,k=Number.MAX_VALUE;return b.forEach(function(b){b.x>e&&(e=b.x);b.x<d&&(d=b.x);
b.y>f&&(f=b.y);b.y<k&&(k=b.y)}),c.setTo(d,k,e-d,f-k),c};PIXI.Rectangle=a.Rectangle;PIXI.EmptyRectangle=new a.Rectangle(0,0,0,0);a.RoundedRectangle=function(b,c,e,d,f){this.x=b||0;this.y=c||0;this.width=e||0;this.height=d||0;this.radius=f||20;this.type=a.ROUNDEDRECTANGLE};a.RoundedRectangle.prototype.clone=function(){return new a.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};a.RoundedRectangle.prototype.contains=function(b,c){if(0>=this.width||0>=this.height)return!1;var a=this.x;
return b>=a&&b<=a+this.width&&(a=this.y,c>=a&&c<=a+this.height)?!0:!1};a.RoundedRectangle.prototype.constructor=a.RoundedRectangle;PIXI.RoundedRectangle=a.RoundedRectangle;a.Camera=function(b,c,e,d,f,k){this.game=b;this.world=b.world;this.id=0;this.view=new a.Rectangle(e,d,f,k);this.screenView=new a.Rectangle(e,d,f,k);this.bounds=new a.Rectangle(e,d,f,k);this.deadzone=null;this.roundPx=this.visible=!0;this.atLimit={x:!1,y:!1};this.scale=this.displayObject=this.target=null;this.totalInView=0;this._targetPosition=
new a.Point;this._edge=0;this._position=new a.Point};a.Camera.FOLLOW_LOCKON=0;a.Camera.FOLLOW_PLATFORMER=1;a.Camera.FOLLOW_TOPDOWN=2;a.Camera.FOLLOW_TOPDOWN_TIGHT=3;a.Camera.prototype={preUpdate:function(){this.totalInView=0},follow:function(b,c){"undefined"==typeof c&&(c=a.Camera.FOLLOW_LOCKON);this.target=b;var e;switch(c){case a.Camera.FOLLOW_PLATFORMER:e=this.width/8;var d=this.height/3;this.deadzone=new a.Rectangle((this.width-e)/2,(this.height-d)/2-.25*d,e,d);break;case a.Camera.FOLLOW_TOPDOWN:e=
Math.max(this.width,this.height)/4;this.deadzone=new a.Rectangle((this.width-e)/2,(this.height-e)/2,e,e);break;case a.Camera.FOLLOW_TOPDOWN_TIGHT:e=Math.max(this.width,this.height)/8;this.deadzone=new a.Rectangle((this.width-e)/2,(this.height-e)/2,e,e);break;case a.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(b){this.setPosition(Math.round(b.x-this.view.halfWidth),Math.round(b.y-this.view.halfHeight))},focusOnXY:function(b,
c){this.setPosition(Math.round(b-this.view.halfWidth),Math.round(c-this.view.halfHeight))},update:function(){this.target&&this.updateTarget();this.bounds&&this.checkBounds();this.roundPx&&this.view.floor();this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){this._targetPosition.copyFrom(this.target);this.target.parent&&this._targetPosition.multiply(this.target.parent.worldTransform.a,this.target.parent.worldTransform.d);this.deadzone?(this._edge=
this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this._targetPosition.x-this.deadzone.left:this._edge>this.deadzone.right&&(this.view.x=this._targetPosition.x-this.deadzone.right),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this._targetPosition.y-this.deadzone.top:this._edge>this.deadzone.bottom&&(this.view.y=this._targetPosition.y-this.deadzone.bottom)):(this.view.x=this._targetPosition.x-this.view.halfWidth,this.view.y=this._targetPosition.y-
this.view.halfHeight)},setBoundsToWorld:function(){this.bounds&&this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=!1;this.atLimit.y=!1;this.view.x<=this.bounds.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x);this.view.right>=this.bounds.right&&(this.atLimit.x=!0,this.view.x=this.bounds.right-this.width);this.view.y<=this.bounds.top&&(this.atLimit.y=!0,this.view.y=this.bounds.top);
this.view.bottom>=this.bounds.bottom&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom-this.height)},setPosition:function(b,c){this.view.x=b;this.view.y=c;this.bounds&&this.checkBounds()},setSize:function(b,c){this.view.width=b;this.view.height=c},reset:function(){this.target=null;this.view.x=0;this.view.y=0}};a.Camera.prototype.constructor=a.Camera;Object.defineProperty(a.Camera.prototype,"x",{get:function(){return this.view.x},set:function(b){this.view.x=b;this.bounds&&this.checkBounds()}});Object.defineProperty(a.Camera.prototype,
"y",{get:function(){return this.view.y},set:function(b){this.view.y=b;this.bounds&&this.checkBounds()}});Object.defineProperty(a.Camera.prototype,"position",{get:function(){return this._position.set(this.view.centerX,this.view.centerY),this._position},set:function(b){"undefined"!=typeof b.x&&(this.view.x=b.x);"undefined"!=typeof b.y&&(this.view.y=b.y);this.bounds&&this.checkBounds()}});Object.defineProperty(a.Camera.prototype,"width",{get:function(){return this.view.width},set:function(b){this.view.width=
b}});Object.defineProperty(a.Camera.prototype,"height",{get:function(){return this.view.height},set:function(b){this.view.height=b}});a.State=function(){this.game=null;this.key="";this.rnd=this.physics=this.particles=this.world=this.tweens=this.time=this.stage=this.scale=this.sound=this.math=this.load=this.input=this.cache=this.camera=this.make=this.add=null};a.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},
render:function(){},resize:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}};a.State.prototype.constructor=a.State;a.StateManager=function(b,c){this.game=b;this.states={};this._pendingState=null;"undefined"!=typeof c&&null!==c&&(this._pendingState=c);this._created=this._clearCache=this._clearWorld=!1;this._args=[];this.current="";this.onShutDownCallback=this.onPauseUpdateCallback=this.onResumedCallback=this.onPausedCallback=this.onLoadRenderCallback=this.onLoadUpdateCallback=
this.onPreRenderCallback=this.onResizeCallback=this.onRenderCallback=this.onUpdateCallback=this.onCreateCallback=this.onPreloadCallback=this.onInitCallback=null};a.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(b,c,e){"undefined"==typeof e&&(e=!1);var d;return c instanceof a.State?d=c:"object"==typeof c?(d=
c,d.game=this.game):"function"==typeof c&&(d=new c(this.game)),this.states[b]=d,e&&(this.game.isBooted?this.start(b):this._pendingState=b),d},remove:function(b){this.current===b&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=
null,this.onResumedCallback=null,this.onPauseUpdateCallback=null);delete this.states[b]},start:function(b,c,a){"undefined"==typeof c&&(c=!0);"undefined"==typeof a&&(a=!1);this.checkState(b)&&(this._pendingState=b,this._clearWorld=c,this._clearCache=a,3<arguments.length&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(b,c){"undefined"==typeof b&&(b=!0);"undefined"==typeof c&&(c=!1);this._pendingState=this.current;this._clearWorld=b;this._clearCache=c;2<arguments.length&&(this._args=
Array.prototype.splice.call(arguments,2))},dummy:function(){},preUpdate:function(){this._pendingState&&this.game.isBooted&&(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.current===this._pendingState)&&(this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete())},
clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),!0===this._clearCache&&this.game.cache.destroy()))},checkState:function(b){if(this.states[b]){var c=!1;return(this.states[b].preload||
this.states[b].create||this.states[b].update||this.states[b].render)&&(c=!0),!1===c?(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):!0}return console.warn("Phaser.StateManager - No state found with the key: "+b),!1},link:function(b){this.states[b].game=this.game;this.states[b].add=this.game.add;this.states[b].make=this.game.make;this.states[b].camera=this.game.camera;this.states[b].cache=this.game.cache;
this.states[b].input=this.game.input;this.states[b].load=this.game.load;this.states[b].math=this.game.math;this.states[b].sound=this.game.sound;this.states[b].scale=this.game.scale;this.states[b].state=this;this.states[b].stage=this.game.stage;this.states[b].time=this.game.time;this.states[b].tweens=this.game.tweens;this.states[b].world=this.game.world;this.states[b].particles=this.game.particles;this.states[b].rnd=this.game.rnd;this.states[b].physics=this.game.physics;this.states[b].key=b},unlink:function(b){this.states[b]&&
(this.states[b].game=null,this.states[b].add=null,this.states[b].make=null,this.states[b].camera=null,this.states[b].cache=null,this.states[b].input=null,this.states[b].load=null,this.states[b].math=null,this.states[b].sound=null,this.states[b].scale=null,this.states[b].state=null,this.states[b].stage=null,this.states[b].time=null,this.states[b].tweens=null,this.states[b].world=null,this.states[b].particles=null,this.states[b].rnd=null,this.states[b].physics=null)},setCurrentState:function(b){this.callbackContext=
this.states[b];this.link(b);this.onInitCallback=this.states[b].init||this.dummy;this.onPreloadCallback=this.states[b].preload||null;this.onLoadRenderCallback=this.states[b].loadRender||null;this.onLoadUpdateCallback=this.states[b].loadUpdate||null;this.onCreateCallback=this.states[b].create||null;this.onUpdateCallback=this.states[b].update||null;this.onPreRenderCallback=this.states[b].preRender||null;this.onRenderCallback=this.states[b].render||null;this.onResizeCallback=this.states[b].resize||null;
this.onPausedCallback=this.states[b].paused||null;this.onResumedCallback=this.states[b].resumed||null;this.onPauseUpdateCallback=this.states[b].pauseUpdate||null;this.onShutDownCallback=this.states[b].shutdown||this.dummy;""!==this.current&&this.game.physics.reset();this.current=b;this._created=!1;this.onInitCallback.apply(this.callbackContext,this._args);b===this._pendingState&&(this._args=[]);this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){!1===
this._created&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created&&this.onUpdateCallback?this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&
this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created&&this.onPauseUpdateCallback?this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(b){this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,b)},resize:function(b,c){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,b,c)},render:function(){this._created&&
this.onRenderCallback?this.game.renderType===a.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this.clearCurrentState();this.game=this.onPauseUpdateCallback=this.onResumedCallback=this.onPausedCallback=this.onRenderCallback=
this.onUpdateCallback=this.onCreateCallback=this.onLoadUpdateCallback=this.onLoadRenderCallback=this.onPreloadCallback=this.onShutDownCallback=this.onInitCallback=this.callbackContext=null;this.states={};this._pendingState=null;this.current=""}};a.StateManager.prototype.constructor=a.StateManager;a.Signal=function(){};a.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(b,c){if("function"!=typeof b)throw Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",
c));},_registerListener:function(b,c,e,d){var f,k=this._indexOfListener(b,e);if(-1!==k){if(f=this._bindings[k],f.isOnce()!==c)throw Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.");}else f=new a.SignalBinding(this,b,c,e,d),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(b){this._bindings||(this._bindings=[]);var c=this._bindings.length;do c--;while(this._bindings[c]&&
b._priority<=this._bindings[c]._priority);this._bindings.splice(c+1,0,b)},_indexOfListener:function(b,c){if(!this._bindings)return-1;"undefined"==typeof c&&(c=null);for(var a,d=this._bindings.length;d--;)if(a=this._bindings[d],a._listener===b&&a.context===c)return d;return-1},has:function(b,c){return-1!==this._indexOfListener(b,c)},add:function(b,c,a){return this.validateListener(b,"add"),this._registerListener(b,!1,c,a)},addOnce:function(b,c,a){return this.validateListener(b,"addOnce"),this._registerListener(b,
!0,c,a)},remove:function(b,c){this.validateListener(b,"remove");var a=this._indexOfListener(b,c);return-1!==a&&(this._bindings[a]._destroy(),this._bindings.splice(a,1)),b},removeAll:function(b){if("undefined"==typeof b&&(b=null),this._bindings){for(var c=this._bindings.length;c--;)b?this._bindings[c].context===b&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)):this._bindings[c]._destroy();b||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:
0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var b,c=Array.prototype.slice.call(arguments),a=this._bindings.length;if(this.memorize&&(this._prevParams=c),a){b=this._bindings.slice();this._shouldPropagate=!0;do a--;while(b[a]&&this._shouldPropagate&&!1!==b[a].execute(c))}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll();this._bindings=null;this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+
this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(a.Signal.prototype,"boundDispatch",{get:function(){var b=this;return this._boundDispatch||(this._boundDispatch=function(){return b.dispatch.apply(b,arguments)})}});a.Signal.prototype.constructor=a.Signal;a.SignalBinding=function(b,c,a,d,f){this._listener=c;a&&(this._isOnce=!0);null!=d&&(this.context=d);this._signal=b;f&&(this._priority=f)};a.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,callCount:0,active:!0,
params:null,execute:function(b){var c,a;return this.active&&this._listener&&(a=this.params?this.params.concat(b):b,c=this._listener.apply(this.context,a),this.callCount++,this._isOnce&&this.detach()),c},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;
delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};a.SignalBinding.prototype.constructor=a.SignalBinding;a.Filter=function(b,c,e){this.game=b;this.type=a.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.prevPoint=new a.Point;b=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,
y:0}},date:{type:"4fv",value:[b.getFullYear(),b.getMonth(),b.getDate(),3600*b.getHours()+60*b.getMinutes()+b.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},c)for(var d in c)this.uniforms[d]=c[d];this.fragmentSrc=e||[]};a.Filter.prototype={init:function(){},
setResolution:function(b,c){this.uniforms.resolution.value.x=b;this.uniforms.resolution.value.y=c},update:function(b){if("undefined"!=typeof b){var c=b.x/this.game.width;b=1-b.y/this.game.height;c===this.prevPoint.x&&b===this.prevPoint.y||(this.uniforms.mouse.value.x=c.toFixed(2),this.uniforms.mouse.value.y=b.toFixed(2),this.prevPoint.set(c,b))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}};a.Filter.prototype.constructor=a.Filter;Object.defineProperty(a.Filter.prototype,
"width",{get:function(){return this.uniforms.resolution.value.x},set:function(b){this.uniforms.resolution.value.x=b}});Object.defineProperty(a.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(b){this.uniforms.resolution.value.y=b}});a.Plugin=function(b,c){"undefined"==typeof c&&(c=null);this.game=b;this.parent=c;this.hasPostRender=this.hasRender=this.hasPostUpdate=this.hasUpdate=this.hasPreUpdate=this.visible=this.active=!1};a.Plugin.prototype={preUpdate:function(){},
update:function(){},render:function(){},postRender:function(){},destroy:function(){this.parent=this.game=null;this.visible=this.active=!1}};a.Plugin.prototype.constructor=a.Plugin;a.PluginManager=function(b){this.game=b;this.plugins=[];this._i=this._len=0};a.PluginManager.prototype={add:function(b){var c=Array.prototype.splice.call(arguments,1),a=!1;return"function"==typeof b?b=new b(this.game,this):(b.game=this.game,b.parent=this),"function"==typeof b.preUpdate&&(b.hasPreUpdate=!0,a=!0),"function"==
typeof b.update&&(b.hasUpdate=!0,a=!0),"function"==typeof b.postUpdate&&(b.hasPostUpdate=!0,a=!0),"function"==typeof b.render&&(b.hasRender=!0,a=!0),"function"==typeof b.postRender&&(b.hasPostRender=!0,a=!0),a?((b.hasPreUpdate||b.hasUpdate||b.hasPostUpdate)&&(b.active=!0),(b.hasRender||b.hasPostRender)&&(b.visible=!0),this._len=this.plugins.push(b),"function"==typeof b.init&&b.init.apply(b,c),b):null},remove:function(b){for(this._i=this._len;this._i--;)if(this.plugins[this._i]===b)return b.destroy(),
this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this._len=this.plugins.length=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=
this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll();this.game=null}};a.PluginManager.prototype.constructor=
a.PluginManager;a.Stage=function(b){this.game=b;PIXI.Stage.call(this,0);this.name="_stage_root";this.disableVisibilityChange=!1;this.exists=!0;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._backgroundColor=0;b.config&&this.parseConfig(b.config)};a.Stage.prototype=Object.create(PIXI.Stage.prototype);a.Stage.prototype.constructor=a.Stage;a.Stage.prototype.parseConfig=function(b){b.disableVisibilityChange&&(this.disableVisibilityChange=b.disableVisibilityChange);b.backgroundColor&&
(this.backgroundColor=b.backgroundColor)};a.Stage.prototype.boot=function(){a.DOM.getOffset(this.game.canvas,this.offset);a.Canvas.setUserSelect(this.game.canvas,"none");a.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};a.Stage.prototype.preUpdate=function(){for(var b=this.currentRenderOrderID=0;b<this.children.length;b++)this.children[b].preUpdate()};a.Stage.prototype.update=function(){for(var b=this.children.length;b--;)this.children[b].update()};a.Stage.prototype.postUpdate=
function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate();this.game.world.camera.update();for(var b=this.children.length;b--;)this.children[b]!==this.game.world.camera.target&&this.children[b].postUpdate()}else for(this.game.world.camera.update(),b=this.children.length;b--;)this.children[b].postUpdate()};a.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var b=0;b<this.children.length;b++)this.children[b].updateTransform()};a.Stage.prototype.checkVisibility=
function(){this._hiddenVar=void 0!==document.webkitHidden?"webkitvisibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":void 0!==document.hidden?"visibilitychange":null;var b=this;this._onChange=function(c){return b.visibilityChange(c)};this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1);window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;
this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){a.Stage.prototype.visibilityChange.call(b,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){a.Stage.prototype.visibilityChange.call(b,{type:"resume"})}))};a.Stage.prototype.visibilityChange=function(b){return"pagehide"===b.type||"blur"===b.type||"pageshow"===b.type||"focus"===b.type?void("pagehide"===b.type||"blur"===b.type?this.game.focusLoss(b):("pageshow"===b.type||"focus"===b.type)&&this.game.focusGain(b)):
void(this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===b.type?this.game.gamePaused(b):this.game.gameResumed(b)))};a.Stage.prototype.setBackgroundColor=function(b){b=a.Color.valueToColor(b);this._backgroundColor=a.Color.getColor(b.r,b.g,b.b);this.backgroundColorSplit=[b.r/255,b.g/255,b.b/255];this.backgroundColorString=a.Color.RGBtoString(b.r,b.g,b.b,255,"#")};a.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,
this._onChange,!1);window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(a.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(b){this.game.transparent||this.setBackgroundColor(b)}});Object.defineProperty(a.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(b){PIXI.scaleModes.DEFAULT=b?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}});a.Group=
function(b,c,e,d,f,k){"undefined"==typeof d&&(d=!1);"undefined"==typeof f&&(f=!1);"undefined"==typeof k&&(k=a.Physics.ARCADE);this.game=b;"undefined"==typeof c&&(c=b.world);this.name=e||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);d?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):c&&(c.addChild(this),this.z=c.children.length);this.physicsType=this.type=a.GROUP;this.exists=this.alive=!0;this.ignoreDestroy=!1;this.classType=a.Sprite;this.scale=new a.Point(1,1);this.cursor=
null;this.enableBody=f;this.enableBodyDebug=!1;this.physicsBodyType=k;this.onDestroy=new a.Signal;this.cursorIndex=0;this.fixedToCamera=!1;this.cameraOffset=new a.Point;this._hash=[];this._sortProperty="z"};a.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);a.Group.prototype.constructor=a.Group;a.Group.RETURN_NONE=0;a.Group.RETURN_TOTAL=1;a.Group.RETURN_CHILD=2;a.Group.SORT_ASCENDING=-1;a.Group.SORT_DESCENDING=1;a.Group.prototype.add=function(b,c){return"undefined"==typeof c&&
(c=!1),b.parent!==this&&(this.enableBody&&this.game.physics.enable(b,this.physicsBodyType),this.addChild(b),this._hash.push(b),b.z=this.children.length,!c&&b.events&&b.events.onAddedToGroup$dispatch(b,this),null===this.cursor&&(this.cursor=b)),b};a.Group.prototype.addMultiple=function(b,c){if(Array.isArray(b))for(var a=0;a<b.length;a++)this.add(b[a],c);return b};a.Group.prototype.addAt=function(b,c,a){return"undefined"==typeof a&&(a=!1),b.parent!==this&&(this.enableBody&&this.game.physics.enable(b,
this.physicsBodyType),this.addChildAt(b,c),this._hash.push(b),this.updateZ(),!a&&b.events&&b.events.onAddedToGroup$dispatch(b,this),null===this.cursor&&(this.cursor=b)),b};a.Group.prototype.getAt=function(b){return 0>b||b>=this.children.length?-1:this.getChildAt(b)};a.Group.prototype.create=function(b,c,a,d,f){"undefined"==typeof f&&(f=!0);b=new this.classType(this.game,b,c,a,d);return this.enableBody&&this.game.physics.enable(b,this.physicsBodyType,this.enableBodyDebug),b.exists=f,b.visible=f,b.alive=
f,this.addChild(b),this._hash.push(b),b.z=this.children.length,b.events&&b.events.onAddedToGroup$dispatch(b,this),null===this.cursor&&(this.cursor=b),b};a.Group.prototype.createMultiple=function(b,c,a,d){"undefined"==typeof d&&(d=!1);for(var f=0;b>f;f++)this.create(0,0,c,a,d)};a.Group.prototype.updateZ=function(){for(var b=this.children.length;b--;)this.children[b].z=b};a.Group.prototype.resetCursor=function(b){return"undefined"==typeof b&&(b=0),b>this.children.length-1&&(b=0),this.cursor?(this.cursorIndex=
b,this.cursor=this.children[this.cursorIndex],this.cursor):void 0};a.Group.prototype.next=function(){return this.cursor?(this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor):void 0};a.Group.prototype.previous=function(){return this.cursor?(0===this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor):void 0};a.Group.prototype.swap=function(b,
c){this.swapChildren(b,c);this.updateZ()};a.Group.prototype.bringToTop=function(b){return b.parent===this&&this.getIndex(b)<this.children.length&&(this.remove(b,!1,!0),this.add(b,!0)),b};a.Group.prototype.sendToBack=function(b){return b.parent===this&&0<this.getIndex(b)&&(this.remove(b,!1,!0),this.addAt(b,0,!0)),b};a.Group.prototype.moveUp=function(b){if(b.parent===this&&this.getIndex(b)<this.children.length-1){var c=this.getIndex(b);(c=this.getAt(c+1))&&this.swap(b,c)}return b};a.Group.prototype.moveDown=
function(b){if(b.parent===this&&0<this.getIndex(b)){var c=this.getIndex(b);(c=this.getAt(c-1))&&this.swap(b,c)}return b};a.Group.prototype.xy=function(b,c,a){return 0>b||b>this.children.length?-1:(this.getChildAt(b).x=c,void(this.getChildAt(b).y=a))};a.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};a.Group.prototype.getIndex=function(b){return this.children.indexOf(b)};a.Group.prototype.replace=function(b,c){var e=this.getIndex(b);return-1!==e?(c.parent&&(c.parent instanceof
a.Group?c.parent.remove(c):c.parent.removeChild(c)),this.remove(b),this.addAt(c,e),b):void 0};a.Group.prototype.hasProperty=function(b,c){var a=c.length;return 1===a&&c[0]in b?!0:2===a&&c[0]in b&&c[1]in b[c[0]]?!0:3===a&&c[0]in b&&c[1]in b[c[0]]&&c[2]in b[c[0]][c[1]]?!0:4===a&&c[0]in b&&c[1]in b[c[0]]&&c[2]in b[c[0]][c[1]]&&c[3]in b[c[0]][c[1]][c[2]]?!0:!1};a.Group.prototype.setProperty=function(b,c,a,d,f){if("undefined"==typeof f&&(f=!1),d=d||0,!this.hasProperty(b,c)&&(!f||0<d))return!1;f=c.length;
return 1===f?0===d?b[c[0]]=a:1==d?b[c[0]]+=a:2==d?b[c[0]]-=a:3==d?b[c[0]]*=a:4==d&&(b[c[0]]/=a):2===f?0===d?b[c[0]][c[1]]=a:1==d?b[c[0]][c[1]]+=a:2==d?b[c[0]][c[1]]-=a:3==d?b[c[0]][c[1]]*=a:4==d&&(b[c[0]][c[1]]/=a):3===f?0===d?b[c[0]][c[1]][c[2]]=a:1==d?b[c[0]][c[1]][c[2]]+=a:2==d?b[c[0]][c[1]][c[2]]-=a:3==d?b[c[0]][c[1]][c[2]]*=a:4==d&&(b[c[0]][c[1]][c[2]]/=a):4===f&&(0===d?b[c[0]][c[1]][c[2]][c[3]]=a:1==d?b[c[0]][c[1]][c[2]][c[3]]+=a:2==d?b[c[0]][c[1]][c[2]][c[3]]-=a:3==d?b[c[0]][c[1]][c[2]][c[3]]*=
a:4==d&&(b[c[0]][c[1]][c[2]][c[3]]/=a)),!0};a.Group.prototype.checkProperty=function(b,c,e,d){return"undefined"==typeof d&&(d=!1),!a.Utils.getProperty(b,c)&&d?!1:a.Utils.getProperty(b,c)!==e?!1:!0};a.Group.prototype.set=function(b,c,a,d,f,k,n){return"undefined"==typeof n&&(n=!1),c=c.split("."),"undefined"==typeof d&&(d=!1),"undefined"==typeof f&&(f=!1),(!1===d||d&&b.alive)&&(!1===f||f&&b.visible)?this.setProperty(b,c,a,k,n):void 0};a.Group.prototype.setAll=function(b,c,a,d,f,k){"undefined"==typeof a&&
(a=!1);"undefined"==typeof d&&(d=!1);"undefined"==typeof k&&(k=!1);b=b.split(".");f=f||0;for(var n=0;n<this.children.length;n++)(!a||a&&this.children[n].alive)&&(!d||d&&this.children[n].visible)&&this.setProperty(this.children[n],b,c,f,k)};a.Group.prototype.setAllChildren=function(b,c,e,d,f,k){"undefined"==typeof e&&(e=!1);"undefined"==typeof d&&(d=!1);"undefined"==typeof k&&(k=!1);f=f||0;for(var n=0;n<this.children.length;n++)(!e||e&&this.children[n].alive)&&(!d||d&&this.children[n].visible)&&(this.children[n]instanceof
a.Group?this.children[n].setAllChildren(b,c,e,d,f,k):this.setProperty(this.children[n],b.split("."),c,f,k))};a.Group.prototype.checkAll=function(b,c,a,d,f){"undefined"==typeof a&&(a=!1);"undefined"==typeof d&&(d=!1);"undefined"==typeof f&&(f=!1);for(var k=0;k<this.children.length;k++)if((!a||a&&this.children[k].alive)&&(!d||d&&this.children[k].visible)&&!this.checkProperty(this.children[k],b,c,f))return!1;return!0};a.Group.prototype.addAll=function(b,c,a,d){this.setAll(b,c,a,d,1)};a.Group.prototype.subAll=
function(b,c,a,d){this.setAll(b,c,a,d,2)};a.Group.prototype.multiplyAll=function(b,c,a,d){this.setAll(b,c,a,d,3)};a.Group.prototype.divideAll=function(b,c,a,d){this.setAll(b,c,a,d,4)};a.Group.prototype.callAllExists=function(b,c){var a;if(2<arguments.length){a=[];for(var d=2;d<arguments.length;d++)a.push(arguments[d])}for(d=0;d<this.children.length;d++)this.children[d].exists===c&&this.children[d][b]&&this.children[d][b].apply(this.children[d],a)};a.Group.prototype.callbackFromArray=function(b,c,
a){if(1==a){if(b[c[0]])return b[c[0]]}else if(2==a){if(b[c[0]][c[1]])return b[c[0]][c[1]]}else if(3==a){if(b[c[0]][c[1]][c[2]])return b[c[0]][c[1]][c[2]]}else if(4==a){if(b[c[0]][c[1]][c[2]][c[3]])return b[c[0]][c[1]][c[2]][c[3]]}else if(b[c])return b[c];return!1};a.Group.prototype.callAll=function(b,c){if("undefined"!=typeof b){b=b.split(".");var a=b.length;if("undefined"==typeof c||null===c||""===c)c=null;else if("string"==typeof c){c=c.split(".");var d=c.length}var f;if(2<arguments.length){f=[];
for(var k=2;k<arguments.length;k++)f.push(arguments[k])}for(var n=null,g=null,k=0;k<this.children.length;k++)n=this.callbackFromArray(this.children[k],b,a),c&&n?(g=this.callbackFromArray(this.children[k],c,d),n&&n.apply(g,f)):n&&n.apply(this.children[k],f)}};a.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var b=this.children.length;b--;)this.children[b].preUpdate();return!0};a.Group.prototype.update=function(){for(var b=this.children.length;b--;)this.children[b].update()};
a.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var b=this.children.length;b--;)this.children[b].postUpdate()};a.Group.prototype.filter=function(b,c){for(var e=-1,d=this.children.length,f=[];++e<d;){var k=this.children[e];(!c||c&&k.exists)&&b(k,e,this.children)&&f.push(k)}return new a.ArraySet(f)};a.Group.prototype.forEach=function(b,c,a){if("undefined"==typeof a&&(a=!1),3>=arguments.length)for(var d=
0;d<this.children.length;d++)(!a||a&&this.children[d].exists)&&b.call(c,this.children[d]);else{for(var f=[null],d=3;d<arguments.length;d++)f.push(arguments[d]);for(d=0;d<this.children.length;d++)(!a||a&&this.children[d].exists)&&(f[0]=this.children[d],b.apply(c,f))}};a.Group.prototype.forEachExists=function(b,c){var e;if(2<arguments.length){e=[null];for(var d=2;d<arguments.length;d++)e.push(arguments[d])}this.iterate("exists",!0,a.Group.RETURN_TOTAL,b,c,e)};a.Group.prototype.forEachAlive=function(b,
c){var e;if(2<arguments.length){e=[null];for(var d=2;d<arguments.length;d++)e.push(arguments[d])}this.iterate("alive",!0,a.Group.RETURN_TOTAL,b,c,e)};a.Group.prototype.forEachDead=function(b,c){var e;if(2<arguments.length){e=[null];for(var d=2;d<arguments.length;d++)e.push(arguments[d])}this.iterate("alive",!1,a.Group.RETURN_TOTAL,b,c,e)};a.Group.prototype.sort=function(b,c){2>this.children.length||("undefined"==typeof b&&(b="z"),"undefined"==typeof c&&(c=a.Group.SORT_ASCENDING),this._sortProperty=
b,this.children.sort(c===a.Group.SORT_ASCENDING?this.ascendingSortHandler.bind(this):this.descendingSortHandler.bind(this)),this.updateZ())};a.Group.prototype.customSort=function(b,c){2>this.children.length||(this.children.sort(b.bind(c)),this.updateZ())};a.Group.prototype.ascendingSortHandler=function(b,c){return b[this._sortProperty]<c[this._sortProperty]?-1:b[this._sortProperty]>c[this._sortProperty]?1:b.z<c.z?-1:1};a.Group.prototype.descendingSortHandler=function(b,c){return b[this._sortProperty]<
c[this._sortProperty]?1:b[this._sortProperty]>c[this._sortProperty]?-1:0};a.Group.prototype.iterate=function(b,c,e,d,f,k){if(e===a.Group.RETURN_TOTAL&&0===this.children.length)return 0;for(var n=0,g=0;g<this.children.length;g++)if(this.children[g][b]===c&&(n++,d&&(k?(k[0]=this.children[g],d.apply(f,k)):d.call(f,this.children[g])),e===a.Group.RETURN_CHILD))return this.children[g];return e===a.Group.RETURN_TOTAL?n:null};a.Group.prototype.getFirstExists=function(b){return"boolean"!=typeof b&&(b=!0),
this.iterate("exists",b,a.Group.RETURN_CHILD)};a.Group.prototype.getFirstAlive=function(){return this.iterate("alive",!0,a.Group.RETURN_CHILD)};a.Group.prototype.getFirstDead=function(){return this.iterate("alive",!1,a.Group.RETURN_CHILD)};a.Group.prototype.getTop=function(){return 0<this.children.length?this.children[this.children.length-1]:void 0};a.Group.prototype.getBottom=function(){return 0<this.children.length?this.children[0]:void 0};a.Group.prototype.countLiving=function(){return this.iterate("alive",
!0,a.Group.RETURN_TOTAL)};a.Group.prototype.countDead=function(){return this.iterate("alive",!1,a.Group.RETURN_TOTAL)};a.Group.prototype.getRandom=function(b,c){return 0===this.children.length?null:(b=b||0,c=c||this.children.length,a.ArrayUtils.getRandomItem(this.children,b,c))};a.Group.prototype.remove=function(b,c,a){if("undefined"==typeof c&&(c=!1),"undefined"==typeof a&&(a=!1),0===this.children.length||-1===this.children.indexOf(b))return!1;a||!b.events||b.destroyPhase||b.events.onRemovedFromGroup$dispatch(b,
this);a=this.removeChild(b);var d=this._hash.indexOf(a);return-1!==d&&this._hash.splice(d,1),this.updateZ(),this.cursor===b&&this.next(),c&&a&&a.destroy(!0),!0};a.Group.prototype.removeAll=function(b,c){if("undefined"==typeof b&&(b=!1),"undefined"==typeof c&&(c=!1),0!==this.children.length){do{!c&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var a=this.removeChild(this.children[0]),d=this._hash.indexOf(a);-1!==d&&this._hash.splice(d,1);b&&a&&
a.destroy(!0)}while(0<this.children.length);this._hash=[];this.cursor=null}};a.Group.prototype.removeBetween=function(b,c,a,d){if("undefined"==typeof c&&(c=this.children.length-1),"undefined"==typeof a&&(a=!1),"undefined"==typeof d&&(d=!1),0!==this.children.length){if(b>c||0>b||c>this.children.length)return!1;for(;c>=b;){!d&&this.children[c].events&&this.children[c].events.onRemovedFromGroup$dispatch(this.children[c],this);var f=this.removeChild(this.children[c]),k=this._hash.indexOf(f);-1!==k&&this._hash.splice(k,
1);a&&f&&f.destroy(!0);this.cursor===this.children[c]&&(this.cursor=null);c--}this.updateZ()}};a.Group.prototype.destroy=function(b,c){null===this.game||this.ignoreDestroy||("undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=!1),this.onDestroy.dispatch(this,b,c),this.removeAll(b),this.cursor=null,this.filters=null,c||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))};Object.defineProperty(a.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,a.Group.RETURN_TOTAL)}});
Object.defineProperty(a.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(a.Group.prototype,"angle",{get:function(){return a.Math.radToDeg(this.rotation)},set:function(b){this.rotation=a.Math.degToRad(b)}});a.World=function(b){a.Group.call(this,b,null,"__world",!1);this.bounds=new a.Rectangle(0,0,b.width,b.height);this.camera=null;this._definedSize=!1;this._width=b.width;this._height=b.height};a.World.prototype=Object.create(a.Group.prototype);a.World.prototype.constructor=
a.World;a.World.prototype.boot=function(){this.camera=new a.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this;this.camera.scale=this.scale;this.game.camera=this.camera;this.game.stage.addChild(this)};a.World.prototype.setBounds=function(b,c,a,d){this._definedSize=!0;this._width=a;this._height=d;this.bounds.setTo(b,c,a,d);this.x=b;this.y=c;this.camera.bounds&&this.camera.bounds.setTo(b,c,Math.max(a,this.game.width),Math.max(d,this.game.height));this.game.physics.setBoundsToWorld()};
a.World.prototype.resize=function(b,c){this._definedSize&&(b<this._width&&(b=this._width),c<this._height&&(c=this._height));this.bounds.width=b;this.bounds.height=c;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};a.World.prototype.shutdown=function(){this.destroy(!0,!0)};a.World.prototype.wrap=function(b,c,a,d,f){"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a=!1);"undefined"==typeof d&&(d=!0);"undefined"==typeof f&&(f=!0);a?(b.getBounds(),d&&(b.x+b._currentBounds.width<
this.bounds.x?b.x=this.bounds.right:b.x>this.bounds.right&&(b.x=this.bounds.left)),f&&(b.y+b._currentBounds.height<this.bounds.top?b.y=this.bounds.bottom:b.y>this.bounds.bottom&&(b.y=this.bounds.top))):(d&&b.x+c<this.bounds.x?b.x=this.bounds.right+c:d&&b.x-c>this.bounds.right&&(b.x=this.bounds.left-c),f&&b.y+c<this.bounds.top?b.y=this.bounds.bottom+c:f&&b.y-c>this.bounds.bottom&&(b.y=this.bounds.top-c))};Object.defineProperty(a.World.prototype,"width",{get:function(){return this.bounds.width},set:function(b){b<
this.game.width&&(b=this.game.width);this._width=this.bounds.width=b;this._definedSize=!0}});Object.defineProperty(a.World.prototype,"height",{get:function(){return this.bounds.height},set:function(b){b<this.game.height&&(b=this.game.height);this._height=this.bounds.height=b;this._definedSize=!0}});Object.defineProperty(a.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}});Object.defineProperty(a.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}});Object.defineProperty(a.World.prototype,
"randomX",{get:function(){return 0>this.bounds.x?this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}});Object.defineProperty(a.World.prototype,"randomY",{get:function(){return 0>this.bounds.y?this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}});a.FlexGrid=function(b,c,e){this.game=b.game;this.manager=b;
this.width=c;this.height=e;this.boundsCustom=new a.Rectangle(0,0,c,e);this.boundsFluid=new a.Rectangle(0,0,c,e);this.boundsFull=new a.Rectangle(0,0,c,e);this.boundsNone=new a.Rectangle(0,0,c,e);this.positionCustom=new a.Point(0,0);this.positionFluid=new a.Point(0,0);this.positionFull=new a.Point(0,0);this.positionNone=new a.Point(0,0);this.scaleCustom=new a.Point(1,1);this.scaleFluid=new a.Point(1,1);this.scaleFluidInversed=new a.Point(1,1);this.scaleFull=new a.Point(1,1);this.scaleNone=new a.Point(1,
1);this.customOffsetY=this.customOffsetX=this.customHeight=this.customWidth=0;this.ratioH=c/e;this.ratioV=e/c;this.multiplier=0;this.layers=[]};a.FlexGrid.prototype={setSize:function(b,c){this.width=b;this.height=c;this.ratioH=b/c;this.ratioV=c/b;this.scaleNone=new a.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(b,c,e,d){"undefined"==typeof d&&(d=!0);this.customWidth=b;this.customHeight=c;this.boundsCustom.width=b;this.boundsCustom.height=
c;b=new a.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return d&&this.game.world.add(b),this.layers.push(b),"undefined"!=typeof e&&null!==typeof e&&b.addMultiple(e),b},createFluidLayer:function(b,c){"undefined"==typeof c&&(c=!0);var e=new a.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return c&&this.game.world.add(e),this.layers.push(e),"undefined"!=typeof b&&null!==typeof b&&e.addMultiple(b),e},createFullLayer:function(b){var c=new a.FlexLayer(this,
this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(c),this.layers.push(c),"undefined"!=typeof b&&c.addMultiple(b),c},createFixedLayer:function(b){var c=new a.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(c),this.layers.push(c),"undefined"!=typeof b&&c.addMultiple(b),c},reset:function(){for(var b=this.layers.length;b--;)this.layers[b].persist||(this.layers[b].position=null,this.layers[b].scale=null,this.layers.slice(b,1))},onResize:function(b,
c){this.ratioH=b/c;this.ratioV=c/b;this.refresh(b,c)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width);this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/
this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(b){this.manager.scaleSprite(b);
b.x=this.manager.bounds.centerX;b.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}};a.FlexGrid.prototype.constructor=a.FlexGrid;a.FlexLayer=function(b,c,e,d){a.Group.call(this,b.game,null,"__flexLayer"+b.game.rnd.uuid(),!1);this.manager=b.manager;this.grid=b;this.persist=!1;this.position=c;this.bounds=e;this.scale=d;this.topLeft=
e.topLeft;this.topMiddle=new a.Point(e.halfWidth,0);this.topRight=e.topRight;this.bottomLeft=e.bottomLeft;this.bottomMiddle=new a.Point(e.halfWidth,e.bottom);this.bottomRight=e.bottomRight};a.FlexLayer.prototype=Object.create(a.Group.prototype);a.FlexLayer.prototype.constructor=a.FlexLayer;a.FlexLayer.prototype.resize=function(){};a.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,
"rgba(0,0,255,0.9",!1);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};a.ScaleManager=function(b,c,e){this.game=b;this.dom=a.DOM;this.grid=null;this.height=this.width=0;this.maxHeight=this.minHeight=this.maxWidth=this.minWidth=null;this.offset=new a.Point;this._pageAlignVertically=this._pageAlignHorizontally=this.incorrectOrientation=this.forcePortrait=this.forceLandscape=
!1;this.maxIterations=5;this.onOrientationChange=new a.Signal;this.enterLandscape=new a.Signal;this.enterPortrait=new a.Signal;this.enterIncorrectOrientation=new a.Signal;this.leaveIncorrectOrientation=new a.Signal;this._createdFullScreenTarget=this.fullScreenTarget=null;this.onFullScreenInit=new a.Signal;this.onFullScreenChange=new a.Signal;this.onFullScreenError=new a.Signal;this.enterFullScreen=new a.Signal;this.leaveFullScreen=new a.Signal;this.fullScreenFailed=this.onFullScreenError;this.screenOrientation=
this.dom.getScreenOrientation();this.scaleFactor=new a.Point(1,1);this.scaleFactorInversed=new a.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new a.Rectangle;this.sourceAspectRatio=this.aspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""};this._fullScreenScaleMode=this._scaleMode=
a.ScaleManager.NO_SCALE;this.parentIsWindow=!1;this.parentNode=null;this.parentScaleFactor=new a.Point(1,1);this.trackParentInterval=2E3;this.onSizeChange=new a.Signal;this._fullScreenRestore=this.onResizeContext=this.onResize=null;this._gameSize=new a.Rectangle;this._userScaleFactor=new a.Point(1,1);this._userScaleTrim=new a.Point(0,0);this._updateThrottle=this._lastUpdate=0;this._updateThrottleReset=100;this._parentBounds=new a.Rectangle;this._tempBounds=new a.Rectangle;this._lastReportedCanvasSize=
new a.Rectangle;this._lastReportedGameSize=new a.Rectangle;b.config&&this.parseConfig(b.config);this.setupScale(c,e)};a.ScaleManager.EXACT_FIT=0;a.ScaleManager.NO_SCALE=1;a.ScaleManager.SHOW_ALL=2;a.ScaleManager.RESIZE=3;a.ScaleManager.USER_SCALE=4;a.ScaleManager.prototype={boot:function(){var b=this.compatibility;b.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(b.scrollTo=this.game.device.android&&
!this.game.device.chrome?new a.Point(0,1):new a.Point(0,0));this.game.device.desktop?(b.orientationFallback="screen",b.clickTrampoline="when-not-mouse"):(b.orientationFallback="",b.clickTrampoline="");var c=this;this._orientationChange=function(b){return c.orientationChange(b)};this._windowResize=function(b){return c.windowResize(b)};window.addEventListener("orientationchange",this._orientationChange,!1);window.addEventListener("resize",this._windowResize,!1);this.compatibility.supportsFullScreen&&
(this._fullScreenChange=function(b){return c.fullScreenChange(b)},this._fullScreenError=function(b){return c.fullScreenError(b)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),
document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1));this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);
this.grid=new a.FlexGrid(this,this.width,this.height)},parseConfig:function(b){b.scaleMode&&(this.scaleMode=b.scaleMode);b.fullScreenScaleMode&&(this.fullScreenScaleMode=b.fullScreenScaleMode);b.fullScreenTarget&&(this.fullScreenTarget=b.fullScreenTarget)},setupScale:function(b,c){var e,d=new a.Rectangle;""!==this.game.parent&&("string"==typeof this.game.parent?e=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(e=this.game.parent));e?(this.parentNode=e,this.parentIsWindow=
!1,this.getParentBounds(this._parentBounds),d.width=this._parentBounds.width,d.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,d.width=this.dom.visualBounds.width,d.height=this.dom.visualBounds.height,this.offset.set(0,0));var f=e=0;"number"==typeof b?e=b:(this.parentScaleFactor.x=parseInt(b,10)/100,e=d.width*this.parentScaleFactor.x);"number"==typeof c?f=c:(this.parentScaleFactor.y=parseInt(c,10)/100,f=d.height*
this.parentScaleFactor.y);this._gameSize.setTo(0,0,e,f);this.updateDimensions(e,f,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(b,c){this._gameSize.setTo(0,0,b,c);this.currentScaleMode!==a.ScaleManager.RESIZE&&this.updateDimensions(b,c,!0);this.queueUpdate(!0)},setUserScale:function(b,c,a,d){this._userScaleFactor.setTo(b,c);this._userScaleTrim.setTo(0|a,0|d);this.queueUpdate(!0)},setResizeCallback:function(b,c){this.onResize=b;this.onResizeContext=c},signalSizeChange:function(){if(!a.Rectangle.sameDimensions(this,
this._lastReportedCanvasSize)||!a.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var b=this.width,c=this.height;this._lastReportedCanvasSize.setTo(0,0,b,c);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);this.grid.onResize(b,c);this.onSizeChange.dispatch(this,b,c);this.currentScaleMode===a.ScaleManager.RESIZE&&(this.game.state.resize(b,c),this.game.load.resize(b,c))}},setMinMax:function(b,c,a,d){this.minWidth=b;this.minHeight=c;"undefined"!=typeof a&&(this.maxWidth=
a);"undefined"!=typeof d&&(this.maxHeight=d)},preUpdate:function(){if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){var b=this._updateThrottle;this._updateThrottleReset=400<=b?0:100;this.dom.getOffset(this.game.canvas,this.offset);var c=this._parentBounds.width,e=this._parentBounds.height,d=this.getParentBounds(this._parentBounds),c=d.width!==c||d.height!==e,e=this.updateOrientationState();(c||e)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,d),this.updateLayout(),
this.signalSizeChange());d=2*this._updateThrottle;this._updateThrottle<b&&(d=Math.min(b,this._updateThrottleReset));this._updateThrottle=a.Math.clamp(d,25,this.trackParentInterval);this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(b,c,a){this.width=b*this.parentScaleFactor.x;this.height=c*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/
this.height;this.updateScalingAndBounds();a&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;this.game.canvas&&this.dom.getOffset(this.game.canvas,
this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(b,c){"undefined"==typeof c&&(c=!1);this.forceLandscape=b;this.forcePortrait=c;this.queueUpdate(!0)},classifyOrientation:function(b){return"portrait-primary"===b||"portrait-secondary"===b?"portrait":"landscape-primary"===b||"landscape-secondary"===b?"landscape":null},updateOrientationState:function(){var b=
this.screenOrientation,c=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var a=b!==this.screenOrientation,d=c!==this.incorrectOrientation;return a&&(this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0)),d&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():
this.leaveIncorrectOrientation.dispatch()),(a||d)&&this.onOrientationChange.dispatch(this,b,c),a||d},orientationChange:function(b){this.event=b;this.queueUpdate(!0)},windowResize:function(b){this.event=b;this.queueUpdate(!0)},scrollTop:function(){var b=this.compatibility.scrollTo;b&&window.scrollTo(b.x,b.y)},refresh:function(){this.scrollTop();this.queueUpdate(!0)},updateLayout:function(){var b=this.currentScaleMode;if(b===a.ScaleManager.RESIZE)return void this.reflowGame();(this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&
(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():b===a.ScaleManager.EXACT_FIT?this.setExactFit():b===a.ScaleManager.SHOW_ALL?!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent?(this.setShowAll(!0),this.resetCanvas(),this.setShowAll()):this.setShowAll():b===a.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):b===a.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-
this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),this.compatibility.canExpandParent||b!==a.ScaleManager.SHOW_ALL&&b!==a.ScaleManager.USER_SCALE)||(b=this.getParentBounds(this._tempBounds),this.width=Math.min(this.width,b.width),this.height=Math.min(this.height,b.height));this.width|=0;this.height|=0;this.reflowCanvas()},getParentBounds:function(b){b=b||new a.Rectangle;var c=this.boundingParent,e=this.dom.visualBounds,d=this.dom.layoutBounds;if(c){c=
c.getBoundingClientRect();b.setTo(c.left,c.top,c.width,c.height);c=this.windowConstraints;if(c.right){var f="layout"===c.right?d:e;b.right=Math.min(b.right,f.width)}c.bottom&&(f="layout"===c.bottom?d:e,b.bottom=Math.min(b.bottom,f.height))}else b.setTo(0,0,e.width,e.height);return b.setTo(Math.round(b.x),Math.round(b.y),Math.round(b.width),Math.round(b.height)),b},alignCanvas:function(b,c){var a=this.getParentBounds(this._tempBounds),d=this.game.canvas,f=this.margin;if(b){f.left=f.right=0;var k=d.getBoundingClientRect();
if(this.width<a.width&&!this.incorrectOrientation){var n=k.left-a.x,g=a.width/2-this.width/2,g=Math.max(g,0);f.left=Math.round(g-n)}d.style.marginLeft=f.left+"px";0!==f.left&&(f.right=-(a.width-k.width-f.left),d.style.marginRight=f.right+"px")}c&&(f.top=f.bottom=0,k=d.getBoundingClientRect(),this.height<a.height&&!this.incorrectOrientation&&(n=k.top-a.y,g=a.height/2-this.height/2,g=Math.max(g,0),f.top=Math.round(g-n)),d.style.marginTop=f.top+"px",0!==f.top&&(f.bottom=-(a.height-k.height-f.top),d.style.marginBottom=
f.bottom+"px"));f.x=f.left;f.y=f.top},reflowGame:function(){this.resetCanvas("","");var b=this.getParentBounds(this._tempBounds);this.updateDimensions(b.width,b.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=a.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=a.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height));this.resetCanvas();this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,
!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically));this.updateScalingAndBounds()},resetCanvas:function(b,c){"undefined"==typeof b&&(b=this.width+"px");"undefined"==typeof c&&(c=this.height+"px");var a=this.game.canvas;this.compatibility.noMargins||(a.style.marginLeft="",a.style.marginTop="",a.style.marginRight="",a.style.marginBottom="");a.style.width=b;a.style.height=c},queueUpdate:function(b){b&&(this._parentBounds.width=0,this._parentBounds.height=0);this._updateThrottle=
this._updateThrottleReset},reset:function(b){b&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(b){var c=this.getParentBounds(this._tempBounds),a=c.width,c=c.height;b=b?Math.max(c/this.game.height,a/this.game.width):Math.min(c/this.game.height,a/this.game.width);this.width=Math.round(this.game.width*b);this.height=Math.round(this.game.height*b)},setExactFit:function(){var b=this.getParentBounds(this._tempBounds);
this.width=b.width;this.height=b.height;this.isFullScreen||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var b=document.createElement("div");return b.style.margin="0",b.style.padding="0",b.style.background="#000",b},startFullScreen:function(b,c){if(this.isFullScreen)return!1;if(!this.compatibility.supportsFullScreen){var e=this;return void setTimeout(function(){e.fullScreenError()},
10)}if("when-not-mouse"===this.compatibility.clickTrampoline){var d=this.game.input;if(d.activePointer&&d.activePointer!==d.mousePointer&&(c||!1!==c))return void d.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[b,!1])}"undefined"!=typeof b&&this.game.renderType===a.CANVAS&&(this.game.stage.smoothed=b);(d=this.fullScreenTarget)||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),d=this._createdFullScreenTarget);if(this.onFullScreenInit.dispatch(this,
{targetElement:d}),this._createdFullScreenTarget){var f=this.game.canvas;f.parentNode.insertBefore(d,f);d.appendChild(f)}return this.game.device.fullscreenKeyboard?d[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):d[this.game.device.requestFullscreen](),!0},stopFullScreen:function(){return this.isFullScreen&&this.compatibility.supportsFullScreen?(document[this.game.device.cancelFullscreen](),!0):!1},cleanupCreatedTarget:function(){var b=this._createdFullScreenTarget;if(b&&b.parentNode){var c=
b.parentNode;c.insertBefore(this.game.canvas,b);c.removeChild(b)}this._createdFullScreenTarget=null},prepScreenMode:function(b){var c=!!this._createdFullScreenTarget,e=this._createdFullScreenTarget||this.fullScreenTarget;b?(c||this.fullScreenScaleMode===a.ScaleManager.EXACT_FIT)&&e!==this.game.canvas&&(this._fullScreenRestore={targetWidth:e.style.width,targetHeight:e.style.height},e.style.width="100%",e.style.height="100%"):(this._fullScreenRestore&&(e.style.width=this._fullScreenRestore.targetWidth,
e.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(b){this.event=b;this.isFullScreen?(this.prepScreenMode(!0),this.updateLayout(),this.queueUpdate(!0),this.enterFullScreen.dispatch(this.width,this.height)):(this.prepScreenMode(!1),this.cleanupCreatedTarget(),this.updateLayout(),this.queueUpdate(!0),this.leaveFullScreen.dispatch(this.width,this.height));
this.onFullScreenChange.dispatch(this)},fullScreenError:function(b){this.event=b;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(b,c,a,d){if("undefined"==typeof c&&(c=this.width),"undefined"==typeof a&&(a=this.height),"undefined"==typeof d&&(d=!1),b.scale.set(1),0>=b.width||0>=b.height||0>=c||0>=a)return b;var f=b.height*c/b.width,k=b.width*a/b.height,
n=k>c;return n=n?d:!d,n?(b.width=Math.floor(c),b.height=Math.floor(f)):(b.width=Math.floor(k),b.height=Math.floor(a)),b},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,!1);window.removeEventListener("resize",this._windowResize,!1);this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,
!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}};a.ScaleManager.prototype.constructor=a.ScaleManager;
a.ScaleManager.prototype.checkResize=a.ScaleManager.prototype.windowResize;a.ScaleManager.prototype.checkOrientation=a.ScaleManager.prototype.orientationChange;a.ScaleManager.prototype.setScreenSize=a.ScaleManager.prototype.updateLayout;a.ScaleManager.prototype.setSize=a.ScaleManager.prototype.reflowCanvas;a.ScaleManager.prototype.checkOrientationState=function(){var b=this.updateOrientationState();return b&&this.refresh(),b};Object.defineProperty(a.ScaleManager.prototype,"boundingParent",{get:function(){return this.parentIsWindow||
this.isFullScreen&&!this._createdFullScreenTarget?null:this.game.canvas&&this.game.canvas.parentNode||null}});Object.defineProperty(a.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(b){return b!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=b),this._scaleMode}});Object.defineProperty(a.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},
set:function(b){return b!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=b,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=b),this._fullScreenScaleMode}});Object.defineProperty(a.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(a.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},
set:function(b){b!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=b,this.queueUpdate(!0))}});Object.defineProperty(a.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(b){b!==this._pageAlignVertically&&(this._pageAlignVertically=b,this.queueUpdate(!0))}});Object.defineProperty(a.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||
document.msFullscreenElement)}});Object.defineProperty(a.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}});Object.defineProperty(a.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}});Object.defineProperty(a.ScaleManager.prototype,"orientation",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)?0:90}});Object.defineProperty(a.ScaleManager.prototype,
"isGamePortrait",{get:function(){return this.height>this.width}});Object.defineProperty(a.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}});a.Game=function(b,c,e,d,f,k,n,g){return this.id=a.GAMES.push(this)-1,this.config=null,this.physicsConfig=g,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.renderer=null,this.renderType=a.AUTO,this.state=
null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=a.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.lockRender=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,
this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new a.Signal,this.forceSingleUpdate=!1,this._nextFpsNotification=0,1===arguments.length&&"object"==typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},"undefined"!=typeof b&&(this._width=b),"undefined"!=typeof c&&(this._height=c),"undefined"!=
typeof e&&(this.renderType=e),"undefined"!=typeof d&&(this.parent=d),"undefined"!=typeof k&&(this.transparent=k),"undefined"!=typeof n&&(this.antialias=n),this.rnd=new a.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new a.StateManager(this,f)),this.device.whenReady(this.boot,this),this};a.Game.prototype={parseConfig:function(b){this.config=b;"undefined"==typeof b.enableDebug&&(this.config.enableDebug=!0);b.width&&(this._width=b.width);b.height&&(this._height=b.height);b.renderer&&
(this.renderType=b.renderer);b.parent&&(this.parent=b.parent);b.transparent&&(this.transparent=b.transparent);b.antialias&&(this.antialias=b.antialias);b.resolution&&(this.resolution=b.resolution);b.preserveDrawingBuffer&&(this.preserveDrawingBuffer=b.preserveDrawingBuffer);b.physicsConfig&&(this.physicsConfig=b.physicsConfig);var c=[(Date.now()*Math.random()).toString()];b.seed&&(c=b.seed);this.rnd=new a.RandomDataGenerator(c);c=null;b.state&&(c=b.state);this.state=new a.StateManager(this,c)},boot:function(){this.isBooted||
(this.onPause=new a.Signal,this.onResume=new a.Signal,this.onBlur=new a.Signal,this.onFocus=new a.Signal,this.isBooted=!0,this.math=a.Math,this.scale=new a.ScaleManager(this,this._width,this._height),this.stage=new a.Stage(this),this.setUpRenderer(),this.world=new a.World(this),this.add=new a.GameObjectFactory(this),this.make=new a.GameObjectCreator(this),this.cache=new a.Cache(this),this.load=new a.Loader(this),this.time=new a.Time(this),this.tweens=new a.TweenManager(this),this.input=new a.Input(this),
this.sound=new a.SoundManager(this),this.physics=new a.Physics(this,this.physicsConfig),this.particles=new a.Particles(this),this.plugins=new a.PluginManager(this),this.net=new a.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new a.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){}},this.showDebugHeader(),this.isRunning=
!0,this.raf=this.config&&this.config.forceSetTimeOut?new a.RequestAnimationFrame(this,this.config.forceSetTimeOut):new a.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.raf.start())},showDebugHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var b=a.VERSION,c="Canvas",e="HTML Audio",d=1;if(this.renderType===a.WEBGL?(c="WebGL",d++):this.renderType==a.HEADLESS&&
(c="Headless"),this.device.webAudio&&(e="WebAudio",d++),this.device.chrome){b=["%c %c %c Phaser v"+b+" | Pixi.js "+PIXI.VERSION+" | "+c+" | "+e+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #9854d8","background: #6c2ca7","color: #ffffff; background: #450f78;","background: #6c2ca7","background: #9854d8","background: #ffffff"];for(c=0;3>c;c++)b.push(d>c?"color: #ff2424; background: #fff":"color: #959595; background: #fff");console.log.apply(console,b)}else window.console&&console.log("Phaser v"+
b+" | Pixi.js "+PIXI.VERSION+" | "+c+" | "+e+" | http://phaser.io")}},setUpRenderer:function(){if(this.canvas=this.config.canvasID?a.Canvas.create(this.width,this.height,this.config.canvasID):a.Canvas.create(this.width,this.height),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===a.CANVAS?!0:!1),this.renderType===a.HEADLESS||this.renderType===a.CANVAS||
this.renderType===a.AUTO&&!1===this.device.webGL){if(!this.device.canvas)throw Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.");this.renderType===a.AUTO&&(this.renderType=a.CANVAS);this.renderer=new PIXI.CanvasRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,clearBeforeRender:!0});this.context=this.renderer.context}else this.renderType=a.WEBGL,this.renderer=new PIXI.WebGLRenderer(this.width,this.height,{view:this.canvas,
transparent:this.transparent,resolution:this.resolution,antialias:this.antialias,preserveDrawingBuffer:this.preserveDrawingBuffer}),this.context=null;this.renderType!==a.HEADLESS&&(this.stage.smoothed=this.antialias,a.Canvas.addToDOM(this.canvas,this.parent,!1),a.Canvas.setTouchAction(this.canvas))},update:function(b){if(this.time.update(b),this._kickstart)return this.updateLogic(1/this.time.desiredFps),this.stage.updateTransform(),this.updateRender(this.time.slowMotion*this.time.desiredFps),void(this._kickstart=
!1);if(1<this._spiraling&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1E4,this.fpsProblemNotifier.dispatch()),this._spiraling=this._deltaTime=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{b=1E3*this.time.slowMotion/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(3*b,this.time.elapsed),0);var c=0;this.updatesThisFrame=Math.floor(this._deltaTime/b);for(this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,
this.updatesThisFrame));this._deltaTime>=b&&(this._deltaTime-=b,this.currentUpdateID=c,this.updateLogic(1/this.time.desiredFps),this.stage.updateTransform(),c++,!this.forceSingleUpdate||1!==c););c>this._lastCount?this._spiraling++:c<this._lastCount&&(this._spiraling=0);this._lastCount=c;this.updateRender(this._deltaTime/b)}},updateLogic:function(b){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),
this.debug.preUpdate(),this.world.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(b),this.plugins.preUpdate(b),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(b),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate())},updateRender:function(b){this.lockRender||(this.state.preRender(b),this.renderer.render(this.stage),this.plugins.render(b),this.state.render(b),
this.plugins.postRender(b))},enableStep:function(){this.stepping=!0;this.pendingStep=!1;this.stepCount=0},disableStep:function(){this.pendingStep=this.stepping=!1},step:function(){this.pendingStep=!1;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.world=this.time=this.stage=this.sound=this.load=this.input=this.cache=this.state=null;this.isBooted=!1;this.renderer.destroy(!1);
a.Canvas.removeFromDOM(this.canvas);a.GAMES[this.id]=null},gamePaused:function(b){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(b))},gameResumed:function(b){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(b))},focusLoss:function(b){this.onBlur.dispatch(b);this.stage.disableVisibilityChange||this.gamePaused(b)},focusGain:function(b){this.onFocus.dispatch(b);
this.stage.disableVisibilityChange||this.gameResumed(b)}};a.Game.prototype.constructor=a.Game;Object.defineProperty(a.Game.prototype,"paused",{get:function(){return this._paused},set:function(b){!0===b?(!1===this._paused&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}});a.Input=function(b){this.game=
b;this.hitContext=this.hitCanvas=null;this.moveCallbacks=[];this.moveCallback=null;this.moveCallbackContext=this;this.pollRate=0;this.enabled=!0;this.multiInputOverride=a.Input.MOUSE_TOUCH_COMBINE;this.scale=this.circle=this.speed=this.position=null;this.maxPointers=-1;this.currentPointers=0;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2E3;this.justReleasedRate=this.justPressedRate=200;this.recordPointerHistory=!1;this.recordLimit=this.recordRate=100;this.pointer10=this.pointer9=this.pointer8=
this.pointer7=this.pointer6=this.pointer5=this.pointer4=this.pointer3=this.pointer2=this.pointer1=null;this.pointers=[];this.gamepad=this.mspointer=this.touch=this.keyboard=this.mouse=this.mousePointer=this.activePointer=null;this.resetLocked=!1;this.onHold=this.onTap=this.onUp=this.onDown=null;this.minPriorityID=0;this.interactiveItems=new a.ArraySet;this._localPoint=new a.Point;this._pollCounter=0;this._oldPosition=null;this._y=this._x=0};a.Input.MOUSE_OVERRIDES_TOUCH=0;a.Input.TOUCH_OVERRIDES_MOUSE=
1;a.Input.MOUSE_TOUCH_COMBINE=2;a.Input.MAX_POINTERS=10;a.Input.prototype={boot:function(){this.mousePointer=new a.Pointer(this.game,0);this.addPointer();this.addPointer();this.mouse=new a.Mouse(this.game);this.touch=new a.Touch(this.game);this.mspointer=new a.MSPointer(this.game);a.Keyboard&&(this.keyboard=new a.Keyboard(this.game));a.Gamepad&&(this.gamepad=new a.Gamepad(this.game));this.onDown=new a.Signal;this.onUp=new a.Signal;this.onTap=new a.Signal;this.onHold=new a.Signal;this.scale=new a.Point(1,
1);this.speed=new a.Point;this.position=new a.Point;this._oldPosition=new a.Point;this.circle=new a.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.touch.start();this.mspointer.start();this.mousePointer.active=!0;this.keyboard&&this.keyboard.start();var b=this;this._onClickTrampoline=function(c){b.onClickTrampoline(c)};
this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();this.keyboard&&this.keyboard.stop();this.gamepad&&this.gamepad.stop();this.moveCallbacks=[];this.game.canvas.removeEventListener("click",this._onClickTrampoline)},addMoveCallback:function(b,c){return this.moveCallbacks.push({callback:b,context:c})-1},deleteMoveCallback:function(b){this.moveCallbacks[b]&&this.moveCallbacks.splice(b,1)},addPointer:function(){if(this.pointers.length>=
a.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: only "+a.Input.MAX_POINTERS+" pointer allowed"),null;var b=this.pointers.length+1,c=new a.Pointer(this.game,b);return this.pointers.push(c),this["pointer"+b]=c,c},update:function(){if(this.keyboard&&this.keyboard.update(),0<this.pollRate&&this._pollCounter<this.pollRate)return void this._pollCounter++;this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);
this.mousePointer.update();this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var b=0;b<this.pointers.length;b++)this.pointers[b].update();this._pollCounter=0},reset:function(b){if(this.game.isBooted&&!this.resetLocked){"undefined"==typeof b&&(b=!1);this.mousePointer.reset();this.keyboard&&this.keyboard.reset(b);this.gamepad&&this.gamepad.reset();for(var c=0;c<this.pointers.length;c++)this.pointers[c].reset();this.currentPointers=0;"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor=
"inherit");b&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new a.Signal,this.onUp=new a.Signal,this.onTap=new a.Signal,this.onHold=new a.Signal,this.moveCallbacks=[]);this._pollCounter=0}},resetSpeed:function(b,c){this._oldPosition.setTo(b,c);this.speed.setTo(0,0)},startPointer:function(b){if(0<=this.maxPointers&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(b);if(!this.pointer2.active)return this.pointer2.start(b);
for(var c=2;c<this.pointers.length;c++){var a=this.pointers[c];if(!a.active)return a.start(b)}return null},updatePointer:function(b){if(this.pointer1.active&&this.pointer1.identifier===b.identifier)return this.pointer1.move(b);if(this.pointer2.active&&this.pointer2.identifier===b.identifier)return this.pointer2.move(b);for(var c=2;c<this.pointers.length;c++){var a=this.pointers[c];if(a.active&&a.identifier===b.identifier)return a.move(b)}return null},stopPointer:function(b){if(this.pointer1.active&&
this.pointer1.identifier===b.identifier)return this.pointer1.stop(b);if(this.pointer2.active&&this.pointer2.identifier===b.identifier)return this.pointer2.stop(b);for(var c=2;c<this.pointers.length;c++){var a=this.pointers[c];if(a.active&&a.identifier===b.identifier)return a.stop(b)}return null},countActivePointers:function(b){"undefined"==typeof b&&(b=this.pointers.length);for(var c=b,a=0;a<this.pointers.length&&0<c;a++)this.pointers[a].active&&c--;return this.currentPointers=b-c,b-c},getPointer:function(b){"undefined"==
typeof b&&(b=!1);for(var c=0;c<this.pointers.length;c++){var a=this.pointers[c];if(a.active===b)return a}return null},getPointerFromIdentifier:function(b){for(var c=0;c<this.pointers.length;c++){var a=this.pointers[c];if(a.identifier===b)return a}return null},getPointerFromId:function(b){for(var c=0;c<this.pointers.length;c++){var a=this.pointers[c];if(a.pointerId===b)return a}return null},getLocalPosition:function(b,c,e){"undefined"==typeof e&&(e=new a.Point);b=b.worldTransform;var d=1/(b.a*b.d+
b.c*-b.b);return e.setTo(b.d*d*c.x+-b.c*d*c.y+(b.ty*b.c-b.tx*b.d)*d,b.a*d*c.y+-b.b*d*c.x+(-b.ty*b.a+b.tx*b.b)*d)},hitTest:function(b,c,e){if(!b.worldVisible)return!1;if(this.getLocalPosition(b,c,this._localPoint),e.copyFrom(this._localPoint),b.hitArea&&b.hitArea.contains)return b.hitArea.contains(this._localPoint.x,this._localPoint.y);if(b instanceof a.TileSprite){var d=b.width,f=b.height,k=-d*b.anchor.x;if(this._localPoint.x>=k&&this._localPoint.x<k+d&&(d=-f*b.anchor.y,this._localPoint.y>=d&&this._localPoint.y<
d+f))return!0}else if(b instanceof PIXI.Sprite){if(d=b.texture.frame.width,f=b.texture.frame.height,k=-d*b.anchor.x,this._localPoint.x>=k&&this._localPoint.x<k+d&&(d=-f*b.anchor.y,this._localPoint.y>=d&&this._localPoint.y<d+f))return!0}else if(b instanceof a.Graphics)for(f=0;f<b.graphicsData.length;f++)if(d=b.graphicsData[f],d.fill&&d.shape&&d.shape.contains(this._localPoint.x,this._localPoint.y))return!0;f=0;for(d=b.children.length;d>f;f++)if(this.hitTest(b.children[f],c,e))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};
a.Input.prototype.constructor=a.Input;Object.defineProperty(a.Input.prototype,"x",{get:function(){return this._x},set:function(b){this._x=Math.floor(b)}});Object.defineProperty(a.Input.prototype,"y",{get:function(){return this._y},set:function(b){this._y=Math.floor(b)}});Object.defineProperty(a.Input.prototype,"pollLocked",{get:function(){return 0<this.pollRate&&this._pollCounter<this.pollRate}});Object.defineProperty(a.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-
this.countActivePointers()}});Object.defineProperty(a.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(a.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(a.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});Object.defineProperty(a.Input.prototype,"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});a.Mouse=function(b){this.callbackContext=
this.game=b;this.mouseWheelCallback=this.mouseOverCallback=this.mouseOutCallback=this.mouseUpCallback=this.mouseMoveCallback=this.mouseDownCallback=null;this.capture=!1;this.button=-1;this.wheelDelta=0;this.enabled=!0;this.stopOnGameOut=this.locked=!1;this.pointerLock=new a.Signal;this._wheelEvent=this._onMouseWheel=this._onMouseOver=this._onMouseOut=this._onMouseUp=this._onMouseMove=this._onMouseDown=this.event=null};a.Mouse.NO_BUTTON=-1;a.Mouse.LEFT_BUTTON=0;a.Mouse.MIDDLE_BUTTON=1;a.Mouse.RIGHT_BUTTON=
2;a.Mouse.WHEEL_UP=1;a.Mouse.WHEEL_DOWN=-1;a.Mouse.prototype={start:function(){if((!this.game.device.android||!1!==this.game.device.chrome)&&null===this._onMouseDown){var b=this;this._onMouseDown=function(c){return b.onMouseDown(c)};this._onMouseMove=function(c){return b.onMouseMove(c)};this._onMouseUp=function(c){return b.onMouseUp(c)};this._onMouseUpGlobal=function(c){return b.onMouseUpGlobal(c)};this._onMouseOut=function(c){return b.onMouseOut(c)};this._onMouseOver=function(c){return b.onMouseOver(c)};
this._onMouseWheel=function(c){return b.onMouseWheel(c)};this.game.canvas.addEventListener("mousedown",this._onMouseDown,!0);this.game.canvas.addEventListener("mousemove",this._onMouseMove,!0);this.game.canvas.addEventListener("mouseup",this._onMouseUp,!0);this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),this.game.canvas.addEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.addEventListener("mouseout",this._onMouseOut,!0));var c=this.game.device.wheelEvent;
c&&(this.game.canvas.addEventListener(c,this._onMouseWheel,!0),"mousewheel"===c?this._wheelEvent=new h(-.025,1):"DOMMouseScroll"===c&&(this._wheelEvent=new h(1,1)))}},onMouseDown:function(b){this.event=b;this.capture&&b.preventDefault();this.button=b.button;this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&(b.identifier=0,this.game.input.mousePointer.start(b))},onMouseMove:function(b){this.event=b;this.capture&&b.preventDefault();this.mouseMoveCallback&&
this.mouseMoveCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&(b.identifier=0,this.game.input.mousePointer.move(b))},onMouseUp:function(b){this.event=b;this.capture&&b.preventDefault();this.button=a.Mouse.NO_BUTTON;this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&(b.identifier=0,this.game.input.mousePointer.stop(b))},onMouseUpGlobal:function(b){this.game.input.mousePointer.withinGame||(this.button=a.Mouse.NO_BUTTON,
this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,b),b.identifier=0,this.game.input.mousePointer.stop(b))},onMouseOut:function(b){this.event=b;this.capture&&b.preventDefault();this.game.input.mousePointer.withinGame=!1;this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&this.stopOnGameOut&&(b.identifier=0,this.game.input.mousePointer.stop(b))},onMouseWheel:function(b){this._wheelEvent&&(b=this._wheelEvent.bindEvent(b));
this.event=b;this.capture&&b.preventDefault();this.wheelDelta=a.Math.clamp(-b.deltaY,-1,1);this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,b)},onMouseOver:function(b){this.event=b;this.capture&&b.preventDefault();this.game.input.mousePointer.withinGame=!0;this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,b);!this.game.input.enabled||!this.enabled},requestPointerLock:function(){if(this.game.device.pointerLock){var b=this.game.canvas;b.requestPointerLock=
b.requestPointerLock||b.mozRequestPointerLock||b.webkitRequestPointerLock;b.requestPointerLock();var c=this;this._pointerLockChange=function(b){return c.pointerLockChange(b)};document.addEventListener("pointerlockchange",this._pointerLockChange,!0);document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(b){var c=this.game.canvas;document.pointerLockElement===c||document.mozPointerLockElement===
c||document.webkitPointerLockElement===c?(this.locked=!0,this.pointerLock.dispatch(!0,b)):(this.locked=!1,this.pointerLock.dispatch(!1,b))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.removeEventListener("webkitpointerlockchange",
this._pointerLockChange,!0)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,!0);this.game.canvas.removeEventListener("mousemove",this._onMouseMove,!0);this.game.canvas.removeEventListener("mouseup",this._onMouseUp,!0);this.game.canvas.removeEventListener("mouseover",this._onMouseOver,!0);this.game.canvas.removeEventListener("mouseout",this._onMouseOut,!0);var b=this.game.device.wheelEvent;b&&this.game.canvas.removeEventListener(b,this._onMouseWheel,!0);window.removeEventListener("mouseup",
this._onMouseUpGlobal,!0);document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}};a.Mouse.prototype.constructor=a.Mouse;Object.defineProperty(a.Mouse.prototype,"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});h.prototype={};h.prototype.constructor=h;h.prototype.bindEvent=function(b){if(!h._stubsGenerated&&
b){var c=function(b){return function(){var c=this.originalEvent[b];return"function"!=typeof c?c:c.bind(this.originalEvent)}},a;for(a in b)a in h.prototype||Object.defineProperty(h.prototype,a,{get:c(a)});h._stubsGenerated=!0}return this.originalEvent=b,this};Object.defineProperties(h.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*
this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});a.MSPointer=function(b){this.callbackContext=this.game=b;this.pointerUpCallback=this.pointerMoveCallback=this.pointerDownCallback=null;this.capture=!0;this.button=-1;this.event=null;this.enabled=!0;this._onMSPointerUp=this._onMSPointerMove=this._onMSPointerDown=null};a.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var b=this;this.game.device.mspointer&&(this._onMSPointerDown=function(c){return b.onPointerDown(c)},this._onMSPointerMove=
function(c){return b.onPointerMove(c)},this._onMSPointerUp=function(c){return b.onPointerUp(c)},this.game.canvas.addEventListener("MSPointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("MSPointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("MSPointerUp",this._onMSPointerUp,!1),this.game.canvas.addEventListener("pointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("pointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("pointerUp",
this._onMSPointerUp,!1),this.game.canvas.style["-ms-content-zooming"]="none",this.game.canvas.style["-ms-touch-action"]="none")}},onPointerDown:function(b){this.event=b;this.capture&&b.preventDefault();this.button=b.button;this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&(b.identifier=b.pointerId,this.game.input.startPointer(b))},onPointerMove:function(b){this.event=b;this.capture&&b.preventDefault();this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,
b);this.game.input.enabled&&this.enabled&&(b.identifier=b.pointerId,this.game.input.updatePointer(b))},onPointerUp:function(b){this.event=b;this.capture&&b.preventDefault();this.button=a.Mouse.NO_BUTTON;this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&(b.identifier=b.pointerId,this.game.input.stopPointer(b))},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("MSPointerMove",
this._onMSPointerMove);this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}};a.MSPointer.prototype.constructor=a.MSPointer;Object.defineProperty(a.MSPointer.prototype,"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});a.Pointer=function(b,
c){this.game=b;this.id=c;this.type=a.POINTER;this.exists=!0;this.identifier=0;this.button=this.target=this.pointerId=null;this._holdSent=!1;this._history=[];this._nextDrop=0;this.withinGame=this._stateReset=!1;this.screenY=this.screenX=this.pageY=this.pageX=this.clientY=this.clientX=-1;this.movementY=this.movementX=this.rawMovementY=this.rawMovementX=0;this.y=this.x=-1;this.isDown=this.isMouse=!1;this.isUp=!0;this.totalTouches=this.previousTapTime=this.timeUp=this.timeDown=0;this.msSinceLastClick=
Number.MAX_VALUE;this.targetObject=null;this.dirty=this.active=!1;this.position=new a.Point;this.positionDown=new a.Point;this.positionUp=new a.Point;this.circle=new a.Circle(0,0,44);0===c&&(this.isMouse=!0);this._trampolineTargetObject=this._clickTrampolines=null};a.Pointer.prototype={start:function(b){return b.pointerId&&(this.pointerId=b.pointerId),this.identifier=b.identifier,this.target=b.target,"undefined"!=typeof b.button&&(this.button=b.button),this._history=[],this.active=!0,this.withinGame=
!0,this.isDown=!0,this.isUp=!1,this.dirty=!1,this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(b,!0),this.positionDown.setTo(this.x,this.y),(this.game.input.multiInputOverride===a.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===a.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===a.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&
(this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.x,this.y),this.game.input.onDown.dispatch(this,b),this.game.input.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,this.isMouse||this.game.input.currentPointers++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){this.active&&(this.dirty&&(0<this.game.input.interactiveItems.total&&this.processInteractiveObjects(!1),this.dirty=!1),!1===this._holdSent&&this.duration>=
this.game.input.holdRate&&((this.game.input.multiInputOverride==a.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==a.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==a.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&this.game.input.onHold.dispatch(this),this._holdSent=!0),this.game.input.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+this.game.input.recordRate,this._history.push({x:this.position.x,y:this.position.y}),
this._history.length>this.game.input.recordLimit&&this._history.shift()))},move:function(b,c){if(!this.game.input.pollLocked){if("undefined"==typeof c&&(c=!1),"undefined"!=typeof b.button&&(this.button=b.button),this.clientX=b.clientX,this.clientY=b.clientY,this.pageX=b.pageX,this.pageY=b.pageY,this.screenX=b.screenX,this.screenY=b.screenY,this.isMouse&&this.game.input.mouse.locked&&!c&&(this.rawMovementX=b.movementX||b.mozMovementX||b.webkitMovementX||0,this.rawMovementY=b.movementY||b.mozMovementY||
b.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*this.game.input.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*this.game.input.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(this.game.input.multiInputOverride===a.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===a.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===a.Input.TOUCH_OVERRIDES_MOUSE&&
0===this.game.input.currentPointers)&&(this.game.input.activePointer=this,this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.game.input.x,this.game.input.y),this.game.input.circle.x=this.game.input.x,this.game.input.circle.y=this.game.input.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;for(var e=this.game.input.moveCallbacks.length;e--;)this.game.input.moveCallbacks[e].callback.call(this.game.input.moveCallbacks[e].context,
this,this.x,this.y,c);return null!==this.targetObject&&!0===this.targetObject.isDragged?!1===this.targetObject.update(this)&&(this.targetObject=null):0<this.game.input.interactiveItems.total&&this.processInteractiveObjects(c),this}},processInteractiveObjects:function(b){for(var c=Number.MAX_VALUE,a=-1,d=null,f=this.game.input.interactiveItems.first;f;)f.checked=!1,f.validForInput(a,c,!1)&&(f.checked=!0,(b&&f.checkPointerDown(this,!0)||!b&&f.checkPointerOver(this,!0))&&(c=f.sprite.renderOrderID,a=
f.priorityID,d=f)),f=this.game.input.interactiveItems.next;for(f=this.game.input.interactiveItems.first;f;)!f.checked&&f.validForInput(a,c,!0)&&(b&&f.checkPointerDown(this,!1)||!b&&f.checkPointerOver(this,!1))&&(c=f.sprite.renderOrderID,a=f.priorityID,d=f),f=this.game.input.interactiveItems.next;return null===d?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):null===this.targetObject?(this.targetObject=d,d._pointerOverHandler(this)):this.targetObject===d?!1===
d.update(this)&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=d,this.targetObject._pointerOverHandler(this)),null!==this.targetObject},leave:function(b){this.withinGame=!1;this.move(b,!1)},stop:function(b){return this._stateReset&&this.withinGame?void b.preventDefault():(this.timeUp=this.game.time.time,(this.game.input.multiInputOverride===a.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===a.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===
a.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.onUp.dispatch(this,b),0<=this.duration&&this.duration<=this.game.input.tapRate&&(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate?this.game.input.onTap.dispatch(this,!0):this.game.input.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),0<this.id&&(this.active=!1),this.withinGame=!1,this.isDown=!1,this.isUp=!0,this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),!1===
this.isMouse&&this.game.input.currentPointers--,this.game.input.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this)},justPressed:function(b){return b=b||this.game.input.justPressedRate,!0===this.isDown&&this.timeDown+b>this.game.time.time},justReleased:function(b){return b=b||this.game.input.justReleasedRate,!0===this.isUp&&this.timeUp+b>this.game.time.time},addClickTrampoline:function(b,c,a,d){if(this.isDown){for(var f=
this._clickTrampolines=this._clickTrampolines||[],k=0;k<f.length;k++)if(f[k].name===b){f.splice(k,1);break}f.push({name:b,targetObject:this.targetObject,callback:c,callbackContext:a,callbackArgs:d})}},processClickTrampolines:function(){var b=this._clickTrampolines;if(b){for(var c=0;c<b.length;c++){var a=b[c];a.targetObject===this._trampolineTargetObject&&a.callback.apply(a.callbackContext,a.callbackArgs)}this._trampolineTargetObject=this._clickTrampolines=null}},reset:function(){!1===this.isMouse&&
(this.active=!1);this.identifier=this.pointerId=null;this.isDown=this.dirty=!1;this.isUp=!0;this.totalTouches=0;this._holdSent=!1;this._history.length=0;this._stateReset=!0;this.targetObject&&this.targetObject._releasedHandler(this);this.targetObject=null},resetMovement:function(){this.movementY=this.movementX=0}};a.Pointer.prototype.constructor=a.Pointer;Object.defineProperty(a.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}});Object.defineProperty(a.Pointer.prototype,
"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(a.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});a.Touch=function(b){this.game=b;this.enabled=!0;this.callbackContext=this.game;this.touchCancelCallback=this.touchLeaveCallback=this.touchEnterCallback=this.touchEndCallback=this.touchMoveCallback=this.touchStartCallback=null;this.preventDefault=!0;this._onTouchMove=this._onTouchCancel=this._onTouchLeave=this._onTouchEnter=
this._onTouchEnd=this._onTouchMove=this._onTouchStart=this.event=null};a.Touch.prototype={start:function(){if(null===this._onTouchStart){var b=this;this.game.device.touch&&(this._onTouchStart=function(c){return b.onTouchStart(c)},this._onTouchMove=function(c){return b.onTouchMove(c)},this._onTouchEnd=function(c){return b.onTouchEnd(c)},this._onTouchEnter=function(c){return b.onTouchEnter(c)},this._onTouchLeave=function(c){return b.onTouchLeave(c)},this._onTouchCancel=function(c){return b.onTouchCancel(c)},
this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=
function(b){b.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(b){if(this.event=b,this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,b),this.game.input.enabled&&this.enabled){this.preventDefault&&b.preventDefault();for(var c=0;c<b.changedTouches.length;c++)this.game.input.startPointer(b.changedTouches[c])}},onTouchCancel:function(b){if(this.event=b,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,
b),this.game.input.enabled&&this.enabled){this.preventDefault&&b.preventDefault();for(var c=0;c<b.changedTouches.length;c++)this.game.input.stopPointer(b.changedTouches[c])}},onTouchEnter:function(b){this.event=b;this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&this.preventDefault&&b.preventDefault()},onTouchLeave:function(b){this.event=b;this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,b);this.preventDefault&&
b.preventDefault()},onTouchMove:function(b){this.event=b;this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,b);this.preventDefault&&b.preventDefault();for(var c=0;c<b.changedTouches.length;c++)this.game.input.updatePointer(b.changedTouches[c])},onTouchEnd:function(b){this.event=b;this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,b);this.preventDefault&&b.preventDefault();for(var c=0;c<b.changedTouches.length;c++)this.game.input.stopPointer(b.changedTouches[c])},
stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}};a.Touch.prototype.constructor=a.Touch;Object.defineProperty(a.Touch.prototype,
"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});a.InputHandler=function(b){this.sprite=b;this.game=b.game;this.checked=this.enabled=!1;this.priorityID=0;this.isDragged=this._setHandCursor=this.useHandCursor=!1;this.allowVerticalDrag=this.allowHorizontalDrag=!0;this.bringToTop=!1;this.snapOffset=null;this.snapOnRelease=this.snapOnDrag=!1;this.snapOffsetY=this.snapOffsetX=this.snapY=this.snapX=0;this.pixelPerfectClick=this.pixelPerfectOver=!1;this.pixelPerfectAlpha=
255;this.draggable=!1;this.boundsSprite=this.boundsRect=null;this.scaleLayer=this.consumePointerEvent=!1;this.dragOffset=new a.Point;this.dragFromCenter=!1;this.dragStartPoint=new a.Point;this._dragPoint=new a.Point;this._wasEnabled=this._dragPhase=!1;this._tempPoint=new a.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})};a.InputHandler.prototype={start:function(b,c){if(b=b||
0,"undefined"==typeof c&&(c=!1),!1===this.enabled){this.game.input.interactiveItems.add(this);this.useHandCursor=c;this.priorityID=b;for(var e=0;10>e;e++)this._pointerData[e]={id:e,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new a.Point;this._wasEnabled=this.enabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.flagged=
!1,this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.flagged=this.enabled=!1;for(var b=0;10>b;b++)this._pointerData[b]={id:b,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){!1!==this.enabled&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},
destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(b,c,a){return"undefined"==typeof a&&(a=!0),0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID?!1:(a||!this.pixelPerfectClick&&!this.pixelPerfectOver)&&(this.priorityID>
b||this.priorityID===b&&this.sprite.renderOrderID<c)?!0:!1},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(b){return b=b||0,this._pointerData[b].x},pointerY:function(b){return b=b||0,this._pointerData[b].y},pointerDown:function(b){return b=b||0,this._pointerData[b].isDown},pointerUp:function(b){return b=b||0,this._pointerData[b].isUp},pointerTimeDown:function(b){return b=b||0,this._pointerData[b].timeDown},pointerTimeUp:function(b){return b=b||0,
this._pointerData[b].timeUp},pointerOver:function(b){if(this.enabled){if("undefined"!=typeof b)return this._pointerData[b].isOver;for(b=0;10>b;b++)if(this._pointerData[b].isOver)return!0}return!1},pointerOut:function(b){if(this.enabled){if("undefined"!=typeof b)return this._pointerData[b].isOut;for(b=0;10>b;b++)if(this._pointerData[b].isOut)return!0}return!1},pointerTimeOver:function(b){return b=b||0,this._pointerData[b].timeOver},pointerTimeOut:function(b){return b=b||0,this._pointerData[b].timeOut},
pointerDragged:function(b){return b=b||0,this._pointerData[b].isDragged},checkPointerDown:function(b,c){return b.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&this.game.input.hitTest(this.sprite,b,this._tempPoint)?("undefined"==typeof c&&(c=!1),!c&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPointerOver:function(b,c){return this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&
this.game.input.hitTest(this.sprite,b,this._tempPoint)?("undefined"==typeof c&&(c=!1),!c&&this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPixel:function(b,c,a){if(this.sprite.texture.baseTexture.source){null===b&&null===c&&(this.game.input.getLocalPosition(this.sprite,a,this._tempPoint),b=this._tempPoint.x,c=this._tempPoint.y);if(0!==this.sprite.anchor.x&&(b-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(c-=-this.sprite.texture.frame.height*
this.sprite.anchor.y),b+=this.sprite.texture.frame.x,c+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(b-=this.sprite.texture.trim.x,c-=this.sprite.texture.trim.y,b<this.sprite.texture.crop.x||b>this.sprite.texture.crop.right||c<this.sprite.texture.crop.y||c>this.sprite.texture.crop.bottom))return this._dx=b,this._dy=c,!1;this._dx=b;this._dy=c;this.game.input.hitContext.clearRect(0,0,1,1);this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,b,c,1,1,0,0,1,1);if(this.game.input.hitContext.getImageData(0,
0,1,1).data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(b){return null!==this.sprite&&void 0!==this.sprite.parent?this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this.draggable&&this._draggedPointerID===b.id?this.updateDrag(b):this._pointerData[b.id].isOver?this.checkPointerOver(b)?(this._pointerData[b.id].x=b.x-this.sprite.x,this._pointerData[b.id].y=b.y-this.sprite.y,!0):(this._pointerOutHandler(b),!1):void 0:(this._pointerOutHandler(b),!1):void 0},_pointerOverHandler:function(b){null!==
this.sprite&&(!1===this._pointerData[b.id].isOver||b.dirty)&&(this._pointerData[b.id].isOver=!0,this._pointerData[b.id].isOut=!1,this._pointerData[b.id].timeOver=this.game.time.time,this._pointerData[b.id].x=b.x-this.sprite.x,this._pointerData[b.id].y=b.y-this.sprite.y,this.useHandCursor&&!1===this._pointerData[b.id].isDragged&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,b))},_pointerOutHandler:function(b){null!==
this.sprite&&(this._pointerData[b.id].isOver=!1,this._pointerData[b.id].isOut=!0,this._pointerData[b.id].timeOut=this.game.time.time,this.useHandCursor&&!1===this._pointerData[b.id].isDragged&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.sprite&&this.sprite.events&&this.sprite.events.onInputOut$dispatch(this.sprite,b))},_touchedHandler:function(b){if(null!==this.sprite){if(!1===this._pointerData[b.id].isDown&&!0===this._pointerData[b.id].isOver){if(this.pixelPerfectClick&&
!this.checkPixel(null,null,b))return;this._pointerData[b.id].isDown=!0;this._pointerData[b.id].isUp=!1;this._pointerData[b.id].timeDown=this.game.time.time;this.sprite&&this.sprite.events&&this.sprite.events.onInputDown$dispatch(this.sprite,b);b.dirty=!0;this.draggable&&!1===this.isDragged&&this.startDrag(b);this.bringToTop&&this.sprite.bringToTop()}return this.consumePointerEvent}},_releasedHandler:function(b){null!==this.sprite&&this._pointerData[b.id].isDown&&b.isUp&&(this._pointerData[b.id].isDown=
!1,this._pointerData[b.id].isUp=!0,this._pointerData[b.id].timeUp=this.game.time.time,this._pointerData[b.id].downDuration=this._pointerData[b.id].timeUp-this._pointerData[b.id].timeDown,this.checkPointerOver(b)?this.sprite&&this.sprite.events&&this.sprite.events.onInputUp$dispatch(this.sprite,b,!0):(this.sprite&&this.sprite.events&&this.sprite.events.onInputUp$dispatch(this.sprite,b,!1),this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1)),b.dirty=!0,this.draggable&&
this.isDragged&&this._draggedPointerID===b.id&&this.stopDrag(b))},updateDrag:function(b){if(b.isUp)return this.stopDrag(b),!1;var c=this.globalToLocalX(b.x)+this._dragPoint.x+this.dragOffset.x;b=this.globalToLocalY(b.y)+this._dragPoint.y+this.dragOffset.y;return this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=c),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=b),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&
(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)):(this.allowHorizontalDrag&&(this.sprite.x=c),this.allowVerticalDrag&&(this.sprite.y=b),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-
this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),!0},justOver:function(b,c){return b=b||0,c=c||500,this._pointerData[b].isOver&&this.overDuration(b)<c},justOut:function(b,c){return b=b||0,c=c||500,this._pointerData[b].isOut&&this.game.time.time-this._pointerData[b].timeOut<c},justPressed:function(b,c){return b=b||0,c=c||500,this._pointerData[b].isDown&&
this.downDuration(b)<c},justReleased:function(b,c){return b=b||0,c=c||500,this._pointerData[b].isUp&&this.game.time.time-this._pointerData[b].timeUp<c},overDuration:function(b){return b=b||0,this._pointerData[b].isOver?this.game.time.time-this._pointerData[b].timeOver:-1},downDuration:function(b){return b=b||0,this._pointerData[b].isDown?this.game.time.time-this._pointerData[b].timeDown:-1},enableDrag:function(b,c,e,d,f,k){"undefined"==typeof b&&(b=!1);"undefined"==typeof c&&(c=!1);"undefined"==typeof e&&
(e=!1);"undefined"==typeof d&&(d=255);"undefined"==typeof f&&(f=null);"undefined"==typeof k&&(k=null);this._dragPoint=new a.Point;this.draggable=!0;this.bringToTop=c;this.dragOffset=new a.Point;this.dragFromCenter=b;this.pixelPerfectClick=e;this.pixelPerfectAlpha=d;f&&(this.boundsRect=f);k&&(this.boundsSprite=k)},disableDrag:function(){if(this._pointerData)for(var b=0;10>b;b++)this._pointerData[b].isDragged=!1;this.isDragged=this.draggable=!1;this._draggedPointerID=-1},startDrag:function(b){var c=
this.sprite.x,a=this.sprite.y;if(this.isDragged=!0,this._draggedPointerID=b.id,this._pointerData[b.id].isDragged=!0,this.sprite.fixedToCamera)this.dragFromCenter?(this.sprite.centerOn(b.x,b.y),this._dragPoint.setTo(this.sprite.cameraOffset.x-b.x,this.sprite.cameraOffset.y-b.y)):this._dragPoint.setTo(this.sprite.cameraOffset.x-b.x,this.sprite.cameraOffset.y-b.y);else{if(this.dragFromCenter){var d=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(b.x)+(this.sprite.x-d.centerX);this.sprite.y=
this.globalToLocalY(b.y)+(this.sprite.y-d.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(b.x),this.sprite.y-this.globalToLocalY(b.y))}this.updateDrag(b);this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop());this.dragStartPoint.set(c,a);this.sprite.events.onDragStart$dispatch(this.sprite,b,c,a)},globalToLocalX:function(b){return this.scaleLayer&&(b-=this.game.scale.grid.boundsFluid.x,b*=this.game.scale.grid.scaleFluidInversed.x),b},globalToLocalY:function(b){return this.scaleLayer&&
(b-=this.game.scale.grid.boundsFluid.y,b*=this.game.scale.grid.scaleFluidInversed.y),b},stopDrag:function(b){this.isDragged=!1;this._draggedPointerID=-1;this._dragPhase=this._pointerData[b.id].isDragged=!1;this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*
this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY));this.sprite.events.onDragStop$dispatch(this.sprite,b);!1===this.checkPointerOver(b)&&this._pointerOutHandler(b)},setDragLock:function(b,c){"undefined"==typeof b&&(b=!0);"undefined"==typeof c&&(c=!0);this.allowHorizontalDrag=
b;this.allowVerticalDrag=c},enableSnap:function(b,c,a,d,f,k){"undefined"==typeof a&&(a=!0);"undefined"==typeof d&&(d=!1);"undefined"==typeof f&&(f=0);"undefined"==typeof k&&(k=0);this.snapX=b;this.snapY=c;this.snapOffsetX=f;this.snapOffsetY=k;this.snapOnDrag=a;this.snapOnRelease=d},disableSnap:function(){this.snapOnRelease=this.snapOnDrag=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+
this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-
(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>
this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<
this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}};a.InputHandler.prototype.constructor=a.InputHandler;a.Gamepad=function(b){this.game=
b;this._gamepadIndexMap={};this._rawPads=[];this._active=!1;this.enabled=!0;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!=navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this._gamepaddisconnected=this._ongamepadconnected=this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=this.onConnectCallback=null;this._gamepads=
[new a.SinglePad(b,this),new a.SinglePad(b,this),new a.SinglePad(b,this),new a.SinglePad(b,this)]};a.Gamepad.prototype={addCallbacks:function(b,c){"undefined"!=typeof c&&(this.onConnectCallback="function"==typeof c.onConnect?c.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof c.onDisconnect?c.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof c.onDown?c.onDown:this.onDownCallback,this.onUpCallback="function"==typeof c.onUp?c.onUp:this.onUpCallback,
this.onAxisCallback="function"==typeof c.onAxis?c.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof c.onFloat?c.onFloat:this.onFloatCallback,this.callbackContext=b)},start:function(){if(!this._active){this._active=!0;var b=this;this._onGamepadConnected=function(c){return b.onGamepadConnected(c)};this._onGamepadDisconnected=function(c){return b.onGamepadDisconnected(c)};window.addEventListener("gamepadconnected",this._onGamepadConnected,!1);window.addEventListener("gamepaddisconnected",
this._onGamepadDisconnected,!1)}},onGamepadConnected:function(b){b=b.gamepad;this._rawPads.push(b);this._gamepads[b.index].connect(b)},onGamepadDisconnected:function(b){b=b.gamepad;for(var c in this._rawPads)this._rawPads[c].index===b.index&&this._rawPads.splice(c,1);this._gamepads[b.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(navigator.getGamepads)var b=navigator.getGamepads();
else navigator.webkitGetGamepads?b=navigator.webkitGetGamepads():navigator.webkitGamepads&&(b=navigator.webkitGamepads());if(b){this._rawPads=[];for(var c=!1,a=0;a<b.length&&(typeof b[a]!==this._prevRawGamepadTypes[a]&&(c=!0,this._prevRawGamepadTypes[a]=typeof b[a]),b[a]&&this._rawPads.push(b[a]),3!==a);a++);if(c){for(var d,b={},c={},a=0;a<this._gamepads.length;a++)if(d=this._gamepads[a],d.connected)for(var f=0;f<this._rawPads.length;f++)this._rawPads[f].index===d.index&&(b[d.index]=!0,c[a]=!0);for(a=
0;a<this._gamepads.length;a++)if(d=this._gamepads[a],!c[a])for(1>this._rawPads.length&&d.disconnect(),f=0;f<this._rawPads.length&&!c[a];f++){var k=this._rawPads[f];k?b[k.index]?d.disconnect():(d.connect(k),b[k.index]=!0,c[a]=!0):d.disconnect()}}}},setDeadZones:function(b){for(var c=0;c<this._gamepads.length;c++)this._gamepads[c].deadZone=b},stop:function(){this._active=!1;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},
reset:function(){this.update();for(var b=0;b<this._gamepads.length;b++)this._gamepads[b].reset()},justPressed:function(b,c){for(var a=0;a<this._gamepads.length;a++)if(!0===this._gamepads[a].justPressed(b,c))return!0;return!1},justReleased:function(b,c){for(var a=0;a<this._gamepads.length;a++)if(!0===this._gamepads[a].justReleased(b,c))return!0;return!1},isDown:function(b){for(var c=0;c<this._gamepads.length;c++)if(!0===this._gamepads[c].isDown(b))return!0;return!1},destroy:function(){this.stop();
for(var b=0;b<this._gamepads.length;b++)this._gamepads[b].destroy()}};a.Gamepad.prototype.constructor=a.Gamepad;Object.defineProperty(a.Gamepad.prototype,"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});Object.defineProperty(a.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(a.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(a.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});
Object.defineProperty(a.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(a.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(a.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(a.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});a.Gamepad.BUTTON_0=0;a.Gamepad.BUTTON_1=1;a.Gamepad.BUTTON_2=2;a.Gamepad.BUTTON_3=3;a.Gamepad.BUTTON_4=4;a.Gamepad.BUTTON_5=5;a.Gamepad.BUTTON_6=
6;a.Gamepad.BUTTON_7=7;a.Gamepad.BUTTON_8=8;a.Gamepad.BUTTON_9=9;a.Gamepad.BUTTON_10=10;a.Gamepad.BUTTON_11=11;a.Gamepad.BUTTON_12=12;a.Gamepad.BUTTON_13=13;a.Gamepad.BUTTON_14=14;a.Gamepad.BUTTON_15=15;a.Gamepad.AXIS_0=0;a.Gamepad.AXIS_1=1;a.Gamepad.AXIS_2=2;a.Gamepad.AXIS_3=3;a.Gamepad.AXIS_4=4;a.Gamepad.AXIS_5=5;a.Gamepad.AXIS_6=6;a.Gamepad.AXIS_7=7;a.Gamepad.AXIS_8=8;a.Gamepad.AXIS_9=9;a.Gamepad.XBOX360_A=0;a.Gamepad.XBOX360_B=1;a.Gamepad.XBOX360_X=2;a.Gamepad.XBOX360_Y=3;a.Gamepad.XBOX360_LEFT_BUMPER=
4;a.Gamepad.XBOX360_RIGHT_BUMPER=5;a.Gamepad.XBOX360_LEFT_TRIGGER=6;a.Gamepad.XBOX360_RIGHT_TRIGGER=7;a.Gamepad.XBOX360_BACK=8;a.Gamepad.XBOX360_START=9;a.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;a.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;a.Gamepad.XBOX360_DPAD_LEFT=14;a.Gamepad.XBOX360_DPAD_RIGHT=15;a.Gamepad.XBOX360_DPAD_UP=12;a.Gamepad.XBOX360_DPAD_DOWN=13;a.Gamepad.XBOX360_STICK_LEFT_X=0;a.Gamepad.XBOX360_STICK_LEFT_Y=1;a.Gamepad.XBOX360_STICK_RIGHT_X=2;a.Gamepad.XBOX360_STICK_RIGHT_Y=3;a.Gamepad.PS3XC_X=
0;a.Gamepad.PS3XC_CIRCLE=1;a.Gamepad.PS3XC_SQUARE=2;a.Gamepad.PS3XC_TRIANGLE=3;a.Gamepad.PS3XC_L1=4;a.Gamepad.PS3XC_R1=5;a.Gamepad.PS3XC_L2=6;a.Gamepad.PS3XC_R2=7;a.Gamepad.PS3XC_SELECT=8;a.Gamepad.PS3XC_START=9;a.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;a.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;a.Gamepad.PS3XC_DPAD_UP=12;a.Gamepad.PS3XC_DPAD_DOWN=13;a.Gamepad.PS3XC_DPAD_LEFT=14;a.Gamepad.PS3XC_DPAD_RIGHT=15;a.Gamepad.PS3XC_STICK_LEFT_X=0;a.Gamepad.PS3XC_STICK_LEFT_Y=1;a.Gamepad.PS3XC_STICK_RIGHT_X=2;a.Gamepad.PS3XC_STICK_RIGHT_Y=
3;a.SinglePad=function(b,c){this.game=b;this.index=null;this.connected=!1;this.callbackContext=this;this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=this.onConnectCallback=null;this.deadZone=.26;this._padParent=c;this._prevTimestamp=this._rawPad=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};a.SinglePad.prototype={addCallbacks:function(b,c){"undefined"!=typeof c&&(this.onConnectCallback="function"==typeof c.onConnect?
c.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof c.onDisconnect?c.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof c.onDown?c.onDown:this.onDownCallback,this.onUpCallback="function"==typeof c.onUp?c.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof c.onAxis?c.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof c.onFloat?c.onFloat:this.onFloatCallback)},getButton:function(b){return this._buttons[b]?this._buttons[b]:
null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var b=0;b<this._buttonsLen;b++){var c=isNaN(this._rawPad.buttons[b])?this._rawPad.buttons[b].value:this._rawPad.buttons[b];c!==this._buttons[b].value&&(1===c?this.processButtonDown(b,c):0===c?this.processButtonUp(b,c):this.processButtonFloat(b,c))}for(b=0;b<this._axesLen;b++)c=this._rawPad.axes[b],0<c&&c>this.deadZone||
0>c&&c<-this.deadZone?this.processAxisChange(b,c):this.processAxisChange(b,0);this._prevTimestamp=this._rawPad.timestamp}},connect:function(b){var c=!this.connected;this.connected=!0;this.index=b.index;this._rawPad=b;this._buttons=[];this._buttonsLen=b.buttons.length;this._axes=[];this._axesLen=b.axes.length;for(var e=0;e<this._axesLen;e++)this._axes[e]=b.axes[e];for(var d in b.buttons)d=parseInt(d,10),this._buttons[d]=new a.GamepadButton(this,d);c&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,
this.index);c&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var b=this.connected,c=this.index;this.connected=!1;this.index=null;this._rawPad=void 0;for(var a=0;a<this._buttonsLen;a++)this._buttons[a].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;b&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,c);b&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},
destroy:function(){this._rawPad=void 0;for(var b=0;b<this._buttonsLen;b++)this._buttons[b].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=this.onConnectCallback=null},processAxisChange:function(b,c){this._axes[b]!==c&&(this._axes[b]=c,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,b,c),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,
this,b,c))},processButtonDown:function(b,c){this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,b,c,this.index);this.onDownCallback&&this.onDownCallback.call(this.callbackContext,b,c);this._buttons[b]&&this._buttons[b].processButtonDown(c)},processButtonUp:function(b,c){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,b,c,this.index);this.onUpCallback&&this.onUpCallback.call(this.callbackContext,b,c);this._buttons[b]&&
this._buttons[b].processButtonUp(c)},processButtonFloat:function(b,c){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,b,c,this.index);this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,b,c);this._buttons[b]&&this._buttons[b].processButtonFloat(c)},axis:function(b){return this._axes[b]?this._axes[b]:!1},isDown:function(b){return this._buttons[b]?this._buttons[b].isDown:!1},isUp:function(b){return this._buttons[b]?this._buttons[b].isUp:
!1},justReleased:function(b,c){return this._buttons[b]?this._buttons[b].justReleased(c):void 0},justPressed:function(b,c){return this._buttons[b]?this._buttons[b].justPressed(c):void 0},buttonValue:function(b){return this._buttons[b]?this._buttons[b].value:null},reset:function(){for(var b=0;b<this._axes.length;b++)this._axes[b]=0}};a.SinglePad.prototype.constructor=a.SinglePad;a.GamepadButton=function(b,c){this.pad=b;this.game=b.game;this.isDown=!1;this.isUp=!0;this.value=this.repeats=this.timeUp=
this.duration=this.timeDown=0;this.buttonCode=c;this.onDown=new a.Signal;this.onUp=new a.Signal;this.onFloat=new a.Signal};a.GamepadButton.prototype={processButtonDown:function(b){this.isDown=!0;this.isUp=!1;this.timeDown=this.game.time.time;this.repeats=this.duration=0;this.value=b;this.onDown.dispatch(this,b)},processButtonUp:function(b){this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.time;this.value=b;this.onUp.dispatch(this,b)},processButtonFloat:function(b){this.value=b;this.onFloat.dispatch(this,
b)},justPressed:function(b){return b=b||250,!0===this.isDown&&this.timeDown+b>this.game.time.time},justReleased:function(b){return b=b||250,!0===this.isUp&&this.timeUp+b>this.game.time.time},reset:function(){this.isDown=!1;this.isUp=!0;this.timeDown=this.game.time.time;this.repeats=this.duration=0},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.game=this.pad=null}};a.GamepadButton.prototype.constructor=a.GamepadButton;a.Key=function(b,c){this.game=b;this._enabled=
!0;this.event=null;this.isDown=!1;this.isUp=!0;this.shiftKey=this.ctrlKey=this.altKey=!1;this.duration=this.timeDown=0;this.timeUp=-2500;this.repeats=0;this.keyCode=c;this.onDown=new a.Signal;this.onHoldContext=this.onHoldCallback=null;this.onUp=new a.Signal;this._justUp=this._justDown=!1};a.Key.prototype={update:function(){this._enabled&&this.isDown&&(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(b){this._enabled&&
(this.event=b,this.isDown||(this.altKey=b.altKey,this.ctrlKey=b.ctrlKey,this.shiftKey=b.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(b){this._enabled&&(this.event=b,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(b){"undefined"==typeof b&&(b=!0);
this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.time;this.duration=0;this._enabled=!0;this._justUp=this._justDown=!1;b&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(b){return"undefined"==typeof b&&(b=50),this.isDown&&this.duration<b},upDuration:function(b){return"undefined"==typeof b&&(b=50),!this.isDown&&this.game.time.time-this.timeUp<b}};Object.defineProperty(a.Key.prototype,"justDown",{get:function(){var b=this._justDown;
return this._justDown=!1,b}});Object.defineProperty(a.Key.prototype,"justUp",{get:function(){var b=this._justUp;return this._justUp=!1,b}});Object.defineProperty(a.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(b){b=!!b;b!==this._enabled&&(b||this.reset(!1),this._enabled=b)}});a.Key.prototype.constructor=a.Key;a.Keyboard=function(b){this.game=b;this.enabled=!0;this.pressEvent=this.event=null;this.callbackContext=this;this.onUpCallback=this.onPressCallback=this.onDownCallback=
null;this._keys=[];this._capture=[];this._onKeyUp=this._onKeyPress=this._onKeyDown=null;this._k=this._i=0};a.Keyboard.prototype={addCallbacks:function(b,c,a,d){this.callbackContext=b;"undefined"!=typeof c&&(this.onDownCallback=c);"undefined"!=typeof a&&(this.onUpCallback=a);"undefined"!=typeof d&&(this.onPressCallback=d)},addKey:function(b){return this._keys[b]||(this._keys[b]=new a.Key(this.game,b),this.addKeyCapture(b)),this._keys[b]},removeKey:function(b){this._keys[b]&&(this._keys[b]=null,this.removeKeyCapture(b))},
createCursorKeys:function(){return{up:this.addKey(a.Keyboard.UP),down:this.addKey(a.Keyboard.DOWN),left:this.addKey(a.Keyboard.LEFT),right:this.addKey(a.Keyboard.RIGHT)}},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var b=this;this._onKeyDown=function(c){return b.processKeyDown(c)};this._onKeyUp=function(c){return b.processKeyUp(c)};this._onKeyPress=function(c){return b.processKeyPress(c)};window.addEventListener("keydown",this._onKeyDown,!1);window.addEventListener("keyup",
this._onKeyUp,!1);window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyPress=this._onKeyUp=this._onKeyDown=null},destroy:function(){this.stop();this.clearCaptures();this._i=this._keys.length=0},addKeyCapture:function(b){if("object"==typeof b)for(var c in b)this._capture[b[c]]=!0;else this._capture[b]=!0},removeKeyCapture:function(b){delete this._capture[b]},
clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(b){this.event=b;this.game.input.enabled&&this.enabled&&(this._capture[b.keyCode]&&b.preventDefault(),this._keys[b.keyCode]||(this._keys[b.keyCode]=new a.Key(this.game,b.keyCode)),this._keys[b.keyCode].processKeyDown(b),this._k=b.keyCode,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,b))},processKeyPress:function(b){this.pressEvent=
b;this.game.input.enabled&&this.enabled&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(b.charCode),b)},processKeyUp:function(b){this.event=b;this.game.input.enabled&&this.enabled&&(this._capture[b.keyCode]&&b.preventDefault(),this._keys[b.keyCode]||(this._keys[b.keyCode]=new a.Key(this.game,b.keyCode)),this._keys[b.keyCode].processKeyUp(b),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,b))},reset:function(b){"undefined"==typeof b&&(b=!0);
this.event=null;for(var c=this._keys.length;c--;)this._keys[c]&&this._keys[c].reset(b)},downDuration:function(b,c){return this._keys[b]?this._keys[b].downDuration(c):null},upDuration:function(b,c){return this._keys[b]?this._keys[b].upDuration(c):null},isDown:function(b){return this._keys[b]?this._keys[b].isDown:null}};Object.defineProperty(a.Keyboard.prototype,"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});Object.defineProperty(a.Keyboard.prototype,"lastChar",{get:function(){return 32===
this.event.charCode?"":String.fromCharCode(this.pressEvent.charCode)}});Object.defineProperty(a.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});a.Keyboard.prototype.constructor=a.Keyboard;a.Keyboard.A=65;a.Keyboard.B=66;a.Keyboard.C=67;a.Keyboard.D=68;a.Keyboard.E=69;a.Keyboard.F=70;a.Keyboard.G=71;a.Keyboard.H=72;a.Keyboard.I=73;a.Keyboard.J=74;a.Keyboard.K=75;a.Keyboard.L=76;a.Keyboard.M=77;a.Keyboard.N=78;a.Keyboard.O=79;a.Keyboard.P=80;a.Keyboard.Q=81;a.Keyboard.R=82;
a.Keyboard.S=83;a.Keyboard.T=84;a.Keyboard.U=85;a.Keyboard.V=86;a.Keyboard.W=87;a.Keyboard.X=88;a.Keyboard.Y=89;a.Keyboard.Z=90;a.Keyboard.ZERO=48;a.Keyboard.ONE=49;a.Keyboard.TWO=50;a.Keyboard.THREE=51;a.Keyboard.FOUR=52;a.Keyboard.FIVE=53;a.Keyboard.SIX=54;a.Keyboard.SEVEN=55;a.Keyboard.EIGHT=56;a.Keyboard.NINE=57;a.Keyboard.NUMPAD_0=96;a.Keyboard.NUMPAD_1=97;a.Keyboard.NUMPAD_2=98;a.Keyboard.NUMPAD_3=99;a.Keyboard.NUMPAD_4=100;a.Keyboard.NUMPAD_5=101;a.Keyboard.NUMPAD_6=102;a.Keyboard.NUMPAD_7=
103;a.Keyboard.NUMPAD_8=104;a.Keyboard.NUMPAD_9=105;a.Keyboard.NUMPAD_MULTIPLY=106;a.Keyboard.NUMPAD_ADD=107;a.Keyboard.NUMPAD_ENTER=108;a.Keyboard.NUMPAD_SUBTRACT=109;a.Keyboard.NUMPAD_DECIMAL=110;a.Keyboard.NUMPAD_DIVIDE=111;a.Keyboard.F1=112;a.Keyboard.F2=113;a.Keyboard.F3=114;a.Keyboard.F4=115;a.Keyboard.F5=116;a.Keyboard.F6=117;a.Keyboard.F7=118;a.Keyboard.F8=119;a.Keyboard.F9=120;a.Keyboard.F10=121;a.Keyboard.F11=122;a.Keyboard.F12=123;a.Keyboard.F13=124;a.Keyboard.F14=125;a.Keyboard.F15=126;
a.Keyboard.COLON=186;a.Keyboard.EQUALS=187;a.Keyboard.UNDERSCORE=189;a.Keyboard.QUESTION_MARK=191;a.Keyboard.TILDE=192;a.Keyboard.OPEN_BRACKET=219;a.Keyboard.BACKWARD_SLASH=220;a.Keyboard.CLOSED_BRACKET=221;a.Keyboard.QUOTES=222;a.Keyboard.BACKSPACE=8;a.Keyboard.TAB=9;a.Keyboard.CLEAR=12;a.Keyboard.ENTER=13;a.Keyboard.SHIFT=16;a.Keyboard.CONTROL=17;a.Keyboard.ALT=18;a.Keyboard.CAPS_LOCK=20;a.Keyboard.ESC=27;a.Keyboard.SPACEBAR=32;a.Keyboard.PAGE_UP=33;a.Keyboard.PAGE_DOWN=34;a.Keyboard.END=35;a.Keyboard.HOME=
36;a.Keyboard.LEFT=37;a.Keyboard.UP=38;a.Keyboard.RIGHT=39;a.Keyboard.DOWN=40;a.Keyboard.INSERT=45;a.Keyboard.DELETE=46;a.Keyboard.HELP=47;a.Keyboard.NUM_LOCK=144;a.Keyboard.PLUS=43;a.Keyboard.MINUS=45;a.Component=function(){};a.Component.Angle=function(){};a.Component.Angle.prototype={angle:{get:function(){return a.Math.wrapAngle(a.Math.radToDeg(this.rotation))},set:function(b){this.rotation=a.Math.degToRad(a.Math.wrapAngle(b))}}};a.Component.Animation=function(){};a.Component.Animation.prototype=
{play:function(b,c,a,d){return this.animations?this.animations.play(b,c,a,d):void 0}};a.Component.AutoCull=function(){};a.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}};a.Component.Bounds=function(){};a.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*
this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},left:{get:function(){return this.x-this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX}},top:{get:function(){return this.y-this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY}}};a.Component.BringToTop=function(){};a.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this};a.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&
this.parent.sendToBack(this),this};a.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this};a.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this};a.Component.Core=function(){};a.Component.Core.install=function(b){a.Utils.mixinPrototype(this,a.Component.Core.prototype);this.components={};for(var c=0;c<b.length;c++){var e=b[c],d=!1;"Destroy"===e&&(d=!0);a.Utils.mixinPrototype(this,a.Component[e].prototype,
d);this.components[e]=!0}};a.Component.Core.init=function(b,c,e,d,f){this.game=b;this.key=d;this.position.set(c,e);this.world=new a.Point(c,e);this.previousPosition=new a.Point(c,e);this.events=new a.Events(this);this._bounds=new a.Rectangle;this.components.PhysicsBody&&(this.body=this.body);this.components.Animation&&(this.animations=new a.AnimationManager(this));this.components.LoadTexture&&null!==d&&this.loadTexture(d,f);this.components.FixedToCamera&&(this.cameraOffset=new a.Point(c,e))};a.Component.Core.preUpdate=
function(){if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++);this.animations&&this.animations.update();this.body&&this.body.preUpdate();for(var b=0;b<this.children.length;b++)this.children[b].preUpdate();return!0};a.Component.Core.prototype=
{game:null,name:"",components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(b){b?(this._exists=!0,this.body&&this.body.type===a.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===a.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},update:function(){},postUpdate:function(){this.key instanceof
a.BitmapData&&this.key.render();this.components.PhysicsBody&&a.Component.PhysicsBody.postUpdate.call(this);this.components.FixedToCamera&&a.Component.FixedToCamera.postUpdate.call(this);for(var b=0;b<this.children.length;b++)this.children[b].postUpdate()}};a.Component.Crop=function(){};a.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(b,c){"undefined"==typeof c&&(c=!1);b?(c&&null!==this.cropRect?this.cropRect.setTo(b.x,b.y,b.width,b.height):this.cropRect=c&&null===this.cropRect?new a.Rectangle(b.x,
b.y,b.width,b.height):b,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){this._crop=a.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var b=Math.max(this._frame.x,this._crop.x),c=Math.max(this._frame.y,this._crop.y),e=Math.min(this._frame.right,this._crop.right)-b,d=Math.min(this._frame.bottom,this._crop.bottom)-c;this.texture.crop.x=b;this.texture.crop.y=c;this.texture.crop.width=e;
this.texture.crop.height=d;this.texture.frame.width=Math.min(e,this.cropRect.width);this.texture.frame.height=Math.min(d,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs()}}};a.Component.Delta=function(){};a.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-
this.previousRotation}}};a.Component.Destroy=function(){};a.Component.Destroy.prototype={destroyPhase:!1,destroy:function(b){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof b&&(b=!0);this.destroyPhase=!0;this.events&&this.events.onDestroy$dispatch(this);this.parent&&(this.parent instanceof a.Group?this.parent.remove(this):this.parent.removeChild(this));this.input&&this.input.destroy();this.animations&&this.animations.destroy();this.body&&this.body.destroy();this.events&&this.events.destroy();
var c=this.children.length;if(b)for(;c--;)this.children[c].destroy(b);else for(;c--;)this.removeChild(this.children[c]);this._crop&&(this._crop=null);this._frame&&(this._frame=null);this.visible=this.exists=this.alive=!1;this.game=this.mask=this.filters=null;this.renderable=!1;this._mask=this._currentBounds=this._bounds=this.filterArea=this.worldTransform=this.stage=this.parent=this.hitArea=this.transformCallbackContext=this.transformCallback=null;this._destroyCachedSprite();this.destroyPhase=!1}}};
a.Events=function(b){this.parent=b};a.Events.prototype={destroy:function(){this._parent=null;this._onDestroy&&this._onDestroy.dispose();this._onAddedToGroup&&this._onAddedToGroup.dispose();this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose();this._onRemovedFromWorld&&this._onRemovedFromWorld.dispose();this._onKilled&&this._onKilled.dispose();this._onRevived&&this._onRevived.dispose();this._onEnterBounds&&this._onEnterBounds.dispose();this._onOutOfBounds&&this._onOutOfBounds.dispose();this._onInputOver&&
this._onInputOver.dispose();this._onInputOut&&this._onInputOut.dispose();this._onInputDown&&this._onInputDown.dispose();this._onInputUp&&this._onInputUp.dispose();this._onDragStart&&this._onDragStart.dispose();this._onDragStop&&this._onDragStop.dispose();this._onAnimationStart&&this._onAnimationStart.dispose();this._onAnimationComplete&&this._onAnimationComplete.dispose();this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,
onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};a.Events.prototype.constructor=a.Events;for(var p in a.Events.prototype)a.Events.prototype.hasOwnProperty(p)&&0===p.indexOf("on")&&null===a.Events.prototype[p]&&!function(b,c){Object.defineProperty(a.Events.prototype,b,{get:function(){return this[c]||(this[c]=new a.Signal)}});
a.Events.prototype[b+"$dispatch"]=function(){return this[c]?this[c].dispatch.apply(this[c],arguments):null}}(p,"_"+p);a.Component.FixedToCamera=function(){};a.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)};a.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},
set:function(b){b?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new a.Point};a.Component.Health=function(){};a.Component.Health.prototype={health:1,damage:function(b){return this.alive&&(this.health-=b,0>=this.health&&this.kill()),this}};a.Component.InCamera=function(){};a.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};a.Component.InputEnabled=function(){};a.Component.InputEnabled.prototype=
{input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(b){b?null===this.input?(this.input=new a.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}};a.Component.InWorld=function(){};a.Component.InWorld.preUpdate=function(){if((this.autoCull||this.checkWorldBounds)&&(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,
this.autoCull&&(this.game.world.camera.view.intersects(this._bounds)?(this.renderable=!0,this.game.world.camera.totalInView++):this.renderable=!1),this.checkWorldBounds))if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),
!1;return!0};a.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};a.Component.LifeSpan=function(){};a.Component.LifeSpan.preUpdate=function(){return 0<this.lifespan&&(this.lifespan-=this.game.time.physicsElapsedMS,0>=this.lifespan)?(this.kill(),!1):!0};a.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(b){return"undefined"==typeof b&&(b=1),this.alive=!0,this.exists=
!0,this.visible=!0,"number"==typeof this.health&&(this.health=b),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}};a.Component.LoadTexture=function(){};a.Component.LoadTexture.prototype={_frame:null,loadTexture:function(b,c,e){c=c||0;(e||"undefined"==typeof e)&&this.animations&&this.animations.stop();this.key=b;e=!0;var d=!this.texture.baseTexture.scaleMode,f=!1;a.RenderTexture&&
b instanceof a.RenderTexture?(this.key=b.key,this.setTexture(b),f=!0):a.BitmapData&&b instanceof a.BitmapData?(this.setTexture(b.texture),this.game.cache.getFrameData(b.key,a.Cache.BITMAPDATA)&&(e=!this.animations.loadFrameData(this.game.cache.getFrameData(b.key,a.Cache.BITMAPDATA),c))):b instanceof PIXI.Texture?this.setTexture(b):null===b||"undefined"==typeof b?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof b||this.game.cache.checkImageKey(b)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[b])),
e=!this.animations.loadFrameData(this.game.cache.getFrameData(b),c)):(console.warn("Texture with key '"+b+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]));f||this.texture.baseTexture.dirty();e&&(this._frame=a.Rectangle.clone(this.texture.frame));d||(this.texture.baseTexture.scaleMode=1)},setFrame:function(b){this._frame=b;this.texture.frame.x=b.x;this.texture.frame.y=b.y;this.texture.frame.width=b.width;this.texture.frame.height=b.height;this.texture.crop.x=b.x;this.texture.crop.y=
b.y;this.texture.crop.width=b.width;this.texture.crop.height=b.height;b.trimmed?(this.texture.trim?(this.texture.trim.x=b.spriteSourceSizeX,this.texture.trim.y=b.spriteSourceSizeY,this.texture.trim.width=b.sourceSizeW,this.texture.trim.height=b.sourceSizeH):this.texture.trim={x:b.spriteSourceSizeX,y:b.spriteSourceSizeY,width:b.sourceSizeW,height:b.sourceSizeH},this.texture.width=b.sourceSizeW,this.texture.height=b.sourceSizeH,this.texture.frame.width=b.sourceSizeW,this.texture.frame.height=b.sourceSizeH):
!b.trimmed&&this.texture.trim&&(this.texture.trim=null);this.cropRect&&this.updateCrop();16777215!==this.tint&&(this.cachedTint=-1);this.texture._updateUvs()},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(b){this.animations.frame=b}},frameName:{get:function(){return this.animations.frameName},set:function(b){this.animations.frameName=b}}};a.Component.Overlap=function(){};a.Component.Overlap.prototype={overlap:function(b){return a.Rectangle.intersects(this.getBounds(),
b.getBounds())}};a.Component.PhysicsBody=function(){};a.Component.PhysicsBody.preUpdate=function(){return this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=
this.rotation,this._exists&&this.parent.exists?!0:(this.renderOrderID=-1,!1))};a.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()};a.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(b){this.position.x=b;this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(b){this.position.y=b;this.body&&!this.body.dirty&&(this.body._reset=!0)}}};a.Component.Reset=function(){};
a.Component.Reset.prototype.reset=function(b,c,a){return"undefined"==typeof a&&(a=1),this.world.set(b,c),this.position.set(b,c),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=a),this.components.PhysicsBody&&this.body&&this.body.reset(b,c,!1,!1),this};a.Component.ScaleMinMax=function(){};a.Component.ScaleMinMax.prototype={transformCallback:this.checkTransform,transformCallbackContext:this,
scaleMin:null,scaleMax:null,checkTransform:function(b){this.scaleMin&&(b.a<this.scaleMin.x&&(b.a=this.scaleMin.x),b.d<this.scaleMin.y&&(b.d=this.scaleMin.y));this.scaleMax&&(b.a>this.scaleMax.x&&(b.a=this.scaleMax.x),b.d>this.scaleMax.y&&(b.d=this.scaleMax.y))},setScaleMinMax:function(b,c,e,d){"undefined"==typeof c?c=e=d=b:"undefined"==typeof e&&(e=d=c,c=b);null===b?this.scaleMin=null:this.scaleMin?this.scaleMin.set(b,c):this.scaleMin=new a.Point(b,c);null===e?this.scaleMax=null:this.scaleMax?this.scaleMax.set(e,
d):this.scaleMax=new a.Point(e,d)}};a.Component.Smoothed=function(){};a.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(b){b?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}};a.GameObjectFactory=function(b){this.game=b;this.world=this.game.world};a.GameObjectFactory.prototype={existing:function(b){return this.world.add(b)},image:function(b,c,e,d,f){return"undefined"==typeof f&&
(f=this.world),f.add(new a.Image(this.game,b,c,e,d))},sprite:function(b,c,a,d,f){return"undefined"==typeof f&&(f=this.world),f.create(b,c,a,d)},tween:function(b){return this.game.tweens.create(b)},group:function(b,c,e,d,f){return new a.Group(this.game,b,c,e,d,f)},physicsGroup:function(b,c,e,d){return new a.Group(this.game,c,e,d,!0,b)},spriteBatch:function(b,c,e){return"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c="group"),"undefined"==typeof e&&(e=!1),new a.SpriteBatch(this.game,b,c,e)},
audio:function(b,c,a,d){return this.game.sound.add(b,c,a,d)},sound:function(b,c,a,d){return this.game.sound.add(b,c,a,d)},audioSprite:function(b){return this.game.sound.addSprite(b)},tileSprite:function(b,c,e,d,f,k,n){return"undefined"==typeof n&&(n=this.world),n.add(new a.TileSprite(this.game,b,c,e,d,f,k))},rope:function(b,c,e,d,f,k){return"undefined"==typeof k&&(k=this.world),k.add(new a.Rope(this.game,b,c,e,d,f))},text:function(b,c,e,d,f){return"undefined"==typeof f&&(f=this.world),f.add(new a.Text(this.game,
b,c,e,d))},button:function(b,c,e,d,f,k,n,g,h,l){return"undefined"==typeof l&&(l=this.world),l.add(new a.Button(this.game,b,c,e,d,f,k,n,g,h))},graphics:function(b,c,e){return"undefined"==typeof e&&(e=this.world),e.add(new a.Graphics(this.game,b,c))},emitter:function(b,c,e){return this.game.particles.add(new a.Particles.Arcade.Emitter(this.game,b,c,e))},retroFont:function(b,c,e,d,f,k,n,g,h){return new a.RetroFont(this.game,b,c,e,d,f,k,n,g,h)},bitmapText:function(b,c,e,d,f,k){return"undefined"==typeof k&&
(k=this.world),k.add(new a.BitmapText(this.game,b,c,e,d,f))},tilemap:function(b,c,e,d,f){return new a.Tilemap(this.game,b,c,e,d,f)},renderTexture:function(b,c,e,d){"undefined"!=typeof e&&""!==e||(e=this.game.rnd.uuid());"undefined"==typeof d&&(d=!1);b=new a.RenderTexture(this.game,b,c,e);return d&&this.game.cache.addRenderTexture(e,b),b},bitmapData:function(b,c,e,d){"undefined"==typeof d&&(d=!1);"undefined"!=typeof e&&""!==e||(e=this.game.rnd.uuid());b=new a.BitmapData(this.game,e,b,c);return d&&
this.game.cache.addBitmapData(e,b),b},filter:function(b){var c=Array.prototype.splice.call(arguments,1);b=new a.Filter[b](this.game);return b.init.apply(b,c),b},plugin:function(b){return this.game.plugins.add(b)}};a.GameObjectFactory.prototype.constructor=a.GameObjectFactory;a.GameObjectCreator=function(b){this.game=b;this.world=this.game.world};a.GameObjectCreator.prototype={image:function(b,c,e,d){return new a.Image(this.game,b,c,e,d)},sprite:function(b,c,e,d){return new a.Sprite(this.game,b,c,
e,d)},tween:function(b){return new a.Tween(b,this.game,this.game.tweens)},group:function(b,c,e,d,f){return new a.Group(this.game,null,c,e,d,f)},spriteBatch:function(b,c,e){return"undefined"==typeof c&&(c="group"),"undefined"==typeof e&&(e=!1),new a.SpriteBatch(this.game,b,c,e)},audio:function(b,c,a,d){return this.game.sound.add(b,c,a,d)},audioSprite:function(b){return this.game.sound.addSprite(b)},sound:function(b,c,a,d){return this.game.sound.add(b,c,a,d)},tileSprite:function(b,c,e,d,f,k){return new a.TileSprite(this.game,
b,c,e,d,f,k)},rope:function(b,c,e,d,f){return new a.Rope(this.game,b,c,e,d,f)},text:function(b,c,e,d){return new a.Text(this.game,b,c,e,d)},button:function(b,c,e,d,f,k,n,g,h){return new a.Button(this.game,b,c,e,d,f,k,n,g,h)},graphics:function(b,c){return new a.Graphics(this.game,b,c)},emitter:function(b,c,e){return new a.Particles.Arcade.Emitter(this.game,b,c,e)},retroFont:function(b,c,e,d,f,k,n,g,h){return new a.RetroFont(this.game,b,c,e,d,f,k,n,g,h)},bitmapText:function(b,c,e,d,f){return new a.BitmapText(this.game,
b,c,e,d,f)},tilemap:function(b,c,e,d,f){return new a.Tilemap(this.game,b,c,e,d,f)},renderTexture:function(b,c,e,d){"undefined"!=typeof e&&""!==e||(e=this.game.rnd.uuid());"undefined"==typeof d&&(d=!1);b=new a.RenderTexture(this.game,b,c,e);return d&&this.game.cache.addRenderTexture(e,b),b},bitmapData:function(b,c,e,d){"undefined"==typeof d&&(d=!1);"undefined"!=typeof e&&""!==e||(e=this.game.rnd.uuid());b=new a.BitmapData(this.game,e,b,c);return d&&this.game.cache.addBitmapData(e,b),b},filter:function(b){var c=
Array.prototype.splice.call(arguments,1);b=new a.Filter[b](this.game);return b.init.apply(b,c),b}};a.GameObjectCreator.prototype.constructor=a.GameObjectCreator;a.Sprite=function(b,c,e,d,f){c=c||0;e=e||0;d=d||null;f=f||null;this.physicsType=this.type=a.SPRITE;PIXI.Sprite.call(this,PIXI.TextureCache.__default);a.Component.Core.init.call(this,b,c,e,d,f)};a.Sprite.prototype=Object.create(PIXI.Sprite.prototype);a.Sprite.prototype.constructor=a.Sprite;a.Component.Core.install.call(a.Sprite.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Delta Destroy FixedToCamera InputEnabled InWorld LifeSpan LoadTexture Overlap PhysicsBody Reset ScaleMinMax Smoothed".split(" "));
a.Sprite.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.Sprite.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;a.Sprite.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.Sprite.prototype.preUpdateCore=a.Component.Core.preUpdate;a.Sprite.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};a.Image=function(b,c,e,d,f){c=c||0;e=e||0;d=d||null;f=f||null;this.type=a.IMAGE;PIXI.Sprite.call(this,
PIXI.TextureCache.__default);a.Component.Core.init.call(this,b,c,e,d,f)};a.Image.prototype=Object.create(PIXI.Sprite.prototype);a.Image.prototype.constructor=a.Image;a.Component.Core.install.call(a.Image.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Destroy FixedToCamera InputEnabled LifeSpan LoadTexture Overlap Reset Smoothed".split(" "));a.Image.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.Image.prototype.preUpdateCore=a.Component.Core.preUpdate;a.Image.prototype.preUpdate=
function(){return this.preUpdateInWorld()?this.preUpdateCore():!1};a.TileSprite=function(b,c,e,d,f,k,n){c=c||0;e=e||0;d=d||256;f=f||256;k=k||null;n=n||null;this.type=a.TILESPRITE;this._scroll=new a.Point;PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,d,f);a.Component.Core.init.call(this,b,c,e,k,n)};a.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);a.TileSprite.prototype.constructor=a.TileSprite;a.Component.Core.install.call(a.TileSprite.prototype,"Angle Animation AutoCull Bounds Destroy FixedToCamera InputEnabled InWorld LoadTexture Overlap PhysicsBody Reset Smoothed".split(" "));
a.TileSprite.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.TileSprite.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;a.TileSprite.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.TileSprite.prototype.preUpdateCore=a.Component.Core.preUpdate;a.TileSprite.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),
this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};a.TileSprite.prototype.autoScroll=function(b,c){this._scroll.set(b,c)};a.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};a.TileSprite.prototype.destroy=function(b){a.Component.Destroy.prototype.destroy.call(this,b);PIXI.TilingSprite.prototype.destroy.call(this)};a.TileSprite.prototype.reset=function(b,c){return a.Component.Reset.prototype.reset.call(this,b,c),this.tilePosition.x=0,
this.tilePosition.y=0,this};a.Rope=function(b,c,e,d,f,k){this.points=[];this.points=k;this._hasUpdateAnimation=!1;this._updateAnimationCallback=null;c=c||0;e=e||0;d=d||null;f=f||null;this.type=a.ROPE;this._scroll=new a.Point;PIXI.Rope.call(this,d,this.points);a.Component.Core.init.call(this,b,c,e,d,f)};a.Rope.prototype=Object.create(PIXI.Rope.prototype);a.Rope.prototype.constructor=a.Rope;a.Component.Core.install.call(a.Rope.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Delta Destroy FixedToCamera InputEnabled InWorld LifeSpan LoadTexture Overlap PhysicsBody Reset ScaleMinMax Smoothed".split(" "));
a.Rope.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.Rope.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;a.Rope.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.Rope.prototype.preUpdateCore=a.Component.Core.preUpdate;a.Rope.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),this.preUpdatePhysics()&&
this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};a.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)};a.Rope.prototype.reset=function(b,c){return a.Component.Reset.prototype.reset.call(this,b,c),this.tilePosition.x=0,this.tilePosition.y=0,this};Object.defineProperty(a.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(b){b&&"function"==typeof b?(this._hasUpdateAnimation=!0,this._updateAnimation=
b):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}});Object.defineProperty(a.Rope.prototype,"segments",{get:function(){for(var b,c,e,d,f=[],k=0;k<this.points.length;k++)b=4*k,c=this.verticies[b],e=this.verticies[b+1],d=this.verticies[b+4],b=this.verticies[b+3],d=a.Math.difference(c,d),b=a.Math.difference(e,b),c+=this.world.x,e+=this.world.y,c=new a.Rectangle(c,e,d,b),f.push(c);return f}});a.Button=function(b,c,e,d,f,k,n,g,h,l){f=f||null;k=k||this;a.Image.call(this,b,c||0,e||0,d||null,g);
this.type=a.BUTTON;this.physicsType=a.SPRITE;this.onUpSound=this.onDownSound=this.onOutSound=this.onOverSound=this._onUpFrame=this._onDownFrame=this._onOutFrame=this._onOverFrame=null;this.onUpSoundMarker=this.onDownSoundMarker=this.onOutSoundMarker=this.onOverSoundMarker="";this.onInputOver=new a.Signal;this.onInputOut=new a.Signal;this.onInputDown=new a.Signal;this.onInputUp=new a.Signal;this.forceOut=this.freezeFrames=this.onOverMouseOnly=!1;this.inputEnabled=!0;this.input.start(0,!0);this.setFrames(n,
g,h,l);null!==f&&this.onInputUp.add(f,k);this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};a.Button.prototype=Object.create(a.Image.prototype);a.Button.prototype.constructor=a.Button;a.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};
a.Button.prototype.removedFromWorld=function(){this.inputEnabled=!1};a.Button.prototype.setStateFrame=function(b,c,a){var d="_on"+b+"Frame";null!=c?(this[d]=c,a&&this.changeStateFrame(b)):this[d]=null};a.Button.prototype.changeStateFrame=function(b){if(this.freezeFrames)return!1;b=this["_on"+b+"Frame"];return"string"==typeof b?(this.frameName=b,!0):"number"==typeof b?(this.frame=b,!0):!1};a.Button.prototype.setFrames=function(b,c,a,d){this.setStateFrame("Over",b,this.input.pointerOver());this.setStateFrame("Out",
c,!this.input.pointerOver());this.setStateFrame("Down",a,this.input.pointerDown());this.setStateFrame("Up",d,this.input.pointerUp())};a.Button.prototype.setStateSound=function(b,c,e){var d="on"+b+"Sound";b="on"+b+"SoundMarker";c instanceof a.Sound||c instanceof a.AudioSprite?(this[d]=c,this[b]="string"==typeof e?e:""):(this[d]=null,this[b]="")};a.Button.prototype.playStateSound=function(b){var c=this["on"+b+"Sound"];return c?(c.play(this["on"+b+"SoundMarker"]),!0):!1};a.Button.prototype.setSounds=
function(b,c,a,d,f,k,n,g){this.setStateSound("Over",b,c);this.setStateSound("Out",f,k);this.setStateSound("Down",a,d);this.setStateSound("Up",n,g)};a.Button.prototype.setOverSound=function(b,c){this.setStateSound("Over",b,c)};a.Button.prototype.setOutSound=function(b,c){this.setStateSound("Out",b,c)};a.Button.prototype.setDownSound=function(b,c){this.setStateSound("Down",b,c)};a.Button.prototype.setUpSound=function(b,c){this.setStateSound("Up",b,c)};a.Button.prototype.onInputOverHandler=function(b,
c){c.justReleased()||(this.changeStateFrame("Over"),(!this.onOverMouseOnly||c.isMouse)&&(this.playStateSound("Over"),this.onInputOver&&this.onInputOver.dispatch(this,c)))};a.Button.prototype.onInputOutHandler=function(b,c){this.changeStateFrame("Out");this.playStateSound("Out");this.onInputOut&&this.onInputOut.dispatch(this,c)};a.Button.prototype.onInputDownHandler=function(b,c){this.changeStateFrame("Down");this.playStateSound("Down");this.onInputDown&&this.onInputDown.dispatch(this,c)};a.Button.prototype.onInputUpHandler=
function(b,c,a){(this.playStateSound("Up"),this.onInputUp&&this.onInputUp.dispatch(this,c,a),this.freezeFrames)||(this.forceOut?this.changeStateFrame("Out"):this.changeStateFrame("Up")||this.changeStateFrame(a?"Over":"Out"))};a.SpriteBatch=function(b,c,e,d){"undefined"!=typeof c&&null!==c||(c=b.world);PIXI.SpriteBatch.call(this);a.Group.call(this,b,c,e,d);this.type=a.SPRITEBATCH};a.SpriteBatch.prototype=a.Utils.extend(!0,a.SpriteBatch.prototype,a.Group.prototype,PIXI.SpriteBatch.prototype);a.SpriteBatch.prototype.constructor=
a.SpriteBatch;a.Particle=function(b,c,e,d,f){a.Sprite.call(this,b,c,e,d,f);this.autoScale=!1;this.scaleData=null;this._s=0;this.autoAlpha=!1;this.alphaData=null;this._a=0};a.Particle.prototype=Object.create(a.Sprite.prototype);a.Particle.prototype.constructor=a.Particle;a.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1);this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:
this.autoAlpha=!1)};a.Particle.prototype.onEmit=function(){};a.Particle.prototype.setAlphaData=function(b){this.alphaData=b;this._a=b.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=!0};a.Particle.prototype.setScaleData=function(b){this.scaleData=b;this._s=b.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=!0};a.Particle.prototype.reset=function(b,c,e){return a.Component.Reset.prototype.reset.call(this,b,c,e),this.alpha=1,this.scale.set(1),this.autoScale=
!1,this.autoAlpha=!1,this};a.BitmapData=function(b,c,e,d){"undefined"==typeof e&&(e=256);"undefined"==typeof d&&(d=256);this.game=b;this.key=c;this.width=e;this.height=d;this.canvas=a.Canvas.create(e,d,"",!0);this.ctx=this.context=this.canvas.getContext("2d",{alpha:!0});this.imageData=this.context.getImageData(0,0,e,d);this.data=this.imageData.data;this.pixels=null;this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=
new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data;this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new a.Frame(0,0,0,e,d,"bitmapData",b.rnd.uuid());this.texture.frame=this.textureFrame;this.type=a.BITMAPDATA;this.dirty=this.disableTextureUpload=!1;this.cls=this.clear;this._image=null;this._pos=new a.Point;this._size=new a.Point;this._scale=new a.Point;this._rotate=
0;this._alpha={prev:1,current:1};this._anchor=new a.Point;this._tempB=this._tempG=this._tempR=0;this._circle=new a.Circle};a.BitmapData.prototype={add:function(b){if(Array.isArray(b))for(var c=0;c<b.length;c++)b[c].loadTexture&&b[c].loadTexture(this);else b.loadTexture(this);return this},load:function(b){return"string"==typeof b&&(b=this.game.cache.getImage(b)),b?(this.resize(b.width,b.height),this.cls(),this.draw(b),this.update(),this):void 0},clear:function(){return this.context.clearRect(0,0,this.width,
this.height),this.dirty=!0,this},fill:function(b,c,a,d){return"undefined"==typeof d&&(d=1),this.context.fillStyle="rgba("+b+","+c+","+a+","+d+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},resize:function(b,c){return(b!==this.width||c!==this.height)&&(this.width=b,this.height=c,this.canvas.width=b,this.canvas.height=c,this.baseTexture.width=b,this.baseTexture.height=c,this.textureFrame.width=b,this.textureFrame.height=c,this.texture.width=b,this.texture.height=c,this.texture.crop.width=
b,this.texture.crop.height=c,this.update(),this.dirty=!0),this},update:function(b,c,a,d){return"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof a&&(a=this.width),"undefined"==typeof d&&(d=this.height),this.imageData=this.context.getImageData(b,c,a,d),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=
new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(b,c,e,d,f,k){"undefined"==typeof e&&(e=0);"undefined"==typeof d&&(d=0);"undefined"==typeof f&&(f=this.width);"undefined"==typeof k&&(k=this.height);f=e+f;k=d+k;for(var n=a.Color.createColor(),g={r:0,g:0,b:0,a:0},h=!1;k>d;d++)for(var l=e;f>l;l++)a.Color.unpackPixel(this.getPixel32(l,d),n),g=b.call(c,n,l,d),!1!==g&&null!==g&&void 0!==g&&(this.setPixel32(l,d,g.r,g.g,g.b,g.a,!1),h=!0);return h&&(this.context.putImageData(this.imageData,
0,0),this.dirty=!0),this},processPixel:function(b,c,a,d,f,k){"undefined"==typeof a&&(a=0);"undefined"==typeof d&&(d=0);"undefined"==typeof f&&(f=this.width);"undefined"==typeof k&&(k=this.height);f=a+f;k=d+k;for(var n=0,g=0,h=!1;k>d;d++)for(var l=a;f>l;l++)n=this.getPixel32(l,d),g=b.call(c,n,l,d),g!==n&&(this.pixels[d*this.width+l]=g,h=!0);return h&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(b,c,e,d,f,k,n,g,h){var l=0,m=0,p=this.width,x=this.height;b=a.Color.packPixel(b,
c,e,d);void 0!==h&&h instanceof a.Rectangle&&(l=h.x,m=h.y,p=h.width,x=h.height);for(h=0;x>h;h++)for(c=0;p>c;c++)this.getPixel32(l+c,m+h)===b&&this.setPixel32(l+c,m+h,f,k,n,g,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(b,c,e,d){if(("undefined"==typeof b||null===b)&&(b=!1),("undefined"==typeof c||null===c)&&(c=!1),("undefined"==typeof e||null===e)&&(e=!1),b||c||e){"undefined"==typeof d&&(d=new a.Rectangle(0,0,this.width,this.height));for(var f=a.Color.createColor(),
k=d.y;k<d.bottom;k++)for(var n=d.x;n<d.right;n++)a.Color.unpackPixel(this.getPixel32(n,k),f,!0),b&&(f.h=b),c&&(f.s=c),e&&(f.l=e),a.Color.HSLtoRGB(f.h,f.s,f.l,f),this.setPixel32(n,k,f.r,f.g,f.b,f.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(b,c,e,d){if(("undefined"==typeof b||null===b)&&(b=!1),("undefined"==typeof c||null===c)&&(c=!1),("undefined"==typeof e||null===e)&&(e=!1),b||c||e){"undefined"==typeof d&&(d=new a.Rectangle(0,0,this.width,this.height));
for(var f=a.Color.createColor(),k=d.y;k<d.bottom;k++)for(var n=d.x;n<d.right;n++)a.Color.unpackPixel(this.getPixel32(n,k),f,!0),b&&(f.h=this.game.math.wrap(f.h+b,0,1)),c&&(f.s=this.game.math.limitValue(f.s+c,0,1)),e&&(f.l=this.game.math.limitValue(f.l+e,0,1)),a.Color.HSLtoRGB(f.h,f.s,f.l,f),this.setPixel32(n,k,f.r,f.g,f.b,f.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(b,c,e,d,f,k,n){return"undefined"==typeof n&&(n=!0),0<=b&&b<=this.width&&0<=
c&&c<=this.height&&(this.pixels[c*this.width+b]=a.Device.LITTLE_ENDIAN?k<<24|f<<16|d<<8|e:e<<24|d<<16|f<<8|k,n&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(b,c,a,d,f,k){return this.setPixel32(b,c,a,d,f,255,k)},getPixel:function(b,c,e){e||(e=a.Color.createColor());b=~~(b+c*this.width);return b*=4,e.r=this.data[b],e.g=this.data[++b],e.b=this.data[++b],e.a=this.data[++b],e},getPixel32:function(b,c){return 0<=b&&b<=this.width&&0<=c&&c<=this.height?this.pixels[c*
this.width+b]:void 0},getPixelRGB:function(b,c,e,d,f){return a.Color.unpackPixel(this.getPixel32(b,c),e,d,f)},getPixels:function(b){return this.context.getImageData(b.x,b.y,b.width,b.height)},getFirstPixel:function(b){"undefined"==typeof b&&(b=0);var c=a.Color.createColor(),e=0,d=0,f=1,k=!1;1===b?(f=-1,d=this.height):3===b&&(f=-1,e=this.width);do a.Color.unpackPixel(this.getPixel32(e,d),c),0===b||1===b?(e++,e===this.width&&(e=0,d+=f,(d>=this.height||0>=d)&&(k=!0))):(2===b||3===b)&&(d++,d===this.height&&
(d=0,e+=f,(e>=this.width||0>=e)&&(k=!0)));while(0===c.a&&!k);return c.x=e,c.y=d,c},getBounds:function(b){return"undefined"==typeof b&&(b=new a.Rectangle),b.x=this.getFirstPixel(2).x,b.x===this.width?b.setTo(0,0,0,0):(b.y=this.getFirstPixel(0).y,b.width=this.getFirstPixel(3).x-b.x+1,b.height=this.getFirstPixel(1).y-b.y+1,b)},addToWorld:function(b,c,a,d,f,k){f=f||1;k=k||1;b=this.game.add.image(b,c,this);return b.anchor.set(a,d),b.scale.set(f,k),b},copy:function(b,c,e,d,f,k,n,g,h,l,m,p,x,v,w,r,F){if(("undefined"==
typeof b||null===b)&&(b=this),this._image=b,b instanceof a.Sprite||b instanceof a.Image||b instanceof a.Text)this._pos.set(b.texture.crop.x,b.texture.crop.y),this._size.set(b.texture.crop.width,b.texture.crop.height),this._scale.set(b.scale.x,b.scale.y),this._anchor.set(b.anchor.x,b.anchor.y),this._rotate=b.rotation,this._alpha.current=b.alpha,this._image=b.texture.baseTexture.source,"undefined"!=typeof k&&null!==k||(k=b.x),"undefined"!=typeof n&&null!==n||(n=b.y),b.texture.trim&&(k+=b.texture.trim.x-
b.anchor.x*b.texture.trim.width,n+=b.texture.trim.y-b.anchor.y*b.texture.trim.height),16777215!==b.tint&&(b.cachedTint!==b.tint&&(b.cachedTint=b.tint,b.tintedTexture=PIXI.CanvasTinter.getTintedTexture(b,b.tint)),this._image=b.tintedTexture);else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,b instanceof a.BitmapData)this._image=b.canvas;else if("string"==typeof b){if(b=this.game.cache.getImage(b),null===b)return;this._image=b}this._size.set(this._image.width,
this._image.height)}return("undefined"==typeof c||null===c)&&(c=0),("undefined"==typeof e||null===e)&&(e=0),d&&(this._size.x=d),f&&(this._size.y=f),("undefined"==typeof k||null===k)&&(k=c),("undefined"==typeof n||null===n)&&(n=e),("undefined"==typeof g||null===g)&&(g=this._size.x),("undefined"==typeof h||null===h)&&(h=this._size.y),"number"==typeof l&&(this._rotate=l),"number"==typeof m&&(this._anchor.x=m),"number"==typeof p&&(this._anchor.y=p),"number"==typeof x&&(this._scale.x=x),"number"==typeof v&&
(this._scale.y=v),"number"==typeof w&&(this._alpha.current=w),"undefined"==typeof r&&(r=null),"undefined"==typeof F&&(F=!1),0>=this._alpha.current||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y?void 0:(this._alpha.prev=this.context.globalAlpha,this.context.save(),this.context.globalAlpha=this._alpha.current,r&&(this.context.globalCompositeOperation=r),F&&(k|=0,n|=0),this.context.translate(k,n),this.context.scale(this._scale.x,this._scale.y),this.context.rotate(this._rotate),
this.context.drawImage(this._image,this._pos.x+c,this._pos.y+e,this._size.x,this._size.y,-g*this._anchor.x,-h*this._anchor.y,g,h),this.context.restore(),this.context.globalAlpha=this._alpha.prev,this.dirty=!0,this)},copyRect:function(b,c,a,d,f,k,n){return this.copy(b,c.x,c.y,c.width,c.height,a,d,c.width,c.height,0,0,0,1,1,f,k,n)},draw:function(b,c,a,d,f,k,n){return this.copy(b,null,null,null,null,c,a,d,f,null,null,null,null,null,null,k,n)},drawGroup:function(b,c,a){return 0<b.total&&b.forEachExists(this.copy,
this,null,null,null,null,null,null,null,null,null,null,null,null,null,null,c,a),this},shadow:function(b,c,a,d){"undefined"==typeof b||null===b?this.context.shadowColor="rgba(0,0,0,0)":(this.context.shadowColor=b,this.context.shadowBlur=c||5,this.context.shadowOffsetX=a||10,this.context.shadowOffsetY=d||10)},alphaMask:function(b,c,a,d){return"undefined"==typeof d||null===d?this.draw(c).blendSourceAtop():this.draw(c,d.x,d.y,d.width,d.height).blendSourceAtop(),"undefined"==typeof a||null===a?this.draw(b).blendReset():
this.draw(b,a.x,a.y,a.width,a.height).blendReset(),this},extract:function(b,c,a,d,f,k,n,g,h){return"undefined"==typeof f&&(f=255),"undefined"==typeof k&&(k=!1),"undefined"==typeof n&&(n=c),"undefined"==typeof g&&(g=a),"undefined"==typeof h&&(h=d),k&&b.resize(this.width,this.height),this.processPixelRGB(function(k,l,m){return k.r===c&&k.g===a&&k.b===d&&b.setPixel32(l,m,n,g,h,f,!1),!1},this),b.context.putImageData(b.imageData,0,0),b.dirty=!0,b},rect:function(b,c,a,d,f){return"undefined"!=typeof f&&
(this.context.fillStyle=f),this.context.fillRect(b,c,a,d),this},text:function(b,c,a,d,f,k){"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a=0);"undefined"==typeof d&&(d="14px Courier");"undefined"==typeof f&&(f="rgb(255,255,255)");"undefined"==typeof k&&(k=!0);var n=this.context.font;this.context.font=d;k&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(b,c+1,a+1));this.context.fillStyle=f;this.context.fillText(b,c,a);this.context.font=n},circle:function(b,c,a,d){return"undefined"!=
typeof d&&(this.context.fillStyle=d),this.context.beginPath(),this.context.arc(b,c,a,0,2*Math.PI,!1),this.context.closePath(),this.context.fill(),this},textureLine:function(b,c,e){if("undefined"==typeof e&&(e="repeat-x"),"string"!=typeof c||(c=this.game.cache.getImage(c))){var d=b.length;return"no-repeat"===e&&d>c.width&&(d=c.width),this.context.fillStyle=this.context.createPattern(c,e),this._circle=new a.Circle(b.start.x,b.start.y,c.height),this._circle.circumferencePoint(b.angle-1.5707963267948966,
!1,this._pos),this.context.save(),this.context.translate(this._pos.x,this._pos.y),this.context.rotate(b.angle),this.context.fillRect(0,0,d,c.height),this.context.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},blendReset:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceOver:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceIn:function(){return this.context.globalCompositeOperation=
"source-in",this},blendSourceOut:function(){return this.context.globalCompositeOperation="source-out",this},blendSourceAtop:function(){return this.context.globalCompositeOperation="source-atop",this},blendDestinationOver:function(){return this.context.globalCompositeOperation="destination-over",this},blendDestinationIn:function(){return this.context.globalCompositeOperation="destination-in",this},blendDestinationOut:function(){return this.context.globalCompositeOperation="destination-out",this},blendDestinationAtop:function(){return this.context.globalCompositeOperation=
"destination-atop",this},blendXor:function(){return this.context.globalCompositeOperation="xor",this},blendAdd:function(){return this.context.globalCompositeOperation="lighter",this},blendMultiply:function(){return this.context.globalCompositeOperation="multiply",this},blendScreen:function(){return this.context.globalCompositeOperation="screen",this},blendOverlay:function(){return this.context.globalCompositeOperation="overlay",this},blendDarken:function(){return this.context.globalCompositeOperation=
"darken",this},blendLighten:function(){return this.context.globalCompositeOperation="lighten",this},blendColorDodge:function(){return this.context.globalCompositeOperation="color-dodge",this},blendColorBurn:function(){return this.context.globalCompositeOperation="color-burn",this},blendHardLight:function(){return this.context.globalCompositeOperation="hard-light",this},blendSoftLight:function(){return this.context.globalCompositeOperation="soft-light",this},blendDifference:function(){return this.context.globalCompositeOperation=
"difference",this},blendExclusion:function(){return this.context.globalCompositeOperation="exclusion",this},blendHue:function(){return this.context.globalCompositeOperation="hue",this},blendSaturation:function(){return this.context.globalCompositeOperation="saturation",this},blendColor:function(){return this.context.globalCompositeOperation="color",this},blendLuminosity:function(){return this.context.globalCompositeOperation="luminosity",this}};Object.defineProperty(a.BitmapData.prototype,"smoothed",
{get:function(){a.Canvas.getSmoothingEnabled(this.context)},set:function(b){a.Canvas.setSmoothingEnabled(this.context,b)}});a.BitmapData.getTransform=function(b,c,a,d,f,k){return"number"!=typeof b&&(b=0),"number"!=typeof c&&(c=0),"number"!=typeof a&&(a=1),"number"!=typeof d&&(d=1),"number"!=typeof f&&(f=0),"number"!=typeof k&&(k=0),{sx:a,sy:d,scaleX:a,scaleY:d,skewX:f,skewY:k,translateX:b,translateY:c,tx:b,ty:c}};a.BitmapData.prototype.constructor=a.BitmapData;a.Graphics=function(b,c,e){c=c||0;e=
e||0;this.type=a.GRAPHICS;this.physicsType=a.SPRITE;PIXI.Graphics.call(this);a.Component.Core.init.call(this,b,c,e,"",null)};a.Graphics.prototype=Object.create(PIXI.Graphics.prototype);a.Graphics.prototype.constructor=a.Graphics;a.Component.Core.install.call(a.Graphics.prototype,"Angle AutoCull Bounds Destroy FixedToCamera InputEnabled InWorld LifeSpan PhysicsBody Reset".split(" "));a.Graphics.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.Graphics.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;
a.Graphics.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.Graphics.prototype.preUpdateCore=a.Component.Core.preUpdate;a.Graphics.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};a.Graphics.prototype.destroy=function(b){this.clear();a.Component.Destroy.prototype.destroy.call(this,b)};a.Graphics.prototype.drawTriangle=function(b,c){"undefined"==typeof c&&(c=!1);var e=new a.Polygon(b);if(c){var d=new a.Point(this.game.camera.x-
b[0].x,this.game.camera.y-b[0].y),f=new a.Point(b[1].x-b[0].x,b[1].y-b[0].y),f=(new a.Point(b[1].x-b[2].x,b[1].y-b[2].y)).cross(f);0<d.dot(f)&&this.drawPolygon(e)}else this.drawPolygon(e)};a.Graphics.prototype.drawTriangles=function(b,c,e){"undefined"==typeof e&&(e=!1);var d,f=new a.Point,k=new a.Point,n=new a.Point,g=[];if(c)if(b[0]instanceof a.Point)for(d=0;d<c.length/3;d++)g.push(b[c[3*d]]),g.push(b[c[3*d+1]]),g.push(b[c[3*d+2]]),3===g.length&&(this.drawTriangle(g,e),g=[]);else for(d=0;d<c.length;d++)f.x=
b[2*c[d]],f.y=b[2*c[d]+1],g.push(f.copyTo({})),3===g.length&&(this.drawTriangle(g,e),g=[]);else if(b[0]instanceof a.Point)for(d=0;d<b.length/3;d++)this.drawTriangle([b[3*d],b[3*d+1],b[3*d+2]],e);else for(d=0;d<b.length/6;d++)f.x=b[6*d+0],f.y=b[6*d+1],k.x=b[6*d+2],k.y=b[6*d+3],n.x=b[6*d+4],n.y=b[6*d+5],this.drawTriangle([f,k,n],e)};a.RenderTexture=function(b,c,e,d,f,k){"undefined"==typeof d&&(d="");"undefined"==typeof f&&(f=a.scaleModes.DEFAULT);"undefined"==typeof k&&(k=1);this.game=b;this.key=d;
this.type=a.RENDERTEXTURE;this.matrix=new PIXI.Matrix;PIXI.RenderTexture.call(this,c,e,this.game.renderer,f,k);this.render=a.RenderTexture.prototype.render};a.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);a.RenderTexture.prototype.constructor=a.RenderTexture;a.RenderTexture.prototype.renderXY=function(b,c,a,d){this.matrix.tx=c;this.matrix.ty=a;this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(b,this.matrix,d):this.renderCanvas(b,this.matrix,d)};a.RenderTexture.prototype.render=
function(b,c,a){this.matrix.tx=c.x;this.matrix.ty=c.y;this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(b,this.matrix,a):this.renderCanvas(b,this.matrix,a)};a.Text=function(b,c,e,d,f){c=c||0;e=e||0;d=d||" ";f=f||{};d=0===d.length?" ":d.toString();this.type=a.TEXT;this.physicsType=a.SPRITE;this.padding=new a.Point;this._text=d;this._fontComponents=null;this._charCount=this._lineSpacing=0;this.colors=[];this.setStyle(f);PIXI.Text.call(this,d,this.style);a.Component.Core.init.call(this,b,c,e,
"",null);" "!==d&&this.updateText()};a.Text.prototype=Object.create(PIXI.Text.prototype);a.Text.prototype.constructor=a.Text;a.Component.Core.install.call(a.Text.prototype,"Angle AutoCull Bounds BringToTop Destroy FixedToCamera InputEnabled InWorld LifeSpan Overlap PhysicsBody Reset Smoothed".split(" "));a.Text.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.Text.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;a.Text.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;
a.Text.prototype.preUpdateCore=a.Component.Core.preUpdate;a.Text.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};a.Text.prototype.update=function(){};a.Text.prototype.destroy=function(b){this.texture.destroy(!0);this.canvas&&this.canvas.parentNode?this.canvas.parentNode.removeChild(this.canvas):(this.canvas=null,this.context=null);a.Component.Destroy.prototype.destroy.call(this,b)};a.Text.prototype.setShadow=
function(b,c,a,d){"undefined"==typeof b&&(b=0);"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a="rgba(0, 0, 0, 1)");"undefined"==typeof d&&(d=0);this.style.shadowOffsetX=b;this.style.shadowOffsetY=c;this.style.shadowColor=a;this.style.shadowBlur=d;this.dirty=!0};a.Text.prototype.setStyle=function(b){b=b||{};b.font=b.font||"bold 20pt Arial";b.backgroundColor=b.backgroundColor||null;b.fill=b.fill||"black";b.align=b.align||"left";b.stroke=b.stroke||"black";b.strokeThickness=b.strokeThickness||
0;b.wordWrap=b.wordWrap||!1;b.wordWrapWidth=b.wordWrapWidth||100;b.shadowOffsetX=b.shadowOffsetX||0;b.shadowOffsetY=b.shadowOffsetY||0;b.shadowColor=b.shadowColor||"rgba(0,0,0,0)";b.shadowBlur=b.shadowBlur||0;var c=this.fontToComponents(b.font);b.fontStyle&&(c.fontStyle=b.fontStyle);b.fontVariant&&(c.fontVariant=b.fontVariant);b.fontWeight&&(c.fontWeight=b.fontWeight);b.fontSize&&("number"==typeof b.fontSize&&(b.fontSize+="px"),c.fontSize=b.fontSize);this._fontComponents=c;b.font=this.componentsToFont(this._fontComponents);
this.style=b;this.dirty=!0};a.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var b=this.text;this.style.wordWrap&&(b=this.runWordWrap(this.text));for(var b=b.split(/(?:\r\n|\r|\n)/),c=[],a=0,d=this.determineFontProperties(this.style.font),f=0;f<b.length;f++){var k=this.context.measureText(b[f]).width+this.padding.x;c[f]=k;a=Math.max(a,k)}this.canvas.width=(a+this.style.strokeThickness)*this.resolution;var k=d.fontSize+this.style.strokeThickness+
this.padding.y,f=k*b.length,n=this._lineSpacing;if(0>n&&Math.abs(n)>k&&(n=-k),0!==n)f+=n*(b.length-1);this.canvas.height=f*this.resolution;this.context.scale(this.resolution,this.resolution);navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height));this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=
this.style.stroke;this.context.textBaseline="alphabetic";this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur;this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";for(var g,h,f=this._charCount=0;f<b.length;f++)g=this.style.strokeThickness/2,h=this.style.strokeThickness/2+f*k+d.ascent,0<f&&(h+=n*f),"right"===
this.style.align?g+=a-c[f]:"center"===this.style.align&&(g+=(a-c[f])/2),0<this.colors.length?this.updateLine(b[f],g,h):(this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(b[f],g,h),this.style.fill&&this.context.fillText(b[f],g,h));this.updateTexture()};a.Text.prototype.updateLine=function(b,c,a){for(var d=0;d<b.length;d++){var f=b[d];this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount],this.context.strokeStyle=this.colors[this._charCount]);this.style.stroke&&
this.style.strokeThickness&&this.context.strokeText(f,c,a);this.style.fill&&this.context.fillText(f,c,a);c+=this.context.measureText(f).width;this._charCount++}};a.Text.prototype.clearColors=function(){this.colors=[];this.dirty=!0};a.Text.prototype.addColor=function(b,c){this.colors[c]=b;this.dirty=!0};a.Text.prototype.runWordWrap=function(b){var c="";b=b.split("\n");for(var a=0;a<b.length;a++){for(var d=this.style.wordWrapWidth,f=b[a].split(" "),k=0;k<f.length;k++){var n=this.context.measureText(f[k]).width,
g=n+this.context.measureText(" ").width;g>d?(0<k&&(c+="\n"),c+=f[k]+" ",d=this.style.wordWrapWidth-n):(d-=g,c+=f[k]+" ")}a<b.length-1&&(c+="\n")}return c};a.Text.prototype.updateFont=function(b){b=this.componentsToFont(b);this.style.font!==b&&(this.style.font=b,this.dirty=!0,this.parent&&this.updateTransform())};a.Text.prototype.fontToComponents=function(b){var c=b.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);
return c?{font:b,fontStyle:c[1]||"normal",fontVariant:c[2]||"normal",fontWeight:c[3]||"normal",fontSize:c[4]||"medium",fontFamily:c[5]}:(console.warn("Phaser.Text - unparsable CSS font: "+b),{font:b})};a.Text.prototype.componentsToFont=function(b){var c,a=[];return c=b.fontStyle,c&&"normal"!==c&&a.push(c),c=b.fontVariant,c&&"normal"!==c&&a.push(c),c=b.fontWeight,c&&"normal"!==c&&a.push(c),c=b.fontSize,c&&"medium"!==c&&a.push(c),c=b.fontFamily,c&&a.push(c),a.length||a.push(b.font),a.join(" ")};Object.defineProperty(a.Text.prototype,
"text",{get:function(){return this._text},set:function(b){b!==this._text&&(this._text=b.toString()||" ",this.dirty=!0,this.parent&&this.updateTransform())}});Object.defineProperty(a.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(b){this._fontComponents=this.fontToComponents(b||"bold 20pt Arial");this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(b){b=
(b||"Arial").trim();/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(b)||/['",]/.exec(b)||(b="'"+b+"'");this._fontComponents.fontFamily=b;this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,"fontSize",{get:function(){var b=this._fontComponents.fontSize;return b&&/(?:^0$|px$)/.exec(b)?parseInt(b,10):b},set:function(b){b=b||"0";"number"==typeof b&&(b+="px");this._fontComponents.fontSize=b;this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,
"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(b){this._fontComponents.fontWeight=b||"normal";this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(b){this._fontComponents.fontStyle=b||"normal";this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||
"normal"},set:function(b){this._fontComponents.fontVariant=b||"normal";this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(b){b!==this.style.fill&&(this.style.fill=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"align",{get:function(){return this.style.align},set:function(b){b!==this.style.align&&(this.style.align=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"stroke",{get:function(){return this.style.stroke},
set:function(b){b!==this.style.stroke&&(this.style.stroke=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(b){b!==this.style.strokeThickness&&(this.style.strokeThickness=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(b){b!==this.style.wordWrap&&(this.style.wordWrap=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"wordWrapWidth",
{get:function(){return this.style.wordWrapWidth},set:function(b){b!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(b){b!==this._lineSpacing&&(this._lineSpacing=parseFloat(b),this.dirty=!0,this.parent&&this.updateTransform())}});Object.defineProperty(a.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(b){b!==this.style.shadowOffsetX&&
(this.style.shadowOffsetX=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(b){b!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(b){b!==this.style.shadowColor&&(this.style.shadowColor=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},
set:function(b){b!==this.style.shadowBlur&&(this.style.shadowBlur=b,this.dirty=!0)}});a.BitmapText=function(b,c,e,d,f,k){c=c||0;e=e||0;f=f||"";this.type=a.BITMAPTEXT;this.physicsType=a.SPRITE;this._text=f;this._font=d||"";this._fontSize=k||32;this._align="left";this._tint=16777215;this._th=this._tw=0;PIXI.BitmapText.call(this,f);a.Component.Core.init.call(this,b,c,e,"",null)};a.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype);a.BitmapText.prototype.constructor=a.BitmapText;a.Component.Core.install.call(a.BitmapText.prototype,
"Angle AutoCull Bounds Destroy FixedToCamera InputEnabled InWorld LifeSpan PhysicsBody Reset".split(" "));a.BitmapText.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.BitmapText.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;a.BitmapText.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.BitmapText.prototype.preUpdateCore=a.Component.Core.preUpdate;a.BitmapText.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?
this.preUpdateCore():!1};a.BitmapText.prototype.postUpdate=function(){a.Component.PhysicsBody.postUpdate.call(this);a.Component.FixedToCamera.postUpdate.call(this);!this.body||this.textWidth===this._tw&&this.textHeight===this._th||(this.body.setSize(this.textWidth,this.textHeight),this._tw=this.textWidth,this._th=this.textHeight)};a.BitmapText.prototype.setStyle=function(){this.style={align:this._align};this.fontName=this._font;this.fontSize=this._fontSize;this.dirty=!0};Object.defineProperty(a.BitmapText.prototype,
"align",{get:function(){return this._align},set:function(b){b!==this._align&&(this._align=b,this.setStyle())}});Object.defineProperty(a.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(b){b!==this._tint&&(this._tint=b,this.dirty=!0)}});Object.defineProperty(a.BitmapText.prototype,"font",{get:function(){return this._font},set:function(b){b!==this._font&&(this._font=b.trim(),this.fontName=this._font,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}});Object.defineProperty(a.BitmapText.prototype,
"fontSize",{get:function(){return this._fontSize},set:function(b){b=parseInt(b,10);b!==this._fontSize&&(this._fontSize=b,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}});Object.defineProperty(a.BitmapText.prototype,"text",{get:function(){return this._text},set:function(b){b!==this._text&&(this._text=b.toString()||" ",this.dirty=!0)}});a.RetroFont=function(b,c,e,d,f,k,n,g,h,l){if(!b.cache.checkImageKey(c))return!1;"undefined"!=typeof k&&null!==k||(k=b.cache.getImage(c).width/
e);this.characterWidth=e;this.characterHeight=d;this.characterSpacingX=n||0;this.characterSpacingY=g||0;this.characterPerRow=k;this.offsetX=h||0;this.offsetY=l||0;this.align="left";this.multiLine=!1;this.autoUpperCase=!0;this.fixedWidth=this.customSpacingY=this.customSpacingX=0;this.fontSet=b.cache.getImage(c);this._text="";this.grabData=[];this.frameData=new a.FrameData;e=this.offsetX;d=this.offsetY;for(n=k=0;n<f.length;n++)g=b.rnd.uuid(),h=this.frameData.addFrame(new a.Frame(n,e,d,this.characterWidth,
this.characterHeight,"",g)),this.grabData[f.charCodeAt(n)]=h.index,PIXI.TextureCache[g]=new PIXI.Texture(PIXI.BaseTextureCache[c],{x:e,y:d,width:this.characterWidth,height:this.characterHeight}),k++,k==this.characterPerRow?(k=0,e=this.offsetX,d+=this.characterHeight+this.characterSpacingY):e+=this.characterWidth+this.characterSpacingX;b.cache.updateFrameData(c,this.frameData);this.stamp=new a.Image(b,0,0,c,0);a.RenderTexture.call(this,b,100,100,"",a.scaleModes.NEAREST);this.type=a.RETROFONT};a.RetroFont.prototype=
Object.create(a.RenderTexture.prototype);a.RetroFont.prototype.constructor=a.RetroFont;a.RetroFont.ALIGN_LEFT="left";a.RetroFont.ALIGN_RIGHT="right";a.RetroFont.ALIGN_CENTER="center";a.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";a.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";a.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";a.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";
a.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";a.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";a.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";a.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";a.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";a.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";a.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";a.RetroFont.prototype.setFixedWidth=
function(b,c){"undefined"==typeof c&&(c="left");this.fixedWidth=b;this.align=c};a.RetroFont.prototype.setText=function(b,c,a,d,f,k){this.multiLine=c||!1;this.customSpacingX=a||0;this.customSpacingY=d||0;this.align=f||"left";this.autoUpperCase=k?!1:!0;0<b.length&&(this.text=b)};a.RetroFont.prototype.buildRetroFontText=function(){var b=0,c=0;if(this.clear(),this.multiLine){var e=this._text.split("\n");0<this.fixedWidth?this.resize(this.fixedWidth,e.length*(this.characterHeight+this.customSpacingY)-
this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),e.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var d=0;d<e.length;d++){switch(this.align){case a.RetroFont.ALIGN_LEFT:b=0;break;case a.RetroFont.ALIGN_RIGHT:b=this.width-e[d].length*(this.characterWidth+this.customSpacingX);break;case a.RetroFont.ALIGN_CENTER:b=this.width/2-e[d].length*(this.characterWidth+this.customSpacingX)/2,b+=this.customSpacingX/2}0>b&&(b=0);this.pasteLine(e[d],
b,c,this.customSpacingX);c+=this.characterHeight+this.customSpacingY}}else{switch(0<this.fixedWidth?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),this.align){case a.RetroFont.ALIGN_LEFT:b=0;break;case a.RetroFont.ALIGN_RIGHT:b=this.width-this._text.length*(this.characterWidth+this.customSpacingX);break;case a.RetroFont.ALIGN_CENTER:b=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/
2,b+=this.customSpacingX/2}this.textureBuffer.clear();this.pasteLine(this._text,b,0,this.customSpacingX)}};a.RetroFont.prototype.pasteLine=function(b,c,e,d){for(var f=new a.Point,k=0;k<b.length;k++)if(" "==b.charAt(k))c+=this.characterWidth+d;else if(0<=this.grabData[b.charCodeAt(k)]&&(this.stamp.frame=this.grabData[b.charCodeAt(k)],f.set(c,e),this.render(this.stamp,f,!1),c+=this.characterWidth+d,c>this.width))break};a.RetroFont.prototype.getLongestLine=function(){var b=0;if(0<this._text.length)for(var c=
this._text.split("\n"),a=0;a<c.length;a++)c[a].length>b&&(b=c[a].length);return b};a.RetroFont.prototype.removeUnsupportedCharacters=function(b){for(var c="",a=0;a<this._text.length;a++){var d=this._text[a],f=d.charCodeAt(0);(0<=this.grabData[f]||!b&&"\n"===d)&&(c=c.concat(d))}return c};a.RetroFont.prototype.updateOffset=function(b,c){if(this.offsetX!==b||this.offsetY!==c){for(var a=b-this.offsetX,d=c-this.offsetY,f=this.game.cache.getFrameData(this.stamp.key).getFrames(),k=f.length;k--;)f[k].x+=
a,f[k].y+=d,PIXI.TextureCache[f[k].uuid].frame.x=f[k].x,PIXI.TextureCache[f[k].uuid].frame.y=f[k].y;this.buildRetroFontText()}};Object.defineProperty(a.RetroFont.prototype,"text",{get:function(){return this._text},set:function(b){b=this.autoUpperCase?b.toUpperCase():b;b!==this._text&&(this._text=b,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}});Object.defineProperty(a.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(b){this.stamp.smoothed=
b;this.buildRetroFontText()}});a.Device=function(){this.deviceReadyAt=0;this.canvas=this.windowsPhone=this.windows=this.macOS=this.linux=this.chromeOS=this.android=this.crosswalk=this.ejecta=this.nodeWebkit=this.node=this.cordova=this.cocoonJSApp=this.cocoonJS=this.iOS=this.desktop=this.initialized=!1;this.canvasBitBltShift=null;this.mspointer=this.touch=this.quirksMode=this.getUserMedia=this.vibration=this.typedArray=this.pointerLock=this.css3D=this.worker=this.localStorage=this.fileSystem=this.file=
this.webGL=!1;this.wheelEvent=null;this.ie=this.firefox=this.epiphany=this.chrome=this.arora=!1;this.ieVersion=0;this.trident=!1;this.tridentVersion=0;this.iPad=this.iPhone4=this.iPhone=this.webm=this.m4a=this.wav=this.mp3=this.opus=this.ogg=this.webAudio=this.audioData=this.silk=this.webApp=this.safari=this.opera=this.midori=this.mobileSafari=!1;this.pixelRatio=0;this.fullscreen=this.support32bit=this.LITTLE_ENDIAN=this.littleEndian=!1;this.cancelFullscreen=this.requestFullscreen="";this.fullscreenKeyboard=
!1};a.Device=new a.Device;a.Device.onInitialized=new a.Signal;a.Device.whenReady=function(b,c,a){var d=this._readyCheck;this.deviceReadyAt||!d?b.call(c,this):d._monitor||a?(d._queue=d._queue||[],d._queue.push([b,c])):(d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([b,c]),b="undefined"!=typeof window.cordova,c=navigator.isCocoonJS,"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):b&&!c?document.addEventListener("deviceready",d._monitor,
!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1)))};a.Device._readyCheck=function(){var b=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",b._monitor);document.removeEventListener("DOMContentLoaded",b._monitor);window.removeEventListener("load",b._monitor);this._initialize();this.initialized=!0;this.onInitialized.dispatch(this);for(var c;c=b._queue.shift();)c[0].call(c[1],
this);this.onInitialized=this._initialize=this._readyCheck=null}}else window.setTimeout(b._monitor,20)};a.Device._initialize=function(){function b(){var b=new ArrayBuffer(4),c=new Uint8Array(b),b=new Uint32Array(b);return c[0]=161,c[1]=178,c[2]=195,c[3]=212,3569595041==b[0]?!0:2712847316==b[0]?!1:null}function c(){if("undefined"==typeof Uint8ClampedArray)return!1;var b=document.createElement("canvas").getContext("2d");return b?b.createImageData(1,1).data instanceof Uint8ClampedArray:!1}var a=this;
(function(){var b=navigator.userAgent;/Playstation Vita/.test(b)?a.vita=!0:/Kindle/.test(b)||/\bKF[A-Z][A-Z]+/.test(b)||/Silk.*Mobile Safari/.test(b)?a.kindle=!0:/Android/.test(b)?a.android=!0:/CrOS/.test(b)?a.chromeOS=!0:/iP[ao]d|iPhone/i.test(b)?a.iOS=!0:/Linux/.test(b)?a.linux=!0:/Mac OS/.test(b)?a.macOS=!0:/Windows/.test(b)&&(a.windows=!0,/Windows Phone/i.test(b)&&(a.windowsPhone=!0));var c=/Silk/.test(b);(a.windows||a.macOS||a.linux&&!c||a.chromeOS)&&(a.desktop=!0);(a.windowsPhone||/Windows NT/i.test(b)&&
/Touch/i.test(b))&&(a.desktop=!1)})();(function(){a.audioData=!!window.Audio;a.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var b=document.createElement("audio");try{b.canPlayType&&(b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(a.ogg=!0),(b.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||b.canPlayType("audio/opus;").replace(/^no$/,""))&&(a.opus=!0),b.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(a.mp3=!0),b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,
"")&&(a.wav=!0),(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;").replace(/^no$/,""))&&(a.m4a=!0),b.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(a.webm=!0))}catch(c){}})();(function(){var b=navigator.userAgent;if(/Arora/.test(b)?a.arora=!0:/Chrome/.test(b)?a.chrome=!0:/Epiphany/.test(b)?a.epiphany=!0:/Firefox/.test(b)?a.firefox=!0:/AppleWebKit/.test(b)&&a.iOS?a.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(b)?(a.ie=!0,a.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(b)?a.midori=
!0:/Opera/.test(b)?a.opera=!0:/Safari/.test(b)?a.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(b)&&(a.ie=!0,a.trident=!0,a.tridentVersion=parseInt(RegExp.$1,10),a.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(b)&&(a.silk=!0),navigator.standalone&&(a.webApp=!0),"undefined"!=typeof window.cordova&&(a.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(a.node=!0),a.node)try{a.nodeWebkit="undefined"!=typeof require("nw.gui")}catch(c){a.nodeWebkit=!1}if(navigator.isCocoonJS&&
(a.cocoonJS=!0),a.cocoonJS)try{a.cocoonJSApp="undefined"!=typeof CocoonJS}catch(k){a.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(a.ejecta=!0);/Crosswalk/.test(b)&&(a.crosswalk=!0)})();(function(){var b,c=document.createElement("p"),k={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(c,null);for(var n in k)void 0!==c.style[n]&&(c.style[n]="translate3d(1px,1px,1px)",b=window.getComputedStyle(c).getPropertyValue(k[n]));
document.body.removeChild(c);a.css3D=void 0!==b&&0<b.length&&"none"!==b})();a.pixelRatio=window.devicePixelRatio||1;a.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone");a.iPhone4=2==a.pixelRatio&&a.iPhone;a.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad");a.typedArray="undefined"!=typeof Int8Array?!0:!1;"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(a.littleEndian=b(),a.LITTLE_ENDIAN=a.littleEndian);a.support32bit="undefined"!=
typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==a.littleEndian&&c();navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;navigator.vibrate&&(a.vibration=!0);(function(){a.canvas=!!window.CanvasRenderingContext2D||a.cocoonJS;try{a.localStorage=!!localStorage.getItem}catch(b){a.localStorage=!1}a.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob);a.fileSystem=!!window.requestFileSystem;
var c;try{var k=document.createElement("canvas");c=(k.screencanvas=!1,!!window.WebGLRenderingContext&&(k.getContext("webgl")||k.getContext("experimental-webgl")))}catch(n){c=!1}a.webGL=c;a.webGL=!!a.webGL;a.worker=!!window.Worker;a.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;a.quirksMode="CSS1Compat"===document.compatMode?!1:!0;a.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||
navigator.msGetUserMedia);!a.iOS&&(a.ie||a.firefox||a.chrome)&&(a.canvasBitBltShift=!0);(a.safari||a.mobileSafari)&&(a.canvasBitBltShift=!1)})();(function(){for(var b="requestFullscreen requestFullScreen webkitRequestFullscreen webkitRequestFullScreen msRequestFullscreen msRequestFullScreen mozRequestFullScreen mozRequestFullscreen".split(" "),c=document.createElement("div"),k=0;k<b.length;k++)if(c[b[k]]){a.fullscreen=!0;a.requestFullscreen=b[k];break}b="cancelFullScreen exitFullscreen webkitCancelFullScreen webkitExitFullscreen msCancelFullScreen msExitFullscreen mozCancelFullScreen mozExitFullscreen".split(" ");
if(a.fullscreen)for(k=0;k<b.length;k++)if(document[b[k]]){a.cancelFullscreen=b[k];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(a.fullscreenKeyboard=!0)})();("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&1<=window.navigator.maxTouchPoints)&&(a.touch=!0);(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(a.mspointer=!0);a.cocoonJS||("onwheel"in window||a.ie&&"WheelEvent"in window?a.wheelEvent="wheel":"onmousewheel"in window?a.wheelEvent="mousewheel":
a.firefox&&"MouseScrollEvent"in window&&(a.wheelEvent="DOMMouseScroll"))};a.Device.canPlayAudio=function(b){return"mp3"==b&&this.mp3?!0:"ogg"==b&&(this.ogg||this.opus)?!0:"m4a"==b&&this.m4a?!0:"opus"==b&&this.opus?!0:"wav"==b&&this.wav?!0:"webm"==b&&this.webm?!0:!1};a.Device.isConsoleOpen=function(){return window.console&&window.console.firebug?!0:window.console&&(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles)?0<console.profiles.length:!1};a.Device.isAndroidStockBrowser=
function(){var b=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return b&&537>b[1]};a.DOM={getOffset:function(b,c){c=c||new a.Point;var e=b.getBoundingClientRect(),d=a.DOM.scrollY,f=document.documentElement.clientTop;return c.x=e.left+a.DOM.scrollX-document.documentElement.clientLeft,c.y=e.top+d-f,c},getBounds:function(b,c){return"undefined"==typeof c&&(c=0),b=b&&!b.nodeType?b[0]:b,b&&1===b.nodeType?this.calibrate(b.getBoundingClientRect(),c):!1},calibrate:function(b,c){c=+c||
0;var a={width:0,height:0,left:0,right:0,top:0,bottom:0};return a.width=(a.right=b.right+c)-(a.left=b.left-c),a.height=(a.bottom=b.bottom+c)-(a.top=b.top-c),a},getAspectRatio:function(b){b=null==b?this.visualBounds:1===b.nodeType?this.getBounds(b):b;var c=b.width,a=b.height;return"function"==typeof c&&(c=c.call(b)),"function"==typeof a&&(a=a.call(b)),c/a},inLayoutViewport:function(b,c){var a=this.getBounds(b,c);return!!a&&0<=a.bottom&&0<=a.right&&a.top<=this.layoutBounds.width&&a.left<=this.layoutBounds.height},
getScreenOrientation:function(b){var c=window.screen,a=c.orientation||c.mozOrientation||c.msOrientation;if(a&&"string"==typeof a.type)return a.type;if("string"==typeof a)return a;if("screen"===b)return c.height>c.width?"portrait-primary":"landscape-primary";if("viewport"===b)return this.visualBounds.height>this.visualBounds.width?"portrait-primary":"landscape-primary";if("window.orientation"===b&&"number"==typeof window.orientation)return 0===window.orientation||180===window.orientation?"portrait-primary":
"landscape-primary";if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return"portrait-primary";if(window.matchMedia("(orientation: landscape)").matches)return"landscape-primary"}return this.visualBounds.height>this.visualBounds.width?"portrait-primary":"landscape-primary"},visualBounds:new a.Rectangle,layoutBounds:new a.Rectangle,documentBounds:new a.Rectangle};a.Device.whenReady(function(b){var c=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},
e=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(a.DOM,"scrollX",{get:c});Object.defineProperty(a.DOM,"scrollY",{get:e});Object.defineProperty(a.DOM.visualBounds,"x",{get:c});Object.defineProperty(a.DOM.visualBounds,"y",{get:e});Object.defineProperty(a.DOM.layoutBounds,"x",{value:0});Object.defineProperty(a.DOM.layoutBounds,"y",{value:0});b.desktop&&document.documentElement.clientWidth<=window.innerWidth&&
document.documentElement.clientHeight<=window.innerHeight?(b=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},c=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)},Object.defineProperty(a.DOM.visualBounds,"width",{get:b}),Object.defineProperty(a.DOM.visualBounds,"height",{get:c}),Object.defineProperty(a.DOM.layoutBounds,"width",{get:b}),Object.defineProperty(a.DOM.layoutBounds,"height",{get:c})):(Object.defineProperty(a.DOM.visualBounds,
"width",{get:function(){return window.innerWidth}}),Object.defineProperty(a.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(a.DOM.layoutBounds,"width",{get:function(){var b=document.documentElement.clientWidth,c=window.innerWidth;return c>b?c:b}}),Object.defineProperty(a.DOM.layoutBounds,"height",{get:function(){var b=document.documentElement.clientHeight,c=window.innerHeight;return c>b?c:b}}));Object.defineProperty(a.DOM.documentBounds,"x",{value:0});
Object.defineProperty(a.DOM.documentBounds,"y",{value:0});Object.defineProperty(a.DOM.documentBounds,"width",{get:function(){var b=document.documentElement;return Math.max(b.clientWidth,b.offsetWidth,b.scrollWidth)}});Object.defineProperty(a.DOM.documentBounds,"height",{get:function(){var b=document.documentElement;return Math.max(b.clientHeight,b.offsetHeight,b.scrollHeight)}})},null,!0);a.Canvas={create:function(b,c,a){b=b||256;c=c||256;var d=document.createElement("canvas");return"string"==typeof a&&
""!==a&&(d.id=a),d.width=b,d.height=c,d.style.display="block",d},setBackgroundColor:function(b,c){return c=c||"rgb(0,0,0)",b.style.backgroundColor=c,b},setTouchAction:function(b,c){return c=c||"none",b.style.msTouchAction=c,b.style["ms-touch-action"]=c,b.style["touch-action"]=c,b},setUserSelect:function(b,c){return c=c||"none",b.style["-webkit-touch-callout"]=c,b.style["-webkit-user-select"]=c,b.style["-khtml-user-select"]=c,b.style["-moz-user-select"]=c,b.style["-ms-user-select"]=c,b.style["user-select"]=
c,b.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",b},addToDOM:function(b,c,a){var d;return"undefined"==typeof a&&(a=!0),c&&("string"==typeof c?d=document.getElementById(c):"object"==typeof c&&1===c.nodeType&&(d=c)),d||(d=document.body),a&&d.style&&(d.style.overflow="hidden"),d.appendChild(b),b},removeFromDOM:function(b){b.parentNode&&b.parentNode.removeChild(b)},setTransform:function(b,c,a,d,f,k,n){return b.setTransform(d,k,n,f,c,a),b},setSmoothingEnabled:function(b,c){return b.imageSmoothingEnabled=
c,b.mozImageSmoothingEnabled=c,b.oImageSmoothingEnabled=c,b.webkitImageSmoothingEnabled=c,b.msImageSmoothingEnabled=c,b},getSmoothingEnabled:function(b){return b.imageSmoothingEnabled||b.mozImageSmoothingEnabled||b.oImageSmoothingEnabled||b.webkitImageSmoothingEnabled||b.msImageSmoothingEnabled},setImageRenderingCrisp:function(b){return b.style["image-rendering"]="optimizeSpeed",b.style["image-rendering"]="crisp-edges",b.style["image-rendering"]="-moz-crisp-edges",b.style["image-rendering"]="-webkit-optimize-contrast",
b.style["image-rendering"]="optimize-contrast",b.style["image-rendering"]="pixelated",b.style.msInterpolationMode="nearest-neighbor",b},setImageRenderingBicubic:function(b){return b.style["image-rendering"]="auto",b.style.msInterpolationMode="bicubic",b}};a.Canvas.getOffset=a.DOM.getOffset;a.Canvas.getAspectRatio=a.DOM.getAspectRatio;a.RequestAnimationFrame=function(b,c){"undefined"==typeof c&&(c=!1);this.game=b;this.isRunning=!1;this.forceSetTimeOut=c;for(var a=["ms","moz","webkit","o"],d=0;d<a.length&&
!window.requestAnimationFrame;d++)window.requestAnimationFrame=window[a[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[d]+"CancelAnimationFrame"];this._isSetTimeOut=!1;this._timeOutID=this._onLoop=null};a.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var b=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return b.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=
!1,this._onLoop=function(c){return b.updateRAF(c)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(b){this.game.update(Math.floor(b));this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID);this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},
isRAF:function(){return!1===this._isSetTimeOut}};a.RequestAnimationFrame.prototype.constructor=a.RequestAnimationFrame;a.Math={PI2:2*Math.PI,fuzzyEqual:function(b,c,a){return"undefined"==typeof a&&(a=1E-4),Math.abs(b-c)<a},fuzzyLessThan:function(b,c,a){return"undefined"==typeof a&&(a=1E-4),c+a>b},fuzzyGreaterThan:function(b,c,a){return"undefined"==typeof a&&(a=1E-4),b>c-a},fuzzyCeil:function(b,c){return"undefined"==typeof c&&(c=1E-4),Math.ceil(b-c)},fuzzyFloor:function(b,c){return"undefined"==typeof c&&
(c=1E-4),Math.floor(b+c)},average:function(){for(var b=0,c=0;c<arguments.length;c++)b+=+arguments[c];return b/arguments.length},truncate:function(b){return Math.trunc(b)},shear:function(b){return b%1},snapTo:function(b,c,a){return"undefined"==typeof a&&(a=0),0===c?b:(b-=a,b=c*Math.round(b/c),a+b)},snapToFloor:function(b,c,a){return"undefined"==typeof a&&(a=0),0===c?b:(b-=a,b=c*Math.floor(b/c),a+b)},snapToCeil:function(b,c,a){return"undefined"==typeof a&&(a=0),0===c?b:(b-=a,b=c*Math.ceil(b/c),a+b)},
snapToInArray:function(b,c,e){return"undefined"==typeof e&&(e=!0),e&&c.sort(),a.ArrayUtils.findClosest(b,c)},roundTo:function(b,c,a){"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a=10);c=Math.pow(a,-c);return Math.round(b*c)/c},floorTo:function(b,c,a){"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a=10);c=Math.pow(a,-c);return Math.floor(b*c)/c},ceilTo:function(b,c,a){"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a=10);c=Math.pow(a,-c);return Math.ceil(b*c)/c},interpolateFloat:function(b,
c,a){return(c-b)*a+b},angleBetween:function(b,c,a,d){return Math.atan2(d-c,a-b)},angleBetweenY:function(b,c,a,d){return Math.atan2(a-b,d-c)},angleBetweenPoints:function(b,c){return Math.atan2(c.y-b.y,c.x-b.x)},angleBetweenPointsY:function(b,c){return Math.atan2(c.x-b.x,c.y-b.y)},reverseAngle:function(b){return this.normalizeAngle(b+Math.PI,!0)},normalizeAngle:function(b){return b%=2*Math.PI,0<=b?b:b+2*Math.PI},normalizeLatitude:function(b){return a.Math.clamp(b,-90,90)},normalizeLongitude:function(b){return a.Math.wrap(b,
-180,180)},chanceRoll:function(b){return a.Utils.chanceRoll(b)},numberArray:function(b,c){return a.ArrayUtils.numberArray(b,c)},numberArrayStep:function(b,c,e){return a.ArrayUtils.numberArrayStep(b,c,e)},maxAdd:function(b,c,a){return Math.min(b+c,a)},minSub:function(b,c,a){return Math.max(b-c,a)},wrap:function(b,c,a){a-=c;if(0>=a)return 0;b=(b-c)%a;return 0>b&&(b+=a),b+c},wrapValue:function(b,c,a){return b=Math.abs(b),c=Math.abs(c),a=Math.abs(a),(b+c)%a},limitValue:function(b,c,e){return a.Math.clamp(b,
c,e)},randomSign:function(){return a.Utils.randomChoice(-1,1)},isOdd:function(b){return 1&b},isEven:function(b){return!(1&b)},min:function(){for(var b=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments,c=1,a=0,d=b.length;d>c;c++)b[c]<b[a]&&(a=c);return b[a]},max:function(){for(var b=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments,c=1,a=0,d=b.length;d>c;c++)b[c]>b[a]&&(a=c);return b[a]},minProperty:function(b){for(var c=2===arguments.length&&"object"==
typeof arguments[1]?arguments[1]:arguments.slice(1),a=1,d=0,f=c.length;f>a;a++)c[a][b]<c[d][b]&&(d=a);return c[d][b]},maxProperty:function(b){for(var c=2===arguments.length&&"object"==typeof arguments[1]?arguments[1]:arguments.slice(1),a=1,d=0,f=c.length;f>a;a++)c[a][b]>c[d][b]&&(d=a);return c[d][b]},wrapAngle:function(b,c){return c?this.wrap(b,-Math.PI,Math.PI):this.wrap(b,-180,180)},angleLimit:function(b,c,a){var d=b;return b>a?d=a:c>b&&(d=c),d},linearInterpolation:function(b,c){var a=b.length-
1,d=a*c,f=Math.floor(d);return 0>c?this.linear(b[0],b[1],d):1<c?this.linear(b[a],b[a-1],a-d):this.linear(b[f],b[f+1>a?a:f+1],d-f)},bezierInterpolation:function(b,c){for(var a=0,d=b.length-1,f=0;d>=f;f++)a+=Math.pow(1-c,d-f)*Math.pow(c,f)*b[f]*this.bernstein(d,f);return a},catmullRomInterpolation:function(b,c){var a=b.length-1,d=a*c,f=Math.floor(d);return b[0]===b[a]?(0>c&&(f=Math.floor(d=a*(1+c))),this.catmullRom(b[(f-1+a)%a],b[f],b[(f+1)%a],b[(f+2)%a],d-f)):0>c?b[0]-(this.catmullRom(b[0],b[0],b[1],
b[1],-d)-b[0]):1<c?b[a]-(this.catmullRom(b[a],b[a],b[a-1],b[a-1],d-a)-b[a]):this.catmullRom(b[f?f-1:0],b[f],b[f+1>a?a:f+1],b[f+2>a?a:f+2],d-f)},linear:function(b,c,a){return(c-b)*a+b},bernstein:function(b,c){return this.factorial(b)/this.factorial(c)/this.factorial(b-c)},factorial:function(b){if(0===b)return 1;for(var c=b;--b;)c*=b;return c},catmullRom:function(b,c,a,d,f){b=.5*(a-b);d=.5*(d-c);var k=f*f;return(2*c-2*a+b+d)*f*k+(-3*c+3*a-2*b-d)*k+b*f+c},difference:function(b,c){return Math.abs(b-c)},
getRandom:function(b,c,e){return a.ArrayUtils.getRandomItem(b,c,e)},removeRandom:function(b,c,e){return a.ArrayUtils.removeRandomItem(b,c,e)},floor:function(b){return Math.trunc(b)},ceil:function(b){return a.Math.roundAwayFromZero(b)},roundAwayFromZero:function(b){return 0<b?Math.ceil(b):Math.floor(b)},sinCosGenerator:function(b,c,a,d){"undefined"==typeof c&&(c=1);"undefined"==typeof a&&(a=1);"undefined"==typeof d&&(d=1);d=d*Math.PI/b;for(var f=[],k=[],n=0;b>n;n++)a-=c*d,c+=a*d,f[n]=a,k[n]=c;return{sin:k,
cos:f,length:b}},shift:function(b){var c=b.shift();return b.push(c),c},shuffleArray:function(b){return a.ArrayUtils.shuffle(b)},distance:function(b,c,a,d){b-=a;c-=d;return Math.sqrt(b*b+c*c)},distancePow:function(b,c,a,d,f){return"undefined"==typeof f&&(f=2),Math.sqrt(Math.pow(a-b,f)+Math.pow(d-c,f))},distanceRounded:function(b,c,e,d){return Math.round(a.Math.distance(b,c,e,d))},clamp:function(b,c,a){return c>b?c:b>a?a:b},clampBottom:function(b,c){return c>b?c:b},within:function(b,c,a){return Math.abs(b-
c)<=a},mapLinear:function(b,c,a,d,f){return d+(b-c)*(f-d)/(a-c)},smoothstep:function(b,c,a){return b=Math.max(0,Math.min(1,(b-c)/(a-c))),b*b*(3-2*b)},smootherstep:function(b,c,a){return b=Math.max(0,Math.min(1,(b-c)/(a-c))),b*b*b*(b*(6*b-15)+10)},sign:function(b){return 0>b?-1:0<b?1:0},percent:function(b,c,a){return"undefined"==typeof a&&(a=0),b>c||a>c?1:a>b||a>b?0:(b-a)/c}};var l=Math.PI/180,m=180/Math.PI;a.Math.degToRad=function(b){return b*l};a.Math.radToDeg=function(b){return b*m};a.RandomDataGenerator=
function(b){"undefined"==typeof b&&(b=[]);this.c=1;this.s2=this.s1=this.s0=0;this.sow(b)};a.RandomDataGenerator.prototype={rnd:function(){var b=2091639*this.s0+2.3283064365386963E-10*this.c;return this.c=0|b,this.s0=this.s1,this.s1=this.s2,this.s2=b-this.c,this.s2},sow:function(b){if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,b)for(var c=0;c<b.length&&null!=b[c];c++){var a=b[c];this.s0-=this.hash(a);this.s0+=~~(0>this.s0);this.s1-=this.hash(a);this.s1+=~~(0>
this.s1);this.s2-=this.hash(a);this.s2+=~~(0>this.s2)}},hash:function(b){var c,a,d;d=4022871197;b=b.toString();for(a=0;a<b.length;a++)d+=b.charCodeAt(a),c=.02519603282416938*d,d=c>>>0,c-=d,c*=d,d=c>>>0,c-=d,d+=4294967296*c;return 2.3283064365386963E-10*(d>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565E-16*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(b,c){return Math.floor(this.realInRange(0,
c-b+1)+b)},between:function(b,c){return this.integerInRange(b,c)},realInRange:function(b,c){return this.frac()*(c-b)+b},normal:function(){return 1-2*this.frac()},uuid:function(){for(var b="",c="",c=b="";36>b++;c+=~b%5|3*b&4?(15^b?8^this.frac()*(20^b?16:4):4).toString(16):"-");return c},pick:function(b){return b[this.integerInRange(0,b.length-1)]},weightedPick:function(b){return b[~~(Math.pow(this.frac(),2)*(b.length-1))]},timestamp:function(b,c){return this.realInRange(b||9466848E5,c||1577862E6)},
angle:function(){return this.integerInRange(-180,180)}};a.RandomDataGenerator.prototype.constructor=a.RandomDataGenerator;a.QuadTree=function(b,c,a,d,f,k,n){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(b,c,a,d,f,k,n)};a.QuadTree.prototype={reset:function(b,c,a,d,f,k,n){this.maxObjects=f||10;this.maxLevels=k||4;this.level=n||0;this.bounds={x:Math.round(b),y:Math.round(c),width:a,height:d,subWidth:Math.floor(a/2),subHeight:Math.floor(d/
2),right:Math.round(b)+Math.floor(a/2),bottom:Math.round(c)+Math.floor(d/2)};this.objects.length=0;this.nodes.length=0},populate:function(b){b.forEach(this.populateHandler,this,!0)},populateHandler:function(b){b.body&&b.exists&&this.insert(b.body)},split:function(){this.nodes[0]=new a.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[1]=new a.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,
this.maxObjects,this.maxLevels,this.level+1);this.nodes[2]=new a.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[3]=new a.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(b){var c,a=0;if(null!=this.nodes[0]&&(c=this.getIndex(b),-1!==c))return void this.nodes[c].insert(b);if(this.objects.push(b),this.objects.length>
this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();a<this.objects.length;)c=this.getIndex(this.objects[a]),-1!==c?this.nodes[c].insert(this.objects.splice(a,1)[0]):a++},getIndex:function(b){var c=-1;return b.x<this.bounds.right&&b.right<this.bounds.right?b.y<this.bounds.bottom&&b.bottom<this.bounds.bottom?c=1:b.y>this.bounds.bottom&&(c=2):b.x>this.bounds.right&&(b.y<this.bounds.bottom&&b.bottom<this.bounds.bottom?c=0:b.y>this.bounds.bottom&&(c=3)),c},retrieve:function(b){if(b instanceof
a.Rectangle)var c=this.objects,e=this.getIndex(b);else{if(!b.body)return this._empty;c=this.objects;e=this.getIndex(b.body)}return this.nodes[0]&&(-1!==e?c=c.concat(this.nodes[e].retrieve(b)):(c=c.concat(this.nodes[0].retrieve(b)),c=c.concat(this.nodes[1].retrieve(b)),c=c.concat(this.nodes[2].retrieve(b)),c=c.concat(this.nodes[3].retrieve(b)))),c},clear:function(){this.objects.length=0;for(var b=this.nodes.length;b--;)this.nodes[b].clear(),this.nodes.splice(b,1);this.nodes.length=0}};a.QuadTree.prototype.constructor=
a.QuadTree;a.Net=function(b){this.game=b};a.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(b){return-1!==window.location.hostname.indexOf(b)},updateQueryString:function(b,c,a,d){"undefined"==typeof a&&(a=!1);"undefined"!=typeof d&&""!==d||(d=window.location.href);var f="",f=new RegExp("([?|&])"+b+"=.*?(&|#|$)(.*)","gi");if(f.test(d))f="undefined"!=typeof c&&null!==c?d.replace(f,"$1"+b+"="+c+"$2$3"):d.replace(f,
"$1$3").replace(/(&|\?)$/,"");else{if("undefined"!=typeof c&&null!==c){var f=-1!==d.indexOf("?")?"&":"?",k=d.split("#");d=k[0]+f+b+"="+c;k[1]&&(d+="#"+k[1])}f=d}return a?void(window.location.href=f):f},getQueryString:function(b){"undefined"==typeof b&&(b="");var c={},a=location.search.substring(1).split("&"),d;for(d in a){var f=a[d].split("=");if(1<f.length){if(b&&b==this.decodeURI(f[0]))return this.decodeURI(f[1]);c[this.decodeURI(f[0])]=this.decodeURI(f[1])}}return c},decodeURI:function(b){return decodeURIComponent(b.replace(/\+/g,
" "))}};a.Net.prototype.constructor=a.Net;a.TweenManager=function(b){this.game=b;this._tweens=[];this._add=[];this.easeMap={Power0:a.Easing.Power0,Power1:a.Easing.Power1,Power2:a.Easing.Power2,Power3:a.Easing.Power3,Power4:a.Easing.Power4,Linear:a.Easing.Linear.None,Quad:a.Easing.Quadratic.Out,Cubic:a.Easing.Cubic.Out,Quart:a.Easing.Quartic.Out,Quint:a.Easing.Quintic.Out,Sine:a.Easing.Sinusoidal.Out,Expo:a.Easing.Exponential.Out,Circ:a.Easing.Circular.Out,Elastic:a.Easing.Elastic.Out,Back:a.Easing.Back.Out,
Bounce:a.Easing.Bounce.Out,"Quad.easeIn":a.Easing.Quadratic.In,"Cubic.easeIn":a.Easing.Cubic.In,"Quart.easeIn":a.Easing.Quartic.In,"Quint.easeIn":a.Easing.Quintic.In,"Sine.easeIn":a.Easing.Sinusoidal.In,"Expo.easeIn":a.Easing.Exponential.In,"Circ.easeIn":a.Easing.Circular.In,"Elastic.easeIn":a.Easing.Elastic.In,"Back.easeIn":a.Easing.Back.In,"Bounce.easeIn":a.Easing.Bounce.In,"Quad.easeOut":a.Easing.Quadratic.Out,"Cubic.easeOut":a.Easing.Cubic.Out,"Quart.easeOut":a.Easing.Quartic.Out,"Quint.easeOut":a.Easing.Quintic.Out,
"Sine.easeOut":a.Easing.Sinusoidal.Out,"Expo.easeOut":a.Easing.Exponential.Out,"Circ.easeOut":a.Easing.Circular.Out,"Elastic.easeOut":a.Easing.Elastic.Out,"Back.easeOut":a.Easing.Back.Out,"Bounce.easeOut":a.Easing.Bounce.Out,"Quad.easeInOut":a.Easing.Quadratic.InOut,"Cubic.easeInOut":a.Easing.Cubic.InOut,"Quart.easeInOut":a.Easing.Quartic.InOut,"Quint.easeInOut":a.Easing.Quintic.InOut,"Sine.easeInOut":a.Easing.Sinusoidal.InOut,"Expo.easeInOut":a.Easing.Exponential.InOut,"Circ.easeInOut":a.Easing.Circular.InOut,
"Elastic.easeInOut":a.Easing.Elastic.InOut,"Back.easeInOut":a.Easing.Back.InOut,"Bounce.easeInOut":a.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};a.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var b=0;b<this._tweens.length;b++)this._tweens[b].pendingDelete=!0;this._add=[]},removeFrom:function(b,c){"undefined"==typeof c&&(c=!0);var e,d;if(Array.isArray(b))for(e=0,d=b.length;d>e;e++)this.removeFrom(b[e]);
else if(b.type===a.GROUP&&c)for(e=0,d=b.children.length;d>e;e++)this.removeFrom(b.children[e]);else{e=0;for(d=this._tweens.length;d>e;e++)b===this._tweens[e].target&&this.remove(this._tweens[e]);e=0;for(d=this._add.length;d>e;e++)b===this._add[e].target&&this.remove(this._add[e])}},add:function(b){b._manager=this;this._add.push(b)},create:function(b){return new a.Tween(b,this.game,this)},remove:function(b){var c=this._tweens.indexOf(b);-1!==c?this._tweens[c].pendingDelete=!0:(c=this._add.indexOf(b),
-1!==c&&(this._add[c].pendingDelete=!0))},update:function(){var b=this._add.length,c=this._tweens.length;if(0===c&&0===b)return!1;for(var a=0;c>a;)this._tweens[a].update(this.game.time.time)?a++:(this._tweens.splice(a,1),c--);return 0<b&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(b){return this._tweens.some(function(c){return c.target===b})},_pauseAll:function(){for(var b=this._tweens.length-1;0<=b;b--)this._tweens[b]._pause()},_resumeAll:function(){for(var b=
this._tweens.length-1;0<=b;b--)this._tweens[b]._resume()},pauseAll:function(){for(var b=this._tweens.length-1;0<=b;b--)this._tweens[b].pause()},resumeAll:function(){for(var b=this._tweens.length-1;0<=b;b--)this._tweens[b].resume(!0)}};a.TweenManager.prototype.constructor=a.TweenManager;a.Tween=function(b,c,e){this.game=c;this.target=b;this.manager=e;this.timeline=[];this.reverse=!1;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=!1;this.onStart=new a.Signal;this.onLoop=new a.Signal;this.onRepeat=
new a.Signal;this.onChildComplete=new a.Signal;this.onComplete=new a.Signal;this.isRunning=!1;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=!1;this._onUpdateCallbackContext=this._onUpdateCallback=null;this._pausedTime=0;this._codePaused=!1};a.Tween.prototype={to:function(b,c,e,d,f,k,n){return"undefined"==typeof c&&(c=1E3),"undefined"==typeof e&&(e=a.Easing.Default),"undefined"==typeof d&&(d=!1),"undefined"==typeof f&&(f=0),"undefined"==typeof k&&(k=0),"undefined"==typeof n&&
(n=!1),"string"==typeof e&&this.manager.easeMap[e]&&(e=this.manager.easeMap[e]),this.isRunning?(console.warn("Phaser.Tween.to cannot be called after Tween.start"),this):(this.timeline.push((new a.TweenData(this)).to(b,c,e,f,k,n)),d&&this.start(),this)},from:function(b,c,e,d,f,k,n){return"undefined"==typeof c&&(c=1E3),"undefined"==typeof e&&(e=a.Easing.Default),"undefined"==typeof d&&(d=!1),"undefined"==typeof f&&(f=0),"undefined"==typeof k&&(k=0),"undefined"==typeof n&&(n=!1),"string"==typeof e&&
this.manager.easeMap[e]&&(e=this.manager.easeMap[e]),this.isRunning?(console.warn("Phaser.Tween.from cannot be called after Tween.start"),this):(this.timeline.push((new a.TweenData(this)).from(b,c,e,f,k,n)),d&&this.start(),this)},start:function(b){if("undefined"==typeof b&&(b=0),null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;for(var c=0;c<this.timeline.length;c++)for(var a in this.timeline[c].vEnd)this.properties[a]=this.target[a]||0,Array.isArray(this.properties[a])||
(this.properties[a]*=1);for(c=0;c<this.timeline.length;c++)this.timeline[c].loadValues();return this.manager.add(this),this.isRunning=!0,(0>b||b>this.timeline.length-1)&&(b=0),this.current=b,this.timeline[this.current].start(),this.onStart.dispatch(this.target,this),this},stop:function(b){return"undefined"==typeof b&&(b=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,b&&(this.onComplete.dispatch(this.target,this),this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),
this},updateTweenData:function(b,c,a){if(0===this.timeline.length)return this;if("undefined"==typeof a&&(a=0),-1===a)for(a=0;a<this.timeline.length;a++)this.timeline[a][b]=c;else this.timeline[a][b]=c;return this},delay:function(b,c){return this.updateTweenData("delay",b,c)},repeat:function(b,c,a){return"undefined"==typeof c&&(c=0),this.updateTweenData("repeatCounter",b,a),this.updateTweenData("repeatDelay",c,a)},repeatDelay:function(b,c){return this.updateTweenData("repeatDelay",b,c)},yoyo:function(b,
c,a){return"undefined"==typeof c&&(c=0),this.updateTweenData("yoyo",b,a),this.updateTweenData("yoyoDelay",c,a)},yoyoDelay:function(b,c){return this.updateTweenData("yoyoDelay",b,c)},easing:function(b,c){return"string"==typeof b&&this.manager.easeMap[b]&&(b=this.manager.easeMap[b]),this.updateTweenData("easingFunction",b,c)},interpolation:function(b,c,e){return"undefined"==typeof c&&(c=a.Math),this.updateTweenData("interpolationFunction",b,e),this.updateTweenData("interpolationContext",c,e)},repeatAll:function(b){return"undefined"==
typeof b&&(b=0),this.repeatCounter=b,this},chain:function(){for(var b=arguments.length;b--;)0<b?arguments[b-1].chainedTween=arguments[b]:this.chainedTween=arguments[b];return this},loop:function(b){return"undefined"==typeof b&&(b=!0),b?this.repeatAll(-1):this.repeatCounter=0,this},onUpdateCallback:function(b,c){return this._onUpdateCallback=b,this._onUpdateCallbackContext=c,this},pause:function(){this._codePaused=this.isPaused=!0;this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||
(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this._codePaused=this.isPaused=!1;for(var b=0;b<this.timeline.length;b++)this.timeline[b].isRunning||(this.timeline[b].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(b){if(this.pendingDelete)return!1;if(this.isPaused)return!0;b=this.timeline[this.current].update(b);if(b===a.TweenData.PENDING)return!0;if(b===a.TweenData.RUNNING)return null!==
this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(b===a.TweenData.LOOPED)return this.onLoop.dispatch(this.target,this),!0;if(b===a.TweenData.COMPLETE)return b=!1,this.reverse?(this.current--,0>this.current&&(this.current=this.timeline.length-1,b=!0)):(this.current++,this.current===this.timeline.length&&(this.current=0,b=!0)),b?-1===this.repeatCounter?(this.timeline[this.current].start(),
this.onRepeat.dispatch(this.target,this),!0):0<this.repeatCounter?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)},generateData:function(b,c){if(null===this.game||null===this.target)return null;"undefined"==typeof c&&(c=[]);for(var a=0;a<this.timeline.length;a++)for(var d in this.timeline[a].vEnd)this.properties[d]=
this.target[d]||0,Array.isArray(this.properties[d])||(this.properties[d]*=1);for(a=0;a<this.timeline.length;a++)this.timeline[a].loadValues();for(a=0;a<this.timeline.length;a++)c=c.concat(this.timeline[a].generateData(b));return c}};Object.defineProperty(a.Tween.prototype,"totalDuration",{get:function(){for(var b=0,c=0;c<this.timeline.length;c++)b+=this.timeline[c].duration;return b}});a.Tween.prototype.constructor=a.Tween;a.TweenData=function(b){this.parent=b;this.game=b.game;this.vStart={};this.vStartCache=
{};this.vEnd={};this.vEndCache={};this.duration=1E3;this.repeatDelay=this.repeatCounter=this.value=this.percent=0;this.yoyo=this.interpolate=!1;this.yoyoDelay=0;this.inReverse=!1;this.dt=this.delay=0;this.startTime=null;this.easingFunction=a.Easing.Default;this.interpolationFunction=a.Math.linearInterpolation;this.interpolationContext=a.Math;this.isFrom=this.isRunning=!1};a.TweenData.PENDING=0;a.TweenData.RUNNING=1;a.TweenData.LOOPED=2;a.TweenData.COMPLETE=3;a.TweenData.prototype={to:function(b,c,
a,d,f,k){return this.vEnd=b,this.duration=c,this.easingFunction=a,this.delay=d,this.repeatCounter=f,this.yoyo=k,this.isFrom=!1,this},from:function(b,c,a,d,f,k){return this.vEnd=b,this.duration=c,this.easingFunction=a,this.delay=d,this.repeatCounter=f,this.yoyo=k,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.dt=this.parent.reverse?this.duration:0,this.isRunning=0<this.delay?!1:!0,this.isFrom)for(var b in this.vStartCache)this.vStart[b]=this.vEndCache[b],
this.vEnd[b]=this.vStartCache[b],this.parent.target[b]=this.vStart[b];return this.value=0,this.yoyoCounter=0,this},loadValues:function(){for(var b in this.parent.properties){if(this.vStart[b]=this.parent.properties[b],Array.isArray(this.vEnd[b])){if(0===this.vEnd[b].length)continue;this.vEnd[b]=[this.vStart[b]].concat(this.vEnd[b])}"undefined"!=typeof this.vEnd[b]?("string"==typeof this.vEnd[b]&&(this.vEnd[b]=this.vStart[b]+parseFloat(this.vEnd[b],10)),this.parent.properties[b]=this.vEnd[b]):this.vEnd[b]=
this.vStart[b];this.vStartCache[b]=this.vStart[b];this.vEndCache[b]=this.vEnd[b]}return this},update:function(){if(this.isRunning){if(this.game.time.time<this.startTime)return a.TweenData.RUNNING}else{if(!(this.game.time.time>=this.startTime))return a.TweenData.PENDING;this.isRunning=!0}this.parent.reverse?(this.dt-=this.game.time.physicsElapsedMS*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=this.game.time.physicsElapsedMS*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration));
this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var b in this.vEnd){var c=this.vStart[b],e=this.vEnd[b];this.parent.target[b]=Array.isArray(e)?this.interpolationFunction.call(this.interpolationContext,e,this.value):c+(e-c)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():a.TweenData.RUNNING},generateData:function(b){this.dt=this.parent.reverse?this.duration:0;var c=[],a=!1;b=1/b*1E3;do{this.parent.reverse?
(this.dt-=b,this.dt=Math.max(this.dt,0)):(this.dt+=b,this.dt=Math.min(this.dt,this.duration));this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var d={},f;for(f in this.vEnd){var k=this.vStart[f],n=this.vEnd[f];d[f]=Array.isArray(n)?this.interpolationFunction(n,this.value):k+(n-k)*this.value}c.push(d);(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)&&(a=!0)}while(!a);this.yoyo&&(a=c.slice(),a.reverse(),c=c.concat(a));return c},repeat:function(){if(this.yoyo){if(this.inReverse&&
0===this.repeatCounter)return a.TweenData.COMPLETE;this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return a.TweenData.COMPLETE;if(this.inReverse)for(var b in this.vStartCache)this.vStart[b]=this.vEndCache[b],this.vEnd[b]=this.vStartCache[b];else{for(b in this.vStartCache)this.vStart[b]=this.vStartCache[b],this.vEnd[b]=this.vEndCache[b];0<this.repeatCounter&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||
(this.startTime+=this.repeatDelay),this.dt=this.parent.reverse?this.duration:0,a.TweenData.LOOPED}};a.TweenData.prototype.constructor=a.TweenData;a.Easing={Linear:{None:function(b){return b}},Quadratic:{In:function(b){return b*b},Out:function(b){return b*(2-b)},InOut:function(b){return 1>(b*=2)?.5*b*b:-.5*(--b*(b-2)-1)}},Cubic:{In:function(b){return b*b*b},Out:function(b){return--b*b*b+1},InOut:function(b){return 1>(b*=2)?.5*b*b*b:.5*((b-=2)*b*b+2)}},Quartic:{In:function(b){return b*b*b*b},Out:function(b){return 1-
--b*b*b*b},InOut:function(b){return 1>(b*=2)?.5*b*b*b*b:-.5*((b-=2)*b*b*b-2)}},Quintic:{In:function(b){return b*b*b*b*b},Out:function(b){return--b*b*b*b*b+1},InOut:function(b){return 1>(b*=2)?.5*b*b*b*b*b:.5*((b-=2)*b*b*b*b+2)}},Sinusoidal:{In:function(b){return 0===b?0:1===b?1:1-Math.cos(b*Math.PI/2)},Out:function(b){return 0===b?0:1===b?1:Math.sin(b*Math.PI/2)},InOut:function(b){return 0===b?0:1===b?1:.5*(1-Math.cos(Math.PI*b))}},Exponential:{In:function(b){return 0===b?0:Math.pow(1024,b-1)},Out:function(b){return 1===
b?1:1-Math.pow(2,-10*b)},InOut:function(b){return 0===b?0:1===b?1:1>(b*=2)?.5*Math.pow(1024,b-1):.5*(-Math.pow(2,-10*(b-1))+2)}},Circular:{In:function(b){return 1-Math.sqrt(1-b*b)},Out:function(b){return Math.sqrt(1- --b*b)},InOut:function(b){return 1>(b*=2)?-.5*(Math.sqrt(1-b*b)-1):.5*(Math.sqrt(1-(b-=2)*b)+1)}},Elastic:{In:function(b){var a,e=.1;return 0===b?0:1===b?1:(!e||1>e?(e=1,a=.1):a=.4*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*--b)*Math.sin(2*(b-a)*Math.PI/.4)))},Out:function(b){var a,
e=.1;return 0===b?0:1===b?1:(!e||1>e?(e=1,a=.1):a=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*b)*Math.sin(2*(b-a)*Math.PI/.4)+1)},InOut:function(b){var a,e=.1;return 0===b?0:1===b?1:(!e||1>e?(e=1,a=.1):a=.4*Math.asin(1/e)/(2*Math.PI),1>(b*=2)?-.5*e*Math.pow(2,10*--b)*Math.sin(2*(b-a)*Math.PI/.4):e*Math.pow(2,-10*--b)*Math.sin(2*(b-a)*Math.PI/.4)*.5+1)}},Back:{In:function(b){return b*b*(2.70158*b-1.70158)},Out:function(b){return--b*b*(2.70158*b+1.70158)+1},InOut:function(b){return 1>(b*=2)?.5*b*
b*(3.5949095*b-2.5949095):.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)}},Bounce:{In:function(b){return 1-a.Easing.Bounce.Out(1-b)},Out:function(b){return 1/2.75>b?7.5625*b*b:2/2.75>b?7.5625*(b-=1.5/2.75)*b+.75:2.5/2.75>b?7.5625*(b-=2.25/2.75)*b+.9375:7.5625*(b-=2.625/2.75)*b+.984375},InOut:function(b){return.5>b?.5*a.Easing.Bounce.In(2*b):.5*a.Easing.Bounce.Out(2*b-1)+.5}}};a.Easing.Default=a.Easing.Linear.None;a.Easing.Power0=a.Easing.Linear.None;a.Easing.Power1=a.Easing.Quadratic.Out;a.Easing.Power2=
a.Easing.Cubic.Out;a.Easing.Power3=a.Easing.Quartic.Out;a.Easing.Power4=a.Easing.Quintic.Out;a.Time=function(b){this.game=b;this.physicsElapsedMS=this.physicsElapsed=this.elapsedMS=this.elapsed=this.now=this.prevTime=this.time=0;this.desiredFps=60;this.suggestedFps=null;this.slowMotion=1;this.advancedTiming=!1;this.fps=this.frames=0;this.fpsMin=1E3;this.fpsMax=0;this.msMin=1E3;this.timeExpected=this.timeToCall=this.pauseDuration=this.msMax=0;this.events=new a.Timer(this.game,!1);this._pauseStarted=
this._timeLastSecond=this._started=this._elapsedAccumulator=this._frameCount=0;this._justResumed=!1;this._timers=[]};a.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start()},add:function(b){return this._timers.push(b),b},create:function(b){"undefined"==typeof b&&(b=!0);b=new a.Timer(this.game,b);return this._timers.push(b),b},removeAll:function(){for(var b=0;b<this._timers.length;b++)this._timers[b].destroy();this._timers=[];this.events.removeAll()},update:function(b){var a=
this.time;if(this.time=Date.now(),this.elapsedMS=this.time-a,this.prevTime=this.now,this.now=b,this.elapsed=this.now-this.prevTime,this.timeToCall=Math.floor(Math.max(0,1E3/this.desiredFps-(this.timeCallExpected-b))),this.timeCallExpected=b+this.timeToCall,this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=2*this.desiredFps&&(this.suggestedFps=5*Math.floor(200/(this._elapsedAccumulator/this._frameCount)),this._frameCount=0,this._elapsedAccumulator=0),this.physicsElapsed=1/
this.desiredFps,this.physicsElapsedMS=1E3*this.physicsElapsed,this.advancedTiming&&(this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1E3&&(this.fps=Math.round(1E3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)),!this.game.paused)for(this.events.update(this.time),b=0,a=this._timers.length;a>
b;)this._timers[b].update(this.time)?b++:(this._timers.splice(b,1),a--)},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();for(var b=this._timers.length;b--;)this._timers[b]._pause()},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();for(var b=this._timers.length;b--;)this._timers[b]._resume()},totalElapsedSeconds:function(){return.001*(this.time-this._started)},elapsedSince:function(b){return this.time-b},elapsedSecondsSince:function(b){return.001*
(this.time-b)},reset:function(){this._started=this.time;this.removeAll()}};a.Time.prototype.constructor=a.Time;a.Timer=function(b,c){"undefined"==typeof c&&(c=!0);this.game=b;this.running=!1;this.autoDestroy=c;this.expired=!1;this.elapsed=0;this.events=[];this.onComplete=new a.Signal;this.nextTick=0;this.timeCap=1E3;this._codePaused=this.paused=!1;this._pauseTotal=this._pauseStarted=this._started=0;this._now=Date.now();this._newTick=this._diff=this._i=this._marked=this._len=0};a.Timer.MINUTE=6E4;
a.Timer.SECOND=1E3;a.Timer.HALF=500;a.Timer.QUARTER=250;a.Timer.prototype={create:function(b,c,e,d,f,k){b=Math.round(b);var n;n=b+(0===this._now?this.game.time.time:this._now);b=new a.TimerEvent(this,b,n,e,c,d,f,k);return this.events.push(b),this.order(),this.expired=!1,b},add:function(b,a,e){return this.create(b,!1,0,a,e,Array.prototype.splice.call(arguments,3))},repeat:function(b,a,e,d){return this.create(b,!1,a,e,d,Array.prototype.splice.call(arguments,4))},loop:function(b,a,e){return this.create(b,
!0,0,a,e,Array.prototype.splice.call(arguments,3))},start:function(b){if(!this.running)for(this._started=this.game.time.time+(b||0),this.running=!0,b=0;b<this.events.length;b++)this.events[b].tick=this.events[b].delay+this._started},stop:function(b){this.running=!1;"undefined"==typeof b&&(b=!0);b&&(this.events.length=0)},remove:function(b){for(var a=0;a<this.events.length;a++)if(this.events[a]===b)return this.events[a].pendingDelete=!0,!0;return!1},order:function(){0<this.events.length&&(this.events.sort(this.sortHandler),
this.nextTick=this.events[0].tick)},sortHandler:function(b,a){return b.tick<a.tick?-1:b.tick>a.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length;this._i=0},update:function(b){if(this.paused)return!0;if(this.elapsed=b-this._now,this._now=b,this.elapsed>this.timeCap&&this.adjustEvents(b-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&
0<this._len){for(;this._i<this._len&&this.running&&this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete;)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),0>this._newTick&&(this._newTick=this._now+this.events[this._i].delay),!0===this.events[this._i].loop?(this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):0<this.events[this._i].repeatCount?(this.events[this._i].repeatCount--,
this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this._marked++,this.events[this._i].pendingDelete=!0,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)),this._i++;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&(this._codePaused=!0,this.paused||
(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(b){for(var a=0;a<this.events.length;a++)if(!this.events[a].pendingDelete){var e=this.events[a].tick-b;0>e&&(e=0);this.events[a].tick=this._now+e}b=this.nextTick-b;this.nextTick=0>b?this._now:this._now+b},resume:function(){if(this.paused){var b=this.game.time.time;this._pauseTotal+=b-this._now;this._now=b;this.adjustEvents(this._pauseStarted);
this._codePaused=this.paused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll();this._i=this._len=this.events.length=0},destroy:function(){this.onComplete.removeAll();this.running=!1;this.events=[];this._i=this._len=0}};Object.defineProperty(a.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(a.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}});
Object.defineProperty(a.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(a.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}});Object.defineProperty(a.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}});a.Timer.prototype.constructor=a.Timer;a.TimerEvent=function(b,a,e,d,f,k,n,g){this.timer=b;this.delay=a;this.tick=e;this.repeatCount=d-1;this.loop=f;this.callback=k;this.callbackContext=
n;this.args=g;this.pendingDelete=!1};a.TimerEvent.prototype.constructor=a.TimerEvent;a.AnimationManager=function(b){this.sprite=b;this.game=b.game;this.currentAnim=this.currentFrame=null;this.updateIfVisible=!0;this.isLoaded=!1;this._frameData=null;this._anims={};this._outputFrames=[]};a.AnimationManager.prototype={loadFrameData:function(b,a){if("undefined"==typeof b)return!1;if(this.isLoaded)for(var e in this._anims)this._anims[e].updateFrameData(b);return this._frameData=b,"undefined"==typeof a||
null===a?this.frame=0:"string"==typeof a?this.frameName=a:this.frame=a,this.isLoaded=!0,!0},copyFrameData:function(b,a){if(this._frameData=b.clone(),this.isLoaded)for(var e in this._anims)this._anims[e].updateFrameData(this._frameData);return"undefined"==typeof a||null===a?this.frame=0:"string"==typeof a?this.frameName=a:this.frame=a,this.isLoaded=!0,!0},add:function(b,c,e,d,f){return c=c||[],e=e||60,"undefined"==typeof d&&(d=!1),"undefined"==typeof f&&(f=c&&"number"==typeof c[0]?!0:!1),this._outputFrames.length=
0,this._frameData.getFrameIndexes(c,f,this._outputFrames),this._anims[b]=new a.Animation(this.game,this.sprite,b,this._frameData,this._outputFrames,e,d),this.currentAnim=this._anims[b],this.currentFrame=this.currentAnim.currentFrame,this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[b]},validateFrames:function(b,a){"undefined"==typeof a&&(a=!0);for(var e=0;e<b.length;e++)if(!0===a){if(b[e]>this._frameData.total)return!1}else if(!1===this._frameData.checkFrameName(b[e]))return!1;
return!0},play:function(b,a,e,d){return this._anims[b]?this.currentAnim===this._anims[b]?!1===this.currentAnim.isPlaying?(this.currentAnim.paused=!1,this.currentAnim.play(a,e,d)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[b],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(a,e,d)):void 0},stop:function(b,a){"undefined"==typeof a&&(a=!1);"string"==typeof b?this._anims[b]&&(this.currentAnim=
this._anims[b],this.currentAnim.stop(a)):this.currentAnim&&this.currentAnim.stop(a)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(b){this.currentAnim&&(this.currentAnim.next(b),this.currentFrame=this.currentAnim.currentFrame)},previous:function(b){this.currentAnim&&(this.currentAnim.previous(b),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(b){return"string"==
typeof b&&this._anims[b]?this._anims[b]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var b=null;for(b in this._anims)this._anims.hasOwnProperty(b)&&this._anims[b].destroy();this._anims={};this._outputFrames=[];this.game=this.sprite=this.currentFrame=this.currentAnim=this._frameData=null}};a.AnimationManager.prototype.constructor=a.AnimationManager;Object.defineProperty(a.AnimationManager.prototype,
"frameData",{get:function(){return this._frameData}});Object.defineProperty(a.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(a.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(b){this.currentAnim.paused=b}});Object.defineProperty(a.AnimationManager.prototype,"name",{get:function(){return this.currentAnim?this.currentAnim.name:void 0}});Object.defineProperty(a.AnimationManager.prototype,
"frame",{get:function(){return this.currentFrame?this.currentFrame.index:void 0},set:function(b){"number"==typeof b&&this._frameData&&null!==this._frameData.getFrame(b)&&(this.currentFrame=this._frameData.getFrame(b),this.currentFrame&&(this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}});Object.defineProperty(a.AnimationManager.prototype,"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:void 0},set:function(b){"string"==
typeof b&&null!==this._frameData.getFrameByName(b)?(this.currentFrame=this._frameData.getFrameByName(b),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+b)}});a.Animation=function(b,c,e,d,f,k,n){"undefined"==typeof n&&(n=!1);this.game=b;this._parent=c;this._frameData=d;this.name=e;this._frames=[];this._frames=this._frames.concat(f);this.delay=
1E3/k;this.loop=n;this.loopCount=0;this.isPaused=this.isPlaying=this.isFinished=this.killOnComplete=!1;this._frameDiff=this._frameIndex=this._pauseStartTime=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new a.Signal;this.onUpdate=null;this.onComplete=new a.Signal;this.onLoop=new a.Signal;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};a.Animation.prototype={play:function(b,a,e){return"number"==typeof b&&
(this.delay=1E3/b),"boolean"==typeof a&&(this.loop=a),"undefined"!=typeof e&&(this.killOnComplete=e),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.updateCurrentFrame(!1),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,
this},restart:function(){this.isPlaying=!0;this.paused=this.isFinished=!1;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},setFrame:function(b,a){var e;if("undefined"==typeof a&&
(a=!1),"string"==typeof b)for(var d=0;d<this._frames.length;d++)this._frameData.getFrame(this._frames[d]).name===b&&(e=d);else if("number"==typeof b)if(a)e=b;else for(d=0;d<this._frames.length;d++)this._frames[d]===e&&(e=d);e&&(this._frameIndex=e-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(b,a){"undefined"==typeof b&&(b=!1);"undefined"==typeof a&&(a=!1);this.isPlaying=!1;this.isFinished=!0;this.paused=!1;b&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame));
a&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.time>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=
this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length?this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,
this),this.updateCurrentFrame(!0)):(this.complete(),!1):this.updateCurrentFrame(!0)):!1},updateCurrentFrame:function(b){return this._frameData?(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&b?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0):!1},next:function(b){"undefined"==typeof b&&
(b=1);b=this._frameIndex+b;b>=this._frames.length&&(this.loop?b%=this._frames.length:b=this._frames.length-1);b!==this._frameIndex&&(this._frameIndex=b,this.updateCurrentFrame(!0))},previous:function(b){"undefined"==typeof b&&(b=1);b=this._frameIndex-b;0>b&&(this.loop?b=this._frames.length+b:b++);b!==this._frameIndex&&(this._frameIndex=b,this.updateCurrentFrame(!0))},updateFrameData:function(b){this.currentFrame=(this._frameData=b)?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):
null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=
!1;this.isFinished=!0;this.paused=!1;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);this.killOnComplete&&this._parent.kill()}};a.Animation.prototype.constructor=a.Animation;Object.defineProperty(a.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(b){(this.isPaused=b)?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}});Object.defineProperty(a.Animation.prototype,
"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(a.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(b){this.currentFrame=this._frameData.getFrame(this._frames[b]);null!==this.currentFrame&&(this._frameIndex=b,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}});Object.defineProperty(a.Animation.prototype,"speed",{get:function(){return Math.round(1E3/
this.delay)},set:function(b){1<=b&&(this.delay=1E3/b)}});Object.defineProperty(a.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(b){b&&null===this.onUpdate?this.onUpdate=new a.Signal:b||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}});a.Animation.generateFrameNames=function(b,c,e,d,f){"undefined"==typeof d&&(d="");var k=[],n="";if(e>c)for(;e>=c;c++)n="number"==typeof f?a.Utils.pad(c.toString(),f,"0",1):c.toString(),n=b+n+d,k.push(n);
else for(;c>=e;c--)n="number"==typeof f?a.Utils.pad(c.toString(),f,"0",1):c.toString(),n=b+n+d,k.push(n);return k};a.Frame=function(b,c,e,d,f,k,n){this.index=b;this.x=c;this.y=e;this.width=d;this.height=f;this.name=k;this.uuid=n;this.centerX=Math.floor(d/2);this.centerY=Math.floor(f/2);this.distance=a.Math.distance(0,0,d,f);this.rotated=!1;this.rotationDirection="cw";this.trimmed=!1;this.sourceSizeW=d;this.sourceSizeH=f;this.spriteSourceSizeH=this.spriteSourceSizeW=this.spriteSourceSizeY=this.spriteSourceSizeX=
0;this.right=this.x+this.width;this.bottom=this.y+this.height};a.Frame.prototype={setTrim:function(b,a,e,d,f,k,n){(this.trimmed=b)&&(this.sourceSizeW=a,this.sourceSizeH=e,this.centerX=Math.floor(a/2),this.centerY=Math.floor(e/2),this.spriteSourceSizeX=d,this.spriteSourceSizeY=f,this.spriteSourceSizeW=k,this.spriteSourceSizeH=n)},clone:function(){var b=new a.Frame(this.index,this.x,this.y,this.width,this.height,this.name,this.uuid),c;for(c in this)this.hasOwnProperty(c)&&(b[c]=this[c]);return b},getRect:function(b){return"undefined"==
typeof b?b=new a.Rectangle(this.x,this.y,this.width,this.height):b.setTo(this.x,this.y,this.width,this.height),b}};a.Frame.prototype.constructor=a.Frame;a.FrameData=function(){this._frames=[];this._frameNames=[]};a.FrameData.prototype={addFrame:function(b){return b.index=this._frames.length,this._frames.push(b),""!==b.name&&(this._frameNames[b.name]=b.index),b},getFrame:function(b){return b>=this._frames.length&&(b=0),this._frames[b]},getFrameByName:function(b){return"number"==typeof this._frameNames[b]?
this._frames[this._frameNames[b]]:null},checkFrameName:function(b){return null==this._frameNames[b]?!1:!0},clone:function(){for(var b=new a.FrameData,c=0;c<this._frames.length;c++)b._frames.push(this._frames[c].clone());for(var e in this._frameNames)this._frameNames.hasOwnProperty(e)&&b._frameNames.push(this._frameNames[e]);return b},getFrameRange:function(b,a,e){for("undefined"==typeof e&&(e=[]);a>=b;b++)e.push(this._frames[b]);return e},getFrames:function(b,a,e){if("undefined"==typeof a&&(a=!0),
"undefined"==typeof e&&(e=[]),"undefined"==typeof b||0===b.length)for(var d=0;d<this._frames.length;d++)e.push(this._frames[d]);else for(var d=0,f=b.length;f>d;d++)e.push(a?this.getFrame(b[d]):this.getFrameByName(b[d]));return e},getFrameIndexes:function(b,a,e){if("undefined"==typeof a&&(a=!0),"undefined"==typeof e&&(e=[]),"undefined"==typeof b||0===b.length)for(var d=0,f=this._frames.length;f>d;d++)e.push(this._frames[d].index);else for(d=0,f=b.length;f>d;d++)a?e.push(b[d]):this.getFrameByName(b[d])&&
e.push(this.getFrameByName(b[d]).index);return e}};a.FrameData.prototype.constructor=a.FrameData;Object.defineProperty(a.FrameData.prototype,"total",{get:function(){return this._frames.length}});a.AnimationParser={spriteSheet:function(b,c,e,d,f,k,n){var g=b.cache.getImage(c);if(null==g)return null;var h=g.width,l=g.height;0>=e&&(e=Math.floor(-h/Math.min(-1,e)));0>=d&&(d=Math.floor(-l/Math.min(-1,d)));g=Math.floor((h-k)/(e+n))*Math.floor((l-k)/(d+n));if(-1!==f&&(g=f),0===h||0===l||e>h||d>l||0===g)return console.warn("Phaser.AnimationParser.spriteSheet: '"+
c+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;f=new a.FrameData;for(var m=l=k,p=0;g>p;p++){var x=b.rnd.uuid();f.addFrame(new a.Frame(p,l,m,e,d,"",x));PIXI.TextureCache[x]=new PIXI.Texture(PIXI.BaseTextureCache[c],{x:l,y:m,width:e,height:d});l+=e+n;l+e>h&&(l=k,m+=d+n)}return f},JSONData:function(b,c,e){if(!c.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(c);for(var d=new a.FrameData,
f=c.frames,k=0;k<f.length;k++){var n=b.rnd.uuid();c=d.addFrame(new a.Frame(k,f[k].frame.x,f[k].frame.y,f[k].frame.w,f[k].frame.h,f[k].filename,n));PIXI.TextureCache[n]=new PIXI.Texture(PIXI.BaseTextureCache[e],{x:f[k].frame.x,y:f[k].frame.y,width:f[k].frame.w,height:f[k].frame.h});f[k].trimmed&&c.setTrim(f[k].trimmed,f[k].sourceSize.w,f[k].sourceSize.h,f[k].spriteSourceSize.x,f[k].spriteSourceSize.y,f[k].spriteSourceSize.w,f[k].spriteSourceSize.h)}return d},JSONDataHash:function(b,c,e){if(!c.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),
void console.log(c);var d=new a.FrameData,f=c.frames,k=0,n;for(n in f){var g=b.rnd.uuid();c=d.addFrame(new a.Frame(k,f[n].frame.x,f[n].frame.y,f[n].frame.w,f[n].frame.h,n,g));PIXI.TextureCache[g]=new PIXI.Texture(PIXI.BaseTextureCache[e],{x:f[n].frame.x,y:f[n].frame.y,width:f[n].frame.w,height:f[n].frame.h});f[n].trimmed&&c.setTrim(f[n].trimmed,f[n].sourceSize.w,f[n].sourceSize.h,f[n].spriteSourceSize.x,f[n].spriteSourceSize.y,f[n].spriteSourceSize.w,f[n].spriteSourceSize.h);k++}return d},XMLData:function(b,
c,e){if(!c.getElementsByTagName("TextureAtlas"))return void console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");for(var d,f,k,n,g,h,l,m,p,x,v=new a.FrameData,w=c.getElementsByTagName("SubTexture"),r=0;r<w.length;r++)c=b.rnd.uuid(),f=w[r].attributes,d=f.name.value,k=parseInt(f.x.value,10),n=parseInt(f.y.value,10),g=parseInt(f.width.value,10),h=parseInt(f.height.value,10),m=l=null,f.frameX&&(l=Math.abs(parseInt(f.frameX.value,10)),m=Math.abs(parseInt(f.frameY.value,
10)),p=parseInt(f.frameWidth.value,10),x=parseInt(f.frameHeight.value,10)),d=v.addFrame(new a.Frame(r,k,n,g,h,d,c)),PIXI.TextureCache[c]=new PIXI.Texture(PIXI.BaseTextureCache[e],{x:k,y:n,width:g,height:h}),null===l&&null===m||d.setTrim(!0,g,h,l,m,p,x);return v}};a.Cache=function(b){this.game=b;this.autoResolveURL=!1;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._json={};this._xml={};this._physics={};this._tilemaps={};this._binary={};this._bitmapDatas={};this._bitmapFont=
{};this._urlMap={};this._urlResolver=new Image;this._urlTemp=null;this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new a.Signal;this._cacheMap=[];this._cacheMap[a.Cache.CANVAS]=this._canvases;this._cacheMap[a.Cache.IMAGE]=this._images;this._cacheMap[a.Cache.TEXTURE]=this._textures;this._cacheMap[a.Cache.SOUND]=this._sounds;this._cacheMap[a.Cache.TEXT]=this._text;this._cacheMap[a.Cache.PHYSICS]=this._physics;this._cacheMap[a.Cache.TILEMAP]=this._tilemaps;this._cacheMap[a.Cache.BINARY]=
this._binary;this._cacheMap[a.Cache.BITMAPDATA]=this._bitmapDatas;this._cacheMap[a.Cache.BITMAPFONT]=this._bitmapFont;this._cacheMap[a.Cache.JSON]=this._json;this._cacheMap[a.Cache.XML]=this._xml};a.Cache.CANVAS=1;a.Cache.IMAGE=2;a.Cache.TEXTURE=3;a.Cache.SOUND=4;a.Cache.TEXT=5;a.Cache.PHYSICS=6;a.Cache.TILEMAP=7;a.Cache.BINARY=8;a.Cache.BITMAPDATA=9;a.Cache.BITMAPFONT=10;a.Cache.JSON=11;a.Cache.XML=12;a.Cache.prototype={addCanvas:function(b,a,e){this._canvases[b]={canvas:a,context:e}},addBinary:function(b,
a){this._binary[b]=a},addBitmapData:function(b,c,e){return c.key=b,"undefined"==typeof e&&(e=new a.FrameData,e.addFrame(c.textureFrame)),this._bitmapDatas[b]={data:c,frameData:e},c},addRenderTexture:function(b,c){var e=new a.Frame(0,0,0,c.width,c.height,"","");this._textures[b]={texture:c,frame:e}},addSpriteSheet:function(b,c,e,d,f,k,n,g){this._images[b]={url:c,data:e,frameWidth:d,frameHeight:f,margin:n,spacing:g};PIXI.BaseTextureCache[b]=new PIXI.BaseTexture(e);PIXI.TextureCache[b]=new PIXI.Texture(PIXI.BaseTextureCache[b]);
this._images[b].frameData=a.AnimationParser.spriteSheet(this.game,b,d,f,k,n,g);this._resolveURL(c,this._images[b])},addTilemap:function(b,a,e,d){this._tilemaps[b]={url:a,data:e,format:d};this._resolveURL(a,this._tilemaps[b])},addTextureAtlas:function(b,c,e,d,f){this._images[b]={url:c,data:e};PIXI.BaseTextureCache[b]=new PIXI.BaseTexture(e);PIXI.TextureCache[b]=new PIXI.Texture(PIXI.BaseTextureCache[b]);f==a.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[b].frameData=a.AnimationParser.JSONData(this.game,
d,b):f==a.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[b].frameData=a.AnimationParser.JSONDataHash(this.game,d,b):f==a.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[b].frameData=a.AnimationParser.XMLData(this.game,d,b));this._resolveURL(c,this._images[b])},addBitmapFont:function(b,c,e,d,f,k){this._images[b]={url:c,data:e};PIXI.BaseTextureCache[b]=new PIXI.BaseTexture(e);PIXI.TextureCache[b]=new PIXI.Texture(PIXI.BaseTextureCache[b]);a.LoaderParser.bitmapFont(this.game,d,b,f,k);this._bitmapFont[b]=
PIXI.BitmapText.fonts[b];this._resolveURL(c,this._bitmapFont[b])},addPhysicsData:function(b,a,e,d){this._physics[b]={url:a,data:e,format:d};this._resolveURL(a,this._physics[b])},addDefaultImage:function(){var b=new Image;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images.__default={url:null,data:b};this._images.__default.frame=new a.Frame(0,0,0,32,32,"","");this._images.__default.frameData=
new a.FrameData;this._images.__default.frameData.addFrame(new a.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(b);PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var b=new Image;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";
this._images.__missing={url:null,data:b};this._images.__missing.frame=new a.Frame(0,0,0,32,32,"","");this._images.__missing.frameData=new a.FrameData;this._images.__missing.frameData.addFrame(new a.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(b);PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(b,a,e){this._text[b]={url:a,data:e};this._resolveURL(a,this._text[b])},addJSON:function(b,a,e){this._json[b]=
{url:a,data:e};this._resolveURL(a,this._json[b])},addXML:function(b,a,e){this._xml[b]={url:a,data:e};this._resolveURL(a,this._xml[b])},addImage:function(b,c,e){this.checkImageKey(b)&&this.removeImage(b);this._images[b]={url:c,data:e};this._images[b].frame=new a.Frame(0,0,0,e.width,e.height,b,this.game.rnd.uuid());this._images[b].frameData=new a.FrameData;this._images[b].frameData.addFrame(new a.Frame(0,0,0,e.width,e.height,c,this.game.rnd.uuid()));PIXI.BaseTextureCache[b]=new PIXI.BaseTexture(e);
PIXI.TextureCache[b]=new PIXI.Texture(PIXI.BaseTextureCache[b]);this._resolveURL(c,this._images[b])},addSound:function(b,a,e,d,f){f=f||!1;var k=!1;f&&(k=!0);this._sounds[b]={url:a,data:e,isDecoding:!1,decoded:k,webAudio:d||!0,audioTag:f,locked:this.game.sound.touchLocked};this._resolveURL(a,this._sounds[b])},reloadSound:function(b){var a=this;this._sounds[b]&&(this._sounds[b].data.src=this._sounds[b].url,this._sounds[b].data.addEventListener("canplaythrough",function(){return a.reloadSoundComplete(b)},
!1),this._sounds[b].data.load())},reloadSoundComplete:function(b){this._sounds[b]&&(this._sounds[b].locked=!1,this.onSoundUnlock.dispatch(b))},updateSound:function(b,a,e){this._sounds[b]&&(this._sounds[b][a]=e)},decodedSound:function(b,a){this._sounds[b].data=a;this._sounds[b].decoded=!0;this._sounds[b].isDecoding=!1},getCanvas:function(b){return this._canvases[b]?this._canvases[b].canvas:(console.warn('Phaser.Cache.getCanvas: Invalid key: "'+b+'"'),null)},getBitmapData:function(b){return this._bitmapDatas[b]?
this._bitmapDatas[b].data:(console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+b+'"'),null)},getBitmapFont:function(b){return this._bitmapFont[b]?this._bitmapFont[b]:(console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+b+'"'),null)},getPhysicsData:function(b,a,e){if("undefined"==typeof a||null===a){if(this._physics[b])return this._physics[b].data;console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+b+'"')}else if(this._physics[b]&&this._physics[b].data[a]){a=this._physics[b].data[a];
if(!a||!e)return a;for(var d in a)if(d=a[d],d.fixtureKey===e)return d;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+e+" in "+b+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+b+" / "+a+'"');return null},checkKey:function(b,a){return this._cacheMap[b][a]?!0:!1},checkCanvasKey:function(b){return this.checkKey(a.Cache.CANVAS,b)},checkImageKey:function(b){return this.checkKey(a.Cache.IMAGE,b)},checkTextureKey:function(b){return this.checkKey(a.Cache.TEXTURE,
b)},checkSoundKey:function(b){return this.checkKey(a.Cache.SOUND,b)},checkTextKey:function(b){return this.checkKey(a.Cache.TEXT,b)},checkPhysicsKey:function(b){return this.checkKey(a.Cache.PHYSICS,b)},checkTilemapKey:function(b){return this.checkKey(a.Cache.TILEMAP,b)},checkBinaryKey:function(b){return this.checkKey(a.Cache.BINARY,b)},checkBitmapDataKey:function(b){return this.checkKey(a.Cache.BITMAPDATA,b)},checkBitmapFontKey:function(b){return this.checkKey(a.Cache.BITMAPFONT,b)},checkJSONKey:function(b){return this.checkKey(a.Cache.JSON,
b)},checkXMLKey:function(b){return this.checkKey(a.Cache.XML,b)},checkURL:function(b){return this._urlMap[this._resolveURL(b)]?!0:!1},getImage:function(b){return this._images[b]?this._images[b].data:(console.warn('Phaser.Cache.getImage: Invalid key: "'+b+'"'),null)},getTilemapData:function(b){return this._tilemaps[b]?this._tilemaps[b]:(console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+b+'"'),null)},getFrameData:function(b,c){return"undefined"==typeof c&&(c=a.Cache.IMAGE),this._cacheMap[c][b]?
this._cacheMap[c][b].frameData:null},updateFrameData:function(b,a){this._images[b]&&(this._images[b].frameData=a)},getFrameByIndex:function(b,a){return this._images[b]?this._images[b].frameData.getFrame(a):null},getFrameByName:function(b,a){return this._images[b]?this._images[b].frameData.getFrameByName(a):null},getFrame:function(b){return this._images[b]?this._images[b].frame:null},getTextureFrame:function(b){return this._textures[b]?this._textures[b].frame:null},getRenderTexture:function(b){return this._textures[b]?
this._textures[b]:(console.warn('Phaser.Cache.getTexture: Invalid key: "'+b+'"'),null)},getTexture:function(b){return this._textures[b]?this._textures[b]:void console.warn('Phaser.Cache.getTexture: Invalid key: "'+b+'"')},getSound:function(b){return this._sounds[b]?this._sounds[b]:(console.warn('Phaser.Cache.getSound: Invalid key: "'+b+'"'),null)},getSoundData:function(b){return this._sounds[b]?this._sounds[b].data:(console.warn('Phaser.Cache.getSoundData: Invalid key: "'+b+'"'),null)},isSoundDecoded:function(b){return this._sounds[b]?
this._sounds[b].decoded:void 0},isSoundReady:function(b){return this._sounds[b]&&this._sounds[b].decoded&&!1===this.game.sound.touchLocked},getFrameCount:function(b){return this._images[b]?this._images[b].frameData.total:0},getText:function(b){return this._text[b]?this._text[b].data:(console.warn('Phaser.Cache.getText: Invalid key: "'+b+'"'),null)},getJSON:function(b){return this._json[b]?this._json[b].data:(console.warn('Phaser.Cache.getJSON: Invalid key: "'+b+'"'),null)},getXML:function(b){return this._xml[b]?
this._xml[b].data:(console.warn('Phaser.Cache.getXML: Invalid key: "'+b+'"'),null)},getBinary:function(b){return this._binary[b]?this._binary[b]:(console.warn('Phaser.Cache.getBinary: Invalid key: "'+b+'"'),null)},getURL:function(b){return(b=this._resolveURL(b))?this._urlMap[b]:(console.warn('Phaser.Cache.getUrl: Invalid url: "'+b+'" or Cache.autoResolveURL was false'),null)},getUrl:function(b){return this.getURL(b)},getKeys:function(b){var c=null;switch(b){case a.Cache.CANVAS:c=this._canvases;break;
case a.Cache.IMAGE:c=this._images;break;case a.Cache.TEXTURE:c=this._textures;break;case a.Cache.SOUND:c=this._sounds;break;case a.Cache.TEXT:c=this._text;break;case a.Cache.PHYSICS:c=this._physics;break;case a.Cache.TILEMAP:c=this._tilemaps;break;case a.Cache.BINARY:c=this._binary;break;case a.Cache.BITMAPDATA:c=this._bitmapDatas;break;case a.Cache.BITMAPFONT:c=this._bitmapFont;break;case a.Cache.JSON:c=this._json;break;case a.Cache.XML:c=this._xml}if(c){b=[];for(var e in c)"__default"!==e&&"__missing"!==
e&&b.push(e);return b}},removeCanvas:function(b){delete this._canvases[b]},removeImage:function(b,a){"undefined"==typeof a&&(a=!0);delete this._images[b];a&&PIXI.BaseTextureCache[b].destroy()},removeSound:function(b){delete this._sounds[b]},removeText:function(b){delete this._text[b]},removeJSON:function(b){delete this._json[b]},removeXML:function(b){delete this._xml[b]},removePhysics:function(b){delete this._physics[b]},removeTilemap:function(b){delete this._tilemaps[b]},removeBinary:function(b){delete this._binary[b]},
removeBitmapData:function(b){delete this._bitmapDatas[b]},removeBitmapFont:function(b){delete this._bitmapFont[b]},_resolveURL:function(b,a){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+b,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",a&&(this._urlMap[this._urlTemp]=a),this._urlTemp):null},destroy:function(){for(var b in this._images)"__default"!==b&&"__missing"!==b&&delete this._images[b];for(var a=[this._canvases,this._sounds,this._text,this._json,this._xml,
this._textures,this._physics,this._tilemaps,this._binary,this._bitmapDatas,this._bitmapFont],e=0;e<a.length;e++)for(b in a[e])delete a[e][b];this._urlTemp=this._urlResolver=this._urlMap=null}};a.Cache.prototype.constructor=a.Cache;a.Loader=function(b){this.game=b;this.hasLoaded=this.isLoading=this.resetLocked=!1;this.preloadSprite=null;this.crossOrigin=!1;this.baseURL="";this.onLoadStart=new a.Signal;this.onLoadComplete=new a.Signal;this.onPackComplete=new a.Signal;this.onFileStart=new a.Signal;this.onFileComplete=
new a.Signal;this.onFileError=new a.Signal;this._warnedAboutXDomainRequest=this.useXDomainRequest=!1;this.enableParallel=!0;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=!1;this._loadedFileCount=this._loadedPackCount=this._totalFileCount=this._totalPackCount=0};a.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;a.Loader.TEXTURE_ATLAS_JSON_HASH=1;a.Loader.TEXTURE_ATLAS_XML_STARLING=2;a.Loader.PHYSICS_LIME_CORONA_JSON=3;a.Loader.PHYSICS_PHASER_JSON=
4;a.Loader.prototype={setPreloadSprite:function(b,c){c=c||0;this.preloadSprite={sprite:b,direction:c,width:b.width,height:b.height,rect:null};this.preloadSprite.rect=0===c?new a.Rectangle(0,0,1,b.height):new a.Rectangle(0,0,b.width,1);b.crop(this.preloadSprite.rect);b.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(b,a){return-1<this.getAssetIndex(b,
a)},getAssetIndex:function(b,a){for(var e=-1,d=0;d<this._fileList.length;d++){var f=this._fileList[d];if(f.type===b&&f.key===a&&(e=d,!f.loaded&&!f.loading))break}return e},getAsset:function(b,a){var e=this.getAssetIndex(b,a);return-1<e?{index:e,file:this._fileList[e]}:!1},reset:function(b,a){"undefined"==typeof a&&(a=!1);this.resetLocked||(b&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=
0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,a&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(b,a,e,d,f){e={type:b,key:a,url:e,syncPoint:0<this._withSyncPointDepth,data:null,loading:!1,loaded:!1,error:!1};if(d)for(var k in d)e[k]=d[k];b=this.getAssetIndex(b,a);f&&-1<b?(f=this._fileList[b],f.loading||f.loaded?
(this._fileList.push(e),this._totalFileCount++):this._fileList[b]=e):-1===b&&(this._fileList.push(e),this._totalFileCount++)},replaceInFileList:function(b,a,e,d){return this.addToFileList(b,a,e,d,!0)},pack:function(b,a,e,d){if("undefined"==typeof a&&(a=null),"undefined"==typeof e&&(e=null),"undefined"==typeof d&&(d=null),!a&&!e)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;b={type:"packfile",key:b,url:a,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,
callbackContext:d};e&&("string"==typeof e&&(e=JSON.parse(e)),b.data=e||{},b.loaded=!0);for(e=0;e<this._fileList.length+1;e++)if(a=this._fileList[e],!a||!a.loaded&&!a.loading&&"packfile"!==a.type){this._fileList.splice(e,1,b);this._totalPackCount++;break}return this},image:function(b,a,e){return"undefined"==typeof e&&(e=!1),this.addToFileList("image",b,a,void 0,e),this},text:function(b,a,e){return"undefined"==typeof e&&(e=!1),this.addToFileList("text",b,a,void 0,e),this},json:function(b,a,e){return"undefined"==
typeof e&&(e=!1),this.addToFileList("json",b,a,void 0,e),this},xml:function(b,a,e){return"undefined"==typeof e&&(e=!1),this.addToFileList("xml",b,a,void 0,e),this},script:function(b,a,e,d){return"undefined"==typeof e&&(e=!1),!1!==e&&"undefined"==typeof d&&(d=e),this.addToFileList("script",b,a,{syncPoint:!0,callback:e,callbackContext:d}),this},binary:function(b,a,e,d){return"undefined"==typeof e&&(e=!1),!1!==e&&"undefined"==typeof d&&(d=e),this.addToFileList("binary",b,a,{callback:e,callbackContext:d}),
this},spritesheet:function(b,a,e,d,f,k,n){return"undefined"==typeof f&&(f=-1),"undefined"==typeof k&&(k=0),"undefined"==typeof n&&(n=0),this.addToFileList("spritesheet",b,a,{frameWidth:e,frameHeight:d,frameMax:f,margin:k,spacing:n}),this},audio:function(b,a,e){return"undefined"==typeof e&&(e=!0),"string"==typeof a&&(a=[a]),this.addToFileList("audio",b,a,{buffer:null,autoDecode:e}),this},audiosprite:function(b,a,e,d,f){return"undefined"==typeof e&&(e=null),"undefined"==typeof d&&(d=null),"undefined"==
typeof f&&(f=!0),this.audio(b,a,f),e?this.json(b+"-audioatlas",e):d?("string"==typeof d&&(d=JSON.parse(d)),this.game.cache.addJSON(b+"-audioatlas","",d)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object"),this},tilemap:function(b,c,e,d){if("undefined"==typeof c&&(c=null),"undefined"==typeof e&&(e=null),"undefined"==typeof d&&(d=a.Tilemap.CSV),!c&&!e)return console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set."),this;
if(e){switch(d){case a.Tilemap.TILED_JSON:"string"==typeof e&&(e=JSON.parse(e))}this.game.cache.addTilemap(b,null,e,d)}else this.addToFileList("tilemap",b,c,{format:d});return this},physics:function(b,c,e,d){return"undefined"==typeof c&&(c=null),"undefined"==typeof e&&(e=null),"undefined"==typeof d&&(d=a.Physics.LIME_CORONA_JSON),c||e?(e?("string"==typeof e&&(e=JSON.parse(e)),this.game.cache.addPhysicsData(b,null,e,d)):this.addToFileList("physics",b,c,{format:d}),this):(console.warn("Phaser.Loader.physics - Both url and data are null. One must be set."),
this)},bitmapFont:function(b,a,e,d,f,k){if("undefined"==typeof e&&(e=null),"undefined"==typeof d&&(d=null),"undefined"==typeof f&&(f=0),"undefined"==typeof k&&(k=0),e)this.addToFileList("bitmapfont",b,a,{xmlURL:e,xSpacing:f,ySpacing:k});else if("string"==typeof d){e=this.parseXml(d);if(!e)throw Error("Phaser.Loader. Invalid Bitmap Font XML given");this.addToFileList("bitmapfont",b,a,{xmlURL:null,xmlData:e,xSpacing:f,ySpacing:k})}return this},atlasJSONArray:function(b,c,e,d){return this.atlas(b,c,
e,d,a.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(b,c,e,d){return this.atlas(b,c,e,d,a.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(b,c,e,d){return this.atlas(b,c,e,d,a.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(b,c,e,d,f){if("undefined"==typeof e&&(e=null),"undefined"==typeof d&&(d=null),"undefined"==typeof f&&(f=a.Loader.TEXTURE_ATLAS_JSON_ARRAY),e)this.addToFileList("textureatlas",b,c,{atlasURL:e,format:f});else{switch(f){case a.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==
typeof d&&(d=JSON.parse(d));break;case a.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof d){e=this.parseXml(d);if(!e)throw Error("Phaser.Loader. Invalid Texture Atlas XML given");d=e}}this.addToFileList("textureatlas",b,c,{atlasURL:null,atlasData:d,format:f})}return this},withSyncPoint:function(b,a){this._withSyncPointDepth++;try{b.call(a||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(b,a){var e=this.getAsset(b,a);return e&&(e.file.syncPoint=!0),this},removeFile:function(b,
a){var e=this.getAsset(b,a);e&&(e.loaded||e.loading||this._fileList.splice(e.index,1))},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){if(!this.isLoading)return console.warn("Phaser.Loader - active loading canceled / reset"),void this.finishedLoading(!0);for(var b=0;b<this._flightQueue.length;b++){var c=this._flightQueue[b];(c.loaded||
c.error)&&(this._flightQueue.splice(b,1),b--,c.loading=!1,c.requestUrl=null,c.requestObject=null,c.error&&this.onFileError.dispatch(c.key,c),"packfile"!==c.type?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,c.key,!c.error,this._loadedFileCount,this._totalFileCount)):"packfile"===c.type&&c.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(c.key,!c.error,this._loadedPackCount,this._totalPackCount)))}for(var e=!1,d=this.enableParallel?a.Math.clamp(this.maxParallelDownloads,
1,12):1,b=this._processingHead;b<this._fileList.length&&!(c=this._fileList[b],"packfile"===c.type&&!c.error&&c.loaded&&b===this._processingHead&&(this.processPack(c),this._loadedPackCount++,this.onPackComplete.dispatch(c.key,!c.error,this._loadedPackCount,this._totalPackCount)),c.loaded||c.error?b===this._processingHead&&(this._processingHead=b+1):!c.loading&&this._flightQueue.length<d&&("packfile"!==c.type||c.data?e||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),
this._flightQueue.push(c),c.loading=!0,this.onFileStart.dispatch(this.progress,c.key,c.url),this.loadFile(c)):(this._flightQueue.push(c),c.loading=!0,this.loadFile(c))),!c.loaded&&c.syncPoint&&(e=!0),this._flightQueue.length>=d||e&&this._loadedPackCount===this._totalPackCount);b++);if(this.updateProgress(),this._processingHead>=this._fileList.length)this.finishedLoading();else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");
var f=this;setTimeout(function(){f.finishedLoading(!0)},2E3)}},finishedLoading:function(b){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,b||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.onLoadComplete.dispatch(),this.reset(),this.game.state.loadComplete())},asyncComplete:function(b,a){"undefined"==typeof a&&(a="");b.loaded=!0;b.error=!!a;a&&(b.errorMessage=a,console.warn("Phaser.Loader - "+b.type+"["+b.key+"]: "+a));this.processLoadQueue()},processPack:function(b){var c=
b.data[b.key];if(!c)return void console.warn("Phaser.Loader - "+b.key+": pack has data, but not for pack key");for(var e=0;e<c.length;e++){var d=c[e];switch(d.type){case "image":this.image(d.key,d.url,d.overwrite);break;case "text":this.text(d.key,d.url,d.overwrite);break;case "json":this.json(d.key,d.url,d.overwrite);break;case "xml":this.xml(d.key,d.url,d.overwrite);break;case "script":this.script(d.key,d.url,d.callback,b.callbackContext||this);break;case "binary":this.binary(d.key,d.url,d.callback,
b.callbackContext||this);break;case "spritesheet":this.spritesheet(d.key,d.url,d.frameWidth,d.frameHeight,d.frameMax,d.margin,d.spacing);break;case "audio":this.audio(d.key,d.urls,d.autoDecode);break;case "audiosprite":this.audio(d.key,d.urls,d.jsonURL);break;case "tilemap":this.tilemap(d.key,d.url,d.data,a.Tilemap[d.format]);break;case "physics":this.physics(d.key,d.url,d.data,a.Loader[d.format]);break;case "bitmapFont":this.bitmapFont(d.key,d.textureURL,d.xmlURL,d.xmlData,d.xSpacing,d.ySpacing);
break;case "atlasJSONArray":this.atlasJSONArray(d.key,d.textureURL,d.atlasURL,d.atlasData);break;case "atlasJSONHash":this.atlasJSONHash(d.key,d.textureURL,d.atlasURL,d.atlasData);break;case "atlasXML":this.atlasXML(d.key,d.textureURL,d.atlasURL,d.atlasData);break;case "atlas":this.atlas(d.key,d.textureURL,d.atlasURL,d.atlasData,a.Loader[d.format])}}},transformUrl:function(b){return this.baseURL+b},loadFile:function(b){switch(b.type){case "packfile":this.xhrLoad(b,this.transformUrl(b.url,b),"text",
this.fileComplete);break;case "image":case "spritesheet":case "textureatlas":case "bitmapfont":this.loadImageTag(b);break;case "audio":b.url=this.getAudioURL(b.url);b.url?this.game.sound.usingWebAudio?this.xhrLoad(b,this.transformUrl(b.url,b),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(b):this.fileError(b,null,"no supported audio URL specified");break;case "json":this.xhrLoad(b,this.transformUrl(b.url,b),"text",this.jsonLoadComplete);break;case "xml":this.xhrLoad(b,
this.transformUrl(b.url,b),"text",this.xmlLoadComplete);break;case "tilemap":b.format===a.Tilemap.TILED_JSON?this.xhrLoad(b,this.transformUrl(b.url,b),"text",this.jsonLoadComplete):b.format===a.Tilemap.CSV?this.xhrLoad(b,this.transformUrl(b.url,b),"text",this.csvLoadComplete):this.asyncComplete(b,"invalid Tilemap format: "+b.format);break;case "text":case "script":case "physics":this.xhrLoad(b,this.transformUrl(b.url,b),"text",this.fileComplete);break;case "binary":this.xhrLoad(b,this.transformUrl(b.url,
b),"arraybuffer",this.fileComplete)}},loadImageTag:function(b){var a=this;b.data=new Image;b.data.name=b.key;this.crossOrigin&&(b.data.crossOrigin=this.crossOrigin);b.data.onload=function(){b.data.onload&&(b.data.onload=null,b.data.onerror=null,a.fileComplete(b))};b.data.onerror=function(){b.data.onload&&(b.data.onload=null,b.data.onerror=null,a.fileError(b))};b.data.src=this.transformUrl(b.url,b);b.data.complete&&b.data.width&&b.data.height&&(b.data.onload=null,b.data.onerror=null,this.fileComplete(b))},
loadAudioTag:function(b){var c=this;if(this.game.sound.touchLocked)b.data=new Audio,b.data.name=b.key,b.data.preload="auto",b.data.src=this.transformUrl(b.url,b),this.fileComplete(b);else{b.data=new Audio;b.data.name=b.key;var e=function(){b.data.removeEventListener("canplaythrough",e,!1);b.data.onerror=null;a.GAMES[c.game.id].load.fileComplete(b)};b.data.onerror=function(){b.data.removeEventListener("canplaythrough",e,!1);b.data.onerror=null;c.fileError(b)};b.data.preload="auto";b.data.src=this.transformUrl(b.url,
b);b.data.addEventListener("canplaythrough",e,!1);b.data.load()}},xhrLoad:function(b,a,e,d,f){if(this.useXDomainRequest&&window.XDomainRequest)return void this.xhrLoadWithXDR(b,a,e,d,f);var k=new XMLHttpRequest;k.open("GET",a,!0);k.responseType=e;f=f||this.fileError;var n=this;k.onload=function(){try{return d.call(n,b,k)}catch(a){n.hasLoaded?window.console&&console.error(a):n.asyncComplete(b,a.message||"Exception")}};k.onerror=function(){try{return f.call(n,b,k)}catch(a){n.hasLoaded?window.console&&
console.error(a):n.asyncComplete(b,a.message||"Exception")}};b.requestObject=k;b.requestUrl=a;k.send()},xhrLoadWithXDR:function(b,a,e,d,f){this._warnedAboutXDomainRequest||this.game.device.ie&&!(10<=this.game.device.ieVersion)||(this._warnedAboutXDomainRequest=!0,console.warn("Phaser.Loader - using XDomainRequest outside of IE 9"));var k=new window.XDomainRequest;k.open("GET",a,!0);k.responseType=e;k.timeout=3E3;f=f||this.fileError;var n=this;k.onerror=function(){try{return f.call(n,b,k)}catch(a){n.asyncComplete(b,
a.message||"Exception")}};k.ontimeout=function(){try{return f.call(n,b,k)}catch(a){n.asyncComplete(b,a.message||"Exception")}};k.onprogress=function(){};k.onload=function(){try{return d.call(n,b,k)}catch(a){n.asyncComplete(b,a.message||"Exception")}};b.requestObject=k;b.requestUrl=a;setTimeout(function(){k.send()},0)},getAudioURL:function(b){for(var a=0;a<b.length;a++){var e;e=b[a];if(e.uri)e=e.uri,e=e.type;else{if(0===e.indexOf("blob:")||0===e.indexOf("data:"))return e;0<=e.indexOf("?")&&(e=e.substr(0,
e.indexOf("?")));e=e.substr((Math.max(0,e.lastIndexOf("."))||1/0)+1).toLowerCase()}if(this.game.device.canPlayAudio(e))return b[a]}return null},fileError:function(b,a,e){var d="error loading asset from URL "+(b.requestUrl||this.transformUrl(b.url,b));!e&&a&&(e=a.status);e&&(d=d+" ("+e+")");this.asyncComplete(b,d)},fileComplete:function(b,c){var e=!0;switch(b.type){case "packfile":var d=JSON.parse(c.responseText);b.data=d||{};break;case "image":this.game.cache.addImage(b.key,b.url,b.data);break;case "spritesheet":this.game.cache.addSpriteSheet(b.key,
b.url,b.data,b.frameWidth,b.frameHeight,b.frameMax,b.margin,b.spacing);break;case "textureatlas":if(null==b.atlasURL)this.game.cache.addTextureAtlas(b.key,b.url,b.data,b.atlasData,b.format);else if(e=!1,b.format==a.Loader.TEXTURE_ATLAS_JSON_ARRAY||b.format==a.Loader.TEXTURE_ATLAS_JSON_HASH)this.xhrLoad(b,this.transformUrl(b.atlasURL,b),"text",this.jsonLoadComplete);else{if(b.format!=a.Loader.TEXTURE_ATLAS_XML_STARLING)throw Error("Phaser.Loader. Invalid Texture Atlas format: "+b.format);this.xhrLoad(b,
this.transformUrl(b.atlasURL,b),"text",this.xmlLoadComplete)}break;case "bitmapfont":b.xmlURL?(e=!1,this.xhrLoad(b,this.transformUrl(b.xmlURL,b),"text",this.xmlLoadComplete)):this.game.cache.addBitmapFont(b.key,b.url,b.data,b.xmlData,b.xSpacing,b.ySpacing);break;case "audio":this.game.sound.usingWebAudio?(b.data=c.response,this.game.cache.addSound(b.key,b.url,b.data,!0,!1),b.autoDecode&&this.game.sound.decode(b.key)):this.game.cache.addSound(b.key,b.url,b.data,!1,!0);break;case "text":b.data=c.responseText;
this.game.cache.addText(b.key,b.url,b.data);break;case "physics":d=JSON.parse(c.responseText);this.game.cache.addPhysicsData(b.key,b.url,d,b.format);break;case "script":b.data=document.createElement("script");b.data.language="javascript";b.data.type="text/javascript";b.data.defer=!1;b.data.text=c.responseText;document.head.appendChild(b.data);b.callback&&(b.data=b.callback.call(b.callbackContext,b.key,c.responseText));break;case "binary":b.data=b.callback?b.callback.call(b.callbackContext,b.key,c.response):
c.response,this.game.cache.addBinary(b.key,b.data)}e&&this.asyncComplete(b)},jsonLoadComplete:function(b,a){var e=JSON.parse(a.responseText);"tilemap"===b.type?this.game.cache.addTilemap(b.key,b.url,e,b.format):"json"===b.type?this.game.cache.addJSON(b.key,b.url,e):this.game.cache.addTextureAtlas(b.key,b.url,b.data,e,b.format);this.asyncComplete(b)},csvLoadComplete:function(b,a){this.game.cache.addTilemap(b.key,b.url,a.responseText,b.format);this.asyncComplete(b)},xmlLoadComplete:function(b,a){var e=
this.parseXml(a.responseText);if(!e)return console.warn("Phaser.Loader - "+b.key+": invalid XML ("+(a.responseType||a.contentType)+")"),void this.asyncComplete(b,"invalid XML");"bitmapfont"===b.type?this.game.cache.addBitmapFont(b.key,b.url,b.data,e,b.xSpacing,b.ySpacing):"textureatlas"===b.type?this.game.cache.addTextureAtlas(b.key,b.url,b.data,e,b.format):"xml"===b.type&&this.game.cache.addXML(b.key,b.url,e);this.asyncComplete(b)},parseXml:function(b){var a;try{window.DOMParser?a=(new DOMParser).parseFromString(b,
"text/xml"):(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(b))}catch(e){a=null}return a&&a.documentElement&&!a.getElementsByTagName("parsererror").length?a:null},updateProgress:function(){this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=
null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(a.Loader.prototype,"progressFloat",{get:function(){return a.Math.clamp(this._loadedFileCount/this._totalFileCount*100||0,0,100)}});Object.defineProperty(a.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});
a.Loader.prototype.constructor=a.Loader;a.LoaderParser={bitmapFont:function(b,a,e,d,f){b={};var k=a.getElementsByTagName("info")[0],n=a.getElementsByTagName("common")[0];b.font=k.getAttribute("face");b.size=parseInt(k.getAttribute("size"),10);b.lineHeight=parseInt(n.getAttribute("lineHeight"),10)+f;b.chars={};k=a.getElementsByTagName("char");for(f=0;f<k.length;f++){var n=parseInt(k[f].getAttribute("id"),10),g=new PIXI.Rectangle(parseInt(k[f].getAttribute("x"),10),parseInt(k[f].getAttribute("y"),10),
parseInt(k[f].getAttribute("width"),10),parseInt(k[f].getAttribute("height"),10));b.chars[n]={xOffset:parseInt(k[f].getAttribute("xoffset"),10),yOffset:parseInt(k[f].getAttribute("yoffset"),10),xAdvance:parseInt(k[f].getAttribute("xadvance"),10)+d,kerning:{},texture:PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e],g)}}a=a.getElementsByTagName("kerning");for(f=0;f<a.length;f++)d=parseInt(a[f].getAttribute("first"),10),k=parseInt(a[f].getAttribute("second"),10),n=parseInt(a[f].getAttribute("amount"),
10),b.chars[k].kerning[d]=n;PIXI.BitmapText.fonts[e]=b}};a.AudioSprite=function(b,a){this.game=b;this.key=a;this.config=this.game.cache.getJSON(a+"-audioatlas");this.autoplayKey=null;this.autoplay=!1;this.sounds={};for(var e in this.config.spritemap){var d=this.config.spritemap[e],f=this.game.add.sound(this.key);f.addMarker(e,d.start,d.end-d.start,null,d.loop);this.sounds[e]=f}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])};
a.AudioSprite.prototype={play:function(b,a){return"undefined"==typeof a&&(a=1),this.sounds[b].play(b,null,a)},stop:function(b){if(b)this.sounds[b].stop();else for(var a in this.sounds)this.sounds[a].stop()},get:function(b){return this.sounds[b]}};a.AudioSprite.prototype.constructor=a.AudioSprite;a.Sound=function(b,c,e,d,f){"undefined"==typeof e&&(e=1);"undefined"==typeof d&&(d=!1);"undefined"==typeof f&&(f=b.sound.connectToMaster);this.game=b;this.key=this.name=c;this.loop=d;this.volume=e;this.markers=
{};this.context=null;this.autoplay=!1;this.stopTime=this.position=this.durationMS=this.duration=this.currentTime=this.startTime=this.totalDuration=0;this.paused=!1;this.pausedTime=this.pausedPosition=0;this.isPlaying=!1;this.currentMarker="";this.fadeTween=null;this.allowMultiple=this.override=this.pendingPlayback=!1;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this._sound=this.gainNode=this.masterGainNode=this.externalNode=null;this.usingWebAudio?
(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=e*this.game.sound.volume,f&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(c)&&this.game.cache.isSoundReady(c)?(this._sound=this.game.cache.getSoundData(c),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):
this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this));this.onDecoded=new a.Signal;this.onPlay=new a.Signal;this.onPause=new a.Signal;this.onResume=new a.Signal;this.onLoop=new a.Signal;this.onStop=new a.Signal;this.onMute=new a.Signal;this.onMarkerComplete=new a.Signal;this.onFadeComplete=new a.Signal;this._volume=e;this._buffer=null;this._muted=!1;this._tempLoop=this._muteVolume=this._tempVolume=this._tempPosition=this._tempMarker=0;this._onDecodedEventDispatched=this._paused=!1};a.Sound.prototype=
{soundHasUnlocked:function(b){b===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(b,a,e,d,f){"undefined"==typeof d&&(d=1);"undefined"==typeof f&&(f=!1);this.markers[b]={name:b,start:a,stop:a+e,volume:d,duration:e,durationMS:1E3*e,loop:f}},removeMarker:function(b){delete this.markers[b]},onEndedHandler:function(){this.isPlaying=!1;this.stop()},update:function(){this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),
this._onDecodedEventDispatched=!0);this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop));this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.time):(this.onMarkerComplete.dispatch(this.currentMarker,this),
this.play(this.currentMarker,0,this.volume,!0,!0))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},loopFull:function(b){this.play(null,0,b,!0)},play:function(b,a,e,d,f){if(("undefined"==typeof b||!1===b||null===b)&&(b=""),"undefined"==typeof f&&(f=!0),this.isPlaying&&!this.allowMultiple&&!f&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||f))if(this.usingWebAudio)if("undefined"==
typeof this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(k){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(""===b&&0<Object.keys(this.markers).length)return this;if(""!==b){if(this.currentMarker=b,!this.markers[b])return this;this.position=this.markers[b].start;this.volume=this.markers[b].volume;this.loop=this.markers[b].loop;this.duration=this.markers[b].duration;this.durationMS=this.markers[b].durationMS;"undefined"!=typeof e&&(this.volume=
e);"undefined"!=typeof d&&(this.loop=d);this._tempMarker=b;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else a=a||0,"undefined"==typeof e&&(e=this._volume),"undefined"==typeof d&&(d=this.loop),this.position=a,this.volume=e,this.loop=d,this.durationMS=this.duration=0,this._tempMarker=b,this._tempPosition=a,this._tempVolume=e,this._tempLoop=d;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(null===this._buffer&&(this._buffer=this.game.cache.getSoundData(this.key)),
this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&""===b&&(this._sound.loop=!0),this.loop||""!==b||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1E3*this.totalDuration)),"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):
this.loop&&""===b?this._sound.start(0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),
this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1E3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):
this.pendingPlayback=!0,this},restart:function(b,a,e,d){"undefined"==typeof d&&(d=!1);this.play(b||"",a||0,e||1,d,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var b=this.position+this.pausedPosition/1E3;this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;this._sound.connect(this.externalNode?
this.externalNode:this.gainNode);this.loop&&(this._sound.loop=!0);this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var a=this.duration-this.pausedPosition/1E3;"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,b,a):this._sound.start(0,b,a)}else this._sound.play();this.isPlaying=!0;this.paused=!1;this.startTime+=this.game.time.time-this.pausedTime;this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio)if("undefined"==
typeof this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(b){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=this.pendingPlayback=!1;var a=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this);this.currentMarker="";null!==this.fadeTween&&this.fadeTween.stop();this.paused||this.onStop.dispatch(this,a)},fadeIn:function(b,a,e){"undefined"==typeof a&&(a=!1);"undefined"==typeof e&&(e=this.currentMarker);
this.paused||(this.play(e,0,0,a),this.fadeTo(b,1))},fadeOut:function(b){this.fadeTo(b,0)},fadeTo:function(b,c){if(this.isPlaying&&!this.paused&&c!==this.volume){if("undefined"==typeof b&&(b=1E3),"undefined"==typeof c)return void console.warn("Phaser.Sound.fadeTo: No Volume Specified.");this.fadeTween=this.game.add.tween(this).to({volume:c},b,a.Easing.Linear.None,!0);this.fadeTween.onComplete.add(this.fadeComplete,this)}},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);0===this.volume&&
this.stop()},destroy:function(b){"undefined"==typeof b&&(b=!0);this.stop();b?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}};a.Sound.prototype.constructor=a.Sound;Object.defineProperty(a.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});
Object.defineProperty(a.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(a.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(b){b?(this._muted=!0,this.usingWebAudio?(this._muteVolume=this.gainNode.gain.value,this.gainNode.gain.value=0):this.usingAudioTag&&this._sound&&(this._muteVolume=this._sound.volume,this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=
this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume));this.onMute.dispatch(this)}});Object.defineProperty(a.Sound.prototype,"volume",{get:function(){return this._volume},set:function(b){this.usingWebAudio?(this._volume=b,this.gainNode.gain.value=b):this.usingAudioTag&&this._sound&&0<=b&&1>=b&&(this._volume=b,this._sound.volume=b)}});a.SoundManager=function(b){this.game=b;this.onSoundDecode=new a.Signal;this._muted=this._codeMuted=!1;this._unlockSource=null;this._volume=
1;this._sounds=[];this._watchList=new a.ArraySet;this._watching=!1;this.context=this._watchContext=this._watchCallback=null;this.usingWebAudio=!0;this.noAudio=this.usingAudioTag=!1;this.connectToMaster=!0;this.touchLocked=!1;this.channels=32};a.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&!1===this.game.device.webAudio&&(this.channels=1),!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(this.game.input.touch.callbackContext=
this,this.game.input.touch.touchStartCallback=this.unlock,this.game.input.mouse.callbackContext=this,this.game.input.mouse.mouseDownCallback=this.unlock,this.touchLocked=!0):this.touchLocked=!1,window.PhaserGlobal){if(!0===window.PhaserGlobal.disableAudio)return this.usingWebAudio=!1,void(this.noAudio=!0);if(!0===window.PhaserGlobal.disableWebAudio)return this.usingWebAudio=!1,this.usingAudioTag=!0,void(this.noAudio=!1)}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;
else if(window.AudioContext)try{this.context=new window.AudioContext}catch(b){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(a){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}window.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1);null!==this.context&&(this.masterGain="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),
this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},unlock:function(){if(!1!==this.touchLocked)if(!1===this.game.device.webAudio||window.PhaserGlobal&&!0===window.PhaserGlobal.disableWebAudio)this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null,this.game.input.mouse.callbackContext=null,this.game.input.mouse.mouseDownCallback=null;else{var b=this.context.createBuffer(1,1,22050);this._unlockSource=
this.context.createBufferSource();this._unlockSource.buffer=b;this._unlockSource.connect(this.context.destination);"undefined"==typeof this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0)}},stopAll:function(){for(var b=0;b<this._sounds.length;b++)this._sounds[b]&&this._sounds[b].stop()},pauseAll:function(){for(var b=0;b<this._sounds.length;b++)this._sounds[b]&&this._sounds[b].pause()},resumeAll:function(){for(var b=0;b<this._sounds.length;b++)this._sounds[b]&&this._sounds[b].resume()},
decode:function(b,a){a=a||null;var e=this.game.cache.getSoundData(b);if(e&&!1===this.game.cache.isSoundDecoded(b)){this.game.cache.updateSound(b,"isDecoding",!0);var d=this;this.context.decodeAudioData(e,function(e){e&&(d.game.cache.decodedSound(b,e),d.onSoundDecode.dispatch(b,a))})}},setDecodedCallback:function(b,c,e){"string"==typeof b&&(b=[b]);this._watchList.reset();for(var d=0;d<b.length;d++)b[d]instanceof a.Sound?this.game.cache.isSoundDecoded(b[d].key)||this._watchList.add(b[d].key):this.game.cache.isSoundDecoded(b[d])||
this._watchList.add(b[d]);0===this._watchList.total?(this._watching=!1,c.call(e)):(this._watching=!0,this._watchCallback=c,this._watchContext=e)},update:function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=
null);for(var b=0;b<this._sounds.length;b++)this._sounds[b].update();if(this._watching){for(b=this._watchList.first;b;)this.game.cache.isSoundDecoded(b)&&this._watchList.remove(b),b=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}},add:function(b,c,e,d){"undefined"==typeof c&&(c=1);"undefined"==typeof e&&(e=!1);"undefined"==typeof d&&(d=this.connectToMaster);b=new a.Sound(this.game,b,c,e,d);return this._sounds.push(b),b},addSprite:function(b){return new a.AudioSprite(this.game,
b)},remove:function(b){for(var a=this._sounds.length;a--;)if(this._sounds[a]===b)return this._sounds[a].destroy(!1),this._sounds.splice(a,1),!0;return!1},removeByKey:function(b){for(var a=this._sounds.length,e=0;a--;)this._sounds[a].key===b&&(this._sounds[a].destroy(!1),this._sounds.splice(a,1),e++);return e},play:function(b,a,e){b=this.add(b,a,e);return b.play(),b},setMute:function(){if(!this._muted){this._muted=!0;this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=
0);for(var b=0;b<this._sounds.length;b++)this._sounds[b].usingAudioTag&&(this._sounds[b].mute=!0)}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1;this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var b=0;b<this._sounds.length;b++)this._sounds[b].usingAudioTag&&(this._sounds[b].mute=!1)}},destroy:function(){this.stopAll();for(var b=0;b<this._sounds.length;b++)this._sounds[b]&&this._sounds[b].destroy();this._sounds=[];this.onSoundDecode.dispose();this.context&&
window.PhaserGlobal&&(window.PhaserGlobal.audioContext=this.context)}};a.SoundManager.prototype.constructor=a.SoundManager;Object.defineProperty(a.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(b){b?this._muted||(this._codeMuted=!0,this.setMute()):this._muted&&(this._codeMuted=!1,this.unsetMute())}});Object.defineProperty(a.SoundManager.prototype,"volume",{get:function(){return this.usingWebAudio?this.masterGain.gain.value:this._volume},set:function(b){if(this._volume=
b,this.usingWebAudio)this.masterGain.gain.value=b;else for(var a=0;a<this._sounds.length;a++)this._sounds[a].usingAudioTag&&(this._sounds[a].volume*=b)}});a.Utils.Debug=function(b){this.game=b;this.context=this.canvas=this.bmd=this.sprite=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=!0;this.currentY=this.currentX=0;this.currentAlpha=1;this.dirty=!1};a.Utils.Debug.prototype={boot:function(){this.game.renderType===a.CANVAS?this.context=this.game.context:(this.bmd=
this.game.make.bitmapData(this.game.width,this.game.height),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.canvas=a.Canvas.create(this.game.width,this.game.height,"",!0),this.context=this.canvas.getContext("2d"))},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,
this.game.height);this.sprite&&this.bmd.clear()},start:function(b,a,e,d){"number"!=typeof b&&(b=0);"number"!=typeof a&&(a=0);e=e||"rgb(255,255,255)";"undefined"==typeof d&&(d=0);this.currentX=b;this.currentY=a;this.currentColor=e;this.currentAlpha=this.context.globalAlpha;this.columnWidth=d;this.dirty=!0;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=e;this.context.fillStyle=e;this.context.font=this.font;this.context.globalAlpha=1},stop:function(){this.context.restore();
this.context.globalAlpha=this.currentAlpha},line:function(){for(var b=this.currentX,a=0;a<arguments.length;a++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[a],b+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[a],b,this.currentY),b+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(b,a,e,d){this.start(a,e,d);this.line("Sound: "+b.key+" Locked: "+b.game.sound.touchLocked);this.line("Is Ready?: "+
this.game.cache.isSoundReady(b.key)+" Pending Playback: "+b.pendingPlayback);this.line("Decoded: "+b.isDecoded+" Decoding: "+b.isDecoding);this.line("Total Duration: "+b.totalDuration+" Playing: "+b.isPlaying);this.line("Time: "+b.currentTime);this.line("Volume: "+b.volume+" Muted: "+b.mute);this.line("WebAudio: "+b.usingWebAudio+" Audio: "+b.usingAudioTag);""!==b.currentMarker&&(this.line("Marker: "+b.currentMarker+" Duration: "+b.duration+" (ms: "+b.durationMS+")"),this.line("Start: "+b.markers[b.currentMarker].start+
" Stop: "+b.markers[b.currentMarker].stop),this.line("Position: "+b.position));this.stop()},cameraInfo:function(b,a,e,d){this.start(a,e,d);this.line("Camera ("+b.width+" x "+b.height+")");this.line("X: "+b.x+" Y: "+b.y);b.bounds&&this.line("Bounds x: "+b.bounds.x+" Y: "+b.bounds.y+" w: "+b.bounds.width+" h: "+b.bounds.height);this.line("View x: "+b.view.x+" Y: "+b.view.y+" w: "+b.view.width+" h: "+b.view.height);this.line("Total in view: "+b.totalInView);this.stop()},timer:function(b,a,e,d){this.start(a,
e,d);this.line("Timer (running: "+b.running+" expired: "+b.expired+")");this.line("Next Tick: "+b.next+" Duration: "+b.duration);this.line("Paused: "+b.paused+" Length: "+b.length);this.stop()},pointer:function(b,a,e,d,f){null==b||("undefined"==typeof a&&(a=!1),e=e||"rgba(0,255,0,0.5)",d=d||"rgba(255,0,0,0.5)",!0===a&&!0===b.isUp||(this.start(b.x,b.y-100,f),this.context.beginPath(),this.context.arc(b.x,b.y,b.circle.radius,0,2*Math.PI),this.context.fillStyle=b.active?e:d,this.context.fill(),this.context.closePath(),
this.context.beginPath(),this.context.moveTo(b.positionDown.x,b.positionDown.y),this.context.lineTo(b.position.x,b.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+b.id+" Active: "+b.active),this.line("World X: "+b.worldX+" World Y: "+b.worldY),this.line("Screen X: "+b.x+" Screen Y: "+b.y),this.line("Duration: "+b.duration+" ms"),this.line("is Down: "+b.isDown+" is Up: "+b.isUp),this.stop()))},spriteInputInfo:function(b,a,e,d){this.start(a,e,d);
this.line("Sprite Input: ("+b.width+" x "+b.height+")");this.line("x: "+b.input.pointerX().toFixed(1)+" y: "+b.input.pointerY().toFixed(1));this.line("over: "+b.input.pointerOver()+" duration: "+b.input.overDuration().toFixed(0));this.line("down: "+b.input.pointerDown()+" duration: "+b.input.downDuration().toFixed(0));this.line("just over: "+b.input.justOver()+" just out: "+b.input.justOut());this.stop()},key:function(b,a,e,d){this.start(a,e,d,150);this.line("Key:",b.keyCode,"isDown:",b.isDown);this.line("justDown:",
b.justDown,"justUp:",b.justUp);this.line("Time Down:",b.timeDown.toFixed(0),"duration:",b.duration.toFixed(0));this.stop()},inputInfo:function(b,a,e){this.start(b,a,e);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+
this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(b,a,e){b=b.getBounds();b.x+=this.game.camera.x;b.y+=this.game.camera.y;this.rectangle(b,a,e)},ropeSegments:function(b,a,e){b.segments.forEach(function(b){this.rectangle(b,a,e)},this)},spriteInfo:function(b,a,e,d){this.start(a,e,d);this.line("Sprite:  ("+b.width+" x "+b.height+") anchor: "+b.anchor.x+" x "+b.anchor.y);this.line("x: "+b.x.toFixed(1)+" y: "+b.y.toFixed(1));this.line("angle: "+b.angle.toFixed(1)+" rotation: "+b.rotation.toFixed(1));
this.line("visible: "+b.visible+" in camera: "+b.inCamera);this.line("bounds x: "+b._bounds.x.toFixed(1)+" y: "+b._bounds.y.toFixed(1)+" w: "+b._bounds.width.toFixed(1)+" h: "+b._bounds.height.toFixed(1));this.stop()},spriteCoords:function(b,a,e,d){this.start(a,e,d,100);b.name&&this.line(b.name);this.line("x:",b.x.toFixed(2),"y:",b.y.toFixed(2));this.line("pos x:",b.position.x.toFixed(2),"pos y:",b.position.y.toFixed(2));this.line("world x:",b.world.x.toFixed(2),"world y:",b.world.y.toFixed(2));this.stop()},
lineInfo:function(b,a,e,d){this.start(a,e,d,80);this.line("start.x:",b.start.x.toFixed(2),"start.y:",b.start.y.toFixed(2));this.line("end.x:",b.end.x.toFixed(2),"end.y:",b.end.y.toFixed(2));this.line("length:",b.length.toFixed(2),"angle:",b.angle);this.stop()},pixel:function(b,a,e,d){d=d||2;this.start();this.context.fillStyle=e;this.context.fillRect(b,a,d,d);this.stop()},geom:function(b,c,e,d){"undefined"==typeof e&&(e=!0);"undefined"==typeof d&&(d=0);c=c||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=
c;this.context.strokeStyle=c;b instanceof a.Rectangle||1===d?e?this.context.fillRect(b.x-this.game.camera.x,b.y-this.game.camera.y,b.width,b.height):this.context.strokeRect(b.x-this.game.camera.x,b.y-this.game.camera.y,b.width,b.height):b instanceof a.Circle||2===d?(this.context.beginPath(),this.context.arc(b.x-this.game.camera.x,b.y-this.game.camera.y,b.radius,0,2*Math.PI,!1),this.context.closePath(),e?this.context.fill():this.context.stroke()):b instanceof a.Point||3===d?this.context.fillRect(b.x-
this.game.camera.x,b.y-this.game.camera.y,4,4):(b instanceof a.Line||4===d)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(b.start.x+.5-this.game.camera.x,b.start.y+.5-this.game.camera.y),this.context.lineTo(b.end.x+.5-this.game.camera.x,b.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke());this.stop()},rectangle:function(b,a,e){"undefined"==typeof e&&(e=!0);a=a||"rgba(0, 255, 0, 0.4)";this.start();e?(this.context.fillStyle=a,this.context.fillRect(b.x-
this.game.camera.x,b.y-this.game.camera.y,b.width,b.height)):(this.context.strokeStyle=a,this.context.strokeRect(b.x-this.game.camera.x,b.y-this.game.camera.y,b.width,b.height));this.stop()},text:function(b,a,e,d,f){d=d||"rgb(255,255,255)";f=f||"16px Courier";this.start();this.context.font=f;this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(b,a+1,e+1));this.context.fillStyle=d;this.context.fillText(b,a,e);this.stop()},quadTree:function(b,a){a=a||"rgba(255,0,0,0.3)";this.start();
var e=b.bounds;if(0===b.nodes.length)for(this.context.strokeStyle=a,this.context.strokeRect(e.x,e.y,e.width,e.height),this.text("size: "+b.objects.length,e.x+4,e.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)",e=0;e<b.objects.length;e++)this.context.strokeRect(b.objects[e].x,b.objects[e].y,b.objects[e].width,b.objects[e].height);else for(e=0;e<b.nodes.length;e++)this.quadTree(b.nodes[e]);this.stop()},body:function(b,c,e){b.body&&(this.start(),b.body.type===a.Physics.ARCADE?
a.Physics.Arcade.Body.render(this.context,b.body,c,e):b.body.type===a.Physics.NINJA?a.Physics.Ninja.Body.render(this.context,b.body,c,e):b.body.type===a.Physics.BOX2D&&a.Physics.Box2D.renderBody(this.context,b.body,c),this.stop())},bodyInfo:function(b,c,e,d){b.body&&(this.start(c,e,d,210),b.body.type===a.Physics.ARCADE?a.Physics.Arcade.Body.renderBodyInfo(this,b.body):b.body.type===a.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,b.body),this.stop())},box2dWorld:function(){this.start();
this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(b,c){this.start();a.Physics.Box2D.renderBody(this.context,b,c);this.stop()}};a.Utils.Debug.prototype.constructor=a.Utils.Debug;a.ArraySet=function(b){this.position=0;this.list=b||[]};a.ArraySet.prototype={add:function(b){return this.exists(b)||this.list.push(b),b},getIndex:function(b){return this.list.indexOf(b)},getByKey:function(b,a){for(var e=
this.list.length;e--;)if(this.list[e][b]===a)return this.list[e];return null},exists:function(b){return-1<this.list.indexOf(b)},reset:function(){this.list.length=0},remove:function(b){var a=this.list.indexOf(b);return-1<a?(this.list.splice(a,1),b):void 0},setAll:function(b,a){for(var e=this.list.length;e--;)this.list[e]&&(this.list[e][b]=a)},callAll:function(b){for(var a=Array.prototype.splice.call(arguments,1),e=this.list.length;e--;)this.list[e]&&this.list[e][b]&&this.list[e][b].apply(this.list[e],
a)},removeAll:function(b){"undefined"==typeof b&&(b=!1);for(var a=this.list.length;a--;)if(this.list[a]){var e=this.remove(this.list[a]);b&&e.destroy()}this.position=0;this.list=[]}};Object.defineProperty(a.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(a.ArraySet.prototype,"first",{get:function(){return this.position=0,0<this.list.length?this.list[0]:null}});Object.defineProperty(a.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?
(this.position++,this.list[this.position]):null}});a.ArraySet.prototype.constructor=a.ArraySet;a.ArrayList=a.ArraySet;a.ArrayUtils={getRandomItem:function(b,a,e){if(null==b)return null;"undefined"==typeof a&&(a=0);"undefined"==typeof e&&(e=b.length);a+=Math.floor(Math.random()*e);return void 0===b[a]?null:b[a]},removeRandomItem:function(b,a,e){if(null==b)return null;"undefined"==typeof a&&(a=0);"undefined"==typeof e&&(e=b.length);a+=Math.floor(Math.random()*e);return a<b.length?(b=b.splice(a,1),void 0===
b[0]?null:b[0]):null},shuffle:function(b){for(var a=b.length-1;0<a;a--){var e=Math.floor(Math.random()*(a+1)),d=b[a];b[a]=b[e];b[e]=d}return b},transposeMatrix:function(b){for(var a=b.length,e=b[0].length,d=Array(e),f=0;e>f;f++){d[f]=Array(a);for(var k=a-1;-1<k;k--)d[f][k]=b[k][f]}return d},rotateMatrix:function(b,c){if("string"!=typeof c&&(c=(c%360+360)%360),90===c||-270===c||"rotateLeft"===c)b=a.ArrayUtils.transposeMatrix(b),b=b.reverse();else if(-90===c||270===c||"rotateRight"===c)b=b.reverse(),
b=a.ArrayUtils.transposeMatrix(b);else if(180===Math.abs(c)||"rotate180"===c){for(var e=0;e<b.length;e++)b[e].reverse();b=b.reverse()}return b},findClosest:function(b,a){if(!a.length)return 0/0;if(1===a.length||b<a[0])return a[0];for(var e=1;a[e]<b;)e++;var d=a[e-1],e=e<a.length?a[e]:Number.POSITIVE_INFINITY;return b-d>=e-b?e:d},rotate:function(b){var a=b.shift();return b.push(a),a},numberArray:function(b,a){for(var e=[],d=b;a>=d;d++)e.push(d);return e},numberArrayStep:function(b,c,e){b=+b||0;var d=
typeof c;"number"!==d&&"string"!==d||!e||e[c]!==b||(c=e=null);e=null==e?1:+e||0;null===c?(c=b,b=0):c=+c||0;d=-1;c=Math.max(a.Math.roundAwayFromZero((c-b)/(e||1)),0);for(var f=Array(c);++d<c;)f[d]=b,b+=e;return f}};a.Color={packPixel:function(b,c,e,d){return a.Device.LITTLE_ENDIAN?(d<<24|e<<16|c<<8|b)>>>0:(b<<24|c<<16|e<<8|d)>>>0},unpackPixel:function(b,c,e,d){return("undefined"==typeof c||null===c)&&(c=a.Color.createColor()),("undefined"==typeof e||null===e)&&(e=!1),("undefined"==typeof d||null===
d)&&(d=!1),a.Device.LITTLE_ENDIAN?(c.a=(4278190080&b)>>>24,c.b=(16711680&b)>>>16,c.g=(65280&b)>>>8,c.r=255&b):(c.r=(4278190080&b)>>>24,c.g=(16711680&b)>>>16,c.b=(65280&b)>>>8,c.a=255&b),c.color=b,c.rgba="rgba("+c.r+","+c.g+","+c.b+","+c.a/255+")",e&&a.Color.RGBtoHSL(c.r,c.g,c.b,c),d&&a.Color.RGBtoHSV(c.r,c.g,c.b,c),c},fromRGBA:function(b,c){return c||(c=a.Color.createColor()),c.r=(4278190080&b)>>>24,c.g=(16711680&b)>>>16,c.b=(65280&b)>>>8,c.a=255&b,c.rgba="rgba("+c.r+","+c.g+","+c.b+","+c.a+")",c},
toRGBA:function(b,a,e,d){return b<<24|a<<16|e<<8|d},RGBtoHSL:function(b,c,e,d){d||(d=a.Color.createColor(b,c,e,1));b/=255;c/=255;e/=255;var f=Math.min(b,c,e),k=Math.max(b,c,e);if(d.h=0,d.s=0,d.l=(k+f)/2,k!==f){var n=k-f;d.s=.5<d.l?n/(2-k-f):n/(k+f);k===b?d.h=(c-e)/n+(e>c?6:0):k===c?d.h=(e-b)/n+2:k===e&&(d.h=(b-c)/n+4);d.h/=6}return d},HSLtoRGB:function(b,c,e,d){if(d?(d.r=e,d.g=e,d.b=e):d=a.Color.createColor(e,e,e),0!==c)c=.5>e?e*(1+c):e+c-e*c,e=2*e-c,d.r=a.Color.hueToColor(e,c,b+1/3),d.g=a.Color.hueToColor(e,
c,b),d.b=a.Color.hueToColor(e,c,b-1/3);return d.r=Math.floor(255*d.r|0),d.g=Math.floor(255*d.g|0),d.b=Math.floor(255*d.b|0),a.Color.updateColor(d),d},RGBtoHSV:function(b,c,e,d){d||(d=a.Color.createColor(b,c,e,255));b/=255;c/=255;e/=255;var f=Math.min(b,c,e),k=Math.max(b,c,e),n=k-f;return d.h=0,d.s=0===k?0:n/k,d.v=k,k!==f&&(k===b?d.h=(c-e)/n+(e>c?6:0):k===c?d.h=(e-b)/n+2:k===e&&(d.h=(b-c)/n+4),d.h/=6),d},HSVtoRGB:function(b,c,e,d){"undefined"==typeof d&&(d=a.Color.createColor(0,0,0,1,b,c,0,e));var f,
k,n,g=Math.floor(6*b),h=6*b-g;b=e*(1-c);var l=e*(1-h*c);c=e*(1-(1-h)*c);switch(g%6){case 0:f=e;k=c;n=b;break;case 1:f=l;k=e;n=b;break;case 2:f=b;k=e;n=c;break;case 3:f=b;k=l;n=e;break;case 4:f=c;k=b;n=e;break;case 5:f=e,k=b,n=l}return d.r=Math.floor(255*f),d.g=Math.floor(255*k),d.b=Math.floor(255*n),a.Color.updateColor(d),d},hueToColor:function(b,a,e){return 0>e&&(e+=1),1<e&&--e,1/6>e?b+6*(a-b)*e:.5>e?a:2/3>e?b+(a-b)*(2/3-e)*6:b},createColor:function(b,c,e,d,f,k,n,g){b={r:b||0,g:c||0,b:e||0,a:d||
1,h:f||0,s:k||0,l:n||0,v:g||0,color:0,color32:0,rgba:""};return b.color=a.Color.getColor(b.r,b.g,b.b),b.color32=a.Color.getColor32(b.a,b.r,b.g,b.b),a.Color.updateColor(b)},updateColor:function(b){return b.rgba="rgba("+b.r.toString()+","+b.g.toString()+","+b.b.toString()+","+b.a.toString()+")",b},getColor32:function(b,a,e,d){return b<<24|a<<16|e<<8|d},getColor:function(b,a,e){return b<<16|a<<8|e},RGBtoString:function(b,c,e,d,f){return"undefined"==typeof d&&(d=255),"undefined"==typeof f&&(f="#"),"#"===
f?"#"+(16777216+(b<<16)+(c<<8)+e).toString(16).slice(1):"0x"+a.Color.componentToHex(d)+a.Color.componentToHex(b)+a.Color.componentToHex(c)+a.Color.componentToHex(e)},hexToRGB:function(b){return(b=a.Color.hexToColor(b))?a.Color.getColor32(b.a,b.r,b.g,b.b):void 0},hexToColor:function(b,c){b=b.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(b,a,c,d){return a+a+c+c+d+d});var e=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);if(e){var d=parseInt(e[1],16),f=parseInt(e[2],16),e=parseInt(e[3],
16);c?(c.r=d,c.g=f,c.b=e):c=a.Color.createColor(d,f,e)}return c},webToColor:function(b,c){c||(c=a.Color.createColor());var e=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(b);return e&&(c.r=parseInt(e[1],10),c.g=parseInt(e[2],10),c.b=parseInt(e[3],10),c.a=void 0!==e[4]?parseFloat(e[4]):1),c},valueToColor:function(b,c){if(c||(c=a.Color.createColor()),"string"==typeof b)return 0===b.indexOf("rgb")?a.Color.webToColor(b,c):(c.a=1,a.Color.hexToColor(b,c));if("number"==
typeof b){var e=a.Color.getRGB(b);return c.r=e.r,c.g=e.g,c.b=e.b,c.a=e.a/255,c}return c},componentToHex:function(b){b=b.toString(16);return 1==b.length?"0"+b:b},HSVColorWheel:function(b,c){"undefined"==typeof b&&(b=1);"undefined"==typeof c&&(c=1);for(var e=[],d=0;359>=d;d++)e.push(a.Color.HSVtoRGB(d/359,b,c));return e},HSLColorWheel:function(b,c){"undefined"==typeof b&&(b=.5);"undefined"==typeof c&&(c=.5);for(var e=[],d=0;359>=d;d++)e.push(a.Color.HSLtoRGB(d/359,b,c));return e},interpolateColor:function(b,
c,e,d,f){"undefined"==typeof f&&(f=255);b=a.Color.getRGB(b);c=a.Color.getRGB(c);return a.Color.getColor32(f,(c.red-b.red)*d/e+b.red,(c.green-b.green)*d/e+b.green,(c.blue-b.blue)*d/e+b.blue)},interpolateColorWithRGB:function(b,c,e,d,f,k){b=a.Color.getRGB(b);return a.Color.getColor((c-b.red)*k/f+b.red,(e-b.green)*k/f+b.green,(d-b.blue)*k/f+b.blue)},interpolateRGB:function(b,c,e,d,f,k,n,g){return a.Color.getColor((d-b)*g/n+b,(f-c)*g/n+c,(k-e)*g/n+e)},getRandomColor:function(b,c,e){if("undefined"==typeof b&&
(b=0),"undefined"==typeof c&&(c=255),"undefined"==typeof e&&(e=255),255<c||b>c)return a.Color.getColor(255,255,255);var d=b+Math.round(Math.random()*(c-b)),f=b+Math.round(Math.random()*(c-b));b+=Math.round(Math.random()*(c-b));return a.Color.getColor32(e,d,f,b)},getRGB:function(b){return 16777215<b?{alpha:b>>>24,red:b>>16&255,green:b>>8&255,blue:255&b,a:b>>>24,r:b>>16&255,g:b>>8&255,b:255&b}:{alpha:255,red:b>>16&255,green:b>>8&255,blue:255&b,a:255,r:b>>16&255,g:b>>8&255,b:255&b}},getWebRGB:function(b){if("object"==
typeof b)return"rgba("+b.r.toString()+","+b.g.toString()+","+b.b.toString()+","+(b.a/255).toString()+")";b=a.Color.getRGB(b);return"rgba("+b.r.toString()+","+b.g.toString()+","+b.b.toString()+","+(b.a/255).toString()+")"},getAlpha:function(b){return b>>>24},getAlphaFloat:function(b){return(b>>>24)/255},getRed:function(b){return b>>16&255},getGreen:function(b){return b>>8&255},getBlue:function(b){return 255&b}};a.LinkedList=function(){this.last=this.first=this.prev=this.next=null;this.total=0};a.LinkedList.prototype=
{add:function(b){return 0===this.total&&null===this.first&&null===this.last?(this.first=b,this.last=b,this.next=b,b.prev=this,this.total++,b):(this.last.next=b,b.prev=this.last,this.last=b,this.total++,b)},reset:function(){this.prev=this.next=this.last=this.first=null;this.total=0},remove:function(b){return 1===this.total?(this.reset(),void(b.next=b.prev=null)):(b===this.first?this.first=this.first.next:b===this.last&&(this.last=this.last.prev),b.prev&&(b.prev.next=b.next),b.next&&(b.next.prev=b.prev),
b.next=b.prev=null,null===this.first&&(this.last=null),void this.total--)},callAll:function(b){if(this.first&&this.last){var a=this.first;do a&&a[b]&&a[b].call(a),a=a.next;while(a!=this.last.next)}}};a.LinkedList.prototype.constructor=a.LinkedList;a.Physics=function(b,a){a=a||{};this.game=b;this.config=a;this.chipmunk=this.box2d=this.ninja=this.p2=this.arcade=null;this.parseConfig()};a.Physics.ARCADE=0;a.Physics.P2JS=1;a.Physics.NINJA=2;a.Physics.BOX2D=3;a.Physics.CHIPMUNK=4;a.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&
!0!==this.config.arcade||!a.Physics.hasOwnProperty("Arcade")||(this.arcade=new a.Physics.Arcade(this.game),this.game.time.deltaCap=.2);this.config.hasOwnProperty("ninja")&&!0===this.config.ninja&&a.Physics.hasOwnProperty("Ninja")&&(this.ninja=new a.Physics.Ninja(this.game));this.config.hasOwnProperty("p2")&&!0===this.config.p2&&a.Physics.hasOwnProperty("P2")&&(this.p2=new a.Physics.P2(this.game,this.config));this.config.hasOwnProperty("box2d")&&!0===this.config.box2d&&a.Physics.hasOwnProperty("BOX2D")&&
(this.box2d=new a.Physics.BOX2D(this.game,this.config))},startSystem:function(b){b===a.Physics.ARCADE?this.arcade=new a.Physics.Arcade(this.game):b===a.Physics.P2JS?null===this.p2?this.p2=new a.Physics.P2(this.game,this.config):this.p2.reset():b===a.Physics.NINJA?this.ninja=new a.Physics.Ninja(this.game):b===a.Physics.BOX2D&&(null===this.box2d?this.box2d=new a.Physics.Box2D(this.game,this.config):this.box2d.reset())},enable:function(b,c,e){"undefined"==typeof c&&(c=a.Physics.ARCADE);"undefined"==
typeof e&&(e=!1);c===a.Physics.ARCADE?this.arcade.enable(b):c===a.Physics.P2JS&&this.p2?this.p2.enable(b,e):c===a.Physics.NINJA&&this.ninja?this.ninja.enableAABB(b):c===a.Physics.BOX2D&&this.box2d&&this.box2d.enable(b)},preUpdate:function(){this.p2&&this.p2.preUpdate();this.box2d&&this.box2d.preUpdate()},update:function(){this.p2&&this.p2.update();this.box2d&&this.box2d.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld();this.ninja&&this.ninja.setBoundsToWorld();this.p2&&
this.p2.setBoundsToWorld();this.box2d&&this.box2d.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear();this.box2d&&this.box2d.clear()},reset:function(){this.p2&&this.p2.reset();this.box2d&&this.box2d.reset()},destroy:function(){this.p2&&this.p2.destroy();this.box2d&&this.box2d.destroy();this.box2d=this.p2=this.ninja=this.arcade=null}};a.Physics.prototype.constructor=a.Physics;a.Physics.Arcade=function(b){this.game=b;this.gravity=new a.Point;this.bounds=new a.Rectangle(0,0,b.world.width,b.world.height);
this.checkCollision={up:!0,down:!0,left:!0,right:!0};this.maxObjects=10;this.OVERLAP_BIAS=this.maxLevels=4;this.forceX=!1;this.sortDirection=a.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=!0;this.isPaused=!1;this.quadTree=new a.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};a.Physics.Arcade.prototype.constructor=a.Physics.Arcade;a.Physics.Arcade.SORT_NONE=0;
a.Physics.Arcade.LEFT_RIGHT=1;a.Physics.Arcade.RIGHT_LEFT=2;a.Physics.Arcade.TOP_BOTTOM=3;a.Physics.Arcade.BOTTOM_TOP=4;a.Physics.Arcade.prototype={setBounds:function(b,a,e,d){this.bounds.setTo(b,a,e,d)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(b,c){"undefined"==typeof c&&(c=!0);var e=1;if(Array.isArray(b))for(e=b.length;e--;)b[e]instanceof a.Group?this.enable(b[e].children,
c):(this.enableBody(b[e]),c&&b[e].hasOwnProperty("children")&&0<b[e].children.length&&this.enable(b[e],!0));else b instanceof a.Group?this.enable(b.children,c):(this.enableBody(b),c&&b.hasOwnProperty("children")&&0<b.children.length&&this.enable(b.children,!0))},enableBody:function(b){b.hasOwnProperty("body")&&null===b.body&&(b.body=new a.Physics.Arcade.Body(b))},updateMotion:function(b){var a=this.computeVelocity(0,b,b.angularVelocity,b.angularAcceleration,b.angularDrag,b.maxAngular)-b.angularVelocity;
b.angularVelocity+=a;b.rotation+=b.angularVelocity*this.game.time.physicsElapsed;b.velocity.x=this.computeVelocity(1,b,b.velocity.x,b.acceleration.x,b.drag.x,b.maxVelocity.x);b.velocity.y=this.computeVelocity(2,b,b.velocity.y,b.acceleration.y,b.drag.y,b.maxVelocity.y)},computeVelocity:function(b,a,e,d,f,k){return"undefined"==typeof k&&(k=1E4),1===b&&a.allowGravity?e+=(this.gravity.x+a.gravity.x)*this.game.time.physicsElapsed:2===b&&a.allowGravity&&(e+=(this.gravity.y+a.gravity.y)*this.game.time.physicsElapsed),
d?e+=d*this.game.time.physicsElapsed:f&&(f*=this.game.time.physicsElapsed,0<e-f?e-=f:0>e+f?e+=f:e=0),e>k?e=k:-k>e&&(e=-k),e},overlap:function(b,a,e,d,f){if(e=e||null,d=d||null,f=f||e,this._total=0,!Array.isArray(b)&&Array.isArray(a))for(var k=0;k<a.length;k++)this.collideHandler(b,a[k],e,d,f,!0);else if(Array.isArray(b)&&!Array.isArray(a))for(k=0;k<b.length;k++)this.collideHandler(b[k],a,e,d,f,!0);else if(Array.isArray(b)&&Array.isArray(a))for(k=0;k<b.length;k++)for(var n=0;n<a.length;n++)this.collideHandler(b[k],
a[n],e,d,f,!0);else this.collideHandler(b,a,e,d,f,!0);return 0<this._total},collide:function(b,a,e,d,f){if(e=e||null,d=d||null,f=f||e,this._total=0,!Array.isArray(b)&&Array.isArray(a))for(var k=0;k<a.length;k++)this.collideHandler(b,a[k],e,d,f,!1);else if(Array.isArray(b)&&!Array.isArray(a))for(k=0;k<b.length;k++)this.collideHandler(b[k],a,e,d,f,!1);else if(Array.isArray(b)&&Array.isArray(a))for(k=0;k<b.length;k++)for(var n=0;n<a.length;n++)this.collideHandler(b[k],a[n],e,d,f,!1);else this.collideHandler(b,
a,e,d,f,!1);return 0<this._total},sort:function(b){this.sortDirection===a.Physics.Arcade.LEFT_RIGHT?b._hash.sort(function(b,a){return b.body&&a.body?b.body.x-a.body.x:-1}):this.sortDirection===a.Physics.Arcade.RIGHT_LEFT?b._hash.sort(function(b,a){return b.body&&a.body?a.body.x-b.body.x:-1}):this.sortDirection===a.Physics.Arcade.TOP_BOTTOM?b._hash.sort(function(b,a){return b.body&&a.body?b.body.y-a.body.y:-1}):this.sortDirection===a.Physics.Arcade.BOTTOM_TOP&&b._hash.sort(function(b,a){return b.body&&
a.body?a.body.y-b.body.y:-1})},collideHandler:function(b,c,e,d,f,k){return"undefined"==typeof c&&b.physicsType===a.GROUP?(this.sort(b),void this.collideGroupVsSelf(b,e,d,f,k)):void(b&&c&&b.exists&&c.exists&&(this.sortDirection!==a.Physics.Arcade.SORT_NONE&&(b.physicsType===a.GROUP&&this.sort(b),c.physicsType===a.GROUP&&this.sort(c)),b.physicsType===a.SPRITE?c.physicsType===a.SPRITE?this.collideSpriteVsSprite(b,c,e,d,f,k):c.physicsType===a.GROUP?this.collideSpriteVsGroup(b,c,e,d,f,k):c.physicsType===
a.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(b,c,e,d,f):b.physicsType===a.GROUP?c.physicsType===a.SPRITE?this.collideSpriteVsGroup(c,b,e,d,f,k):c.physicsType===a.GROUP?this.collideGroupVsGroup(b,c,e,d,f,k):c.physicsType===a.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(b,c,e,d,f,k):b.physicsType===a.TILEMAPLAYER&&(c.physicsType===a.SPRITE?this.collideSpriteVsTilemapLayer(c,b,e,d,f,k):c.physicsType===a.GROUP&&this.collideGroupVsTilemapLayer(c,b,e,d,f,k))))},collideSpriteVsSprite:function(b,a,e,
d,f,k){return b.body&&a.body?(this.separate(b.body,a.body,d,f,k)&&(e&&e.call(f,b,a),this._total++),!0):!1},collideSpriteVsGroup:function(b,c,e,d,f,k){if(0!==c.length&&b.body)if(this.skipQuadTree||b.body.skipQuadTree)for(var n=0;n<c._hash.length;n++){if(c._hash[n]&&c._hash[n].exists&&c._hash[n].body){if(this.sortDirection===a.Physics.Arcade.LEFT_RIGHT){if(b.body.right<c._hash[n].body.x)break;if(c._hash[n].body.right<b.body.x)continue}else if(this.sortDirection===a.Physics.Arcade.RIGHT_LEFT){if(b.body.x>
c._hash[n].body.right)break;if(c._hash[n].body.x>b.body.right)continue}else if(this.sortDirection===a.Physics.Arcade.TOP_BOTTOM){if(b.body.bottom<c._hash[n].body.y)break;if(c._hash[n].body.bottom<b.body.y)continue}else if(this.sortDirection===a.Physics.Arcade.BOTTOM_TOP){if(b.body.y>c._hash[n].body.bottom)break;if(c._hash[n].body.y>b.body.bottom)continue}this.collideSpriteVsSprite(b,c._hash[n],e,d,f,k)}}else for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,
this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(c),c=this.quadTree.retrieve(b),n=0;n<c.length;n++)this.separate(b.body,c[n],d,f,k)&&(e&&e.call(f,b,c[n].sprite),this._total++)},collideGroupVsSelf:function(b,c,e,d,f){if(0!==b.length)for(var k=0;k<b._hash.length;k++)if(b._hash[k]&&b._hash[k].exists&&b._hash[k].body)for(var n=b._hash[k],g=k+1;g<b._hash.length;g++)if(b._hash[g]&&b._hash[g].exists&&b._hash[g].body){var h=b._hash[g];if(this.sortDirection===
a.Physics.Arcade.LEFT_RIGHT){if(n.body.right<h.body.x)break;if(h.body.right<n.body.x)continue}else if(this.sortDirection===a.Physics.Arcade.RIGHT_LEFT){if(n.body.x>h.body.right)continue;if(h.body.x>n.body.right)break}else if(this.sortDirection===a.Physics.Arcade.TOP_BOTTOM){if(n.body.bottom<h.body.y)continue;if(h.body.bottom<n.body.y)break}else if(this.sortDirection===a.Physics.Arcade.BOTTOM_TOP){if(n.body.y>h.body.bottom)continue;if(h.body.y>n.body.bottom)break}this.collideSpriteVsSprite(n,h,c,e,
d,f)}},collideGroupVsGroup:function(b,c,e,d,f,k){if(0!==b.length&&0!==c.length)for(var n=0;n<b.children.length;n++)b.children[n].exists&&(b.children[n].physicsType===a.GROUP?this.collideGroupVsGroup(b.children[n],c,e,d,f,k):this.collideSpriteVsGroup(b.children[n],c,e,d,f,k))},separate:function(b,a,e,d,f){if(!b.enable||!a.enable||!this.intersects(b,a)||e&&!1===e.call(d,b.sprite,a.sprite))return!1;e=!1;return e=this.forceX||Math.abs(this.gravity.y+b.gravity.y)<Math.abs(this.gravity.x+b.gravity.x)?this.separateX(b,
a,f)||this.separateY(b,a,f):this.separateY(b,a,f)||this.separateX(b,a,f),f?!0:e},intersects:function(b,a){return b.right<=a.position.x?!1:b.bottom<=a.position.y?!1:b.position.x>=a.right?!1:b.position.y>=a.bottom?!1:!0},separateX:function(b,a,e){if(b.immovable&&a.immovable)return!1;var d=0;if(this.intersects(b,a)){var f=b.deltaAbsX()+a.deltaAbsX()+this.OVERLAP_BIAS;if(0===b.deltaX()&&0===a.deltaX()?(b.embedded=!0,a.embedded=!0):b.deltaX()>a.deltaX()?(d=b.right-a.x,d>f||!1===b.checkCollision.right||
!1===a.checkCollision.left?d=0:(b.touching.none=!1,b.touching.right=!0,a.touching.none=!1,a.touching.left=!0)):b.deltaX()<a.deltaX()&&(d=b.x-a.width-a.x,-d>f||!1===b.checkCollision.left||!1===a.checkCollision.right?d=0:(b.touching.none=!1,b.touching.left=!0,a.touching.none=!1,a.touching.right=!0)),b.overlapX=d,a.overlapX=d,0!==d){if(e||b.customSeparateX||a.customSeparateX)return!0;e=b.velocity.x;f=a.velocity.x;b.immovable||a.immovable?b.immovable?a.immovable||(a.x+=d,a.velocity.x=e-f*a.bounce.x,b.moves&&
(a.y+=(b.y-b.prev.y)*b.friction.y)):(b.x-=d,b.velocity.x=f-e*b.bounce.x,a.moves&&(b.y+=(a.y-a.prev.y)*a.friction.y)):(d*=.5,b.x-=d,a.x+=d,d=Math.sqrt(f*f*a.mass/b.mass)*(0<f?1:-1),e=Math.sqrt(e*e*b.mass/a.mass)*(0<e?1:-1),f=.5*(d+e),b.velocity.x=f+(d-f)*b.bounce.x,a.velocity.x=f+(e-f)*a.bounce.x);return!0}}return!1},separateY:function(b,a,e){if(b.immovable&&a.immovable)return!1;var d=0;if(this.intersects(b,a)){var f=b.deltaAbsY()+a.deltaAbsY()+this.OVERLAP_BIAS;if(0===b.deltaY()&&0===a.deltaY()?(b.embedded=
!0,a.embedded=!0):b.deltaY()>a.deltaY()?(d=b.bottom-a.y,d>f||!1===b.checkCollision.down||!1===a.checkCollision.up?d=0:(b.touching.none=!1,b.touching.down=!0,a.touching.none=!1,a.touching.up=!0)):b.deltaY()<a.deltaY()&&(d=b.y-a.bottom,-d>f||!1===b.checkCollision.up||!1===a.checkCollision.down?d=0:(b.touching.none=!1,b.touching.up=!0,a.touching.none=!1,a.touching.down=!0)),b.overlapY=d,a.overlapY=d,0!==d){if(e||b.customSeparateY||a.customSeparateY)return!0;e=b.velocity.y;f=a.velocity.y;b.immovable||
a.immovable?b.immovable?a.immovable||(a.y+=d,a.velocity.y=e-f*a.bounce.y,b.moves&&(a.x+=(b.x-b.prev.x)*b.friction.x)):(b.y-=d,b.velocity.y=f-e*b.bounce.y,a.moves&&(b.x+=(a.x-a.prev.x)*a.friction.x)):(d*=.5,b.y-=d,a.y+=d,d=Math.sqrt(f*f*a.mass/b.mass)*(0<f?1:-1),e=Math.sqrt(e*e*b.mass/a.mass)*(0<e?1:-1),f=.5*(d+e),b.velocity.y=f+(d-f)*b.bounce.y,a.velocity.y=f+(e-f)*a.bounce.y);return!0}}return!1},getObjectsUnderPointer:function(b,a,e,d){return 0!==a.length&&b.exists?this.getObjectsAtLocation(b.x,
b.y,a,e,d,b):void 0},getObjectsAtLocation:function(b,c,e,d,f,k){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(e);var n=new a.Rectangle(b,c,1,1);e=[];for(var n=this.quadTree.retrieve(n),g=0;g<n.length;g++)n[g].hitTest(b,c)&&(d&&d.call(f,k,n[g].sprite),e.push(n[g].sprite));return e},moveToObject:function(b,a,e,d){"undefined"==typeof e&&(e=60);
"undefined"==typeof d&&(d=0);var f=Math.atan2(a.y-b.y,a.x-b.x);return 0<d&&(e=this.distanceBetween(b,a)/(d/1E3)),b.body.velocity.x=Math.cos(f)*e,b.body.velocity.y=Math.sin(f)*e,f},moveToPointer:function(b,a,e,d){"undefined"==typeof a&&(a=60);e=e||this.game.input.activePointer;"undefined"==typeof d&&(d=0);var f=this.angleToPointer(b,e);return 0<d&&(a=this.distanceToPointer(b,e)/(d/1E3)),b.body.velocity.x=Math.cos(f)*a,b.body.velocity.y=Math.sin(f)*a,f},moveToXY:function(b,a,e,d,f){"undefined"==typeof d&&
(d=60);"undefined"==typeof f&&(f=0);var k=Math.atan2(e-b.y,a-b.x);return 0<f&&(d=this.distanceToXY(b,a,e)/(f/1E3)),b.body.velocity.x=Math.cos(k)*d,b.body.velocity.y=Math.sin(k)*d,k},velocityFromAngle:function(b,c,e){return"undefined"==typeof c&&(c=60),e=e||new a.Point,e.setTo(Math.cos(this.game.math.degToRad(b))*c,Math.sin(this.game.math.degToRad(b))*c)},velocityFromRotation:function(b,c,e){return"undefined"==typeof c&&(c=60),e=e||new a.Point,e.setTo(Math.cos(b)*c,Math.sin(b)*c)},accelerationFromRotation:function(b,
c,e){return"undefined"==typeof c&&(c=60),e=e||new a.Point,e.setTo(Math.cos(b)*c,Math.sin(b)*c)},accelerateToObject:function(b,a,e,d,f){"undefined"==typeof e&&(e=60);"undefined"==typeof d&&(d=1E3);"undefined"==typeof f&&(f=1E3);a=this.angleBetween(b,a);return b.body.acceleration.setTo(Math.cos(a)*e,Math.sin(a)*e),b.body.maxVelocity.setTo(d,f),a},accelerateToPointer:function(b,a,e,d,f){"undefined"==typeof e&&(e=60);"undefined"==typeof a&&(a=this.game.input.activePointer);"undefined"==typeof d&&(d=1E3);
"undefined"==typeof f&&(f=1E3);a=this.angleToPointer(b,a);return b.body.acceleration.setTo(Math.cos(a)*e,Math.sin(a)*e),b.body.maxVelocity.setTo(d,f),a},accelerateToXY:function(b,a,e,d,f,k){"undefined"==typeof d&&(d=60);"undefined"==typeof f&&(f=1E3);"undefined"==typeof k&&(k=1E3);a=this.angleToXY(b,a,e);return b.body.acceleration.setTo(Math.cos(a)*d,Math.sin(a)*d),b.body.maxVelocity.setTo(f,k),a},distanceBetween:function(b,a){var e=b.x-a.x,d=b.y-a.y;return Math.sqrt(e*e+d*d)},distanceToXY:function(b,
a,e){a=b.x-a;b=b.y-e;return Math.sqrt(a*a+b*b)},distanceToPointer:function(b,a){a=a||this.game.input.activePointer;var e=b.x-a.worldX,d=b.y-a.worldY;return Math.sqrt(e*e+d*d)},angleBetween:function(b,a){return Math.atan2(a.y-b.y,a.x-b.x)},angleToXY:function(b,a,e){return Math.atan2(e-b.y,a-b.x)},angleToPointer:function(b,a){a=a||this.game.input.activePointer;return Math.atan2(a.worldY-b.y,a.worldX-b.x)}};a.Physics.Arcade.Body=function(b){this.sprite=b;this.game=b.game;this.type=a.Physics.ARCADE;this.enable=
!0;this.offset=new a.Point;this.position=new a.Point(b.x,b.y);this.prev=new a.Point(this.position.x,this.position.y);this.allowRotation=!0;this.preRotation=this.rotation=b.rotation;this.width=b.width;this.height=b.height;this.sourceWidth=b.width;this.sourceHeight=b.height;b.texture&&(this.sourceWidth=b.texture.frame.width,this.sourceHeight=b.texture.frame.height);this.halfWidth=Math.abs(b.width/2);this.halfHeight=Math.abs(b.height/2);this.center=new a.Point(b.x+this.halfWidth,b.y+this.halfHeight);
this.velocity=new a.Point;this.newVelocity=new a.Point(0,0);this.deltaMax=new a.Point(0,0);this.acceleration=new a.Point;this.drag=new a.Point;this.allowGravity=!0;this.gravity=new a.Point(0,0);this.bounce=new a.Point;this.maxVelocity=new a.Point(1E4,1E4);this.friction=new a.Point(1,0);this.angularDrag=this.angularAcceleration=this.angularVelocity=0;this.maxAngular=1E3;this.mass=1;this.speed=this.angle=0;this.facing=a.NONE;this.immovable=!1;this.moves=!0;this.customSeparateY=this.customSeparateX=
!1;this.overlapY=this.overlapX=0;this.collideWorldBounds=this.embedded=!1;this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0};this.touching={none:!0,up:!1,down:!1,left:!1,right:!1};this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1};this.blocked={up:!1,down:!1,left:!1,right:!1};this.tilePadding=new a.Point;this.skipQuadTree=this.dirty=!1;this._reset=!0;this._sx=b.scale.x;this._sy=b.scale.y;this._dy=this._dx=0};a.Physics.Arcade.Body.prototype={updateBounds:function(){var b=Math.abs(this.sprite.scale.x),
a=Math.abs(this.sprite.scale.y);(b!==this._sx||a!==this._sy)&&(this.width=this.sourceWidth*b,this.height=this.sourceHeight*a,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this._sx=b,this._sy=a,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this._reset=!0)},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=
this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y,this.rotation=
this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,(this.position.x!==this.prev.x||this.position.y!==this.prev.y)&&(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+
this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds()),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},postUpdate:function(){this.enable&&this.dirty&&(this.dirty=!1,0>this.deltaX()?this.facing=a.LEFT:0<this.deltaX()&&(this.facing=a.RIGHT),0>this.deltaY()?this.facing=a.UP:0<this.deltaY()&&(this.facing=a.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&
(0>this._dx&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:0<this._dx&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(0>this._dy&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:0<this._dy&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=
this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},destroy:function(){this.sprite=this.sprite.body=null},checkWorldBounds:function(){this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left?(this.position.x=this.game.physics.arcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0):this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right&&(this.position.x=this.game.physics.arcade.bounds.right-
this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0);this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up?(this.position.y=this.game.physics.arcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0):this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down&&(this.position.y=this.game.physics.arcade.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0)},setSize:function(b,
a,e,d){"undefined"==typeof e&&(e=this.offset.x);"undefined"==typeof d&&(d=this.offset.y);this.sourceWidth=b;this.sourceHeight=a;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(e,d);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(b,a){this.velocity.set(0);this.acceleration.set(0);this.angularAcceleration=this.angularVelocity=
this.speed=0;this.position.x=b-this.sprite.anchor.x*this.width+this.offset.x;this.position.y=a-this.sprite.anchor.y*this.height+this.offset.y;this.prev.x=this.position.x;this.prev.y=this.position.y;this.preRotation=this.rotation=this.sprite.angle;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(b,c){return a.Rectangle.contains(this,b,c)},onFloor:function(){return this.blocked.down},onWall:function(){return this.blocked.left||
this.blocked.right},deltaAbsX:function(){return 0<this.deltaX()?this.deltaX():-this.deltaX()},deltaAbsY:function(){return 0<this.deltaY()?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}};Object.defineProperty(a.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(a.Physics.Arcade.Body.prototype,
"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(a.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(b){this.position.x=b}});Object.defineProperty(a.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(b){this.position.y=b}});a.Physics.Arcade.Body.render=function(b,a,e,d){"undefined"==typeof d&&(d=!0);e=e||"rgba(0,255,0,0.4)";d?(b.fillStyle=e,b.fillRect(a.position.x-a.game.camera.x,a.position.y-
a.game.camera.y,a.width,a.height)):(b.strokeStyle=e,b.strokeRect(a.position.x-a.game.camera.x,a.position.y-a.game.camera.y,a.width,a.height))};a.Physics.Arcade.Body.renderBodyInfo=function(b,a){b.line("x: "+a.x.toFixed(2),"y: "+a.y.toFixed(2),"width: "+a.width,"height: "+a.height);b.line("velocity x: "+a.velocity.x.toFixed(2),"y: "+a.velocity.y.toFixed(2),"deltaX: "+a._dx.toFixed(2),"deltaY: "+a._dy.toFixed(2));b.line("acceleration x: "+a.acceleration.x.toFixed(2),"y: "+a.acceleration.y.toFixed(2),
"speed: "+a.speed.toFixed(2),"angle: "+a.angle.toFixed(2));b.line("gravity x: "+a.gravity.x,"y: "+a.gravity.y,"bounce x: "+a.bounce.x.toFixed(2),"y: "+a.bounce.y.toFixed(2));b.line("touching left: "+a.touching.left,"right: "+a.touching.right,"up: "+a.touching.up,"down: "+a.touching.down);b.line("blocked left: "+a.blocked.left,"right: "+a.blocked.right,"up: "+a.blocked.up,"down: "+a.blocked.down)};a.Physics.Arcade.Body.prototype.constructor=a.Physics.Arcade.Body;a.Physics.Arcade.TilemapCollision=function(){};
a.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(b,a,e,d,f){if(b.body&&(a=a.getTiles(b.body.position.x-b.body.tilePadding.x,b.body.position.y-b.body.tilePadding.y,b.body.width+b.body.tilePadding.x,b.body.height+b.body.tilePadding.y,!1,!1),0!==a.length))for(var k=0;k<a.length;k++)d?d.call(f,b,a[k])&&this.separateTile(k,b.body,a[k])&&(this._total++,e&&e.call(f,b,a[k])):this.separateTile(k,b.body,a[k])&&(this._total++,e&&e.call(f,b,a[k]))},collideGroupVsTilemapLayer:function(b,
a,e,d,f){if(0!==b.length)for(var k=0;k<b.children.length;k++)b.children[k].exists&&this.collideSpriteVsTilemapLayer(b.children[k],a,e,d,f)},separateTile:function(b,a,e){if(!a.enable||!e.intersects(a.position.x,a.position.y,a.right,a.bottom)||e.collisionCallback&&!e.collisionCallback.call(e.collisionCallbackContext,a.sprite,e)||e.layer.callbacks[e.index]&&!e.layer.callbacks[e.index].callback.call(e.layer.callbacks[e.index].callbackContext,a.sprite,e)||!(e.faceLeft||e.faceRight||e.faceTop||e.faceBottom))return!1;
var d=b=0,f=0,k=1;if(a.deltaAbsX()>a.deltaAbsY()?f=-1:a.deltaAbsX()<a.deltaAbsY()&&(k=-1),0!==a.deltaX()&&0!==a.deltaY()&&(e.faceLeft||e.faceRight)&&(e.faceTop||e.faceBottom)&&(f=Math.min(Math.abs(a.position.x-e.right),Math.abs(a.right-e.left)),k=Math.min(Math.abs(a.position.y-e.bottom),Math.abs(a.bottom-e.top))),k>f){if((e.faceLeft||e.faceRight)&&(b=this.tileCheckX(a,e),0!==b&&!e.intersects(a.position.x,a.position.y,a.right,a.bottom)))return!0;(e.faceTop||e.faceBottom)&&(d=this.tileCheckY(a,e))}else{if((e.faceTop||
e.faceBottom)&&(d=this.tileCheckY(a,e),0!==d&&!e.intersects(a.position.x,a.position.y,a.right,a.bottom)))return!0;(e.faceLeft||e.faceRight)&&(b=this.tileCheckX(a,e))}return 0!==b||0!==d},tileCheckX:function(b,a){var e=0;return 0>b.deltaX()&&!b.blocked.left&&a.collideRight&&b.checkCollision.left?a.faceRight&&b.x<a.right&&(e=b.x-a.right,e<-this.TILE_BIAS&&(e=0)):0<b.deltaX()&&!b.blocked.right&&a.collideLeft&&b.checkCollision.right&&a.faceLeft&&b.right>a.left&&(e=b.right-a.left,e>this.TILE_BIAS&&(e=
0)),0!==e&&(b.customSeparateX?b.overlapX=e:this.processTileSeparationX(b,e)),e},tileCheckY:function(b,a){var e=0;return 0>b.deltaY()&&!b.blocked.up&&a.collideDown&&b.checkCollision.up?a.faceBottom&&b.y<a.bottom&&(e=b.y-a.bottom,e<-this.TILE_BIAS&&(e=0)):0<b.deltaY()&&!b.blocked.down&&a.collideUp&&b.checkCollision.down&&a.faceTop&&b.bottom>a.top&&(e=b.bottom-a.top,e>this.TILE_BIAS&&(e=0)),0!==e&&(b.customSeparateY?b.overlapY=e:this.processTileSeparationY(b,e)),e},processTileSeparationX:function(b,
a){0>a?b.blocked.left=!0:0<a&&(b.blocked.right=!0);b.position.x-=a;b.velocity.x=0===b.bounce.x?0:-b.velocity.x*b.bounce.x},processTileSeparationY:function(b,a){0>a?b.blocked.up=!0:0<a&&(b.blocked.down=!0);b.position.y-=a;b.velocity.y=0===b.bounce.y?0:-b.velocity.y*b.bounce.y}};a.Utils.mixinPrototype(a.Physics.Arcade.prototype,a.Physics.Arcade.TilemapCollision.prototype);!function(b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):"undefined"!=typeof window?
window.p2=b():"undefined"!=typeof global?global.p2=b():"undefined"!=typeof self&&(self.p2=b())}(function(){return function c(a,d,f){function k(g,h){if(!d[g]){if(!a[g]){var u="function"==typeof require&&require;if(!h&&u)return u(g,!0);if(n)return n(g,!0);throw Error("Cannot find module '"+g+"'");}u=d[g]={exports:{}};a[g][0].call(u.exports,function(c){var d=a[g][1][c];return k(d?d:c)},u,u.exports,c,a,d,f)}return d[g].exports}for(var n="function"==typeof require&&require,g=0;g<f.length;g++)k(f[g]);return k}({1:[function(a,
e){function d(){}var f=a("./Scalar");e.exports=d;d.lineInt=function(a,c,d){var e,g,h,l,m,p,w,r=[0,0];return e=a[1][1]-a[0][1],g=a[0][0]-a[1][0],h=e*a[0][0]+g*a[0][1],l=c[1][1]-c[0][1],m=c[0][0]-c[1][0],p=l*c[0][0]+m*c[0][1],w=e*m-l*g,f.eq(w,0,d||0)||(r[0]=(m*h-g*p)/w,r[1]=(e*p-l*h)/w),r};d.segmentsIntersect=function(a,c,d,e){var f=c[0]-a[0];c=c[1]-a[1];var g=e[0]-d[0],h=e[1]-d[1];if(0==g*c-h*f)return!1;e=(f*(d[1]-a[1])+c*(a[0]-d[0]))/(g*c-h*f);a=(g*(a[1]-d[1])+h*(d[0]-a[0]))/(h*f-g*c);return 0<=e&&
1>=e&&0<=a&&1>=a}},{"./Scalar":4}],2:[function(a,e){function d(){}e.exports=d;d.area=function(a,c,d){return(c[0]-a[0])*(d[1]-a[1])-(d[0]-a[0])*(c[1]-a[1])};d.left=function(a,c,e){return 0<d.area(a,c,e)};d.leftOn=function(a,c,e){return 0<=d.area(a,c,e)};d.right=function(a,c,e){return 0>d.area(a,c,e)};d.rightOn=function(a,c,e){return 0>=d.area(a,c,e)};var f=[],k=[];d.collinear=function(a,c,e,g){return g?(f[0]=c[0]-a[0],f[1]=c[1]-a[1],k[0]=e[0]-c[0],k[1]=e[1]-c[1],a=f[0]*k[0]+f[1]*k[1],c=Math.sqrt(f[0]*
f[0]+f[1]*f[1]),e=Math.sqrt(k[0]*k[0]+k[1]*k[1]),a=Math.acos(a/(c*e)),g>a):0==d.area(a,c,e)};d.sqdist=function(a,c){var d=c[0]-a[0],e=c[1]-a[1];return d*d+e*e}},{}],3:[function(a,e){function d(){this.vertices=[]}function f(a,c,d,e,f){var k=c[1]-a[1];c=a[0]-c[0];a=k*a[0]+c*a[1];var n=e[1]-d[1];e=d[0]-e[0];d=n*d[0]+e*d[1];var h=k*e-n*c;return g.eq(h,0,f||0)?[0,0]:[(e*a-c*d)/h,(k*d-n*a)/h]}var k=a("./Line"),n=a("./Point"),g=a("./Scalar");e.exports=d;d.prototype.at=function(a){var c=this.vertices,d=c.length;
return c[0>a?a%d+d:a%d]};d.prototype.first=function(){return this.vertices[0]};d.prototype.last=function(){return this.vertices[this.vertices.length-1]};d.prototype.clear=function(){this.vertices.length=0};d.prototype.append=function(a,c,d){if("undefined"==typeof c)throw Error("From is not given!");if("undefined"==typeof d)throw Error("To is not given!");if(c>d-1)throw Error("lol1");if(d>a.vertices.length)throw Error("lol2");if(0>c)throw Error("lol3");for(;d>c;c++)this.vertices.push(a.vertices[c])};
d.prototype.makeCCW=function(){for(var a=0,c=this.vertices,d=1;d<this.vertices.length;++d)(c[d][1]<c[a][1]||c[d][1]==c[a][1]&&c[d][0]>c[a][0])&&(a=d);n.left(this.at(a-1),this.at(a),this.at(a+1))||this.reverse()};d.prototype.reverse=function(){for(var a=[],c=0,d=this.vertices.length;c!==d;c++)a.push(this.vertices.pop());this.vertices=a};d.prototype.isReflex=function(a){return n.right(this.at(a-1),this.at(a),this.at(a+1))};var h=[],l=[];d.prototype.canSee=function(a,c){var d,e;if(n.leftOn(this.at(a+
1),this.at(a),this.at(c))&&n.rightOn(this.at(a-1),this.at(a),this.at(c)))return!1;e=n.sqdist(this.at(a),this.at(c));for(var f=0;f!==this.vertices.length;++f)if((f+1)%this.vertices.length!==a&&f!==a&&n.leftOn(this.at(a),this.at(c),this.at(f+1))&&n.rightOn(this.at(a),this.at(c),this.at(f))&&(h[0]=this.at(a),h[1]=this.at(c),l[0]=this.at(f),l[1]=this.at(f+1),d=k.lineInt(h,l),n.sqdist(this.at(a),d)<e))return!1;return!0};d.prototype.copy=function(a,c,e){e=e||new d;if(e.clear(),c>a)for(var f=a;c>=f;f++)e.vertices.push(this.vertices[f]);
else{for(f=0;c>=f;f++)e.vertices.push(this.vertices[f]);for(f=a;f<this.vertices.length;f++)e.vertices.push(this.vertices[f])}return e};d.prototype.getCutEdges=function(){for(var a=[],c=[],e=[],f=new d,k=Number.MAX_VALUE,n=0;n<this.vertices.length;++n)if(this.isReflex(n))for(var g=0;g<this.vertices.length;++g)if(this.canSee(n,g)){for(var c=this.copy(n,g,f).getCutEdges(),e=this.copy(g,n,f).getCutEdges(),h=0;h<e.length;h++)c.push(e[h]);c.length<k&&(a=c,k=c.length,a.push([this.at(n),this.at(g)]))}return a};
d.prototype.decomp=function(){var a=this.getCutEdges();return 0<a.length?this.slice(a):[this]};d.prototype.slice=function(a){if(0==a.length)return[this];if(a instanceof Array&&a.length&&a[0]instanceof Array&&2==a[0].length&&a[0][0]instanceof Array){for(var c=[this],d=0;d<a.length;d++)for(var e=a[d],f=0;f<c.length;f++){var k=c[f].slice(e);if(k){c.splice(f,1);c.push(k[0],k[1]);break}}return c}e=a;d=this.vertices.indexOf(e[0]);f=this.vertices.indexOf(e[1]);return-1!=d&&-1!=f?[this.copy(d,f),this.copy(f,
d)]:!1};d.prototype.isSimple=function(){for(var a=this.vertices,c=0;c<a.length-1;c++)for(var d=0;c-1>d;d++)if(k.segmentsIntersect(a[c],a[c+1],a[d],a[d+1]))return!1;for(c=1;c<a.length-2;c++)if(k.segmentsIntersect(a[0],a[a.length-1],a[c],a[c+1]))return!1;return!0};d.prototype.quickDecomp=function(a,c,e,k,g,h){g=g||100;h=h||0;k=k||25;a="undefined"!=typeof a?a:[];c=c||[];e=e||[];var u=[0,0],l=[0,0],m=[0,0],z=0,p=0,y=0,H=z=0,B=0,E=0,K=new d,M=new d,L=this.vertices;if(3>L.length)return a;if(h++,h>g)return console.warn("quickDecomp: max level ("+
g+") reached."),a;for(var J=0;J<this.vertices.length;++J)if(this.isReflex(J)){c.push(this.vertices[J]);for(var z=p=Number.MAX_VALUE,N=0;N<this.vertices.length;++N)n.left(this.at(J-1),this.at(J),this.at(N))&&n.rightOn(this.at(J-1),this.at(J),this.at(N-1))&&(m=f(this.at(J-1),this.at(J),this.at(N),this.at(N-1)),n.right(this.at(J+1),this.at(J),m)&&(y=n.sqdist(this.vertices[J],m),p>y&&(p=y,l=m,B=N))),n.left(this.at(J+1),this.at(J),this.at(N+1))&&n.rightOn(this.at(J+1),this.at(J),this.at(N))&&(m=f(this.at(J+
1),this.at(J),this.at(N),this.at(N+1)),n.left(this.at(J-1),this.at(J),m)&&(y=n.sqdist(this.vertices[J],m),z>y&&(z=y,u=m,H=N)));if(B==(H+1)%this.vertices.length)m[0]=(l[0]+u[0])/2,m[1]=(l[1]+u[1])/2,e.push(m),H>J?(K.append(this,J,H+1),K.vertices.push(m),M.vertices.push(m),0!=B&&M.append(this,B,this.vertices.length),M.append(this,0,J+1)):(0!=J&&K.append(this,J,this.vertices.length),K.append(this,0,H+1),K.vertices.push(m),M.vertices.push(m),M.append(this,B,J+1));else{if(B>H&&(H+=this.vertices.length),
z=Number.MAX_VALUE,B>H)return a;for(N=B;H>=N;++N)n.leftOn(this.at(J-1),this.at(J),this.at(N))&&n.rightOn(this.at(J+1),this.at(J),this.at(N))&&(y=n.sqdist(this.at(J),this.at(N)),z>y&&(z=y,E=N%this.vertices.length));E>J?(K.append(this,J,E+1),0!=E&&M.append(this,E,L.length),M.append(this,0,J+1)):(0!=J&&K.append(this,J,L.length),K.append(this,0,E+1),M.append(this,E,J+1))}return K.vertices.length<M.vertices.length?(K.quickDecomp(a,c,e,k,g,h),M.quickDecomp(a,c,e,k,g,h)):(M.quickDecomp(a,c,e,k,g,h),K.quickDecomp(a,
c,e,k,g,h)),a}return a.push(this),a};d.prototype.removeCollinearPoints=function(a){for(var c=0,d=this.vertices.length-1;3<this.vertices.length&&0<=d;--d)n.collinear(this.at(d-1),this.at(d),this.at(d+1),a)&&(this.vertices.splice(d%this.vertices.length,1),d--,c++);return c}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(a,e){function d(){}e.exports=d;d.eq=function(a,c,d){return d=d||0,Math.abs(a-c)<d}},{}],5:[function(a,e){e.exports={Polygon:a("./Polygon"),Point:a("./Point")}},{"./Point":2,"./Polygon":3}],
6:[function(a,e){e.exports={name:"p2",version:"0.6.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0",
"grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(a,e){function d(a){this.lowerBound=f.create();a&&a.lowerBound&&f.copy(this.lowerBound,a.lowerBound);this.upperBound=f.create();a&&a.upperBound&&f.copy(this.upperBound,a.upperBound)}var f=a("../math/vec2");a("../utils/Utils");e.exports=d;var k=f.create();d.prototype.setFromPoints=function(a,c,d,e){var g=this.lowerBound,h=this.upperBound;"number"!=typeof d&&
(d=0);0!==d?f.rotate(g,a[0],d):f.copy(g,a[0]);f.copy(h,g);for(var l=Math.cos(d),m=Math.sin(d),p=1;p<a.length;p++){var r=a[p];if(0!==d){var F=r[0],r=r[1];k[0]=l*F-m*r;k[1]=m*F+l*r;r=k}for(F=0;2>F;F++)r[F]>h[F]&&(h[F]=r[F]),r[F]<g[F]&&(g[F]=r[F])}c&&(f.add(this.lowerBound,this.lowerBound,c),f.add(this.upperBound,this.upperBound,c));e&&(this.lowerBound[0]-=e,this.lowerBound[1]-=e,this.upperBound[0]+=e,this.upperBound[1]+=e)};d.prototype.copy=function(a){f.copy(this.lowerBound,a.lowerBound);f.copy(this.upperBound,
a.upperBound)};d.prototype.extend=function(a){for(var c=2;c--;){var d=a.lowerBound[c];this.lowerBound[c]>d&&(this.lowerBound[c]=d);d=a.upperBound[c];this.upperBound[c]<d&&(this.upperBound[c]=d)}};d.prototype.overlaps=function(a){var c=this.lowerBound,d=this.upperBound,e=a.lowerBound;a=a.upperBound;return(e[0]<=d[0]&&d[0]<=a[0]||c[0]<=a[0]&&a[0]<=d[0])&&(e[1]<=d[1]&&d[1]<=a[1]||c[1]<=a[1]&&a[1]<=d[1])}},{"../math/vec2":31,"../utils/Utils":50}],8:[function(a,e){function d(a){this.type=a;this.result=
[];this.world=null;this.boundingVolumeType=d.AABB}var f=a("../math/vec2"),k=a("../objects/Body");e.exports=d;d.AABB=1;d.BOUNDING_CIRCLE=2;d.prototype.setWorld=function(a){this.world=a};d.prototype.getCollisionPairs=function(){throw Error("getCollisionPairs must be implemented in a subclass!");};var n=f.create();d.boundingRadiusCheck=function(a,c){f.sub(n,a.position,c.position);var d=f.squaredLength(n),e=a.boundingRadius+c.boundingRadius;return e*e>=d};d.aabbCheck=function(a,c){return a.getAABB().overlaps(c.getAABB())};
d.prototype.boundingVolumeCheck=function(a,c){var e;switch(this.boundingVolumeType){case d.BOUNDING_CIRCLE:e=d.boundingRadiusCheck(a,c);break;case d.AABB:e=d.aabbCheck(a,c);break;default:throw Error("Bounding volume type not recognized: "+this.boundingVolumeType);}return e};d.canCollide=function(a,c){return a.type===k.STATIC&&c.type===k.STATIC?!1:a.type===k.KINEMATIC&&c.type===k.STATIC||a.type===k.STATIC&&c.type===k.KINEMATIC?!1:a.type===k.KINEMATIC&&c.type===k.KINEMATIC?!1:a.sleepState===k.SLEEPING&&
c.sleepState===k.SLEEPING?!1:a.sleepState===k.SLEEPING&&c.type===k.STATIC||c.sleepState===k.SLEEPING&&a.type===k.STATIC?!1:!0};d.NAIVE=1;d.SAP=2},{"../math/vec2":31,"../objects/Body":32}],9:[function(a,e){function d(a){f.apply(this);a=k.defaults(a,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10});this.xmin=a.xmin;this.ymin=a.ymin;this.xmax=a.xmax;this.ymax=a.ymax;this.nx=a.nx;this.ny=a.ny;this.binsizeX=(this.xmax-this.xmin)/this.nx;this.binsizeY=(this.ymax-this.ymin)/this.ny}var f=(a("../shapes/Circle"),
a("../shapes/Plane"),a("../shapes/Particle"),a("../collision/Broadphase")),k=(a("../math/vec2"),a("../utils/Utils"));e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.getCollisionPairs=function(a){var c=[],d=a.bodies,e=d.length,k=(this.binsizeX,this.binsizeY,this.nx),g=this.ny,h=this.xmin,l=this.ymin,m=this.xmax,p=this.ymax;a=[];for(var F=k*g,C=0;F>C;C++)a.push([]);for(var D=k/(m-h),I=g/(p-l),C=0;C!==e;C++)for(var k=d[C],A=k.aabb,G=Math.max(A.lowerBound[0],h),H=Math.max(A.lowerBound[1],
l),B=Math.min(A.upperBound[0],m),E=Math.min(A.upperBound[1],p),H=Math.floor(I*(H-l)),A=Math.floor(D*(B-h)),E=Math.floor(I*(E-l)),G=Math.floor(D*(G-h));A>=G;G++)for(B=H;E>=B;B++){var K=G*(g-1)+B;0<=K&&F>K&&a[K].push(k)}for(C=0;C!==F;C++)for(d=a[C],G=0,e=d.length;G!==e;G++)for(k=d[G],B=0;B!==G;B++)g=d[B],f.canCollide(k,g)&&this.boundingVolumeCheck(k,g)&&c.push(k,g);return c}},{"../collision/Broadphase":8,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../utils/Utils":50}],
10:[function(a,e){function d(){f.call(this,f.NAIVE)}var f=(a("../shapes/Circle"),a("../shapes/Plane"),a("../shapes/Shape"),a("../shapes/Particle"),a("../collision/Broadphase"));a("../math/vec2");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.getCollisionPairs=function(a){a=a.bodies;for(var c=this.result,d=c.length=0,e=a.length;d!==e;d++)for(var g=a[d],h=0;d>h;h++){var l=a[h];f.canCollide(g,l)&&this.boundingVolumeCheck(g,l)&&c.push(g,l)}return c};d.prototype.aabbQuery=function(a,
c,d){d=d||[];a=a.bodies;for(var e=0;e<a.length;e++){var f=a[e];f.aabbNeedsUpdate&&f.updateAABB();f.aabb.overlaps(c)&&d.push(f)}return d}},{"../collision/Broadphase":8,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Shape":45}],11:[function(a,e){function d(){this.contactEquations=[];this.frictionEquations=[];this.enabledEquations=this.enableFriction=!0;this.slipForce=10;this.frictionCoefficient=.3;this.surfaceVelocity=0;this.reuseObjects=!0;this.reusableContactEquations=
[];this.reusableFrictionEquations=[];this.restitution=0;this.stiffness=x.DEFAULT_STIFFNESS;this.relaxation=x.DEFAULT_RELAXATION;this.frictionStiffness=x.DEFAULT_STIFFNESS;this.frictionRelaxation=x.DEFAULT_RELAXATION;this.enableFrictionReduction=!0;this.collidingBodiesLastStep=new p;this.contactSkinSize=.01}function f(a,c){n.set(a.vertices[0],.5*-c.length,-c.radius);n.set(a.vertices[1],.5*c.length,-c.radius);n.set(a.vertices[2],.5*c.length,c.radius);n.set(a.vertices[3],.5*-c.length,c.radius)}function k(a,
c,d,e){var f=aa,k=Da,l=Ea,m=Fa;c=c.vertices;for(var p=null,y=0;y!==c.length+1;y++){var q=c[(y+1)%c.length];n.rotate(f,c[y%c.length],e);n.rotate(k,q,e);h(f,f,d);h(k,k,d);g(l,f,a);g(m,k,a);q=n.crossLength(l,m);if(null===p&&(p=q),0>=q*p)return!1;p=q}return!0}var n=a("../math/vec2"),g=n.sub,h=n.add,l=n.dot,m=a("../utils/Utils"),p=a("../utils/TupleDictionary"),x=a("../equations/Equation"),v=a("../equations/ContactEquation"),w=a("../equations/FrictionEquation"),r=a("../shapes/Circle"),F=a("../shapes/Convex"),
C=a("../shapes/Shape"),D=(a("../objects/Body"),a("../shapes/Rectangle"));e.exports=d;var I=n.fromValues(0,1),A=n.fromValues(0,0),G=n.fromValues(0,0),H=n.fromValues(0,0),B=n.fromValues(0,0),E=n.fromValues(0,0),K=n.fromValues(0,0),M=n.fromValues(0,0),L=n.fromValues(0,0),J=n.fromValues(0,0),N=n.fromValues(0,0),P=n.fromValues(0,0),Y=n.fromValues(0,0),Q=n.fromValues(0,0),S=n.fromValues(0,0),ea=n.fromValues(0,0),R=n.fromValues(0,0),O=n.fromValues(0,0),ua=n.fromValues(0,0),ba=[],va=n.create(),V=n.create();
d.prototype.bodiesOverlap=function(a,c){for(var d=0,e=a.shapes.length;d!==e;d++){var f=a.shapes[d],k=a.shapeOffsets[d];a.shapeAngles[d];a.toWorldFrame(va,k);for(var k=0,n=c.shapes.length;k!==n;k++){var g=c.shapes[k],h=c.shapeOffsets[k];c.shapeAngles[k];if(c.toWorldFrame(V,h),this[f.type|g.type](a,f,va,f.angle+a.angle,c,g,V,g.angle+c.angle,!0))return!0}}return!1};d.prototype.collidedLastStep=function(a,c){return!!this.collidingBodiesLastStep.get(0|a.id,0|c.id)};d.prototype.reset=function(){this.collidingBodiesLastStep.reset();
for(var a=this.contactEquations,c=a.length;c--;){var d=a[c];this.collidingBodiesLastStep.set(d.bodyA.id,d.bodyB.id,!0)}this.reuseObjects&&(a=this.frictionEquations,c=this.reusableFrictionEquations,m.appendArray(this.reusableContactEquations,this.contactEquations),m.appendArray(c,a));this.contactEquations.length=this.frictionEquations.length=0};d.prototype.createContactEquation=function(a,c,d,e){var f=this.reusableContactEquations.length?this.reusableContactEquations.pop():new v(a,c);return f.bodyA=
a,f.bodyB=c,f.shapeA=d,f.shapeB=e,f.restitution=this.restitution,f.firstImpact=!this.collidedLastStep(a,c),f.stiffness=this.stiffness,f.relaxation=this.relaxation,f.needsUpdate=!0,f.enabled=this.enabledEquations,f.offset=this.contactSkinSize,f};d.prototype.createFrictionEquation=function(a,c,d,e){var f=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new w(a,c);return f.bodyA=a,f.bodyB=c,f.shapeA=d,f.shapeB=e,f.setSlipForce(this.slipForce),f.frictionCoefficient=this.frictionCoefficient,
f.relativeVelocity=this.surfaceVelocity,f.enabled=this.enabledEquations,f.needsUpdate=!0,f.stiffness=this.frictionStiffness,f.relaxation=this.frictionRelaxation,f.contactEquations.length=0,f};d.prototype.createFrictionFromContact=function(a){var c=this.createFrictionEquation(a.bodyA,a.bodyB,a.shapeA,a.shapeB);return n.copy(c.contactPointA,a.contactPointA),n.copy(c.contactPointB,a.contactPointB),n.rotate90cw(c.t,a.normalA),c.contactEquations.push(a),c};d.prototype.createFrictionFromAverage=function(a){var c=
this.contactEquations[this.contactEquations.length-1],d=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB),e=c.bodyA;c.bodyB;n.set(d.contactPointA,0,0);n.set(d.contactPointB,0,0);n.set(d.t,0,0);for(var f=0;f!==a;f++)c=this.contactEquations[this.contactEquations.length-1-f],c.bodyA===e?(n.add(d.t,d.t,c.normalA),n.add(d.contactPointA,d.contactPointA,c.contactPointA),n.add(d.contactPointB,d.contactPointB,c.contactPointB)):(n.sub(d.t,d.t,c.normalA),n.add(d.contactPointA,d.contactPointA,c.contactPointB),
n.add(d.contactPointB,d.contactPointB,c.contactPointA)),d.contactEquations.push(c);a=1/a;return n.scale(d.contactPointA,d.contactPointA,a),n.scale(d.contactPointB,d.contactPointB,a),n.normalize(d.t,d.t),n.rotate90cw(d.t,d.t),d};d.prototype[C.LINE|C.CONVEX]=d.prototype.convexLine=function(a,c,d,e,f,k,n,g,h){return h?!1:0};d.prototype[C.LINE|C.RECTANGLE]=d.prototype.lineRectangle=function(a,c,d,e,f,k,n,g,h){return h?!1:0};var ha=new D(1,1),U=n.create();d.prototype[C.CAPSULE|C.CONVEX]=d.prototype[C.CAPSULE|
C.RECTANGLE]=d.prototype.convexCapsule=function(a,c,d,e,k,g,h,l,u){n.set(U,g.length/2,0);n.rotate(U,U,l);n.add(U,U,h);var m=this.circleConvex(k,g,U,l,a,c,d,e,u,g.radius);n.set(U,-g.length/2,0);n.rotate(U,U,l);n.add(U,U,h);var z=this.circleConvex(k,g,U,l,a,c,d,e,u,g.radius);if(u&&(m||z))return!0;f(ha,g);return this.convexConvex(a,c,d,e,k,ha,h,l,u)+m+z};d.prototype[C.CAPSULE|C.LINE]=d.prototype.lineCapsule=function(a,c,d,e,f,k,n,g,h){return h?!1:0};var ia=n.create(),ja=n.create(),pa=new D(1,1);d.prototype[C.CAPSULE|
C.CAPSULE]=d.prototype.capsuleCapsule=function(a,c,d,e,k,g,h,l,u){for(var m,z=0,p=0;2>p;p++){n.set(ia,(0===p?-1:1)*c.length/2,0);n.rotate(ia,ia,e);n.add(ia,ia,d);for(var y=0;2>y;y++){n.set(ja,(0===y?-1:1)*g.length/2,0);n.rotate(ja,ja,l);n.add(ja,ja,h);this.enableFrictionReduction&&(m=this.enableFriction,this.enableFriction=!1);var q=this.circleCircle(a,c,ia,e,k,g,ja,l,u,c.radius,g.radius);if(this.enableFrictionReduction&&(this.enableFriction=m),u&&q)return!0;z+=q}}this.enableFrictionReduction&&(m=
this.enableFriction,this.enableFriction=!1);f(pa,c);p=this.convexCapsule(a,pa,d,e,k,g,h,l,u);if(this.enableFrictionReduction&&(this.enableFriction=m),u&&p)return!0;if(z+=p,this.enableFrictionReduction)m=this.enableFriction,this.enableFriction=!1;f(pa,g);a=this.convexCapsule(k,pa,h,l,a,c,d,e,u);return this.enableFrictionReduction&&(this.enableFriction=m),u&&a?!0:(z+=a,this.enableFrictionReduction&&z&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(z)),z)};d.prototype[C.LINE|
C.LINE]=d.prototype.lineLine=function(a,c,d,e,f,k,n,g,h){return h?!1:0};d.prototype[C.PLANE|C.LINE]=d.prototype.planeLine=function(a,c,d,e,f,k,m,p,q){var r=0;n.set(A,-k.length/2,0);n.set(G,k.length/2,0);n.rotate(H,A,p);n.rotate(B,G,p);h(H,H,m);h(B,B,m);n.copy(A,H);n.copy(G,B);g(E,G,A);n.normalize(K,E);n.rotate90cw(J,K);n.rotate(L,I,e);ba[0]=A;ba[1]=G;for(e=0;e<ba.length;e++){p=ba[e];g(M,p,d);var t=l(M,L);if(0>t){if(q)return!0;var w=this.createContactEquation(a,f,c,k);r++;n.copy(w.normalA,L);n.normalize(w.normalA,
w.normalA);n.scale(M,L,t);g(w.contactPointA,p,M);g(w.contactPointA,w.contactPointA,a.position);g(w.contactPointB,p,m);h(w.contactPointB,w.contactPointB,m);g(w.contactPointB,w.contactPointB,f.position);this.contactEquations.push(w);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w))}}return q?!1:(this.enableFrictionReduction||r&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(r)),r)};d.prototype[C.PARTICLE|
C.CAPSULE]=d.prototype.particleCapsule=function(a,c,d,e,f,k,n,g,h){return this.circleLine(a,c,d,e,f,k,n,g,h,k.radius,0)};d.prototype[C.CIRCLE|C.LINE]=d.prototype.circleLine=function(a,c,d,e,f,k,m,p,q,r,t){r=r||0;t="undefined"!=typeof t?t:c.radius;n.set(L,-k.length/2,0);n.set(J,k.length/2,0);n.rotate(N,L,p);n.rotate(P,J,p);h(N,N,m);h(P,P,m);n.copy(L,N);n.copy(J,P);g(K,J,L);n.normalize(M,K);n.rotate90cw(E,M);g(Y,d,L);p=l(Y,E);g(B,L,m);g(Q,d,m);e=t+r;if(Math.abs(p)<e){n.scale(A,E,p);g(H,d,A);n.scale(G,
E,l(E,Q));n.normalize(G,G);n.scale(G,G,r);h(H,H,G);p=l(M,H);var w=l(M,L),v=l(M,J);if(p>w&&v>p){if(q)return!0;c=this.createContactEquation(a,f,c,k);return n.scale(c.normalA,A,-1),n.normalize(c.normalA,c.normalA),n.scale(c.contactPointA,c.normalA,t),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),g(c.contactPointB,H,m),h(c.contactPointB,c.contactPointB,m),g(c.contactPointB,c.contactPointB,f.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),
1}}ba[0]=L;ba[1]=J;for(w=0;w<ba.length;w++)if(p=ba[w],g(Y,p,d),n.squaredLength(Y)<Math.pow(e,2)){if(q)return!0;c=this.createContactEquation(a,f,c,k);return n.copy(c.normalA,Y),n.normalize(c.normalA,c.normalA),n.scale(c.contactPointA,c.normalA,t),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),g(c.contactPointB,p,m),n.scale(S,c.normalA,-r),h(c.contactPointB,c.contactPointB,S),h(c.contactPointB,c.contactPointB,m),g(c.contactPointB,c.contactPointB,f.position),this.contactEquations.push(c),
this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}return 0};d.prototype[C.CIRCLE|C.CAPSULE]=d.prototype.circleCapsule=function(a,c,d,e,f,k,n,g,h){return this.circleLine(a,c,d,e,f,k,n,g,h,k.radius)};d.prototype[C.CIRCLE|C.CONVEX]=d.prototype[C.CIRCLE|C.RECTANGLE]=d.prototype.circleConvex=function(a,c,d,e,f,l,m,p,y,q){q="number"==typeof q?q:c.radius;e=!1;for(var r=Number.MAX_VALUE,t=l.vertices,w=0;w!==t.length+1;w++){var v=t[(w+1)%t.length];if(n.rotate(A,t[w%t.length],
p),n.rotate(G,v,p),h(A,A,m),h(G,G,m),g(H,G,A),n.normalize(B,H),n.rotate90cw(E,B),n.scale(S,E,-c.radius),h(S,S,d),k(S,l,m,p))n.sub(ea,A,S),v=Math.abs(n.dot(ea,E)),r>v&&(n.copy(R,S),r=v,n.scale(Q,E,v),n.add(Q,Q,S),e=!0)}if(e){if(y)return!0;c=this.createContactEquation(a,f,c,l);return n.sub(c.normalA,R,d),n.normalize(c.normalA,c.normalA),n.scale(c.contactPointA,c.normalA,q),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),g(c.contactPointB,Q,m),h(c.contactPointB,c.contactPointB,
m),g(c.contactPointB,c.contactPointB,f.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}if(0<q)for(w=0;w<t.length;w++)if(n.rotate(P,t[w],p),h(P,P,m),g(N,P,d),n.squaredLength(N)<Math.pow(q,2)){if(y)return!0;c=this.createContactEquation(a,f,c,l);return n.copy(c.normalA,N),n.normalize(c.normalA,c.normalA),n.scale(c.contactPointA,c.normalA,q),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),
g(c.contactPointB,P,m),h(c.contactPointB,c.contactPointB,m),g(c.contactPointB,c.contactPointB,f.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}return 0};var aa=n.create(),Da=n.create(),Ea=n.create(),Fa=n.create();d.prototype[C.PARTICLE|C.CONVEX]=d.prototype[C.PARTICLE|C.RECTANGLE]=d.prototype.particleConvex=function(a,c,d,e,f,m,p,q,r){e=Number.MAX_VALUE;var t=!1,w=m.vertices;if(!k(d,m,p,q))return 0;if(r)return!0;for(r=
0;r!==w.length+1;r++){var v=w[(r+1)%w.length];n.rotate(A,w[r%w.length],q);n.rotate(G,v,q);h(A,A,p);h(G,G,p);g(H,G,A);n.normalize(B,H);n.rotate90cw(E,B);g(N,d,A);l(N,E);g(K,A,p);g(M,d,p);n.sub(O,A,d);v=Math.abs(n.dot(O,E));e>v&&(e=v,n.scale(Q,E,v),n.add(Q,Q,d),n.copy(ua,E),t=!0)}return t?(c=this.createContactEquation(a,f,c,m),n.scale(c.normalA,ua,-1),n.normalize(c.normalA,c.normalA),n.set(c.contactPointA,0,0),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),g(c.contactPointB,
Q,p),h(c.contactPointB,c.contactPointB,p),g(c.contactPointB,c.contactPointB,f.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1):0};d.prototype[C.CIRCLE]=d.prototype.circleCircle=function(a,c,d,e,f,k,l,m,p,y,q){y=y||c.radius;q=q||k.radius;g(A,d,l);e=y+q;if(n.squaredLength(A)>Math.pow(e,2))return 0;if(p)return!0;c=this.createContactEquation(a,f,c,k);return g(c.normalA,l,d),n.normalize(c.normalA,c.normalA),n.scale(c.contactPointA,
c.normalA,y),n.scale(c.contactPointB,c.normalA,-q),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),h(c.contactPointB,c.contactPointB,l),g(c.contactPointB,c.contactPointB,f.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1};d.prototype[C.PLANE|C.CONVEX]=d.prototype[C.PLANE|C.RECTANGLE]=d.prototype.planeConvex=function(a,c,d,e,f,k,m,p,q){var r=0;n.rotate(G,I,e);for(e=0;e!==k.vertices.length;e++)if(n.rotate(A,
k.vertices[e],p),h(A,A,m),g(H,A,d),0>=l(H,G)){if(q)return!0;r++;var w=this.createContactEquation(a,f,c,k);g(H,A,d);n.copy(w.normalA,G);var t=l(H,w.normalA);n.scale(H,w.normalA,t);g(w.contactPointB,A,f.position);g(w.contactPointA,A,H);g(w.contactPointA,w.contactPointA,a.position);this.contactEquations.push(w);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w))}return this.enableFrictionReduction&&this.enableFriction&&r&&this.frictionEquations.push(this.createFrictionFromAverage(r)),
r};d.prototype[C.PARTICLE|C.PLANE]=d.prototype.particlePlane=function(a,c,d,e,f,k,h,m,p){m=m||0;g(A,d,h);n.rotate(G,I,m);e=l(A,G);if(0<e)return 0;if(p)return!0;c=this.createContactEquation(f,a,k,c);return n.copy(c.normalA,G),n.scale(A,c.normalA,e),g(c.contactPointA,d,A),g(c.contactPointA,c.contactPointA,f.position),g(c.contactPointB,d,a.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1};d.prototype[C.CIRCLE|C.PARTICLE]=d.prototype.circleParticle=
function(a,c,d,e,f,k,l,m,p){if(g(A,l,d),n.squaredLength(A)>Math.pow(c.radius,2))return 0;if(p)return!0;e=this.createContactEquation(a,f,c,k);return n.copy(e.normalA,A),n.normalize(e.normalA,e.normalA),n.scale(e.contactPointA,e.normalA,c.radius),h(e.contactPointA,e.contactPointA,d),g(e.contactPointA,e.contactPointA,a.position),g(e.contactPointB,l,f.position),this.contactEquations.push(e),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(e)),1};var ta=new r(1),ka=n.create(),
la=n.create();n.create();d.prototype[C.PLANE|C.CAPSULE]=d.prototype.planeCapsule=function(a,c,d,e,f,k,g,l,m){n.set(ka,-k.length/2,0);n.rotate(ka,ka,l);h(ka,ka,g);n.set(la,k.length/2,0);n.rotate(la,la,l);h(la,la,g);ta.radius=k.radius;var u;this.enableFrictionReduction&&(u=this.enableFriction,this.enableFriction=!1);k=this.circlePlane(f,ta,ka,0,a,c,d,e,m);a=this.circlePlane(f,ta,la,0,a,c,d,e,m);if(this.enableFrictionReduction&&(this.enableFriction=u),m)return k||a;m=k+a;return this.enableFrictionReduction&&
m&&this.frictionEquations.push(this.createFrictionFromAverage(m)),m};d.prototype[C.CIRCLE|C.PLANE]=d.prototype.circlePlane=function(a,c,d,e,f,k,m,p,q){e=p||0;g(A,d,m);n.rotate(G,I,e);e=l(G,A);if(e>c.radius)return 0;if(q)return!0;k=this.createContactEquation(f,a,k,c);return n.copy(k.normalA,G),n.scale(k.contactPointB,k.normalA,-c.radius),h(k.contactPointB,k.contactPointB,d),g(k.contactPointB,k.contactPointB,a.position),n.scale(H,k.normalA,e),g(k.contactPointA,A,H),h(k.contactPointA,k.contactPointA,
m),g(k.contactPointA,k.contactPointA,f.position),this.contactEquations.push(k),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(k)),1};d.prototype[C.CONVEX]=d.prototype[C.CONVEX|C.RECTANGLE]=d.prototype[C.RECTANGLE]=d.prototype.convexConvex=function(a,c,e,f,k,m,p,q,w,r){var t=0;r="number"==typeof r?r:0;if(!d.findSeparatingAxis(c,e,f,m,p,q,A))return 0;g(L,p,e);0<l(A,L)&&n.scale(A,A,-1);var v=d.getClosestEdge(c,f,A,!0),C=d.getClosestEdge(m,q,A);if(-1===v||-1===C)return 0;
for(var x=0;2>x;x++){var F=v,Y=C,D=c,Q=m,I=e,S=p,aa=f,N=q,ea=a,K=k;if(0===x){var R;R=F;F=Y;Y=R;R=D;D=Q;Q=R;R=I;I=S;S=R;R=aa;aa=N;N=R;R=ea;ea=K;K=R}for(R=Y;Y+2>R;R++){n.rotate(G,Q.vertices[(R+Q.vertices.length)%Q.vertices.length],N);h(G,G,S);for(var O=0,P=F-1;F+2>P;P++){var V=D.vertices[(P+D.vertices.length)%D.vertices.length],ha=D.vertices[(P+1+D.vertices.length)%D.vertices.length];n.rotate(H,V,aa);n.rotate(B,ha,aa);h(H,H,I);h(B,B,I);g(E,B,H);n.rotate90cw(J,E);n.normalize(J,J);g(L,G,H);V=l(J,L);(P===
F&&r>=V||P!==F&&0>=V)&&O++}if(3<=O){if(w)return!0;O=this.createContactEquation(ea,K,D,Q);t++;V=D.vertices[F%D.vertices.length];ha=D.vertices[(F+1)%D.vertices.length];n.rotate(H,V,aa);n.rotate(B,ha,aa);h(H,H,I);h(B,B,I);g(E,B,H);n.rotate90cw(O.normalA,E);n.normalize(O.normalA,O.normalA);g(L,G,H);V=l(O.normalA,L);n.scale(M,O.normalA,V);g(O.contactPointA,G,I);g(O.contactPointA,O.contactPointA,M);h(O.contactPointA,O.contactPointA,I);g(O.contactPointA,O.contactPointA,ea.position);g(O.contactPointB,G,S);
h(O.contactPointB,O.contactPointB,S);g(O.contactPointB,O.contactPointB,K.position);this.contactEquations.push(O);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(O))}}}return this.enableFrictionReduction&&this.enableFriction&&t&&this.frictionEquations.push(this.createFrictionFromAverage(t)),t};var wa=n.fromValues(0,0);d.projectConvexOntoAxis=function(a,c,d,e,f){var k,g=null,h=null;n.rotate(wa,e,-d);for(d=0;d<a.vertices.length;d++)k=a.vertices[d],
k=l(k,wa),(null===g||k>g)&&(g=k),(null===h||h>k)&&(h=k);h>g&&(a=h,h=g,g=a);c=l(c,e);n.set(f,h+c,g+c)};var xa=n.fromValues(0,0),ya=n.fromValues(0,0),za=n.fromValues(0,0),T=n.fromValues(0,0),ca=n.fromValues(0,0),da=n.fromValues(0,0);d.findSeparatingAxis=function(a,c,e,f,k,h,l){var m=null,p=!1,z=!1;if(a instanceof D&&f instanceof D)for(var y=0;2!==y;y++){var q=a,r=e;1===y&&(r=h);for(var w=0;2!==w;w++){0===w?n.set(T,0,1):1===w&&n.set(T,1,0);0!==r&&n.rotate(T,T,r);d.projectConvexOntoAxis(a,c,e,T,ca);d.projectConvexOntoAxis(f,
k,h,T,da);var p=ca,t=da;ca[0]>da[0]&&(t=ca,p=da);t=t[0]-p[1];p=0>=t;(null===m||t>m)&&(n.copy(l,T),m=t,z=p)}}else for(y=0;2!==y;y++)for(q=a,r=e,1===y&&(q=f,r=h),w=0;w!==q.vertices.length;w++)n.rotate(ya,q.vertices[w],r),n.rotate(za,q.vertices[(w+1)%q.vertices.length],r),g(xa,za,ya),n.rotate90cw(T,xa),n.normalize(T,T),d.projectConvexOntoAxis(a,c,e,T,ca),d.projectConvexOntoAxis(f,k,h,T,da),p=ca,t=da,ca[0]>da[0]&&(t=ca,p=da),t=t[0]-p[1],p=0>=t,(null===m||t>m)&&(n.copy(l,T),m=t,z=p);return z};var qa=n.fromValues(0,
0),Aa=n.fromValues(0,0),ra=n.fromValues(0,0);d.getClosestEdge=function(a,c,d,e){n.rotate(qa,d,-c);e&&n.scale(qa,qa,-1);c=-1;d=a.vertices.length;e=-1;for(var f=0;f!==d;f++){g(Aa,a.vertices[(f+1)%d],a.vertices[f%d]);n.rotate90cw(ra,Aa);n.normalize(ra,ra);var k=l(ra,qa);(-1===c||k>e)&&(c=f%d,e=k)}return c};var fa=n.create(),ga=n.create(),W=n.create(),oa=n.create(),Ba=n.create(),Z=n.create(),Ca=n.create();d.prototype[C.CIRCLE|C.HEIGHTFIELD]=d.prototype.circleHeightfield=function(a,c,d,e,f,k,l,m,p,y){e=
k.data;y=y||c.radius;m=k.elementWidth;var q=Math.floor((d[0]-y-l[0])/m),r=Math.ceil((d[0]+y-l[0])/m);0>q&&(q=0);r>=e.length&&(r=e.length-1);for(var w=e[q],t=e[r],v=q;r>v;v++)e[v]<t&&(t=e[v]),e[v]>w&&(w=e[v]);if(d[1]-y>w)return p?!1:0;w=!1;for(v=q;r>v;v++)if(n.set(W,v*m,e[v]),n.set(oa,(v+1)*m,e[v+1]),n.add(W,W,l),n.add(oa,oa,l),n.sub(Z,oa,W),n.rotate(Z,Z,Math.PI/2),n.normalize(Z,Z),n.scale(fa,Z,-y),n.add(fa,fa,d),n.sub(ga,fa,W),w=n.dot(ga,Z),fa[0]>=W[0]&&fa[0]<oa[0]&&0>=w){if(p)return!0;n.scale(ga,
Z,-w);n.add(Ba,fa,ga);n.copy(Ca,Z);t=this.createContactEquation(f,a,k,c);n.copy(t.normalA,Ca);n.scale(t.contactPointB,t.normalA,-y);h(t.contactPointB,t.contactPointB,d);g(t.contactPointB,t.contactPointB,a.position);n.copy(t.contactPointA,Ba);n.sub(t.contactPointA,t.contactPointA,f.position);this.contactEquations.push(t);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(t))}if(w=!1,0<y)for(v=q;r>=v;v++)if(n.set(W,v*m,e[v]),n.add(W,W,l),n.sub(ga,d,W),n.squaredLength(ga)<
Math.pow(y,2)){if(p)return!0;w=!0;t=this.createContactEquation(f,a,k,c);n.copy(t.normalA,ga);n.normalize(t.normalA,t.normalA);n.scale(t.contactPointB,t.normalA,-y);h(t.contactPointB,t.contactPointB,d);g(t.contactPointB,t.contactPointB,a.position);g(t.contactPointA,W,l);h(t.contactPointA,t.contactPointA,l);g(t.contactPointA,t.contactPointA,f.position);this.contactEquations.push(t);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(t))}return w?1:0};var ma=n.create(),na=
n.create(),sa=n.create(),X=new F([n.create(),n.create(),n.create(),n.create()]);d.prototype[C.RECTANGLE|C.HEIGHTFIELD]=d.prototype[C.CONVEX|C.HEIGHTFIELD]=d.prototype.convexHeightfield=function(a,c,d,e,f,k,g,h,l){h=k.data;k=k.elementWidth;var m=Math.floor((a.aabb.lowerBound[0]-g[0])/k),u=Math.ceil((a.aabb.upperBound[0]-g[0])/k);0>m&&(m=0);u>=h.length&&(u=h.length-1);for(var p=h[m],z=h[u],y=m;u>y;y++)h[y]<z&&(z=h[y]),h[y]>p&&(p=h[y]);if(a.aabb.lowerBound[1]>p)return l?!1:0;p=0;for(y=m;u>y;y++)n.set(ma,
y*k,h[y]),n.set(na,(y+1)*k,h[y+1]),n.add(ma,ma,g),n.add(na,na,g),n.set(sa,.5*(na[0]+ma[0]),.5*(na[1]+ma[1]-100)),n.sub(X.vertices[0],na,sa),n.sub(X.vertices[1],ma,sa),n.copy(X.vertices[2],X.vertices[1]),n.copy(X.vertices[3],X.vertices[0]),X.vertices[2][1]-=100,X.vertices[3][1]-=100,p+=this.convexConvex(a,c,d,e,f,X,sa,0,l);return p}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/FrictionEquation":24,"../math/vec2":31,"../objects/Body":32,"../shapes/Circle":38,"../shapes/Convex":39,
"../shapes/Rectangle":44,"../shapes/Shape":45,"../utils/TupleDictionary":49,"../utils/Utils":50}],12:[function(a,e){function d(a){a=a||{};this.from=a.from?f.fromValues(a.from[0],a.from[1]):f.create();this.to=a.to?f.fromValues(a.to[0],a.to[1]):f.create();this._direction=f.create();this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionGroup=this.collisionMask=-1;this.mode=d.ANY;this.result=new k;this.hasHit=!1;this.callback=function(){}}e.exports=d;var f=a("../math/vec2"),
k=a("../collision/RaycastResult"),n=a("../shapes/Shape"),g=a("../collision/AABB");d.prototype.constructor=d;d.CLOSEST=1;d.ANY=2;d.ALL=4;var h=new g,l=[];d.prototype.intersectWorld=function(a,c){return this.mode=c.mode||d.ANY,this.result=c.result||new k,this.skipBackfaces=!!c.skipBackfaces,this.collisionMask="undefined"!=typeof c.collisionMask?c.collisionMask:-1,this.collisionGroup="undefined"!=typeof c.collisionGroup?c.collisionGroup:-1,c.from&&f.copy(this.from,c.from),c.to&&f.copy(this.to,c.to),
this.callback=c.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(h),l.length=0,a.broadphase.aabbQuery(a,h,l),this.intersectBodies(l),this.hasHit};var m=(f.create(),f.create(),f.create());d.prototype.intersectBody=function(a,c){c&&(this.result=c,this._updateDirection());var d=this.checkCollisionResponse;if(!d||a.collisionResponse)for(var e=0,k=a.shapes.length;k>e;e++){var n=a.shapes[e];if(!d||n.collisionResponse)if(f.copy(m,a.shapeOffsets[e]),f.rotate(m,
m,a.angle),f.add(m,m,a.position),this.intersectShape(n,a.shapeAngles[e]+a.angle,m,a),this.result._shouldStop)break}};d.prototype.intersectBodies=function(a,c){c&&(this.result=c,this._updateDirection());for(var d=0,e=a.length;!this.result._shouldStop&&e>d;d++)this.intersectBody(a[d])};d.prototype._updateDirection=function(){var a=this._direction;f.sub(a,this.to,this.from);f.normalize(a,a)};d.prototype.intersectShape=function(a,c,d,e){var k=this.from,n=this._direction;f.sub(K,d,k);var g=f.dot(K,n);
f.scale(M,n,g);f.add(M,M,k);f.distance(d,M)>a.boundingSphereRadius||(k=this[a.type])&&k.call(this,a,c,d,e)};var p=(f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),new k,f.create()),x=f.create(),v=f.create(),w=f.create(),r=f.create(),F=f.create(),C=f.create();d.prototype.intersectRectangle=function(a,c,d,e){d=-Number.MAX_VALUE;var k=Number.MAX_VALUE;if(f.set(F,.5*-a.width,.5*-a.height),f.set(C,.5*a.width,.5*a.height),f.rotate(p,this._direction,-c),e.toLocalFrame(x,this.from),
0!==p[0]){var n=(F[0]-x[0])/p[0],g=(C[0]-x[0])/p[0],h=d;d=Math.max(d,Math.min(n,g));d!==h&&f.set(v,n>g?1:-1,0);h=k;k=Math.min(k,Math.max(n,g));k!==h&&f.set(w,g>n?1:-1,0)}0!==p[1]&&(n=(F[1]-x[1])/p[1],g=(C[1]-x[1])/p[1],h=d,d=Math.max(d,Math.min(n,g)),d!==h&&f.set(v,0,n>g?1:-1),h=k,k=Math.min(k,Math.max(n,g)),k!==h&&f.set(w,0,g>n?1:-1));k>=d&&(f.set(r,x[0]+p[0]*d,x[1]+p[1]*d),f.rotate(v,v,c),e.toWorldFrame(r,r),this.reportIntersection(v,r,a,e,-1),!this._shouldStop)&&(f.rotate(w,w,c),f.set(r,x[0]+p[0]*
k,x[1]+p[1]*k),e.toWorldFrame(r,r),this.reportIntersection(w,r,a,e,-1))};d.prototype[n.RECTANGLE]=d.prototype.intersectRectangle;var D=f.create(),I=f.create(),A=f.create(),G=f.create(),H=f.create();d.prototype.intersectPlane=function(a,c,d,e){var k=this.from,n=this.to,g=this._direction;f.set(G,0,1);f.rotate(G,G,c);f.sub(H,k,d);c=f.dot(H,G);f.sub(H,n,d);var h=f.dot(H,G);0<c*h||f.distance(k,n)<c||(n=f.dot(G,g),f.sub(D,k,d),d=-f.dot(G,D)/n,f.scale(I,g,d),f.add(A,k,I),this.reportIntersection(G,A,a,e,
-1))};d.prototype[n.PLANE]=d.prototype.intersectPlane;var B=f.create(),E=f.create();d.prototype.intersectCircle=function(a,c,d,e){c=this.from;var k=this.to,n=a.radius,g=Math.pow(k[0]-c[0],2)+Math.pow(k[1]-c[1],2),h=2*((k[0]-c[0])*(c[0]-d[0])+(k[1]-c[1])*(c[1]-d[1])),n=Math.pow(c[0]-d[0],2)+Math.pow(c[1]-d[1],2)-Math.pow(n,2),l=Math.pow(h,2)-4*g*n;0>l||(0===l?(f.lerp(B,c,k,l),f.sub(E,B,d),f.normalize(E,E),this.reportIntersection(E,B,a,e,-1)):(n=(-h-Math.sqrt(l))/(2*g),g=(-h+Math.sqrt(l))/(2*g),(f.lerp(B,
c,k,n),f.sub(E,B,d),f.normalize(E,E),this.reportIntersection(E,B,a,e,-1),this.result._shouldStop)||(f.lerp(B,c,k,g),f.sub(E,B,d),f.normalize(E,E),this.reportIntersection(E,B,a,e,-1))))};d.prototype[n.CIRCLE]=d.prototype.intersectCircle;d.prototype.getAABB=function(a){var c=this.to,d=this.from;a.lowerBound[0]=Math.min(c[0],d[0]);a.lowerBound[1]=Math.min(c[1],d[1]);a.upperBound[0]=Math.max(c[0],d[0]);a.upperBound[1]=Math.max(c[1],d[1])};d.prototype.reportIntersection=function(a,c,e,k,n){var g=this.from,
h=this.to,l=f.distance(g,c),m=this.result;if(!(this.skipBackfaces&&0<f.dot(a,this._direction)))switch(m.hitFaceIndex="undefined"!=typeof n?n:-1,this.mode){case d.ALL:this.hasHit=!0;m.set(g,h,a,c,e,k,l);m.hasHit=!0;this.callback(m);break;case d.CLOSEST:(l<m.distance||!m.hasHit)&&(this.hasHit=!0,m.hasHit=!0,m.set(g,h,a,c,e,k,l));break;case d.ANY:this.hasHit=!0,m.hasHit=!0,m.set(g,h,a,c,e,k,l),m._shouldStop=!0}};var K=f.create(),M=f.create()},{"../collision/AABB":7,"../collision/RaycastResult":13,"../math/vec2":31,
"../shapes/Shape":45}],13:[function(a,e){function d(){this.rayFromWorld=f.create();this.rayToWorld=f.create();this.hitNormalWorld=f.create();this.hitPointWorld=f.create();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var f=a("../math/vec2");e.exports=d;d.prototype.reset=function(){f.set(this.rayFromWorld,0,0);f.set(this.rayToWorld,0,0);f.set(this.hitNormalWorld,0,0);f.set(this.hitPointWorld,0,0);this.hasHit=!1;this.body=this.shape=null;this.distance=
this.hitFaceIndex=-1;this._shouldStop=!1};d.prototype.abort=function(){this._shouldStop=!0};d.prototype.set=function(a,c,d,e,g,h,l){f.copy(this.rayFromWorld,a);f.copy(this.rayToWorld,c);f.copy(this.hitNormalWorld,d);f.copy(this.hitPointWorld,e);this.shape=g;this.body=h;this.distance=l}},{"../math/vec2":31}],14:[function(a,e){function d(){k.call(this,k.SAP);this.axisList=[];this.axisIndex=0;var a=this;this._addBodyHandler=function(c){a.axisList.push(c.body)};this._removeBodyHandler=function(c){c=a.axisList.indexOf(c.body);
-1!==c&&a.axisList.splice(c,1)}}var f=a("../utils/Utils"),k=a("../collision/Broadphase");e.exports=d;d.prototype=new k;d.prototype.constructor=d;d.prototype.setWorld=function(a){this.axisList.length=0;f.appendArray(this.axisList,a.bodies);a.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);a.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=a};d.sortAxisList=function(a,c){c|=0;for(var d=1,e=a.length;e>d;d++){for(var f=a[d],k=d-1;0<=
k&&!(a[k].aabb.lowerBound[c]<=f.aabb.lowerBound[c]);k--)a[k+1]=a[k];a[k+1]=f}return a};d.prototype.sortList=function(){d.sortAxisList(this.axisList,this.axisIndex)};d.prototype.getCollisionPairs=function(){var a=this.axisList,c=this.result,d=this.axisIndex;c.length=0;for(var e=a.length;e--;){var f=a[e];f.aabbNeedsUpdate&&f.updateAABB()}this.sortList();e=0;for(f=0|a.length;e!==f;e++)for(var g=a[e],h=e+1;f>h;h++){var l=a[h];if(!(l.aabb.lowerBound[d]<=g.aabb.upperBound[d]))break;k.canCollide(g,l)&&this.boundingVolumeCheck(g,
l)&&c.push(g,l)}return c};d.prototype.aabbQuery=function(a,c,d){d=d||[];this.sortList();a=this.axisIndex;var e="x";1===a&&(e="y");2===a&&(e="z");a=this.axisList;for(e=(c.lowerBound[e],c.upperBound[e],0);e<a.length;e++){var f=a[e];f.aabbNeedsUpdate&&f.updateAABB();f.aabb.overlaps(c)&&d.push(f)}return d}},{"../collision/Broadphase":8,"../utils/Utils":50}],15:[function(a,e){function d(a,c,d,e){this.type=d;e=f.defaults(e,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=a;this.bodyB=
c;this.collideConnected=e.collideConnected;e.wakeUpBodies&&(a&&a.wakeUp(),c&&c.wakeUp())}e.exports=d;var f=a("../utils/Utils");d.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};d.DISTANCE=1;d.GEAR=2;d.LOCK=3;d.PRISMATIC=4;d.REVOLUTE=5;d.prototype.setStiffness=function(a){for(var c=this.equations,d=0;d!==c.length;d++){var e=c[d];e.stiffness=a;e.needsUpdate=!0}};d.prototype.setRelaxation=function(a){for(var c=this.equations,d=0;d!==c.length;d++){var e=
c[d];e.relaxation=a;e.needsUpdate=!0}}},{"../utils/Utils":50}],16:[function(a,e){function d(a,c,d){d=h.defaults(d,{localAnchorA:[0,0],localAnchorB:[0,0]});f.call(this,a,c,f.DISTANCE,d);this.localAnchorA=g.fromValues(d.localAnchorA[0],d.localAnchorA[1]);this.localAnchorB=g.fromValues(d.localAnchorB[0],d.localAnchorB[1]);var e=this.localAnchorA,l=this.localAnchorB;if(this.distance=0,"number"==typeof d.distance)this.distance=d.distance;else{var m=g.create(),p=g.create(),z=g.create();g.rotate(m,e,a.angle);
g.rotate(p,l,c.angle);g.add(z,c.position,p);g.sub(z,z,m);g.sub(z,z,a.position);this.distance=g.length(z)}d="undefined"==typeof d.maxForce?Number.MAX_VALUE:d.maxForce;a=new k(a,c,-d,d);this.equations=[a];this.maxForce=d;var z=g.create(),y=g.create(),q=g.create(),G=this;a.computeGq=function(){var a=this.bodyA,c=this.bodyB,d=a.position,f=c.position;return g.rotate(y,e,a.angle),g.rotate(q,l,c.angle),g.add(z,f,q),g.sub(z,z,y),g.sub(z,z,d),g.length(z)-G.distance};this.setMaxForce(d);this.upperLimitEnabled=
!1;this.upperLimit=1;this.lowerLimitEnabled=!1;this.position=this.lowerLimit=0}var f=a("./Constraint"),k=a("../equations/Equation"),g=a("../math/vec2"),h=a("../utils/Utils");e.exports=d;d.prototype=new f;d.prototype.constructor=d;var l=g.create(),m=g.create(),p=g.create();d.prototype.update=function(){var a=this.equations[0],c=this.bodyA,d=this.bodyB,e=(this.distance,c.position),f=d.position,k=this.equations[0],a=a.G;g.rotate(m,this.localAnchorA,c.angle);g.rotate(p,this.localAnchorB,d.angle);g.add(l,
f,p);g.sub(l,l,m);g.sub(l,l,e);this.position=g.length(l);c=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(k.maxForce=0,k.minForce=-this.maxForce,this.distance=this.upperLimit,c=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(k.maxForce=this.maxForce,k.minForce=0,this.distance=this.lowerLimit,c=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!c)return void(k.enabled=!1);k.enabled=!0;g.normalize(l,l);k=g.crossLength(m,l);c=g.crossLength(p,l);a[0]=-l[0];a[1]=-l[1];a[2]=
-k;a[3]=l[0];a[4]=l[1];a[5]=c};d.prototype.setMaxForce=function(a){var c=this.equations[0];c.minForce=-a;c.maxForce=a};d.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":23,"../math/vec2":31,"../utils/Utils":50,"./Constraint":15}],17:[function(a,e){function d(a,c,d){d=d||{};f.call(this,a,c,f.GEAR,d);this.ratio="number"==typeof d.ratio?d.ratio:1;this.angle="number"==typeof d.angle?d.angle:c.angle-this.ratio*a.angle;d.angle=this.angle;d.ratio=this.ratio;
this.equations=[new k(a,c,d)];"number"==typeof d.maxTorque&&this.setMaxTorque(d.maxTorque)}var f=a("./Constraint"),k=(a("../equations/Equation"),a("../equations/AngleLockEquation"));a("../math/vec2");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.update=function(){var a=this.equations[0];a.ratio!==this.ratio&&a.setRatio(this.ratio);a.angle=this.angle};d.prototype.setMaxTorque=function(a){this.equations[0].setMaxTorque(a)};d.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},
{"../equations/AngleLockEquation":21,"../equations/Equation":23,"../math/vec2":31,"./Constraint":15}],18:[function(a,e){function d(a,c,d){d=d||{};f.call(this,a,c,f.LOCK,d);var e="undefined"==typeof d.maxForce?Number.MAX_VALUE:d.maxForce,h=(d.localAngleB||0,new g(a,c,-e,e)),l=new g(a,c,-e,e),m=new g(a,c,-e,e),u=k.create(),p=k.create(),z=this;h.computeGq=function(){return k.rotate(u,z.localOffsetB,a.angle),k.sub(p,c.position,a.position),k.sub(p,p,u),p[0]};l.computeGq=function(){return k.rotate(u,z.localOffsetB,
a.angle),k.sub(p,c.position,a.position),k.sub(p,p,u),p[1]};var y=k.create(),q=k.create();m.computeGq=function(){return k.rotate(y,z.localOffsetB,c.angle-z.localAngleB),k.scale(y,y,-1),k.sub(p,a.position,c.position),k.add(p,p,y),k.rotate(q,y,-Math.PI/2),k.normalize(q,q),k.dot(p,q)};this.localOffsetB=k.create();d.localOffsetB?k.copy(this.localOffsetB,d.localOffsetB):(k.sub(this.localOffsetB,c.position,a.position),k.rotate(this.localOffsetB,this.localOffsetB,-a.angle));this.localAngleB=0;this.localAngleB=
"number"==typeof d.localAngleB?d.localAngleB:c.angle-a.angle;this.equations.push(h,l,m);this.setMaxForce(e)}var f=a("./Constraint"),k=a("../math/vec2"),g=a("../equations/Equation");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.setMaxForce=function(a){for(var c=this.equations,d=0;d<this.equations.length;d++)c[d].maxForce=a,c[d].minForce=-a};d.prototype.getMaxForce=function(){return this.equations[0].maxForce};var h=k.create(),l=k.create(),m=k.create(),p=k.fromValues(1,0),t=k.fromValues(0,
1);d.prototype.update=function(){var a=this.equations[0],c=this.equations[1],d=this.equations[2],e=this.bodyB;k.rotate(h,this.localOffsetB,this.bodyA.angle);k.rotate(l,this.localOffsetB,e.angle-this.localAngleB);k.scale(l,l,-1);k.rotate(m,l,Math.PI/2);k.normalize(m,m);a.G[0]=-1;a.G[1]=0;a.G[2]=-k.crossLength(h,p);a.G[3]=1;c.G[0]=0;c.G[1]=-1;c.G[2]=-k.crossLength(h,t);c.G[4]=1;d.G[0]=-m[0];d.G[1]=-m[1];d.G[3]=m[0];d.G[4]=m[1];d.G[5]=k.crossLength(l,m)}},{"../equations/Equation":23,"../math/vec2":31,
"./Constraint":15}],19:[function(a,e){function d(a,c,d){d=d||{};f.call(this,a,c,f.PRISMATIC,d);var e=h.fromValues(0,0),m=h.fromValues(1,0),p=h.fromValues(0,0);d.localAnchorA&&h.copy(e,d.localAnchorA);d.localAxisA&&h.copy(m,d.localAxisA);d.localAnchorB&&h.copy(p,d.localAnchorB);this.localAnchorA=e;this.localAnchorB=p;this.localAxisA=m;var y=this.maxForce="undefined"!=typeof d.maxForce?d.maxForce:Number.MAX_VALUE,q=new g(a,c,-y,y),t=new h.create,w=new h.create,v=new h.create,x=new h.create;(q.computeGq=
function(){return h.dot(v,x)},q.updateJacobian=function(){var d=this.G,f=a.position,k=c.position;h.rotate(t,e,a.angle);h.rotate(w,p,c.angle);h.add(v,k,w);h.sub(v,v,f);h.sub(v,v,t);h.rotate(x,m,a.angle+Math.PI/2);d[0]=-x[0];d[1]=-x[1];d[2]=-h.crossLength(t,x)+h.crossLength(x,v);d[3]=x[0];d[4]=x[1];d[5]=h.crossLength(w,x)},this.equations.push(q),d.disableRotationalLock)||(q=new l(a,c,-y,y),this.equations.push(q));this.velocity=this.position=0;this.lowerLimitEnabled="undefined"!=typeof d.lowerLimit?
!0:!1;this.upperLimitEnabled="undefined"!=typeof d.upperLimit?!0:!1;this.lowerLimit="undefined"!=typeof d.lowerLimit?d.lowerLimit:0;this.upperLimit="undefined"!=typeof d.upperLimit?d.upperLimit:1;this.upperLimitEquation=new k(a,c);this.lowerLimitEquation=new k(a,c);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=y;this.motorEquation=new g(a,c);this.motorEnabled=!1;this.motorSpeed=0;var L=this;d=this.motorEquation;
d.computeGW;d.computeGq=function(){return 0};d.computeGW=function(){var a=this.bodyA,c=this.bodyB;return this.gmult(this.G,a.velocity,a.angularVelocity,c.velocity,c.angularVelocity)+L.motorSpeed}}var f=a("./Constraint"),k=a("../equations/ContactEquation"),g=a("../equations/Equation"),h=a("../math/vec2"),l=a("../equations/RotationalLockEquation");e.exports=d;d.prototype=new f;d.prototype.constructor=d;var m=h.create(),p=h.create(),t=h.create(),x=h.create(),v=h.create(),w=h.create();d.prototype.update=
function(){var a=this.equations,c=this.upperLimit,d=this.lowerLimit,e=this.upperLimitEquation,f=this.lowerLimitEquation,k=this.bodyA,g=this.bodyB,n=this.localAxisA,l=this.localAnchorA,z=this.localAnchorB;a[0].updateJacobian();h.rotate(m,n,k.angle);h.rotate(x,l,k.angle);h.add(p,x,k.position);h.rotate(v,z,g.angle);h.add(t,v,g.position);n=this.position=h.dot(t,m)-h.dot(p,m);this.motorEnabled&&(l=this.motorEquation.G,l[0]=m[0],l[1]=m[1],l[2]=h.crossLength(m,v),l[3]=-m[0],l[4]=-m[1],l[5]=-h.crossLength(m,
x));this.upperLimitEnabled&&n>c?(h.scale(e.normalA,m,-1),h.sub(e.contactPointA,p,k.position),h.sub(e.contactPointB,t,g.position),h.scale(w,m,c),h.add(e.contactPointA,e.contactPointA,w),-1===a.indexOf(e)&&a.push(e)):(c=a.indexOf(e),-1!==c&&a.splice(c,1));this.lowerLimitEnabled&&d>n?(h.scale(f.normalA,m,1),h.sub(f.contactPointA,p,k.position),h.sub(f.contactPointB,t,g.position),h.scale(w,m,d),h.sub(f.contactPointB,f.contactPointB,w),-1===a.indexOf(f)&&a.push(f)):(c=a.indexOf(f),-1!==c&&a.splice(c,1))};
d.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};d.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1);this.motorEnabled=!1}};d.prototype.setLimits=function(a,c){"number"==typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1);"number"==typeof c?(this.upperLimit=c,this.upperLimitEnabled=!0):(this.upperLimit=
c,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../math/vec2":31,"./Constraint":15}],20:[function(a,e){function d(a,c,d){d=d||{};f.call(this,a,c,f.REVOLUTE,d);var e=this.maxForce="undefined"!=typeof d.maxForce?d.maxForce:Number.MAX_VALUE;this.pivotA=l.create();this.pivotB=l.create();d.worldPivot?(l.sub(this.pivotA,d.worldPivot,a.position),l.sub(this.pivotB,d.worldPivot,c.position),l.rotate(this.pivotA,this.pivotA,
-a.angle),l.rotate(this.pivotB,this.pivotB,-c.angle)):(l.copy(this.pivotA,d.localPivotA),l.copy(this.pivotB,d.localPivotB));var D=this.equations=[new k(a,c,-e,e),new k(a,c,-e,e)];d=D[0];var D=D[1],I=this;d.computeGq=function(){return l.rotate(m,I.pivotA,a.angle),l.rotate(p,I.pivotB,c.angle),l.add(v,c.position,p),l.sub(v,v,a.position),l.sub(v,v,m),l.dot(v,t)};D.computeGq=function(){return l.rotate(m,I.pivotA,a.angle),l.rotate(p,I.pivotB,c.angle),l.add(v,c.position,p),l.sub(v,v,a.position),l.sub(v,
v,m),l.dot(v,x)};D.minForce=d.minForce=-e;D.maxForce=d.maxForce=e;this.motorEquation=new g(a,c);this.motorEnabled=!1;this.angle=0;this.upperLimitEnabled=this.lowerLimitEnabled=!1;this.upperLimit=this.lowerLimit=0;this.upperLimitEquation=new h(a,c);this.lowerLimitEquation=new h(a,c);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}var f=a("./Constraint"),k=a("../equations/Equation"),g=a("../equations/RotationalVelocityEquation"),h=a("../equations/RotationalLockEquation"),l=a("../math/vec2");
e.exports=d;var m=l.create(),p=l.create(),t=l.fromValues(1,0),x=l.fromValues(0,1),v=l.create();d.prototype=new f;d.prototype.constructor=d;d.prototype.setLimits=function(a,c){"number"==typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1);"number"==typeof c?(this.upperLimit=c,this.upperLimitEnabled=!0):(this.upperLimit=c,this.upperLimitEnabled=!1)};d.prototype.update=function(){var a=this.bodyA,c=this.bodyB,d=this.pivotA,e=this.pivotB,f=this.equations,
k=(f[0],f[1],f[0]),g=f[1],h=this.upperLimit,n=this.lowerLimit,u=this.upperLimitEquation,v=this.lowerLimitEquation,K=this.angle=c.angle-a.angle;this.upperLimitEnabled&&K>h?(u.angle=h,-1===f.indexOf(u)&&f.push(u)):(h=f.indexOf(u),-1!==h&&f.splice(h,1));this.lowerLimitEnabled&&n>K?(v.angle=n,-1===f.indexOf(v)&&f.push(v)):(h=f.indexOf(v),-1!==h&&f.splice(h,1));l.rotate(m,d,a.angle);l.rotate(p,e,c.angle);k.G[0]=-1;k.G[1]=0;k.G[2]=-l.crossLength(m,t);k.G[3]=1;k.G[4]=0;k.G[5]=l.crossLength(p,t);g.G[0]=0;
g.G[1]=-1;g.G[2]=-l.crossLength(m,x);g.G[3]=0;g.G[4]=1;g.G[5]=l.crossLength(p,x)};d.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};d.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1);this.motorEnabled=!1}};d.prototype.motorIsEnabled=function(){return!!this.motorEnabled};d.prototype.setMotorSpeed=function(a){if(this.motorEnabled){var c=this.equations.indexOf(this.motorEquation);
this.equations[c].relativeVelocity=a}};d.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../equations/RotationalVelocityEquation":26,"../math/vec2":31,"./Constraint":15}],21:[function(a,e){function d(a,c,d){d=d||{};f.call(this,a,c,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=d.angle||0;this.ratio="number"==typeof d.ratio?d.ratio:1;this.setRatio(this.ratio)}var f=a("./Equation");
a("../math/vec2");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};d.prototype.setRatio=function(a){var c=this.G;c[2]=a;c[5]=-1;this.ratio=a};d.prototype.setMaxTorque=function(a){this.maxForce=a;this.minForce=-a}},{"../math/vec2":31,"./Equation":23}],22:[function(a,e){function d(a,c){f.call(this,a,c,0,Number.MAX_VALUE);this.contactPointA=k.create();this.penetrationVec=k.create();this.contactPointB=
k.create();this.normalA=k.create();this.restitution=0;this.firstImpact=!1;this.shapeB=this.shapeA=null}var f=a("./Equation"),k=a("../math/vec2");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.computeB=function(a,c,d){var e=this.contactPointA,f=this.contactPointB,g=this.bodyA.position,h=this.bodyB.position,l=this.penetrationVec,m=this.normalA,p=this.G,F=k.crossLength(e,m),C=k.crossLength(f,m);p[0]=-m[0];p[1]=-m[1];p[2]=-F;p[3]=m[0];p[4]=m[1];p[5]=C;k.add(l,h,f);k.sub(l,l,g);k.sub(l,
l,e);var D,I;this.firstImpact&&0!==this.restitution?(I=0,D=1/c*(1+this.restitution)*this.computeGW()):(I=k.dot(m,l)+this.offset,D=this.computeGW());e=this.computeGiMf();return-I*a-D*c-d*e}},{"../math/vec2":31,"./Equation":23}],23:[function(a,e){function d(a,c,e,f){this.minForce="undefined"==typeof e?-Number.MAX_VALUE:e;this.maxForce="undefined"==typeof f?Number.MAX_VALUE:f;this.bodyA=a;this.bodyB=c;this.stiffness=d.DEFAULT_STIFFNESS;this.relaxation=d.DEFAULT_RELAXATION;this.G=new k.ARRAY_TYPE(6);
for(a=0;6>a;a++)this.G[a]=0;this.epsilon=this.b=this.a=this.offset=0;this.timeStep=1/60;this.needsUpdate=!0;this.relativeVelocity=this.multiplier=0;this.enabled=!0}e.exports=d;var f=a("../math/vec2"),k=a("../utils/Utils");a("../objects/Body");d.prototype.constructor=d;d.DEFAULT_STIFFNESS=1E6;d.DEFAULT_RELAXATION=4;d.prototype.update=function(){var a=this.stiffness,c=this.relaxation,d=this.timeStep;this.a=4/(d*(1+4*c));this.b=4*c/(1+4*c);this.epsilon=4/(d*d*a*(1+4*c));this.needsUpdate=!1};d.prototype.gmult=
function(a,c,d,e,f){return a[0]*c[0]+a[1]*c[1]+a[2]*d+a[3]*e[0]+a[4]*e[1]+a[5]*f};d.prototype.computeB=function(a,c,d){var e=this.computeGW(),f=this.computeGq(),k=this.computeGiMf();return-f*a-e*c-k*d};var g=f.create(),h=f.create();d.prototype.computeGq=function(){var a=this.G,c=this.bodyA,d=this.bodyB,c=(c.position,d.position,c.angle);return this.gmult(a,g,c,h,d.angle)+this.offset};d.prototype.computeGW=function(){var a=this.bodyA,c=this.bodyB;return this.gmult(this.G,a.velocity,a.angularVelocity,
c.velocity,c.angularVelocity)+this.relativeVelocity};d.prototype.computeGWlambda=function(){var a=this.bodyA,c=this.bodyB;return this.gmult(this.G,a.vlambda,a.wlambda,c.vlambda,c.wlambda)};var l=f.create(),m=f.create();d.prototype.computeGiMf=function(){var a=this.bodyA,c=this.bodyB,d=a.angularForce,e=c.force,k=c.angularForce,g=c.invMassSolve,h=a.invInertiaSolve,c=c.invInertiaSolve,n=this.G;return f.scale(l,a.force,a.invMassSolve),f.scale(m,e,g),this.gmult(n,l,d*h,m,k*c)};d.prototype.computeGiMGt=
function(){var a=this.bodyA,c=this.bodyB,d=a.invMassSolve,e=c.invMassSolve,f=this.G;return f[0]*f[0]*d+f[1]*f[1]*d+f[2]*f[2]*a.invInertiaSolve+f[3]*f[3]*e+f[4]*f[4]*e+f[5]*f[5]*c.invInertiaSolve};var p=f.create(),t=f.create(),x=f.create();f.create();f.create();f.create();d.prototype.addToWlambda=function(a){var c=this.bodyA,d=this.bodyB,e=c.invMassSolve,k=d.invMassSolve,g=c.invInertiaSolve,h=d.invInertiaSolve,n=this.G;t[0]=n[0];t[1]=n[1];x[0]=n[3];x[1]=n[4];f.scale(p,t,e*a);f.add(c.vlambda,c.vlambda,
p);c.wlambda+=g*n[2]*a;f.scale(p,x,k*a);f.add(d.vlambda,d.vlambda,p);d.wlambda+=h*n[5]*a};d.prototype.computeInvC=function(a){return 1/(this.computeGiMGt()+a)}},{"../math/vec2":31,"../objects/Body":32,"../utils/Utils":50}],24:[function(a,e){function d(a,c,d){k.call(this,a,c,-d,d);this.contactPointA=f.create();this.contactPointB=f.create();this.t=f.create();this.contactEquations=[];this.shapeB=this.shapeA=null;this.frictionCoefficient=.3}var f=a("../math/vec2"),k=a("./Equation");a("../utils/Utils");
e.exports=d;d.prototype=new k;d.prototype.constructor=d;d.prototype.setSlipForce=function(a){this.maxForce=a;this.minForce=-a};d.prototype.getSlipForce=function(){return this.maxForce};d.prototype.computeB=function(a,c,d){a=(this.bodyA,this.bodyB,this.contactPointA);var e=this.contactPointB,k=this.t,g=this.G;g[0]=-k[0];g[1]=-k[1];g[2]=-f.crossLength(a,k);g[3]=k[0];g[4]=k[1];g[5]=f.crossLength(e,k);a=this.computeGW();e=this.computeGiMf();return-a*c-d*e}},{"../math/vec2":31,"../utils/Utils":50,"./Equation":23}],
25:[function(a,e){function d(a,c,d){d=d||{};f.call(this,a,c,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=d.angle||0;a=this.G;a[2]=1;a[5]=-1}var f=a("./Equation"),k=a("../math/vec2");e.exports=d;d.prototype=new f;d.prototype.constructor=d;var g=k.create(),h=k.create(),l=k.fromValues(1,0),m=k.fromValues(0,1);d.prototype.computeGq=function(){return k.rotate(g,l,this.bodyA.angle+this.angle),k.rotate(h,m,this.bodyB.angle),k.dot(g,h)}},{"../math/vec2":31,"./Equation":23}],26:[function(a,e){function d(a,
c){f.call(this,a,c,-Number.MAX_VALUE,Number.MAX_VALUE);this.ratio=this.relativeVelocity=1}var f=a("./Equation");a("../math/vec2");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.computeB=function(a,c,d){a=this.G;a[2]=-1;a[5]=this.ratio;a=this.computeGiMf();return-this.computeGW()*c-d*a}},{"../math/vec2":31,"./Equation":23}],27:[function(a,e){var d=function(){};e.exports=d;d.prototype={constructor:d,on:function(a,c,d){c.context=d||this;void 0===this._listeners&&(this._listeners=
{});d=this._listeners;return void 0===d[a]&&(d[a]=[]),-1===d[a].indexOf(c)&&d[a].push(c),this},has:function(a,c){if(void 0===this._listeners)return!1;var d=this._listeners;if(c){if(void 0!==d[a]&&-1!==d[a].indexOf(c))return!0}else if(void 0!==d[a])return!0;return!1},off:function(a,c){if(void 0===this._listeners)return this;var d=this._listeners,e=d[a].indexOf(c);return-1!==e&&d[a].splice(e,1),this},emit:function(a){if(void 0===this._listeners)return this;var c=this._listeners[a.type];if(void 0!==
c){a.target=this;for(var d=0,e=c.length;e>d;d++){var g=c[d];g.call(g.context,a)}}return this}}},{}],28:[function(a,e){function d(a,c,e){if(e=e||{},!(a instanceof f&&c instanceof f))throw Error("First two arguments must be Material instances.");this.id=d.idCounter++;this.materialA=a;this.materialB=c;this.friction="undefined"!=typeof e.friction?Number(e.friction):.3;this.restitution="undefined"!=typeof e.restitution?Number(e.restitution):0;this.stiffness="undefined"!=typeof e.stiffness?Number(e.stiffness):
k.DEFAULT_STIFFNESS;this.relaxation="undefined"!=typeof e.relaxation?Number(e.relaxation):k.DEFAULT_RELAXATION;this.frictionStiffness="undefined"!=typeof e.frictionStiffness?Number(e.frictionStiffness):k.DEFAULT_STIFFNESS;this.frictionRelaxation="undefined"!=typeof e.frictionRelaxation?Number(e.frictionRelaxation):k.DEFAULT_RELAXATION;this.surfaceVelocity="undefined"!=typeof e.surfaceVelocity?Number(e.surfaceVelocity):0;this.contactSkinSize=.005}var f=a("./Material"),k=a("../equations/Equation");
e.exports=d;d.idCounter=0},{"../equations/Equation":23,"./Material":29}],29:[function(a,e){function d(a){this.id=a||d.idCounter++}e.exports=d;d.idCounter=0},{}],30:[function(a,e){var d={GetArea:function(a){if(6>a.length)return 0;for(var c=a.length-2,d=0,e=0;c>e;e+=2)d+=(a[e+2]-a[e])*(a[e+1]+a[e+3]);return d+=(a[0]-a[c])*(a[c+1]+a[1]),.5*-d},Triangulate:function(a){var c=a.length>>1;if(3>c)return[];for(var e=[],g=[],h=0;c>h;h++)g.push(h);for(h=0;3<c;){var l=g[(h+0)%c],m=g[(h+1)%c],p=g[(h+2)%c],x=a[2*
l],v=a[2*l+1],w=a[2*m],r=a[2*m+1],F=a[2*p],C=a[2*p+1],D=!1;if(d._convex(x,v,w,r,F,C))for(var D=!0,I=0;c>I;I++){var A=g[I];if(A!=l&&A!=m&&A!=p&&d._PointInTriangle(a[2*A],a[2*A+1],x,v,w,r,F,C)){D=!1;break}}if(D)e.push(l,m,p),g.splice((h+1)%c,1),c--,h=0;else if(h++>3*c)break}return e.push(g[0],g[1],g[2]),e},_PointInTriangle:function(a,c,d,e,g,h,l,m){l-=d;m-=e;g-=d;h-=e;a-=d;d=c-e;c=l*l+m*m;e=l*g+m*h;l=l*a+m*d;m=g*g+h*h;g=g*a+h*d;h=1/(c*m-e*e);m=(m*l-e*g)*h;l=(c*g-e*l)*h;return 0<=m&&0<=l&&1>m+l},_convex:function(a,
c,d,e,g,h){return 0<=(c-e)*(g-d)+(d-a)*(h-e)}};e.exports=d},{}],31:[function(a,e){var d=e.exports={},f=a("../utils/Utils");d.crossLength=function(a,c){return a[0]*c[1]-a[1]*c[0]};d.crossVZ=function(a,c,e){return d.rotate(a,c,-Math.PI/2),d.scale(a,a,e),a};d.crossZV=function(a,c,e){return d.rotate(a,e,Math.PI/2),d.scale(a,a,c),a};d.rotate=function(a,c,d){if(0!==d){var e=Math.cos(d);d=Math.sin(d);var f=c[0];c=c[1];a[0]=e*f-d*c;a[1]=d*f+e*c}else a[0]=c[0],a[1]=c[1]};d.rotate90cw=function(a,c){var d=c[0];
a[0]=c[1];a[1]=-d};d.toLocalFrame=function(a,c,e,f){d.copy(a,c);d.sub(a,a,e);d.rotate(a,a,-f)};d.toGlobalFrame=function(a,c,e,f){d.copy(a,c);d.rotate(a,a,f);d.add(a,a,e)};d.centroid=function(a,c,e,f){return d.add(a,c,e),d.add(a,a,f),d.scale(a,a,1/3),a};d.create=function(){var a=new f.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a};d.clone=function(a){var c=new f.ARRAY_TYPE(2);return c[0]=a[0],c[1]=a[1],c};d.fromValues=function(a,c){var d=new f.ARRAY_TYPE(2);return d[0]=a,d[1]=c,d};d.copy=function(a,c){return a[0]=
c[0],a[1]=c[1],a};d.set=function(a,c,d){return a[0]=c,a[1]=d,a};d.add=function(a,c,d){return a[0]=c[0]+d[0],a[1]=c[1]+d[1],a};d.subtract=function(a,c,d){return a[0]=c[0]-d[0],a[1]=c[1]-d[1],a};d.sub=d.subtract;d.multiply=function(a,c,d){return a[0]=c[0]*d[0],a[1]=c[1]*d[1],a};d.mul=d.multiply;d.divide=function(a,c,d){return a[0]=c[0]/d[0],a[1]=c[1]/d[1],a};d.div=d.divide;d.scale=function(a,c,d){return a[0]=c[0]*d,a[1]=c[1]*d,a};d.distance=function(a,c){var d=c[0]-a[0],e=c[1]-a[1];return Math.sqrt(d*
d+e*e)};d.dist=d.distance;d.squaredDistance=function(a,c){var d=c[0]-a[0],e=c[1]-a[1];return d*d+e*e};d.sqrDist=d.squaredDistance;d.length=function(a){var c=a[0];a=a[1];return Math.sqrt(c*c+a*a)};d.len=d.length;d.squaredLength=function(a){var c=a[0];a=a[1];return c*c+a*a};d.sqrLen=d.squaredLength;d.negate=function(a,c){return a[0]=-c[0],a[1]=-c[1],a};d.normalize=function(a,c){var d=c[0],e=c[1],d=d*d+e*e;return 0<d&&(d=1/Math.sqrt(d),a[0]=c[0]*d,a[1]=c[1]*d),a};d.dot=function(a,c){return a[0]*c[0]+
a[1]*c[1]};d.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};d.lerp=function(a,c,d,e){var f=c[0];c=c[1];return a[0]=f+e*(d[0]-f),a[1]=c+e*(d[1]-c),a}},{"../utils/Utils":50}],32:[function(a,e){function d(a){a=a||{};l.call(this);this.id=++d._idCounter;this.world=null;this.shapes=[];this.shapeOffsets=[];this.shapeAngles=[];this.mass=a.mass||0;this.invInertiaSolve=this.invMassSolve=this.invInertia=this.inertia=this.invMass=0;this.fixedRotation=!!a.fixedRotation;this.position=f.fromValues(0,0);a.position&&
f.copy(this.position,a.position);this.interpolatedPosition=f.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=f.fromValues(0,0);this.previousAngle=0;this.velocity=f.fromValues(0,0);a.velocity&&f.copy(this.velocity,a.velocity);this.vlambda=f.fromValues(0,0);this.wlambda=0;this.angle=a.angle||0;this.angularVelocity=a.angularVelocity||0;this.force=f.create();a.force&&f.copy(this.force,a.force);this.angularForce=a.angularForce||0;this.damping="number"==typeof a.damping?a.damping:.1;this.angularDamping=
"number"==typeof a.angularDamping?a.angularDamping:.1;this.type=d.STATIC;this.type="undefined"!=typeof a.type?a.type:a.mass?d.DYNAMIC:d.STATIC;this.boundingRadius=0;this.aabb=new h;this.allowSleep=this.aabbNeedsUpdate=!0;this.wantsToSleep=!1;this.sleepState=d.AWAKE;this.sleepSpeedLimit=.2;this.gravityScale=this.sleepTimeLimit=1;this.collisionResponse=!0;this.timeLastSleepy=this.idleTime=0;this.ccdSpeedThreshold=void 0!==a.ccdSpeedThreshold?a.ccdSpeedThreshold:-1;this.ccdIterations=void 0!==a.ccdIterations?
a.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=!1;this.updateMassProperties()}var f=a("../math/vec2"),k=a("poly-decomp"),g=a("../shapes/Convex"),h=a("../collision/AABB"),l=a("../events/EventEmitter");e.exports=d;d.prototype=new l;d.prototype.constructor=d;d._idCounter=0;d.prototype.updateSolveMassProperties=function(){this.sleepState===d.SLEEPING||this.type===d.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)};
d.prototype.setDensity=function(a){this.mass=this.getArea()*a;this.updateMassProperties()};d.prototype.getArea=function(){for(var a=0,c=0;c<this.shapes.length;c++)a+=this.shapes[c].area;return a};d.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var m=new h,p=f.create();d.prototype.updateAABB=function(){for(var a=this.shapes,c=this.shapeOffsets,d=this.shapeAngles,e=a.length,k=this.angle,g=0;g!==e;g++){var h=a[g],n=d[g]+k;f.rotate(p,c[g],k);f.add(p,p,this.position);
h.computeAABB(m,p,n);0===g?this.aabb.copy(m):this.aabb.extend(m)}this.aabbNeedsUpdate=!1};d.prototype.updateBoundingRadius=function(){for(var a=this.shapes,c=this.shapeOffsets,d=a.length,e=0,k=0;k!==d;k++){var g=a[k],h=f.length(c[k]),g=g.boundingRadius;h+g>e&&(e=h+g)}this.boundingRadius=e};d.prototype.addShape=function(a,c,d){d=d||0;c=c?f.fromValues(c[0],c[1]):f.fromValues(0,0);this.shapes.push(a);this.shapeOffsets.push(c);this.shapeAngles.push(d);this.updateMassProperties();this.updateBoundingRadius();
this.aabbNeedsUpdate=!0};d.prototype.removeShape=function(a){a=this.shapes.indexOf(a);return-1!==a?(this.shapes.splice(a,1),this.shapeOffsets.splice(a,1),this.shapeAngles.splice(a,1),this.aabbNeedsUpdate=!0,!0):!1};d.prototype.updateMassProperties=function(){if(this.type===d.STATIC||this.type===d.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var a=this.shapes,c=a.length,e=this.mass/c,k=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,
this.invInertia=0;else{for(var g=0;c>g;g++)var h=a[g],n=f.squaredLength(this.shapeOffsets[g]),h=h.computeMomentOfInertia(e),k=k+(h+e*n);this.inertia=k;this.invInertia=0<k?1/k:0}this.invMass=1/this.mass}};var t=f.create();d.prototype.applyForce=function(a,c){f.sub(t,c,this.position);f.add(this.force,this.force,a);var d=f.crossLength(t,a);this.angularForce+=d};d.prototype.toLocalFrame=function(a,c){f.toLocalFrame(a,c,this.position,this.angle)};d.prototype.toWorldFrame=function(a,c){f.toGlobalFrame(a,
c,this.position,this.angle)};d.prototype.fromPolygon=function(a,c){c=c||{};for(var d=this.shapes.length;0<=d;--d)this.removeShape(this.shapes[d]);var e=new k.Polygon;if(e.vertices=a,e.makeCCW(),"number"==typeof c.removeCollinearPoints&&e.removeCollinearPoints(c.removeCollinearPoints),"undefined"==typeof c.skipSimpleCheck&&!e.isSimple())return!1;this.concavePath=e.vertices.slice(0);for(d=0;d<this.concavePath.length;d++){var h=[0,0];f.copy(h,this.concavePath[d]);this.concavePath[d]=h}for(var e=c.optimalDecomp?
e.decomp():e.quickDecomp(),l=f.create(),d=0;d!==e.length;d++){for(var m=new g(e[d].vertices),p=0;p!==m.vertices.length;p++)h=m.vertices[p],f.sub(h,h,m.centerOfMass);f.scale(l,m.centerOfMass,1);m.updateTriangles();m.updateCenterOfMass();m.updateBoundingRadius();this.addShape(m,l)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var x=(f.fromValues(0,0),f.fromValues(0,0)),v=f.fromValues(0,0),w=f.fromValues(0,0);d.prototype.adjustCenterOfMass=function(){var a=0;f.set(v,0,0);for(var c=0;c!==
this.shapes.length;c++){var d=this.shapes[c],e=this.shapeOffsets[c];f.scale(x,e,d.area);f.add(v,v,x);a+=d.area}f.scale(w,v,1/a);for(c=0;c!==this.shapes.length;c++)(e=this.shapeOffsets[c])||(e=this.shapeOffsets[c]=f.create()),f.sub(e,e,w);f.add(this.position,this.position,w);for(c=0;this.concavePath&&c<this.concavePath.length;c++)f.sub(this.concavePath[c],this.concavePath[c],w);this.updateMassProperties();this.updateBoundingRadius()};d.prototype.setZeroForce=function(){f.set(this.force,0,0);this.angularForce=
0};d.prototype.resetConstraintVelocity=function(){f.set(this.vlambda,0,0);this.wlambda=0};d.prototype.addConstraintVelocity=function(){var a=this.velocity;f.add(a,a,this.vlambda);this.angularVelocity+=this.wlambda};d.prototype.applyDamping=function(a){if(this.type===d.DYNAMIC){var c=this.velocity;f.scale(c,c,Math.pow(1-this.damping,a));this.angularVelocity*=Math.pow(1-this.angularDamping,a)}};d.prototype.wakeUp=function(){var a=this.sleepState;this.sleepState=d.AWAKE;this.idleTime=0;a!==d.AWAKE&&
this.emit(d.wakeUpEvent)};d.prototype.sleep=function(){this.sleepState=d.SLEEPING;this.angularForce=this.angularVelocity=0;f.set(this.velocity,0,0);f.set(this.force,0,0);this.emit(d.sleepEvent)};d.prototype.sleepTick=function(a,c,e){if(this.allowSleep&&this.type!==d.SLEEPING){this.wantsToSleep=!1;a=(this.sleepState,f.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2));var k=Math.pow(this.sleepSpeedLimit,2);a>=k?(this.idleTime=0,this.sleepState=d.AWAKE):(this.idleTime+=e,this.sleepState=
d.SLEEPY);this.idleTime>this.sleepTimeLimit&&(c?this.wantsToSleep=!0:this.sleep())}};d.prototype.getVelocityFromPosition=function(a,c){return a=a||f.create(),f.sub(a,this.position,this.previousPosition),f.scale(a,a,1/c),a};d.prototype.getAngularVelocityFromPosition=function(a){return(this.angle-this.previousAngle)/a};d.prototype.overlaps=function(a){return this.world.overlapKeeper.bodiesAreOverlapping(this,a)};var r=f.create(),F=f.create();d.prototype.integrate=function(a){var c=this.invMass,d=this.force,
e=this.position,k=this.velocity;f.copy(this.previousPosition,this.position);this.previousAngle=this.angle;this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*a);f.scale(r,d,a*c);f.add(k,r,k);this.integrateToTimeOfImpact(a)||(f.scale(F,k,a),f.add(e,e,F),this.fixedRotation||(this.angle+=this.angularVelocity*a));this.aabbNeedsUpdate=!0};var C=f.create(),D=f.create(),I=f.create(),A=f.create();d.prototype.integrateToTimeOfImpact=function(a){if(0>this.ccdSpeedThreshold||f.squaredLength(this.velocity)<
Math.pow(this.ccdSpeedThreshold,2))return!1;f.normalize(C,this.velocity);f.scale(D,this.velocity,a);f.add(D,D,this.position);f.sub(I,D,this.position);var c;a*=this.angularVelocity;var d=f.length(I),e=1,k=this;if(this.world.raycastAll(this.position,D,{},function(a){a.body!==k&&(c=a.body,f.copy(D,a.hitPointWorld),f.sub(I,a.hitPointWorld,k.position),e=f.length(I)/d,a.abort())}),!c)return!1;var g=this.angle;f.copy(A,this.position);for(var h=0,n=0,l=0,m=e;m>=n&&h<this.ccdIterations;)h++,l=(m-n)/2,f.scale(F,
I,e),f.add(this.position,A,F),this.angle=g+a*e,this.updateAABB(),this.aabb.overlaps(c.aabb)&&this.world.narrowphase.bodiesOverlap(this,c)?n=l:m=l;return e=l,f.copy(this.position,A),this.angle=g,f.scale(F,I,e),f.add(this.position,this.position,F),this.fixedRotation||(this.angle+=a*e),!0};d.sleepyEvent={type:"sleepy"};d.sleepEvent={type:"sleep"};d.wakeUpEvent={type:"wakeup"};d.DYNAMIC=1;d.STATIC=2;d.KINEMATIC=4;d.AWAKE=0;d.SLEEPY=1;d.SLEEPING=2},{"../collision/AABB":7,"../events/EventEmitter":27,"../math/vec2":31,
"../shapes/Convex":39,"poly-decomp":5}],33:[function(a,e){function d(a,c,d){d=d||{};k.call(this,a,c,d);this.localAnchorA=f.fromValues(0,0);this.localAnchorB=f.fromValues(0,0);d.localAnchorA&&f.copy(this.localAnchorA,d.localAnchorA);d.localAnchorB&&f.copy(this.localAnchorB,d.localAnchorB);d.worldAnchorA&&this.setWorldAnchorA(d.worldAnchorA);d.worldAnchorB&&this.setWorldAnchorB(d.worldAnchorB);a=f.create();c=f.create();this.getWorldAnchorA(a);this.getWorldAnchorB(c);a=f.distance(a,c);this.restLength=
"number"==typeof d.restLength?d.restLength:a}var f=a("../math/vec2"),k=a("./Spring");a("../utils/Utils");e.exports=d;d.prototype=new k;d.prototype.constructor=d;d.prototype.setWorldAnchorA=function(a){this.bodyA.toLocalFrame(this.localAnchorA,a)};d.prototype.setWorldAnchorB=function(a){this.bodyB.toLocalFrame(this.localAnchorB,a)};d.prototype.getWorldAnchorA=function(a){this.bodyA.toWorldFrame(a,this.localAnchorA)};d.prototype.getWorldAnchorB=function(a){this.bodyB.toWorldFrame(a,this.localAnchorB)};
var g=f.create(),h=f.create(),l=f.create(),m=f.create(),p=f.create(),t=f.create(),x=f.create(),v=f.create(),w=f.create();d.prototype.applyForce=function(){var a=this.stiffness,c=this.damping,d=this.restLength,e=this.bodyA,k=this.bodyB;this.getWorldAnchorA(p);this.getWorldAnchorB(t);f.sub(x,p,e.position);f.sub(v,t,k.position);f.sub(g,t,p);var A=f.len(g);f.normalize(h,g);f.sub(l,k.velocity,e.velocity);f.crossZV(w,k.angularVelocity,v);f.add(l,l,w);f.crossZV(w,e.angularVelocity,x);f.sub(l,l,w);f.scale(m,
h,-a*(A-d)-c*f.dot(l,h));f.sub(e.force,e.force,m);f.add(k.force,k.force,m);a=f.crossLength(x,m);c=f.crossLength(v,m);e.angularForce-=a;k.angularForce+=c}},{"../math/vec2":31,"../utils/Utils":50,"./Spring":35}],34:[function(a,e){function d(a,c,d){d=d||{};f.call(this,a,c,d);this.restAngle="number"==typeof d.restAngle?d.restAngle:c.angle-a.angle}var f=(a("../math/vec2"),a("./Spring"));e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.applyForce=function(){var a=this.bodyA,c=this.bodyB,
d=-this.stiffness*(c.angle-a.angle-this.restAngle)-this.damping*(c.angularVelocity-a.angularVelocity)*0;a.angularForce-=d;c.angularForce+=d}},{"../math/vec2":31,"./Spring":35}],35:[function(a,e){function d(a,c,d){d=f.defaults(d,{stiffness:100,damping:1});this.stiffness=d.stiffness;this.damping=d.damping;this.bodyA=a;this.bodyB=c}var f=(a("../math/vec2"),a("../utils/Utils"));e.exports=d;d.prototype.applyForce=function(){}},{"../math/vec2":31,"../utils/Utils":50}],36:[function(a,e){e.exports={AABB:a("./collision/AABB"),
AngleLockEquation:a("./equations/AngleLockEquation"),Body:a("./objects/Body"),Broadphase:a("./collision/Broadphase"),Capsule:a("./shapes/Capsule"),Circle:a("./shapes/Circle"),Constraint:a("./constraints/Constraint"),ContactEquation:a("./equations/ContactEquation"),ContactMaterial:a("./material/ContactMaterial"),Convex:a("./shapes/Convex"),DistanceConstraint:a("./constraints/DistanceConstraint"),Equation:a("./equations/Equation"),EventEmitter:a("./events/EventEmitter"),FrictionEquation:a("./equations/FrictionEquation"),
GearConstraint:a("./constraints/GearConstraint"),GridBroadphase:a("./collision/GridBroadphase"),GSSolver:a("./solver/GSSolver"),Heightfield:a("./shapes/Heightfield"),Line:a("./shapes/Line"),LockConstraint:a("./constraints/LockConstraint"),Material:a("./material/Material"),Narrowphase:a("./collision/Narrowphase"),NaiveBroadphase:a("./collision/NaiveBroadphase"),Particle:a("./shapes/Particle"),Plane:a("./shapes/Plane"),RevoluteConstraint:a("./constraints/RevoluteConstraint"),PrismaticConstraint:a("./constraints/PrismaticConstraint"),
Ray:a("./collision/Ray"),RaycastResult:a("./collision/RaycastResult"),Rectangle:a("./shapes/Rectangle"),RotationalVelocityEquation:a("./equations/RotationalVelocityEquation"),SAPBroadphase:a("./collision/SAPBroadphase"),Shape:a("./shapes/Shape"),Solver:a("./solver/Solver"),Spring:a("./objects/Spring"),LinearSpring:a("./objects/LinearSpring"),RotationalSpring:a("./objects/RotationalSpring"),Utils:a("./utils/Utils"),World:a("./world/World"),vec2:a("./math/vec2"),version:a("../package.json").version}},
{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/GridBroadphase":9,"./collision/NaiveBroadphase":10,"./collision/Narrowphase":11,"./collision/Ray":12,"./collision/RaycastResult":13,"./collision/SAPBroadphase":14,"./constraints/Constraint":15,"./constraints/DistanceConstraint":16,"./constraints/GearConstraint":17,"./constraints/LockConstraint":18,"./constraints/PrismaticConstraint":19,"./constraints/RevoluteConstraint":20,"./equations/AngleLockEquation":21,"./equations/ContactEquation":22,
"./equations/Equation":23,"./equations/FrictionEquation":24,"./equations/RotationalVelocityEquation":26,"./events/EventEmitter":27,"./material/ContactMaterial":28,"./material/Material":29,"./math/vec2":31,"./objects/Body":32,"./objects/LinearSpring":33,"./objects/RotationalSpring":34,"./objects/Spring":35,"./shapes/Capsule":37,"./shapes/Circle":38,"./shapes/Convex":39,"./shapes/Heightfield":40,"./shapes/Line":41,"./shapes/Particle":42,"./shapes/Plane":43,"./shapes/Rectangle":44,"./shapes/Shape":45,
"./solver/GSSolver":46,"./solver/Solver":47,"./utils/Utils":50,"./world/World":54}],37:[function(a,e){function d(a,c){this.length=a||1;this.radius=c||1;f.call(this,f.CAPSULE)}var f=a("./Shape"),k=a("../math/vec2");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(a){var c=this.radius,d=this.length+c,c=2*c;return a*(c*c+d*d)/12};d.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};d.prototype.updateArea=function(){this.area=
Math.PI*this.radius*this.radius+2*this.radius*this.length};var g=k.create();d.prototype.computeAABB=function(a,c,d){var e=this.radius;k.set(g,this.length/2,0);0!==d&&k.rotate(g,g,d);k.set(a.upperBound,Math.max(g[0]+e,-g[0]+e),Math.max(g[1]+e,-g[1]+e));k.set(a.lowerBound,Math.min(g[0]-e,-g[0]-e),Math.min(g[1]-e,-g[1]-e));k.add(a.lowerBound,a.lowerBound,c);k.add(a.upperBound,a.upperBound,c)}},{"../math/vec2":31,"./Shape":45}],38:[function(a,e){function d(a){this.radius=a||1;f.call(this,f.CIRCLE)}var f=
a("./Shape"),g=a("../math/vec2");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(a){var c=this.radius;return a*c*c/2};d.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};d.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};d.prototype.computeAABB=function(a,c){var d=this.radius;g.set(a.upperBound,d,d);g.set(a.lowerBound,-d,-d);c&&(g.add(a.lowerBound,a.lowerBound,c),g.add(a.upperBound,a.upperBound,
c))}},{"../math/vec2":31,"./Shape":45}],39:[function(a,e){function d(a,c){this.vertices=[];this.axes=[];for(var d=0;d<a.length;d++){var e=g.create();g.copy(e,a[d]);this.vertices.push(e)}if(c)for(d=0;d<c.length;d++)e=g.create(),g.copy(e,c[d]),this.axes.push(e);else for(d=0;d<a.length;d++){var e=a[d],h=a[(d+1)%a.length],n=g.create();g.sub(n,h,e);g.rotate90cw(n,n);g.normalize(n,n);this.axes.push(n)}if(this.centerOfMass=g.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),
this.updateCenterOfMass()),this.boundingRadius=0,f.call(this,f.CONVEX),this.updateBoundingRadius(),this.updateArea(),0>this.area)throw Error("Convex vertices must be given in conter-clockwise winding.");}var f=a("./Shape"),g=a("../math/vec2"),h=a("../math/polyk");a("poly-decomp");e.exports=d;d.prototype=new f;d.prototype.constructor=d;var l=g.create(),m=g.create();d.prototype.projectOntoLocalAxis=function(a,c){var d,e=null,f=null;a=l;for(var h=0;h<this.vertices.length;h++)d=this.vertices[h],d=g.dot(d,
a),(null===e||d>e)&&(e=d),(null===f||f>d)&&(f=d);f>e&&(h=f,f=e,e=h);g.set(c,f,e)};d.prototype.projectOntoWorldAxis=function(a,c,d,e){var f=m;this.projectOntoLocalAxis(a,e);0!==d?g.rotate(f,a,d):f=a;a=g.dot(c,f);g.set(e,e[0]+a,e[1]+a)};d.prototype.updateTriangles=function(){this.triangles.length=0;for(var a=[],c=0;c<this.vertices.length;c++){var d=this.vertices[c];a.push(d[0],d[1])}a=h.Triangulate(a);for(c=0;c<a.length;c+=3)this.triangles.push([a[c],a[c+1],a[c+2]])};var p=g.create(),q=g.create(),t=
g.create(),x=g.create(),v=g.create();g.create();g.create();g.create();g.create();d.prototype.updateCenterOfMass=function(){var a=this.triangles,c=this.vertices,e=this.centerOfMass,f=t,h=x,n=v;g.set(e,0,0);for(var l=0,m=0;m!==a.length;m++)n=a[m],f=c[n[0]],h=c[n[1]],n=c[n[2]],g.centroid(p,f,h,n),f=d.triangleArea(f,h,n),l+=f,g.scale(q,p,f),g.add(e,e,q);g.scale(e,e,1/l)};d.prototype.computeMomentOfInertia=function(a){for(var c=0,d=0,e=this.vertices.length,f=e-1,h=0;e>h;f=h,h++)var n=this.vertices[f],
l=this.vertices[h],f=Math.abs(g.crossLength(n,l)),n=g.dot(l,l)+g.dot(l,n)+g.dot(n,n),c=c+f*n,d=d+f;return a/6*(c/d)};d.prototype.updateBoundingRadius=function(){for(var a=this.vertices,c=0,d=0;d!==a.length;d++){var e=g.squaredLength(a[d]);e>c&&(c=e)}this.boundingRadius=Math.sqrt(c)};d.triangleArea=function(a,c,d){return.5*((c[0]-a[0])*(d[1]-a[1])-(d[0]-a[0])*(c[1]-a[1]))};d.prototype.updateArea=function(){this.updateTriangles();this.area=0;for(var a=this.triangles,c=this.vertices,e=0;e!==a.length;e++){var f=
a[e],f=d.triangleArea(c[f[0]],c[f[1]],c[f[2]]);this.area+=f}};d.prototype.computeAABB=function(a,c,d){a.setFromPoints(this.vertices,c,d,0)}},{"../math/polyk":30,"../math/vec2":31,"./Shape":45,"poly-decomp":5}],40:[function(a,e){function d(a,c){if(c=g.defaults(c,{maxValue:null,minValue:null,elementWidth:.1}),null===c.minValue||null===c.maxValue){c.maxValue=a[0];c.minValue=a[0];for(var d=0;d!==a.length;d++){var e=a[d];e>c.maxValue&&(c.maxValue=e);e<c.minValue&&(c.minValue=e)}}this.data=a;this.maxValue=
c.maxValue;this.minValue=c.minValue;this.elementWidth=c.elementWidth;f.call(this,f.HEIGHTFIELD)}var f=a("./Shape"),g=(a("../math/vec2"),a("../utils/Utils"));e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE};d.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};d.prototype.updateArea=function(){for(var a=this.data,c=0,d=0;d<a.length-1;d++)c+=(a[d]+a[d+1])/2*this.elementWidth;this.area=c};d.prototype.computeAABB=
function(a,c){a.upperBound[0]=this.elementWidth*this.data.length+c[0];a.upperBound[1]=this.maxValue+c[1];a.lowerBound[0]=c[0];a.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45}],41:[function(a,e){function d(a){this.length=a||1;f.call(this,f.LINE)}var f=a("./Shape"),g=a("../math/vec2");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(a){return a*Math.pow(this.length,2)/12};d.prototype.updateBoundingRadius=function(){this.boundingRadius=
this.length/2};var h=[g.create(),g.create()];d.prototype.computeAABB=function(a,c,d){var e=this.length/2;g.set(h[0],-e,0);g.set(h[1],e,0);a.setFromPoints(h,c,d,0)}},{"../math/vec2":31,"./Shape":45}],42:[function(a,e){function d(){f.call(this,f.PARTICLE)}var f=a("./Shape"),g=a("../math/vec2");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(){return 0};d.prototype.updateBoundingRadius=function(){this.boundingRadius=0};d.prototype.computeAABB=function(a,
c){g.copy(a.lowerBound,c);g.copy(a.upperBound,c)}},{"../math/vec2":31,"./Shape":45}],43:[function(a,e){function d(){f.call(this,f.PLANE)}var f=a("./Shape"),g=a("../math/vec2");a("../utils/Utils");e.exports=d;d.prototype=new f;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(){return 0};d.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};d.prototype.computeAABB=function(a,c,d){var e=0,f=g.set;"number"==typeof d&&(e=d%(2*Math.PI));0===e?(f(a.lowerBound,
-Number.MAX_VALUE,-Number.MAX_VALUE),f(a.upperBound,Number.MAX_VALUE,0)):e===Math.PI/2?(f(a.lowerBound,0,-Number.MAX_VALUE),f(a.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):e===Math.PI?(f(a.lowerBound,-Number.MAX_VALUE,0),f(a.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):e===3*Math.PI/2?(f(a.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),f(a.upperBound,0,Number.MAX_VALUE)):(f(a.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),f(a.upperBound,Number.MAX_VALUE,Number.MAX_VALUE));g.add(a.lowerBound,
a.lowerBound,c);g.add(a.upperBound,a.upperBound,c)};d.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45}],44:[function(a,e){function d(a,c){this.width=a||1;this.height=c||1;var d=[f.fromValues(-a/2,-c/2),f.fromValues(a/2,-c/2),f.fromValues(a/2,c/2),f.fromValues(-a/2,c/2)],e=[f.fromValues(1,0),f.fromValues(0,1)];h.call(this,d,e);this.type=g.RECTANGLE}var f=a("../math/vec2"),g=a("./Shape"),h=a("./Convex");e.exports=d;d.prototype=new h([]);
d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(a){var c=this.width,d=this.height;return a*(d*d+c*c)/12};d.prototype.updateBoundingRadius=function(){var a=this.width,c=this.height;this.boundingRadius=Math.sqrt(a*a+c*c)/2};f.create();f.create();f.create();f.create();d.prototype.computeAABB=function(a,c,d){a.setFromPoints(this.vertices,c,d,0)};d.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":31,"./Convex":39,"./Shape":45}],45:[function(a,e){function d(a){this.type=
a;this.id=d.idCounter++;this.boundingRadius=0;this.collisionGroup=1;this.collisionResponse=!0;this.collisionMask=1;a&&this.updateBoundingRadius();this.material=null;this.area=0;this.sensor=!1;this.updateArea()}e.exports=d;d.idCounter=0;d.CIRCLE=1;d.PARTICLE=2;d.PLANE=4;d.CONVEX=8;d.LINE=16;d.RECTANGLE=32;d.CAPSULE=64;d.HEIGHTFIELD=128;d.prototype.computeMomentOfInertia=function(){throw Error("Shape.computeMomentOfInertia is not implemented in this Shape...");};d.prototype.updateBoundingRadius=function(){throw Error("Shape.updateBoundingRadius is not implemented in this Shape...");
};d.prototype.updateArea=function(){};d.prototype.computeAABB=function(){}},{}],46:[function(a,e){function d(a){g.call(this,a,g.GS);a=a||{};this.iterations=a.iterations||10;this.tolerance=a.tolerance||1E-10;this.arrayStep=30;this.lambda=new h.ARRAY_TYPE(this.arrayStep);this.Bs=new h.ARRAY_TYPE(this.arrayStep);this.invCs=new h.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=!1;this.usedIterations=this.frictionIterations=0}var f=a("../math/vec2"),g=a("./Solver"),h=a("../utils/Utils"),l=a("../equations/FrictionEquation");
e.exports=d;d.prototype=new g;d.prototype.constructor=d;d.prototype.solve=function(a,c){this.sortEquations();var e=0,g=this.iterations,k=this.frictionIterations,m=this.equations,p=m.length,r=Math.pow(this.tolerance*p,2),F=c.bodies,C=c.bodies.length,D=(f.add,f.set,this.useZeroRHS),I=this.lambda;if(this.usedIterations=0,p)for(var A=0;A!==C;A++)e=F[A],e.updateSolveMassProperties();I.length<p&&(I=this.lambda=new h.ARRAY_TYPE(p+this.arrayStep),this.Bs=new h.ARRAY_TYPE(p+this.arrayStep),this.invCs=new h.ARRAY_TYPE(p+
this.arrayStep));for(var G=I.length;G--;)I[G]=0;for(var G=this.invCs,H=this.Bs,I=this.lambda,A=0;A!==m.length;A++){var B=m[A];(B.timeStep!==a||B.needsUpdate)&&(B.timeStep=a,B.update());H[A]=B.computeB(B.a,B.b,a);G[A]=B.computeInvC(B.epsilon)}var E;if(0!==p){for(A=0;A!==C;A++)e=F[A],e.resetConstraintVelocity();if(k){for(e=0;e!==k;e++){for(A=E=0;A!==p;A++)B=m[A],B=d.iterateEquation(A,B,B.epsilon,H,G,I,D,a,e),E+=Math.abs(B);if(this.usedIterations++,r>=E*E)break}d.updateMultipliers(m,I,1/a);for(A=0;A!==
p;A++)if(k=m[A],k instanceof l){for(B=e=0;B!==k.contactEquations.length;B++)e+=k.contactEquations[B].multiplier;e*=k.frictionCoefficient/k.contactEquations.length;k.maxForce=e;k.minForce=-e}}for(e=0;e!==g;e++){for(A=E=0;A!==p;A++)B=m[A],B=d.iterateEquation(A,B,B.epsilon,H,G,I,D,a,e),E+=Math.abs(B);if(this.usedIterations++,r>=E*E)break}for(A=0;A!==C;A++)F[A].addConstraintVelocity();d.updateMultipliers(m,I,1/a)}};d.updateMultipliers=function(a,c,d){for(var e=a.length;e--;)a[e].multiplier=c[e]*d};d.iterateEquation=
function(a,c,d,e,f,g,k,h){var n=e[a],l=f[a];f=g[a];var m=c.computeGWlambda();e=c.maxForce;var p=c.minForce;k&&(n=0);d=l*(n-m-d*f);k=f+d;return p*h>k?d=p*h-f:k>e*h&&(d=e*h-f),g[a]+=d,c.addToWlambda(d),d}},{"../equations/FrictionEquation":24,"../math/vec2":31,"../utils/Utils":50,"./Solver":47}],47:[function(a,e){function d(a,c){a=a||{};f.call(this);this.type=c;this.equations=[];this.equationSortFunction=a.equationSortFunction||!1}var f=(a("../utils/Utils"),a("../events/EventEmitter"));e.exports=d;d.prototype=
new f;d.prototype.constructor=d;d.prototype.solve=function(){throw Error("Solver.solve should be implemented by subclasses!");};var g={bodies:[]};d.prototype.solveIsland=function(a,c){this.removeAllEquations();c.equations.length&&(this.addEquations(c.equations),g.bodies.length=0,c.getBodies(g.bodies),g.bodies.length&&this.solve(a,g))};d.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)};d.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)};
d.prototype.addEquations=function(a){for(var c=0,d=a.length;c!==d;c++){var e=a[c];e.enabled&&this.equations.push(e)}};d.prototype.removeEquation=function(a){a=this.equations.indexOf(a);-1!==a&&this.equations.splice(a,1)};d.prototype.removeAllEquations=function(){this.equations.length=0};d.GS=1;d.ISLAND=2},{"../events/EventEmitter":27,"../utils/Utils":50}],48:[function(a,e){function d(){this.overlappingShapesLastState=new g;this.overlappingShapesCurrentState=new g;this.recordPool=[];this.tmpDict=new g;
this.tmpArray1=[]}function f(a,c,d,e){this.shapeA=c;this.shapeB=e;this.bodyA=a;this.bodyB=d}var g=a("./TupleDictionary");a("./Utils");e.exports=d;d.prototype.tick=function(){for(var a=this.overlappingShapesLastState,c=this.overlappingShapesCurrentState,d=a.keys.length;d--;){var e=a.keys[d],f=a.getByKey(e),e=c.getByKey(e);f&&!e&&this.recordPool.push(f)}a.reset();a.copy(c);c.reset()};d.prototype.setOverlapping=function(a,c,d,e){var g=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);
if(!g.get(c.id,e.id)){var k;this.recordPool.length?(k=this.recordPool.pop(),k.set(a,c,d,e)):k=new f(a,c,d,e);g.set(c.id,e.id,k)}};d.prototype.getNewOverlaps=function(a){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,a)};d.prototype.getEndOverlaps=function(a){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,a)};d.prototype.bodiesAreOverlapping=function(a,c){for(var d=this.overlappingShapesCurrentState,e=d.keys.length;e--;){var f=
d.data[d.keys[e]];if(f.bodyA===a&&f.bodyB===c||f.bodyA===c&&f.bodyB===a)return!0}return!1};d.prototype.getDiff=function(a,c,d){d=d||[];d.length=0;for(var e=c.keys.length;e--;){var f=c.keys[e],g=c.data[f];if(!g)throw Error("Key "+f+" had no data!");a.data[f]||d.push(g)}return d};d.prototype.isNewOverlap=function(a,c){var d=0|a.id,e=0|c.id,f=this.overlappingShapesCurrentState;return!this.overlappingShapesLastState.get(d,e)&&!!f.get(d,e)};d.prototype.getNewBodyOverlaps=function(a){this.tmpArray1.length=
0;var c=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(c,a)};d.prototype.getEndBodyOverlaps=function(a){this.tmpArray1.length=0;var c=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(c,a)};d.prototype.getBodyDiff=function(a,c){c=c||[];for(var d=this.tmpDict,e=a.length;e--;){var f=a[e];d.set(0|f.bodyA.id,0|f.bodyB.id,f)}for(e=d.keys.length;e--;)(f=d.getByKey(d.keys[e]))&&c.push(f.bodyA,f.bodyB);return d.reset(),c};f.prototype.set=function(a,c,d,e){f.call(this,a,c,d,e)}},{"./TupleDictionary":49,
"./Utils":50}],49:[function(a,e){function d(){this.data={};this.keys=[]}var f=a("./Utils");e.exports=d;d.prototype.getKey=function(a,c){return a|=0,c|=0,(0|a)===(0|c)?-1:0|((0|a)>(0|c)?a<<16|65535&c:c<<16|65535&a)};d.prototype.getByKey=function(a){return a|=0,this.data[a]};d.prototype.get=function(a,c){return this.data[this.getKey(a,c)]};d.prototype.set=function(a,c,d){if(!d)throw Error("No data!");a=this.getKey(a,c);return this.data[a]||this.keys.push(a),this.data[a]=d,a};d.prototype.reset=function(){for(var a=
this.data,c=this.keys,d=c.length;d--;)delete a[c[d]];c.length=0};d.prototype.copy=function(a){this.reset();f.appendArray(this.keys,a.keys);for(var c=a.keys.length;c--;){var d=a.keys[c];this.data[d]=a.data[d]}}},{"./Utils":50}],50:[function(a,e){function d(){}e.exports=d;d.appendArray=function(a,c){if(15E4>c.length)a.push.apply(a,c);else for(var d=0,e=c.length;d!==e;++d)a.push(c[d])};d.splice=function(a,c,d){d=d||1;for(var e=a.length-d;e>c;c++)a[c]=a[c+d];a.length=e};d.ARRAY_TYPE=window.Float32Array||
Array;d.extend=function(a,c){for(var d in c)a[d]=c[d]};d.defaults=function(a,c){a=a||{};for(var d in c)d in a||(a[d]=c[d]);return a}},{}],51:[function(a,e){function d(){this.equations=[];this.bodies=[]}var f=a("../objects/Body");e.exports=d;d.prototype.reset=function(){this.equations.length=this.bodies.length=0};var g=[];d.prototype.getBodies=function(a){a=a||[];for(var c=this.equations,d=g.length=0;d!==c.length;d++){var e=c[d];-1===g.indexOf(e.bodyA.id)&&(a.push(e.bodyA),g.push(e.bodyA.id));-1===
g.indexOf(e.bodyB.id)&&(a.push(e.bodyB),g.push(e.bodyB.id))}return a};d.prototype.wantsToSleep=function(){for(var a=0;a<this.bodies.length;a++){var c=this.bodies[a];if(c.type===f.DYNAMIC&&!c.wantsToSleep)return!1}return!0};d.prototype.sleep=function(){for(var a=0;a<this.bodies.length;a++)this.bodies[a].sleep();return!0}},{"../objects/Body":32}],52:[function(a,e){function d(){this._nodePool=[];this._islandPool=[];this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}var f=(a("../math/vec2"),
a("./Island")),g=a("./IslandNode"),h=a("../objects/Body");e.exports=d;d.getUnvisitedNode=function(a){for(var c=a.length,d=0;d!==c;d++){var e=a[d];if(!e.visited&&e.body.type===h.DYNAMIC)return e}return!1};d.prototype.visit=function(a,c,d){c.push(a.body);c=a.equations.length;for(var e=0;e!==c;e++){var f=a.equations[e];-1===d.indexOf(f)&&d.push(f)}};d.prototype.bfs=function(a,c,e){var f=this.queue;f.length=0;f.push(a);a.visited=!0;for(this.visit(a,c,e);f.length;)for(var g=f.pop();a=d.getUnvisitedNode(g.neighbors);)a.visited=
!0,this.visit(a,c,e),a.body.type===h.DYNAMIC&&f.push(a)};d.prototype.split=function(a){var c=a.bodies;a=this.nodes;for(var e=this.equations;a.length;)this._nodePool.push(a.pop());for(var h=0;h!==c.length;h++)if(this._nodePool.length){var n=this._nodePool.pop();n.reset();n.body=c[h];a.push(n)}else a.push(new g(c[h]));for(n=0;n!==e.length;n++){var l=e[n],h=c.indexOf(l.bodyA),m=c.indexOf(l.bodyB),h=a[h],m=a[m];h.neighbors.push(m);m.neighbors.push(h);h.equations.push(l);m.equations.push(l)}for(c=this.islands;c.length;)e=
c.pop(),e.reset(),this._islandPool.push(e);for(;n=d.getUnvisitedNode(a);)e=this._islandPool.length?this._islandPool.pop():new f,this.bfs(n,e.bodies,e.equations),c.push(e);return c}},{"../math/vec2":31,"../objects/Body":32,"./Island":51,"./IslandNode":53}],53:[function(a,e){function d(a){this.body=a;this.neighbors=[];this.equations=[];this.visited=!1}e.exports=d;d.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=!1;this.body=null}},{}],54:[function(a,e){function d(a){x.apply(this);
a=a||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=a.solver||new f;this.narrowphase=new C(this);this.islandManager=new A;this.gravity=h.fromValues(0,-9.78);a.gravity&&h.copy(this.gravity,a.gravity);this.frictionGravity=h.length(this.gravity)||10;this.useFrictionGravityOnZeroGravity=this.useWorldGravityAsFrictionGravity=!0;this.doProfiling=a.doProfiling||!1;this.lastStepTime=0;this.broadphase=a.broadphase||new F;this.broadphase.setWorld(this);this.constraints=[];
this.defaultMaterial=new w;this.defaultContactMaterial=new r(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.solveConstraints=this.applyGravity=this.applyDamping=this.applySpringForces=!0;this.contactMaterials=[];this.time=0;this.stepping=!1;this.bodiesToBeRemoved=[];this.fixedStepTime=0;this.islandSplit="undefined"!=typeof a.islandSplit?!!a.islandSplit:!1;this.emitImpactEvent=!0;this._bodyIdCounter=this._constraintIdCounter=0;this.postStepEvent={type:"postStep"};this.addBodyEvent=
{type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=d.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,
bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new I}var f=a("../solver/GSSolver"),g=(a("../solver/Solver"),a("../collision/NaiveBroadphase"),a("../collision/Ray")),h=a("../math/vec2"),l=a("../shapes/Circle"),m=(a("../shapes/Rectangle"),a("../shapes/Convex")),p=(a("../shapes/Line"),a("../shapes/Plane")),q=a("../shapes/Capsule"),t=a("../shapes/Particle"),
x=a("../events/EventEmitter"),v=a("../objects/Body"),w=(a("../shapes/Shape"),a("../objects/LinearSpring"),a("../material/Material")),r=a("../material/ContactMaterial"),F=(a("../constraints/DistanceConstraint"),a("../constraints/Constraint"),a("../constraints/LockConstraint"),a("../constraints/RevoluteConstraint"),a("../constraints/PrismaticConstraint"),a("../constraints/GearConstraint"),a("../../package.json"),a("../collision/Broadphase"),a("../collision/SAPBroadphase")),C=a("../collision/Narrowphase"),
D=a("../utils/Utils"),I=a("../utils/OverlapKeeper"),A=a("./IslandManager");a("../objects/RotationalSpring");if(e.exports=d,"undefined"==typeof performance&&(performance={}),!performance.now){var G=Date.now();performance.timing&&performance.timing.navigationStart&&(G=performance.timing.navigationStart);performance.now=function(){return Date.now()-G}}d.prototype=Object(x.prototype);d.prototype.constructor=d;d.NO_SLEEPING=1;d.BODY_SLEEPING=2;d.ISLAND_SLEEPING=4;d.prototype.addConstraint=function(a){this.constraints.push(a)};
d.prototype.addContactMaterial=function(a){this.contactMaterials.push(a)};d.prototype.removeContactMaterial=function(a){a=this.contactMaterials.indexOf(a);-1!==a&&D.splice(this.contactMaterials,a,1)};d.prototype.getContactMaterial=function(a,c){for(var d=this.contactMaterials,e=0,f=d.length;e!==f;e++){var g=d[e];if(g.materialA.id===a.id&&g.materialB.id===c.id||g.materialA.id===c.id&&g.materialB.id===a.id)return g}return!1};d.prototype.removeConstraint=function(a){a=this.constraints.indexOf(a);-1!==
a&&D.splice(this.constraints,a,1)};var H=(h.create(),h.create(),h.create(),h.create(),h.create(),h.create(),h.create()),B=h.fromValues(0,0),E=h.fromValues(0,0),K=(h.fromValues(0,0),h.fromValues(0,0));d.prototype.step=function(a,c,d){if(d=d||10,c=c||0,0===c)this.internalStep(a),this.time+=a;else{var e=Math.floor((this.time+c)/a)-Math.floor(this.time/a),e=Math.min(e,d);d=performance.now();for(var f=0;f!==e&&(this.internalStep(a),!(performance.now()-d>1E3*a));f++);this.time+=c;a=this.time%a/a;for(c=
0;c!==this.bodies.length;c++)e=this.bodies[c],e.type!==v.STATIC&&e.sleepState!==v.SLEEPING?(h.sub(K,e.position,e.previousPosition),h.scale(K,K,a),h.add(e.interpolatedPosition,e.position,K),e.interpolatedAngle=e.angle+(e.angle-e.previousAngle)*a):(h.copy(e.interpolatedPosition,e.position),e.interpolatedAngle=e.angle)}};var M=[];d.prototype.internalStep=function(a){this.stepping=!0;var c,e,f=this.doProfiling,g=this.springs.length,k=this.springs,l=this.bodies,m=this.gravity,p=this.solver,u=this.bodies.length,
y=this.broadphase,z=this.narrowphase,q=this.constraints,t=(h.scale,h.add),w=(h.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=a,f&&(c=performance.now()),this.useWorldGravityAsFrictionGravity){var r=h.length(this.gravity);0===r&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=r)}if(this.applyGravity)for(r=0;r!==u;r++){var x=l[r],A=x.force;x.type===v.DYNAMIC&&x.sleepState!==v.SLEEPING&&(h.scale(H,m,x.mass*x.gravityScale),t(A,A,H))}if(this.applySpringForces)for(r=
0;r!==g;r++)k[r].applyForce();if(this.applyDamping)for(r=0;r!==u;r++)x=l[r],x.type===v.DYNAMIC&&x.applyDamping(a);g=y.getCollisionPairs(this);m=this.disabledBodyCollisionPairs;for(r=m.length-2;0<=r;r-=2)for(k=g.length-2;0<=k;k-=2)(m[r]===g[k]&&m[r+1]===g[k+1]||m[r+1]===g[k]&&m[r]===g[k+1])&&g.splice(k,2);m=q.length;for(r=0;r!==m;r++)if(y=q[r],!y.collideConnected)for(k=g.length-2;0<=k;k-=2)(y.bodyA===g[k]&&y.bodyB===g[k+1]||y.bodyB===g[k]&&y.bodyA===g[k+1])&&g.splice(k,2);this.postBroadphaseEvent.pairs=
g;this.emit(this.postBroadphaseEvent);z.reset(this);r=0;for(m=g.length;r!==m;r+=2)for(y=g[r],t=g[r+1],x=0,A=y.shapes.length;x!==A;x++)for(var C=y.shapes[x],B=y.shapeOffsets[x],E=y.shapeAngles[x],k=0,G=t.shapes.length;k!==G;k++){var F=t.shapes[k],I=t.shapeOffsets[k],J=t.shapeAngles[k],K=this.defaultContactMaterial;if(C.material&&F.material){var L=this.getContactMaterial(C.material,F.material);L&&(K=L)}this.runNarrowphase(z,y,C,B,E,t,F,I,J,K,this.frictionGravity)}for(r=0;r!==u;r++)g=l[r],g._wakeUpAfterNarrowphase&&
(g.wakeUp(),g._wakeUpAfterNarrowphase=!1);if(this.has("endContact"))for(this.overlapKeeper.getEndOverlaps(M),r=this.endContactEvent,k=M.length;k--;)g=M[k],r.shapeA=g.shapeA,r.shapeB=g.shapeB,r.bodyA=g.bodyA,r.bodyB=g.bodyB,this.emit(r);r=this.preSolveEvent;r.contactEquations=z.contactEquations;r.frictionEquations=z.frictionEquations;this.emit(r);m=q.length;for(r=0;r!==m;r++)q[r].update();if(z.contactEquations.length||z.frictionEquations.length||q.length)if(this.islandSplit){w.equations.length=0;D.appendArray(w.equations,
z.contactEquations);D.appendArray(w.equations,z.frictionEquations);for(r=0;r!==m;r++)D.appendArray(w.equations,q[r].equations);w.split(this);for(r=0;r!==w.islands.length;r++)q=w.islands[r],q.equations.length&&p.solveIsland(a,q)}else{p.addEquations(z.contactEquations);p.addEquations(z.frictionEquations);for(r=0;r!==m;r++)p.addEquations(q[r].equations);this.solveConstraints&&p.solve(a,this);p.removeAllEquations()}for(r=0;r!==u;r++)g=l[r],g.sleepState!==v.SLEEPING&&g.type!==v.STATIC&&g.integrate(a);
for(r=0;r!==u;r++)l[r].setZeroForce();if(f&&(e=performance.now(),this.lastStepTime=e-c),this.emitImpactEvent&&this.has("impact"))for(c=this.impactEvent,r=0;r!==z.contactEquations.length;r++)e=z.contactEquations[r],e.firstImpact&&(c.bodyA=e.bodyA,c.bodyB=e.bodyB,c.shapeA=e.shapeA,c.shapeB=e.shapeB,c.contactEquation=e,this.emit(c));if(this.sleepMode===d.BODY_SLEEPING)for(r=0;r!==u;r++)l[r].sleepTick(this.time,!1,a);else if(this.sleepMode===d.ISLAND_SLEEPING&&this.islandSplit){for(r=0;r!==u;r++)l[r].sleepTick(this.time,
!0,a);for(r=0;r<this.islandManager.islands.length;r++)q=this.islandManager.islands[r],q.wantsToSleep()&&q.sleep()}if(this.stepping=!1,this.bodiesToBeRemoved.length){for(r=0;r!==this.bodiesToBeRemoved.length;r++)this.removeBody(this.bodiesToBeRemoved[r]);this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};d.prototype.runNarrowphase=function(a,c,d,e,f,g,k,l,m,p,u){if(0!==(d.collisionGroup&k.collisionMask)&&0!==(k.collisionGroup&d.collisionMask)&&(h.rotate(B,e,c.angle),h.rotate(E,l,g.angle),
h.add(B,B,c.position),h.add(E,E,g.position),e=f+c.angle,m+=g.angle,a.enableFriction=0<p.friction,a.frictionCoefficient=p.friction,a.slipForce=p.friction*u*(c.type===v.STATIC||c.type===v.KINEMATIC?g.mass:g.type===v.STATIC||g.type===v.KINEMATIC?c.mass:c.mass*g.mass/(c.mass+g.mass)),a.restitution=p.restitution,a.surfaceVelocity=p.surfaceVelocity,a.frictionStiffness=p.frictionStiffness,a.frictionRelaxation=p.frictionRelaxation,a.stiffness=p.stiffness,a.relaxation=p.relaxation,a.contactSkinSize=p.contactSkinSize,
a.enabledEquations=c.collisionResponse&&g.collisionResponse&&d.collisionResponse&&k.collisionResponse,u=a[d.type|k.type],p=0,u&&(p=d.sensor||k.sensor,f=a.frictionEquations.length,p=d.type<k.type?u.call(a,c,d,B,e,g,k,E,m,p):u.call(a,g,k,E,m,c,d,B,e,p),e=a.frictionEquations.length-f,p))){c.allowSleep&&c.type===v.DYNAMIC&&c.sleepState===v.SLEEPING&&g.sleepState===v.AWAKE&&g.type!==v.STATIC&&(u=h.squaredLength(g.velocity)+Math.pow(g.angularVelocity,2),m=Math.pow(g.sleepSpeedLimit,2),u>=2*m&&(c._wakeUpAfterNarrowphase=
!0));g.allowSleep&&g.type===v.DYNAMIC&&g.sleepState===v.SLEEPING&&c.sleepState===v.AWAKE&&c.type!==v.STATIC&&(u=h.squaredLength(c.velocity)+Math.pow(c.angularVelocity,2),m=Math.pow(c.sleepSpeedLimit,2),u>=2*m&&(g._wakeUpAfterNarrowphase=!0));if(this.overlapKeeper.setOverlapping(c,d,g,k),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(d,k)){u=this.beginContactEvent;if(u.shapeA=d,u.shapeB=k,u.bodyA=c,u.bodyB=g,u.contactEquations.length=0,"number"==typeof p)for(c=a.contactEquations.length-
p;c<a.contactEquations.length;c++)u.contactEquations.push(a.contactEquations[c]);this.emit(u)}if("number"==typeof p&&1<e)for(c=a.frictionEquations.length-e;c<a.frictionEquations.length;c++)d=a.frictionEquations[c],d.setSlipForce(d.getSlipForce()/e)}};d.prototype.addSpring=function(a){this.springs.push(a);this.addSpringEvent.spring=a;this.emit(this.addSpringEvent)};d.prototype.removeSpring=function(a){a=this.springs.indexOf(a);-1!==a&&D.splice(this.springs,a,1)};d.prototype.addBody=function(a){-1===
this.bodies.indexOf(a)&&(this.bodies.push(a),a.world=this,this.addBodyEvent.body=a,this.emit(this.addBodyEvent))};d.prototype.removeBody=function(a){if(this.stepping)this.bodiesToBeRemoved.push(a);else{a.world=null;var c=this.bodies.indexOf(a);-1!==c&&(D.splice(this.bodies,c,1),this.removeBodyEvent.body=a,a.resetConstraintVelocity(),this.emit(this.removeBodyEvent))}};d.prototype.getBodyById=function(a){for(var c=this.bodies,d=0;d<c.length;d++){var e=c[d];if(e.id===a)return e}return!1};d.prototype.disableBodyCollision=
function(a,c){this.disabledBodyCollisionPairs.push(a,c)};d.prototype.enableBodyCollision=function(a,c){for(var d=this.disabledBodyCollisionPairs,e=0;e<d.length;e+=2)if(d[e]===a&&d[e+1]===c||d[e+1]===a&&d[e]===c)return void d.splice(e,2)};d.prototype.clear=function(){this.fixedStepTime=this.time=0;this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var a=this.constraints,c=a.length-1;0<=c;c--)this.removeConstraint(a[c]);a=this.bodies;for(c=a.length-1;0<=c;c--)this.removeBody(a[c]);
a=this.springs;for(c=a.length-1;0<=c;c--)this.removeSpring(a[c]);a=this.contactMaterials;for(c=a.length-1;0<=c;c--)this.removeContactMaterial(a[c]);d.apply(this)};d.prototype.clone=function(){var a=new d;return a.fromJSON(this.toJSON()),a};var L=h.create(),J=h.fromValues(0,0),N=h.fromValues(0,0);d.prototype.hitTest=function(a,c,d){d=d||0;var e=new v({position:a}),f=new t;e.addShape(f);for(var g=this.narrowphase,k=[],r=0,w=c.length;r!==w;r++)for(var x=c[r],A=0,C=x.shapes.length;A!==C;A++){var B=x.shapes[A],
D=x.shapeAngles[A]||0;h.rotate(L,x.shapeOffsets[A]||J,x.angle);h.add(L,L,x.position);D+=x.angle;(B instanceof l&&g.circleParticle(x,B,L,D,e,f,a,0,!0)||B instanceof m&&g.particleConvex(e,f,a,0,x,B,L,D,!0)||B instanceof p&&g.particlePlane(e,f,a,0,x,B,L,D,!0)||B instanceof q&&g.particleCapsule(e,f,a,0,x,B,L,D,!0)||B instanceof t&&h.squaredLength(h.sub(N,L,a))<d*d)&&k.push(x)}return k};d.prototype.setGlobalEquationParameters=function(a){a=a||{};for(var c=0;c!==this.constraints.length;c++)for(var d=this.constraints[c],
e=0;e!==d.equations.length;e++){var f=d.equations[e];"undefined"!=typeof a.stiffness&&(f.stiffness=a.stiffness);"undefined"!=typeof a.relaxation&&(f.relaxation=a.relaxation);f.needsUpdate=!0}for(c=0;c!==this.contactMaterials.length;c++)d=this.contactMaterials[c],"undefined"!=typeof a.stiffness&&(d.stiffness=a.stiffness,d.frictionStiffness=a.stiffness),"undefined"!=typeof a.relaxation&&(d.relaxation=a.relaxation,d.frictionRelaxation=a.relaxation);d=this.defaultContactMaterial;"undefined"!=typeof a.stiffness&&
(d.stiffness=a.stiffness,d.frictionStiffness=a.stiffness);"undefined"!=typeof a.relaxation&&(d.relaxation=a.relaxation,d.frictionRelaxation=a.relaxation)};d.prototype.setGlobalStiffness=function(a){this.setGlobalEquationParameters({stiffness:a})};d.prototype.setGlobalRelaxation=function(a){this.setGlobalEquationParameters({relaxation:a})};var P=new g;d.prototype.raycastAll=function(a,c,d,e){return d.mode=g.ALL,d.from=a,d.to=c,d.callback=e,P.intersectWorld(this,d)};d.prototype.raycastAny=function(a,
c,d,e){return d.mode=g.ANY,d.from=a,d.to=c,d.result=e,P.intersectWorld(this,d)};d.prototype.raycastClosest=function(a,c,d,e){return d.mode=g.CLOSEST,d.from=a,d.to=c,d.result=e,P.intersectWorld(this,d)}},{"../../package.json":6,"../collision/Broadphase":8,"../collision/NaiveBroadphase":10,"../collision/Narrowphase":11,"../collision/Ray":12,"../collision/SAPBroadphase":14,"../constraints/Constraint":15,"../constraints/DistanceConstraint":16,"../constraints/GearConstraint":17,"../constraints/LockConstraint":18,
"../constraints/PrismaticConstraint":19,"../constraints/RevoluteConstraint":20,"../events/EventEmitter":27,"../material/ContactMaterial":28,"../material/Material":29,"../math/vec2":31,"../objects/Body":32,"../objects/LinearSpring":33,"../objects/RotationalSpring":34,"../shapes/Capsule":37,"../shapes/Circle":38,"../shapes/Convex":39,"../shapes/Line":41,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Rectangle":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":48,
"../utils/Utils":50,"./IslandManager":52}]},{},[36])(36)});p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;a.Physics.P2=function(b,c){this.game=b;"undefined"==typeof c?c={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(c.hasOwnProperty("gravity")||(c.gravity=[0,0]),c.hasOwnProperty("broadphase")||(c.broadphase=new p2.SAPBroadphase));this.config=c;this.world=new p2.World(this.config);this.frameRate=1/60;this.paused=this.useElapsedTime=!1;this.materials=[];this.gravity=new a.Physics.P2.InversePointProxy(this,
this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new a.Signal;this.onBodyRemoved=new a.Signal;this.onSpringAdded=new a.Signal;this.onSpringRemoved=new a.Signal;this.onConstraintAdded=new a.Signal;this.onConstraintRemoved=new a.Signal;this.onContactMaterialAdded=new a.Signal;this.onContactMaterialRemoved=new a.Signal;this.callbackContext=this.postBroadphaseCallback=null;this.onBeginContact=new a.Signal;this.onEndContact=new a.Signal;c.hasOwnProperty("mpx")&&
c.hasOwnProperty("pxm")&&c.hasOwnProperty("mpxi")&&c.hasOwnProperty("pxmi")&&(this.mpx=c.mpx,this.mpxi=c.mpxi,this.pxm=c.pxm,this.pxmi=c.pxmi);this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new a.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new a.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new a.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=
[];this._toRemove=[];this._collisionGroupID=2;this._boundsBottom=this._boundsTop=this._boundsRight=this._boundsLeft=!0;this._boundsOwnGroup=!1;this.setBoundsToWorld(!0,!0,!0,!0,!1)};a.Physics.P2.prototype={removeBodyNextStep:function(b){this._toRemove.push(b)},preUpdate:function(){for(var b=this._toRemove.length;b--;)this.removeBody(this._toRemove[b]);this._toRemove.length=0},enable:function(b,c,e){"undefined"==typeof c&&(c=!1);"undefined"==typeof e&&(e=!0);var d=1;if(Array.isArray(b))for(d=b.length;d--;)b[d]instanceof
a.Group?this.enable(b[d].children,c,e):(this.enableBody(b[d],c),e&&b[d].hasOwnProperty("children")&&0<b[d].children.length&&this.enable(b[d],c,!0));else b instanceof a.Group?this.enable(b.children,c,e):(this.enableBody(b,c),e&&b.hasOwnProperty("children")&&0<b.children.length&&this.enable(b.children,c,!0))},enableBody:function(b,c){b.hasOwnProperty("body")&&null===b.body&&(b.body=new a.Physics.P2.Body(this.game,b,b.x,b.y,1),b.body.debug=c,b.anchor.set(.5))},setImpactEvents:function(b){b?this.world.on("impact",
this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(b,a){this.postBroadphaseCallback=b;this.callbackContext=a;null!==b?this.world.on("postBroadphase",this.postBroadphaseHandler,this):this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(b){if(this.postBroadphaseCallback&&0!==b.pairs.length)for(var a=b.pairs.length-2;0<=a;a-=2)b.pairs[a].parent&&b.pairs[a+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,
b.pairs[a].parent,b.pairs[a+1].parent)&&b.pairs.splice(a,2)},impactHandler:function(b){if(b.bodyA.parent&&b.bodyB.parent){var a=b.bodyA.parent,e=b.bodyB.parent;a._bodyCallbacks[b.bodyB.id]&&a._bodyCallbacks[b.bodyB.id].call(a._bodyCallbackContext[b.bodyB.id],a,e,b.shapeA,b.shapeB);e._bodyCallbacks[b.bodyA.id]&&e._bodyCallbacks[b.bodyA.id].call(e._bodyCallbackContext[b.bodyA.id],e,a,b.shapeB,b.shapeA);a._groupCallbacks[b.shapeB.collisionGroup]&&a._groupCallbacks[b.shapeB.collisionGroup].call(a._groupCallbackContext[b.shapeB.collisionGroup],
a,e,b.shapeA,b.shapeB);e._groupCallbacks[b.shapeA.collisionGroup]&&e._groupCallbacks[b.shapeA.collisionGroup].call(e._groupCallbackContext[b.shapeA.collisionGroup],e,a,b.shapeB,b.shapeA)}},beginContactHandler:function(b){this.onBeginContact.dispatch(b.bodyA,b.bodyB,b.shapeA,b.shapeB,b.contactEquations);b.bodyA.parent&&b.bodyA.parent.onBeginContact.dispatch(b.bodyB.parent,b.shapeA,b.shapeB,b.contactEquations);b.bodyB.parent&&b.bodyB.parent.onBeginContact.dispatch(b.bodyA.parent,b.shapeB,b.shapeA,b.contactEquations)},
endContactHandler:function(b){this.onEndContact.dispatch(b.bodyA,b.bodyB,b.shapeA,b.shapeB);b.bodyA.parent&&b.bodyA.parent.onEndContact.dispatch(b.bodyB.parent,b.shapeA,b.shapeB);b.bodyB.parent&&b.bodyB.parent.onEndContact.dispatch(b.bodyA.parent,b.shapeB,b.shapeA)},setBoundsToWorld:function(b,a,e,d,f){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,b,a,e,d,f)},setWorldMaterial:function(b,a,e,d,f){"undefined"==typeof a&&(a=
!0);"undefined"==typeof e&&(e=!0);"undefined"==typeof d&&(d=!0);"undefined"==typeof f&&(f=!0);a&&this.walls.left&&(this.walls.left.shapes[0].material=b);e&&this.walls.right&&(this.walls.right.shapes[0].material=b);d&&this.walls.top&&(this.walls.top.shapes[0].material=b);f&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=b)},updateBoundsCollisionGroup:function(b){var a=this.everythingCollisionGroup.mask;"undefined"==typeof b&&(a=this.boundsCollisionGroup.mask);this.walls.left&&(this.walls.left.shapes[0].collisionGroup=
a);this.walls.right&&(this.walls.right.shapes[0].collisionGroup=a);this.walls.top&&(this.walls.top.shapes[0].collisionGroup=a);this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=a)},setBounds:function(b,a,e,d,f,g,h,l,m){"undefined"==typeof f&&(f=this._boundsLeft);"undefined"==typeof g&&(g=this._boundsRight);"undefined"==typeof h&&(h=this._boundsTop);"undefined"==typeof l&&(l=this._boundsBottom);"undefined"==typeof m&&(m=this._boundsOwnGroup);this.walls.left&&this.world.removeBody(this.walls.left);
this.walls.right&&this.world.removeBody(this.walls.right);this.walls.top&&this.world.removeBody(this.walls.top);this.walls.bottom&&this.world.removeBody(this.walls.bottom);f&&(this.walls.left=new p2.Body({mass:0,position:[this.pxmi(b),this.pxmi(a)],angle:1.5707963267948966}),this.walls.left.addShape(new p2.Plane),m&&(this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.left));g&&(this.walls.right=new p2.Body({mass:0,position:[this.pxmi(b+e),this.pxmi(a)],
angle:-1.5707963267948966}),this.walls.right.addShape(new p2.Plane),m&&(this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.right));h&&(this.walls.top=new p2.Body({mass:0,position:[this.pxmi(b),this.pxmi(a)],angle:-3.141592653589793}),this.walls.top.addShape(new p2.Plane),m&&(this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.top));l&&(this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(b),
this.pxmi(a+d)]}),this.walls.bottom.addShape(new p2.Plane),m&&(this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.bottom));this._boundsLeft=f;this._boundsRight=g;this._boundsTop=h;this._boundsBottom=l;this._boundsOwnGroup=m},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||this.world.step(this.useElapsedTime?this.game.time.physicsElapsed:this.frameRate)},reset:function(){this.world.on("beginContact",
this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=new a.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new a.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new a.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0;this.world.fixedStepTime=0;this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();
for(var b=this.world.constraints,a=b.length-1;0<=a;a--)this.world.removeConstraint(b[a]);b=this.world.bodies;for(a=b.length-1;0<=a;a--)this.world.removeBody(b[a]);b=this.world.springs;for(a=b.length-1;0<=a;a--)this.world.removeSpring(b[a]);b=this.world.contactMaterials;for(a=b.length-1;0<=a;a--)this.world.removeContactMaterial(b[a]);this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.impactCallback=this.callbackContext=this.postBroadphaseCallback=
null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[]},destroy:function(){this.clear();this.game=null},addBody:function(b){return b.data.world?!1:(this.world.addBody(b.data),this.onBodyAdded.dispatch(b),!0)},removeBody:function(b){return b.data.world==this.world&&(this.world.removeBody(b.data),this.onBodyRemoved.dispatch(b)),b},addSpring:function(b){return this.world.addSpring(b instanceof a.Physics.P2.Spring||b instanceof a.Physics.P2.RotationalSpring?b.data:b),this.onSpringAdded.dispatch(b),
b},removeSpring:function(b){return this.world.removeSpring(b instanceof a.Physics.P2.Spring||b instanceof a.Physics.P2.RotationalSpring?b.data:b),this.onSpringRemoved.dispatch(b),b},createDistanceConstraint:function(b,c,e,d,f,g){return b=this.getBody(b),c=this.getBody(c),b&&c?this.addConstraint(new a.Physics.P2.DistanceConstraint(this,b,c,e,d,f,g)):void console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(b,c,e,d){return b=this.getBody(b),c=this.getBody(c),
b&&c?this.addConstraint(new a.Physics.P2.GearConstraint(this,b,c,e,d)):void console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(b,c,e,d,f,g){return b=this.getBody(b),e=this.getBody(e),b&&e?this.addConstraint(new a.Physics.P2.RevoluteConstraint(this,b,c,e,d,f,g)):void console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(b,c,e,d,f){return b=this.getBody(b),c=this.getBody(c),b&&c?this.addConstraint(new a.Physics.P2.LockConstraint(this,
b,c,e,d,f)):void console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(b,c,e,d,f,g,h){return b=this.getBody(b),c=this.getBody(c),b&&c?this.addConstraint(new a.Physics.P2.PrismaticConstraint(this,b,c,e,d,f,g,h)):void console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(b){return this.world.addConstraint(b),this.onConstraintAdded.dispatch(b),b},removeConstraint:function(b){return this.world.removeConstraint(b),
this.onConstraintRemoved.dispatch(b),b},addContactMaterial:function(b){return this.world.addContactMaterial(b),this.onContactMaterialAdded.dispatch(b),b},removeContactMaterial:function(b){return this.world.removeContactMaterial(b),this.onContactMaterialRemoved.dispatch(b),b},getContactMaterial:function(b,a){return this.world.getContactMaterial(b,a)},setMaterial:function(b,a){for(var e=a.length;e--;)a[e].setMaterial(b)},createMaterial:function(b,c){var e=new a.Physics.P2.Material(b||"");return this.materials.push(e),
"undefined"!=typeof c&&c.setMaterial(e),e},createContactMaterial:function(b,c,e){"undefined"==typeof b&&(b=this.createMaterial());"undefined"==typeof c&&(c=this.createMaterial());b=new a.Physics.P2.ContactMaterial(b,c,e);return this.addContactMaterial(b)},getBodies:function(){for(var b=[],a=this.world.bodies.length;a--;)b.push(this.world.bodies[a].parent);return b},getBody:function(b){return b instanceof p2.Body?b:b instanceof a.Physics.P2.Body?b.data:b.body&&b.body.type===a.Physics.P2JS?b.body.data:
null},getSprings:function(){for(var b=[],a=this.world.springs.length;a--;)b.push(this.world.springs[a].parent);return b},getConstraints:function(){for(var b=[],a=this.world.constraints.length;a--;)b.push(this.world.constraints[a].parent);return b},hitTest:function(b,c,e,d){"undefined"==typeof c&&(c=this.world.bodies);"undefined"==typeof e&&(e=5);"undefined"==typeof d&&(d=!1);b=[this.pxmi(b.x),this.pxmi(b.y)];for(var f=[],g=c.length;g--;)c[g]instanceof a.Physics.P2.Body&&(!d||c[g].data.type!==p2.Body.STATIC)?
f.push(c[g].data):c[g]instanceof p2.Body&&c[g].parent&&(!d||c[g].type!==p2.Body.STATIC)?f.push(c[g]):c[g]instanceof a.Sprite&&c[g].hasOwnProperty("body")&&(!d||c[g].body.data.type!==p2.Body.STATIC)&&f.push(c[g].body.data);return this.world.hitTest(b,f,e)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(b){var c=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask|=c);this.walls.right&&(this.walls.right.shapes[0].collisionMask|=c);
this.walls.top&&(this.walls.top.shapes[0].collisionMask|=c);this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask|=c);this._collisionGroupID++;c=new a.Physics.P2.CollisionGroup(c);return this.collisionGroups.push(c),b&&this.setCollisionGroup(b,c),c},setCollisionGroup:function(b,c){if(b instanceof a.Group)for(var e=0;e<b.total;e++)b.children[e].body&&b.children[e].body.type===a.Physics.P2JS&&b.children[e].body.setCollisionGroup(c);else b.body.setCollisionGroup(c)},createSpring:function(b,c,
e,d,f,g,h,l,m){return b=this.getBody(b),c=this.getBody(c),b&&c?this.addSpring(new a.Physics.P2.Spring(this,b,c,e,d,f,g,h,l,m)):void console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(b,c,e,d,f){return b=this.getBody(b),c=this.getBody(c),b&&c?this.addSpring(new a.Physics.P2.RotationalSpring(this,b,c,e,d,f)):void console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(b,c,e,d,f,g){"undefined"==typeof d&&(d=!1);b=
new a.Physics.P2.Body(this.game,null,b,c,e);return g&&!b.addPolygon(f,g)?!1:(d&&this.world.addBody(b.data),b)},createParticle:function(b,c,e,d,f,g){"undefined"==typeof d&&(d=!1);b=new a.Physics.P2.Body(this.game,null,b,c,e);return g&&!b.addPolygon(f,g)?!1:(d&&this.world.addBody(b.data),b)},convertCollisionObjects:function(b,a,e){"undefined"==typeof e&&(e=!0);for(var d=[],f=0,g=b.collision[a].length;g>f;f++){var h=b.collision[a][f];(h=this.createBody(h.x,h.y,0,e,{},h.polyline))&&d.push(h)}return d},
clearTilemapLayerBodies:function(b,a){a=b.getLayer(a);for(var e=b.layers[a].bodies.length;e--;)b.layers[a].bodies[e].destroy();b.layers[a].bodies.length=0},convertTilemap:function(b,a,e,d){a=b.getLayer(a);"undefined"==typeof e&&(e=!0);"undefined"==typeof d&&(d=!0);this.clearTilemapLayerBodies(b,a);for(var f=0,g=0,h=0,l=0,m=b.layers[a].height;m>l;l++)for(var p=f=0,q=b.layers[a].width;q>p;p++){var t=b.layers[a].data[l][p];if(t&&-1<t.index&&t.collides)if(d){var x=b.getTileRight(a,p,l);(0===f&&(g=t.x*
t.width,h=t.y*t.height,f=t.width),x&&x.collides)?f+=t.width:(x=this.createBody(g,h,0,!1),x.addRectangle(f,t.height,f/2,t.height/2,0),e&&this.addBody(x),b.layers[a].bodies.push(x),f=0)}else x=this.createBody(t.x*t.width,t.y*t.height,0,!1),x.addRectangle(t.width,t.height,t.width/2,t.height/2,0),e&&this.addBody(x),b.layers[a].bodies.push(x)}return b.layers[a].bodies},mpx:function(b){return 20*b},pxm:function(b){return.05*b},mpxi:function(b){return-20*b},pxmi:function(b){return-.05*b}};Object.defineProperty(a.Physics.P2.prototype,
"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(b){this.world.defaultContactMaterial.friction=b}});Object.defineProperty(a.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(b){this.world.defaultContactMaterial.restitution=b}});Object.defineProperty(a.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(b){this.world.defaultContactMaterial=
b}});Object.defineProperty(a.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(b){this.world.applySpringForces=b}});Object.defineProperty(a.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(b){this.world.applyDamping=b}});Object.defineProperty(a.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(b){this.world.applyGravity=b}});Object.defineProperty(a.Physics.P2.prototype,
"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(b){this.world.solveConstraints=b}});Object.defineProperty(a.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(a.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(b){this.world.emitImpactEvent=b}});Object.defineProperty(a.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(b){this.world.sleepMode=
b}});Object.defineProperty(a.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});a.Physics.P2.FixtureList=function(b){Array.isArray(b)||(b=[b]);this.rawList=b;this.init();this.parse(this.rawList)};a.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(b,a){this.getFixtures(a).forEach(function(a){a.collisionGroup=b})},setMask:function(b,a){this.getFixtures(a).forEach(function(a){a.collisionMask=
b})},setSensor:function(b,a){this.getFixtures(a).forEach(function(a){a.sensor=b})},setMaterial:function(b,a){this.getFixtures(a).forEach(function(a){a.material=b})},getFixtures:function(b){var a=[];if(b){b instanceof Array||(b=[b]);var e=this;return b.forEach(function(b){e.namedFixtures[b]&&a.push(e.namedFixtures[b])}),this.flatten(a)}return this.allFixtures},getFixtureByKey:function(b){return this.namedFixtures[b]},getGroup:function(b){return this.groupedFixtures[b]},parse:function(){var b,a,e,d;
e=this.rawList;d=[];for(b in e)a=e[b],isNaN(b-0)?this.namedFixtures[b]=this.flatten(a):(this.groupedFixtures[b]=this.groupedFixtures[b]||[],this.groupedFixtures[b]=this.groupedFixtures[b].concat(a)),d.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(b){var a,e;return a=[],e=arguments.callee,b.forEach(function(b){return Array.prototype.push.apply(a,Array.isArray(b)?e(b):[b])}),a}};a.Physics.P2.PointProxy=function(b,a){this.world=b;this.destination=a};a.Physics.P2.PointProxy.prototype.constructor=
a.Physics.P2.PointProxy;Object.defineProperty(a.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(b){this.destination[0]=this.world.pxm(b)}});Object.defineProperty(a.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(b){this.destination[1]=this.world.pxm(b)}});Object.defineProperty(a.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(b){this.destination[0]=
b}});Object.defineProperty(a.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(b){this.destination[1]=b}});a.Physics.P2.InversePointProxy=function(b,a){this.world=b;this.destination=a};a.Physics.P2.InversePointProxy.prototype.constructor=a.Physics.P2.InversePointProxy;Object.defineProperty(a.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(b){this.destination[0]=this.world.pxmi(b)}});Object.defineProperty(a.Physics.P2.InversePointProxy.prototype,
"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(b){this.destination[1]=this.world.pxmi(b)}});Object.defineProperty(a.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(b){this.destination[0]=-b}});Object.defineProperty(a.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(b){this.destination[1]=-b}});a.Physics.P2.Body=function(b,c,e,d,f){c=c||null;e=e||0;d=d||0;"undefined"==
typeof f&&(f=1);this.game=b;this.world=b.physics.p2;this.sprite=c;this.type=a.Physics.P2JS;this.offset=new a.Point;this.data=new p2.Body({position:[this.world.pxmi(e),this.world.pxmi(d)],mass:f});this.data.parent=this;this.velocity=new a.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new a.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new a.Point;this.onBeginContact=new a.Signal;this.onEndContact=new a.Signal;this.collidesWith=[];this.removeNextStep=
!1;this.debugBody=null;this.dirty=!1;this._collideWorldBounds=!0;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=!1;c&&(this.setRectangleFromSprite(c),c.exists&&this.game.physics.p2.addBody(this))};a.Physics.P2.Body.prototype={createBodyCallback:function(b,a,e){var d=-1;b.id?d=b.id:b.body&&(d=b.body.id);-1<d&&(null===a?(delete this._bodyCallbacks[d],delete this._bodyCallbackContext[d]):(this._bodyCallbacks[d]=a,this._bodyCallbackContext[d]=
e))},createGroupCallback:function(b,a,e){null===a?(delete this._groupCallbacks[b.mask],delete this._groupCallbacksContext[b.mask]):(this._groupCallbacks[b.mask]=a,this._groupCallbackContext[b.mask]=e)},getCollisionMask:function(){var b=0;this._collideWorldBounds&&(b=this.game.physics.p2.boundsCollisionGroup.mask);for(var a=0;a<this.collidesWith.length;a++)b|=this.collidesWith[a].mask;return b},updateCollisionMask:function(b){var a=this.getCollisionMask();if("undefined"==typeof b)for(b=this.data.shapes.length-
1;0<=b;b--)this.data.shapes[b].collisionMask=a;else b.collisionMask=a},setCollisionGroup:function(b,a){var e=this.getCollisionMask();if("undefined"==typeof a)for(var d=this.data.shapes.length-1;0<=d;d--)this.data.shapes[d].collisionGroup=b.mask,this.data.shapes[d].collisionMask=e;else a.collisionGroup=b.mask,a.collisionMask=e},clearCollision:function(b,a,e){if("undefined"==typeof b&&(b=!0),"undefined"==typeof a&&(a=!0),"undefined"==typeof e)for(e=this.data.shapes.length-1;0<=e;e--)b&&(this.data.shapes[e].collisionGroup=
null),a&&(this.data.shapes[e].collisionMask=null);else b&&(e.collisionGroup=null),a&&(e.collisionMask=null);b&&(this.collidesWith.length=0)},collides:function(b,a,e,d){if(Array.isArray(b))for(var f=0;f<b.length;f++)-1===this.collidesWith.indexOf(b[f])&&(this.collidesWith.push(b[f]),a&&this.createGroupCallback(b[f],a,e));else-1===this.collidesWith.indexOf(b)&&(this.collidesWith.push(b),a&&this.createGroupCallback(b,a,e));b=this.getCollisionMask();if("undefined"==typeof d)for(f=this.data.shapes.length-
1;0<=f;f--)this.data.shapes[f].collisionMask=b;else d.collisionMask=b},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},applyDamping:function(b){this.data.applyDamping(b)},applyForce:function(b,a,e){this.data.applyForce(b,[this.world.pxmi(a),this.world.pxmi(e)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=
0;this.data.angularDamping=0},toLocalFrame:function(b,a){return this.data.toLocalFrame(b,a)},toWorldFrame:function(b,a){return this.data.toWorldFrame(b,a)},rotateLeft:function(b){this.data.angularVelocity=this.world.pxm(-b)},rotateRight:function(b){this.data.angularVelocity=this.world.pxm(b)},moveForward:function(b){b=this.world.pxmi(-b);var a=this.data.angle+Math.PI/2;this.data.velocity[0]=b*Math.cos(a);this.data.velocity[1]=b*Math.sin(a)},moveBackward:function(b){b=this.world.pxmi(-b);var a=this.data.angle+
Math.PI/2;this.data.velocity[0]=-(b*Math.cos(a));this.data.velocity[1]=-(b*Math.sin(a))},thrust:function(b){b=this.world.pxmi(-b);var a=this.data.angle+Math.PI/2;this.data.force[0]+=b*Math.cos(a);this.data.force[1]+=b*Math.sin(a)},reverse:function(b){b=this.world.pxmi(-b);var a=this.data.angle+Math.PI/2;this.data.force[0]-=b*Math.cos(a);this.data.force[1]-=b*Math.sin(a)},moveLeft:function(b){this.data.velocity[0]=this.world.pxmi(-b)},moveRight:function(b){this.data.velocity[0]=this.world.pxmi(b)},
moveUp:function(b){this.data.velocity[1]=this.world.pxmi(-b)},moveDown:function(b){this.data.velocity[1]=this.world.pxmi(b)},preUpdate:function(){this.dirty=!0;this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]);this.sprite.y=this.world.mpxi(this.data.position[1]);this.fixedRotation||(this.sprite.rotation=this.data.angle);this.debugBody&&this.debugBody.updateSpriteTransform();this.dirty=!1},reset:function(b,
a,e,d){"undefined"==typeof e&&(e=!1);"undefined"==typeof d&&(d=!1);this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();e&&this.setZeroDamping();d&&(this.mass=1);this.x=b;this.y=a},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var b=0;b<this.game.physics.p2._toRemove.length;b++)this.game.physics.p2._toRemove[b]===this&&this.game.physics.p2._toRemove.splice(b,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===
this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this.debugBody&&this.debugBody.destroy(!0,!0);this.debugBody=null;this.sprite=this.sprite.body=null},clearShapes:function(){for(var b=this.data.shapes.length;b--;)this.data.removeShape(this.data.shapes[b]);this.shapeChanged()},addShape:function(b,a,e,d){return"undefined"==
typeof a&&(a=0),"undefined"==typeof e&&(e=0),"undefined"==typeof d&&(d=0),this.data.addShape(b,[this.world.pxmi(a),this.world.pxmi(e)],d),this.shapeChanged(),b},addCircle:function(b,a,e,d){b=new p2.Circle(this.world.pxm(b));return this.addShape(b,a,e,d)},addRectangle:function(b,a,e,d,f){b=new p2.Rectangle(this.world.pxm(b),this.world.pxm(a));return this.addShape(b,e,d,f)},addPlane:function(b,a,e){var d=new p2.Plane;return this.addShape(d,b,a,e)},addParticle:function(b,a,e){var d=new p2.Particle;return this.addShape(d,
b,a,e)},addLine:function(b,a,e,d){b=new p2.Line(this.world.pxm(b));return this.addShape(b,a,e,d)},addCapsule:function(b,a,e,d,f){b=new p2.Capsule(this.world.pxm(b),this.world.pxm(a));return this.addShape(b,e,d,f)},addPolygon:function(b,a){b=b||{};Array.isArray(a)||(a=Array.prototype.slice.call(arguments,1));var e=[];if(1===a.length&&Array.isArray(a[0]))e=a[0].slice(0);else if(Array.isArray(a[0]))e=a.slice();else if("number"==typeof a[0])for(var d=0,f=a.length;f>d;d+=2)e.push([a[d],a[d+1]]);d=e.length-
1;e[d][0]===e[0][0]&&e[d][1]===e[0][1]&&e.pop();for(d=0;d<e.length;d++)e[d][0]=this.world.pxmi(e[d][0]),e[d][1]=this.world.pxmi(e[d][1]);e=this.data.fromPolygon(e,b);return this.shapeChanged(),e},removeShape:function(b){b=this.data.removeShape(b);return this.shapeChanged(),b},setCircle:function(b,a,e,d){return this.clearShapes(),this.addCircle(b,a,e,d)},setRectangle:function(b,a,e,d,f){return"undefined"==typeof b&&(b=16),"undefined"==typeof a&&(a=16),this.clearShapes(),this.addRectangle(b,a,e,d,f)},
setRectangleFromSprite:function(b){return"undefined"==typeof b&&(b=this.sprite),this.clearShapes(),this.addRectangle(b.width,b.height,0,0,b.rotation)},setMaterial:function(b,a){if("undefined"==typeof a)for(var e=this.data.shapes.length-1;0<=e;e--)this.data.shapes[e].material=b;else a.material=b},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(b,a){for(var e=this.game.cache.getPhysicsData(b,a),d=[],f=0;f<e.length;f++){var g=e[f],h=this.addFixture(g);d[g.filter.group]=
d[g.filter.group]||[];d[g.filter.group]=d[g.filter.group].concat(h);g.fixtureKey&&(d[g.fixtureKey]=h)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),d},addFixture:function(b){var a=[];if(b.circle){var e=new p2.Circle(this.world.pxm(b.circle.radius));e.collisionGroup=b.filter.categoryBits;e.collisionMask=b.filter.maskBits;e.sensor=b.isSensor;var d=p2.vec2.create();d[0]=this.world.pxmi(b.circle.position[0]-this.sprite.width/2);d[1]=this.world.pxmi(b.circle.position[1]-this.sprite.height/2);
this.data.addShape(e,d);a.push(e)}else for(var d=b.polygons,f=p2.vec2.create(),g=0;g<d.length;g++){for(var e=d[g],h=[],l=0;l<e.length;l+=2)h.push([this.world.pxmi(e[l]),this.world.pxmi(e[l+1])]);e=new p2.Convex(h);for(h=0;h!==e.vertices.length;h++)l=e.vertices[h],p2.vec2.sub(l,l,e.centerOfMass);p2.vec2.scale(f,e.centerOfMass,1);f[0]-=this.world.pxmi(this.sprite.width/2);f[1]-=this.world.pxmi(this.sprite.height/2);e.updateTriangles();e.updateCenterOfMass();e.updateBoundingRadius();e.collisionGroup=
b.filter.categoryBits;e.collisionMask=b.filter.maskBits;e.sensor=b.isSensor;this.data.addShape(e,f);a.push(e)}return a},loadPolygon:function(b,a){for(var e=this.game.cache.getPhysicsData(b,a),d=p2.vec2.create(),f=0;f<e.length;f++){for(var g=[],h=0;h<e[f].shape.length;h+=2)g.push([this.world.pxmi(e[f].shape[h]),this.world.pxmi(e[f].shape[h+1])]);g=new p2.Convex(g);for(h=0;h!==g.vertices.length;h++){var l=g.vertices[h];p2.vec2.sub(l,l,g.centerOfMass)}p2.vec2.scale(d,g.centerOfMass,1);d[0]-=this.world.pxmi(this.sprite.width/
2);d[1]-=this.world.pxmi(this.sprite.height/2);g.updateTriangles();g.updateCenterOfMass();g.updateBoundingRadius();this.data.addShape(g,d)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}};a.Physics.P2.Body.prototype.constructor=a.Physics.P2.Body;a.Physics.P2.Body.DYNAMIC=1;a.Physics.P2.Body.STATIC=2;a.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(a.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===a.Physics.P2.Body.STATIC},set:function(b){b&&this.data.type!==
a.Physics.P2.Body.STATIC?(this.data.type=a.Physics.P2.Body.STATIC,this.mass=0):b||this.data.type!==a.Physics.P2.Body.STATIC||(this.data.type=a.Physics.P2.Body.DYNAMIC,0===this.mass&&(this.mass=1))}});Object.defineProperty(a.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===a.Physics.P2.Body.DYNAMIC},set:function(b){b&&this.data.type!==a.Physics.P2.Body.DYNAMIC?(this.data.type=a.Physics.P2.Body.DYNAMIC,0===this.mass&&(this.mass=1)):b||this.data.type!==a.Physics.P2.Body.DYNAMIC||
(this.data.type=a.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(a.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===a.Physics.P2.Body.KINEMATIC},set:function(b){b&&this.data.type!==a.Physics.P2.Body.KINEMATIC?(this.data.type=a.Physics.P2.Body.KINEMATIC,this.mass=4):b||this.data.type!==a.Physics.P2.Body.KINEMATIC||(this.data.type=a.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(a.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},
set:function(b){b!==this.data.allowSleep&&(this.data.allowSleep=b)}});Object.defineProperty(a.Physics.P2.Body.prototype,"angle",{get:function(){return a.Math.wrapAngle(a.Math.radToDeg(this.data.angle))},set:function(b){this.data.angle=a.Math.degToRad(a.Math.wrapAngle(b))}});Object.defineProperty(a.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(b){this.data.angularDamping=b}});Object.defineProperty(a.Physics.P2.Body.prototype,"angularForce",
{get:function(){return this.data.angularForce},set:function(b){this.data.angularForce=b}});Object.defineProperty(a.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(b){this.data.angularVelocity=b}});Object.defineProperty(a.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(b){this.data.damping=b}});Object.defineProperty(a.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},
set:function(b){b!==this.data.fixedRotation&&(this.data.fixedRotation=b)}});Object.defineProperty(a.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(b){this.data.inertia=b}});Object.defineProperty(a.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(b){b!==this.data.mass&&(this.data.mass=b,this.data.updateMassProperties())}});Object.defineProperty(a.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},
set:function(b){b!==this.data.type&&(this.data.type=b)}});Object.defineProperty(a.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(b){this.data.angle=b}});Object.defineProperty(a.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(b){this.data.sleepSpeedLimit=b}});Object.defineProperty(a.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(b){this.data.position[0]=
this.world.pxmi(b)}});Object.defineProperty(a.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(b){this.data.position[1]=this.world.pxmi(b)}});Object.defineProperty(a.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(a.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(b){b&&!this.debugBody?this.debugBody=new a.Physics.P2.BodyDebug(this.game,this.data):!b&&this.debugBody&&
(this.debugBody.destroy(),this.debugBody=null)}});Object.defineProperty(a.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(b){b&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!b&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}});a.Physics.P2.BodyDebug=function(b,c,e){a.Group.call(this,b);this.settings=a.Utils.extend({pixelsPerLengthUnit:20,debugPolygons:!1,lineWidth:1,
alpha:.5},e);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu*=-1;this.body=c;this.canvas=new a.Graphics(b);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};a.Physics.P2.BodyDebug.prototype=Object.create(a.Group.prototype);a.Physics.P2.BodyDebug.prototype.constructor=a.Physics.P2.BodyDebug;a.Utils.extend(a.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*
this.ppu;this.rotation=this.body.angle},draw:function(){var b,a,e,d,f,g,h,l,m,p,q,t,x;if(h=this.body,m=this.canvas,m.clear(),e=parseInt(this.randomPastelHex(),16),g=this.lineWidth,h instanceof p2.Body&&h.shapes.length){var v=h.shapes.length;for(d=0;d!==v;){if(a=h.shapes[d],l=h.shapeOffsets[d],b=h.shapeAngles[d],l=l||0,b=b||0,a instanceof p2.Circle)this.drawCircle(m,l[0]*this.ppu,l[1]*this.ppu,b,a.radius*this.ppu,e,g);else if(a instanceof p2.Capsule)this.drawCapsule(m,l[0]*this.ppu,l[1]*this.ppu,b,
a.length*this.ppu,a.radius*this.ppu,16711680,e,g);else if(a instanceof p2.Plane)this.drawPlane(m,l[0]*this.ppu,-l[1]*this.ppu,e,16711680,5*g,10*g,10*g,100*this.ppu,b);else if(a instanceof p2.Line)this.drawLine(m,a.length*this.ppu,16711680,g);else if(a instanceof p2.Rectangle)this.drawRectangle(m,l[0]*this.ppu,l[1]*this.ppu,b,a.width*this.ppu,a.height*this.ppu,16711680,e,g);else if(a instanceof p2.Convex){p=[];q=p2.vec2.create();f=t=0;for(x=a.vertices.length;0<=x?x>t:t>x;f=0<=x?++t:--t)f=a.vertices[f],
p2.vec2.rotate(q,f,b),p.push([(q[0]+l[0])*this.ppu,-(q[1]+l[1])*this.ppu]);this.drawConvex(m,p,a.triangles,16711680,e,g,this.settings.debugPolygons,[l[0]*this.ppu,-l[1]*this.ppu])}d++}}},drawRectangle:function(b,a,e,d,f,g,h,l,m){"undefined"==typeof m&&(m=1);"undefined"==typeof h&&(h=0);b.lineStyle(m,h,1);b.beginFill(l);b.drawRect(a-f/2,e-g/2,f,g)},drawCircle:function(b,a,e,d,f,g,h){"undefined"==typeof h&&(h=1);"undefined"==typeof g&&(g=16777215);b.lineStyle(h,0,1);b.beginFill(g,1);b.drawCircle(a,
e,2*-f);b.endFill();b.moveTo(a,e);b.lineTo(a+f*Math.cos(-d),e+f*Math.sin(-d))},drawLine:function(b,a,e,d){"undefined"==typeof d&&(d=1);"undefined"==typeof e&&(e=0);b.lineStyle(5*d,e,1);b.moveTo(-a/2,0);b.lineTo(a/2,0)},drawConvex:function(b,a,e,d,f,g,h,l){var m,p;if("undefined"==typeof g&&(g=1),"undefined"==typeof d&&(d=0),h){d=[16711680,65280,255];for(e=0;e!==a.length+1;)m=a[e%a.length],h=a[(e+1)%a.length],f=m[0],p=m[1],m=h[0],h=h[1],b.lineStyle(g,d[e%d.length],1),b.moveTo(f,-p),b.lineTo(m,-h),b.drawCircle(f,
-p,2*g),e++;return b.lineStyle(g,0,1),b.drawCircle(l[0],l[1],2*g)}b.lineStyle(g,d,1);b.beginFill(f);for(e=0;e!==a.length;)l=a[e],g=l[0],l=l[1],0===e?b.moveTo(g,-l):b.lineTo(g,-l),e++;return b.endFill(),2<a.length?(b.moveTo(a[a.length-1][0],-a[a.length-1][1]),b.lineTo(a[0][0],-a[0][1])):void 0},drawPath:function(b,a,e,d,f){var g,h,l,m,p,q,t,x,v,w;"undefined"==typeof f&&(f=1);"undefined"==typeof e&&(e=0);b.lineStyle(f,e,1);"number"==typeof d&&b.beginFill(d);h=f=null;for(e=0;e<a.length;)v=a[e],w=v[0],
v=v[1],(w!==f||v!==h)&&(0===e?b.moveTo(w,v):(l=f,m=h,p=w,q=v,t=a[(e+1)%a.length][0],x=a[(e+1)%a.length][1],g=(p-l)*(x-m)-(t-l)*(q-m),0!==g&&b.lineTo(w,v)),f=w,h=v),e++;"number"==typeof d&&b.endFill();2<a.length&&"number"==typeof d&&(b.moveTo(a[a.length-1][0],a[a.length-1][1]),b.lineTo(a[0][0],a[0][1]))},drawPlane:function(b,a,e,d,f,g,h,l,m,p){"undefined"==typeof g&&(g=1);"undefined"==typeof d&&(d=16777215);b.lineStyle(g,f,11);b.beginFill(d);b.moveTo(a,-e);d=a+Math.cos(p)*this.game.width;f=e+Math.sin(p)*
this.game.height;b.lineTo(d,-f);b.moveTo(a,-e);d=a+Math.cos(p)*-this.game.width;f=e+Math.sin(p)*-this.game.height;b.lineTo(d,-f)},drawCapsule:function(b,a,e,d,f,g,h,l,m){"undefined"==typeof m&&(m=1);"undefined"==typeof h&&(h=0);b.lineStyle(m,h,1);var p=Math.cos(d);d=Math.sin(d);b.beginFill(l,1);b.drawCircle(-f/2*p+a,-f/2*d+e,2*-g);b.drawCircle(f/2*p+a,f/2*d+e,2*-g);b.endFill();b.lineStyle(m,h,0);b.beginFill(l,1);b.moveTo(-f/2*p+g*d+a,-f/2*d+g*p+e);b.lineTo(f/2*p+g*d+a,f/2*d+g*p+e);b.lineTo(f/2*p-
g*d+a,f/2*d-g*p+e);b.lineTo(-f/2*p-g*d+a,-f/2*d-g*p+e);b.endFill();b.lineStyle(m,h,1);b.moveTo(-f/2*p+g*d+a,-f/2*d+g*p+e);b.lineTo(f/2*p+g*d+a,f/2*d+g*p+e);b.moveTo(-f/2*p-g*d+a,-f/2*d-g*p+e);b.lineTo(f/2*p-g*d+a,f/2*d-g*p+e)},randomPastelHex:function(){var b,a,e,d;return e=[255,255,255],d=Math.floor(256*Math.random()),a=Math.floor(256*Math.random()),b=Math.floor(256*Math.random()),d=Math.floor((d+3*e[0])/4),a=Math.floor((a+3*e[1])/4),b=Math.floor((b+3*e[2])/4),this.rgbToHex(d,a,b)},rgbToHex:function(b,
a,e){return this.componentToHex(b)+this.componentToHex(a)+this.componentToHex(e)},componentToHex:function(b){var a;return a=b.toString(16),2===a.len?a:a+"0"}});a.Physics.P2.Spring=function(b,a,e,d,f,g,h,l,m,p){this.game=b.game;this.world=b;"undefined"==typeof d&&(d=1);"undefined"==typeof f&&(f=100);"undefined"==typeof g&&(g=1);d=b.pxm(d);d={restLength:d,stiffness:f,damping:g};"undefined"!=typeof h&&null!==h&&(d.worldAnchorA=[b.pxm(h[0]),b.pxm(h[1])]);"undefined"!=typeof l&&null!==l&&(d.worldAnchorB=
[b.pxm(l[0]),b.pxm(l[1])]);"undefined"!=typeof m&&null!==m&&(d.localAnchorA=[b.pxm(m[0]),b.pxm(m[1])]);"undefined"!=typeof p&&null!==p&&(d.localAnchorB=[b.pxm(p[0]),b.pxm(p[1])]);this.data=new p2.LinearSpring(a,e,d);this.data.parent=this};a.Physics.P2.Spring.prototype.constructor=a.Physics.P2.Spring;a.Physics.P2.RotationalSpring=function(b,a,e,d,f,g){this.game=b.game;this.world=b;"undefined"==typeof d&&(d=null);"undefined"==typeof f&&(f=100);"undefined"==typeof g&&(g=1);d&&(d=b.pxm(d));this.data=
new p2.RotationalSpring(a,e,{restAngle:d,stiffness:f,damping:g});this.data.parent=this};a.Physics.P2.Spring.prototype.constructor=a.Physics.P2.Spring;a.Physics.P2.Material=function(b){this.name=b;p2.Material.call(this)};a.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);a.Physics.P2.Material.prototype.constructor=a.Physics.P2.Material;a.Physics.P2.ContactMaterial=function(b,a,e){p2.ContactMaterial.call(this,b,a,e)};a.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);
a.Physics.P2.ContactMaterial.prototype.constructor=a.Physics.P2.ContactMaterial;a.Physics.P2.CollisionGroup=function(b){this.mask=b};a.Physics.P2.DistanceConstraint=function(b,a,e,d,f,g,h){"undefined"==typeof d&&(d=100);"undefined"==typeof f&&(f=[0,0]);"undefined"==typeof g&&(g=[0,0]);"undefined"==typeof h&&(h=Number.MAX_VALUE);this.game=b.game;this.world=b;d=b.pxm(d);f=[b.pxmi(f[0]),b.pxmi(f[1])];g=[b.pxmi(g[0]),b.pxmi(g[1])];p2.DistanceConstraint.call(this,a,e,{distance:d,localAnchorA:f,localAnchorB:g,
maxForce:h})};a.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);a.Physics.P2.DistanceConstraint.prototype.constructor=a.Physics.P2.DistanceConstraint;a.Physics.P2.GearConstraint=function(b,a,e,d,f){"undefined"==typeof d&&(d=0);"undefined"==typeof f&&(f=1);this.game=b.game;this.world=b;p2.GearConstraint.call(this,a,e,{angle:d,ratio:f})};a.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);a.Physics.P2.GearConstraint.prototype.constructor=
a.Physics.P2.GearConstraint;a.Physics.P2.LockConstraint=function(b,a,e,d,f,g){"undefined"==typeof d&&(d=[0,0]);"undefined"==typeof f&&(f=0);"undefined"==typeof g&&(g=Number.MAX_VALUE);this.game=b.game;this.world=b;d=[b.pxm(d[0]),b.pxm(d[1])];p2.LockConstraint.call(this,a,e,{localOffsetB:d,localAngleB:f,maxForce:g})};a.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);a.Physics.P2.LockConstraint.prototype.constructor=a.Physics.P2.LockConstraint;a.Physics.P2.PrismaticConstraint=
function(b,a,e,d,f,g,h,l){"undefined"==typeof d&&(d=!0);"undefined"==typeof f&&(f=[0,0]);"undefined"==typeof g&&(g=[0,0]);"undefined"==typeof h&&(h=[0,0]);"undefined"==typeof l&&(l=Number.MAX_VALUE);this.game=b.game;this.world=b;f=[b.pxmi(f[0]),b.pxmi(f[1])];g=[b.pxmi(g[0]),b.pxmi(g[1])];p2.PrismaticConstraint.call(this,a,e,{localAnchorA:f,localAnchorB:g,localAxisA:h,maxForce:l,disableRotationalLock:!d})};a.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);a.Physics.P2.PrismaticConstraint.prototype.constructor=
a.Physics.P2.PrismaticConstraint;a.Physics.P2.RevoluteConstraint=function(b,a,e,d,f,g,h){"undefined"==typeof g&&(g=Number.MAX_VALUE);"undefined"==typeof h&&(h=null);this.game=b.game;this.world=b;e=[b.pxmi(e[0]),b.pxmi(e[1])];f=[b.pxmi(f[0]),b.pxmi(f[1])];h&&(h=[b.pxmi(h[0]),b.pxmi(h[1])]);p2.RevoluteConstraint.call(this,a,d,{worldPivot:h,localPivotA:e,localPivotB:f,maxForce:g})};a.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);a.Physics.P2.RevoluteConstraint.prototype.constructor=
a.Physics.P2.RevoluteConstraint;a.Tile=function(b,a,e,d,f,g){this.layer=b;this.index=a;this.x=e;this.y=d;this.rotation=0;this.flipped=!1;this.worldX=e*f;this.worldY=d*g;this.width=f;this.height=g;this.centerX=Math.abs(f/2);this.centerY=Math.abs(g/2);this.alpha=1;this.properties={};this.collideDown=this.collideUp=this.collideRight=this.collideLeft=this.faceRight=this.faceLeft=this.faceBottom=this.faceTop=this.scanned=!1;this.collisionCallback=null;this.collisionCallbackContext=this};a.Tile.prototype=
{containsPoint:function(b,a){return!(b<this.worldX||a<this.worldY||b>this.right||a>this.bottom)},intersects:function(b,a,e,d){return e<=this.worldX?!1:d<=this.worldY?!1:b>=this.worldX+this.width?!1:a>=this.worldY+this.height?!1:!0},setCollisionCallback:function(b,a){this.collisionCallback=b;this.collisionCallbackContext=a},destroy:function(){this.properties=this.collisionCallbackContext=this.collisionCallback=null},setCollision:function(b,a,e,d){this.collideLeft=b;this.collideRight=a;this.collideUp=
e;this.collideDown=d;this.faceLeft=b;this.faceRight=a;this.faceTop=e;this.faceBottom=d},resetCollision:function(){this.faceRight=this.faceLeft=this.faceBottom=this.faceTop=this.collideDown=this.collideUp=this.collideRight=this.collideLeft=!1},isInteresting:function(b,a){return b&&a?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:b?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:
a?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1},copy:function(b){this.index=b.index;this.alpha=b.alpha;this.properties=b.properties;this.collideUp=b.collideUp;this.collideDown=b.collideDown;this.collideLeft=b.collideLeft;this.collideRight=b.collideRight;this.collisionCallback=b.collisionCallback;this.collisionCallbackContext=b.collisionCallbackContext}};a.Tile.prototype.constructor=a.Tile;Object.defineProperty(a.Tile.prototype,"collides",{get:function(){return this.collideLeft||
this.collideRight||this.collideUp||this.collideDown}});Object.defineProperty(a.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}});Object.defineProperty(a.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(a.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(a.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(a.Tile.prototype,
"bottom",{get:function(){return this.worldY+this.height}});a.Tilemap=function(b,c,e,d,f,g){this.game=b;this.key=c;b=a.TilemapParser.parse(this.game,c,e,d,f,g);null!==b&&(this.width=b.width,this.height=b.height,this.tileWidth=b.tileWidth,this.tileHeight=b.tileHeight,this.orientation=b.orientation,this.format=b.format,this.version=b.version,this.properties=b.properties,this.widthInPixels=b.widthInPixels,this.heightInPixels=b.heightInPixels,this.layers=b.layers,this.tilesets=b.tilesets,this.tiles=b.tiles,
this.objects=b.objects,this.collideIndexes=[],this.collision=b.collision,this.images=b.images,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)};a.Tilemap.CSV=0;a.Tilemap.TILED_JSON=1;a.Tilemap.NORTH=0;a.Tilemap.EAST=1;a.Tilemap.SOUTH=2;a.Tilemap.WEST=3;a.Tilemap.prototype={create:function(b,a,e,d,f,g){return"undefined"==typeof g&&(g=this.game.world),this.width=a,this.height=e,this.setTileSize(d,f),this.layers.length=0,this.createBlankLayer(b,a,e,d,f,g)},setTileSize:function(b,
a){this.tileWidth=b;this.tileHeight=a;this.widthInPixels=this.width*b;this.heightInPixels=this.height*a},addTilesetImage:function(b,c,e,d,f,g,h){if("undefined"==typeof e&&(e=this.tileWidth),"undefined"==typeof d&&(d=this.tileHeight),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g=0),"undefined"==typeof h&&(h=0),0===e&&(e=32),0===d&&(d=32),"undefined"==typeof c){if("string"!=typeof b)return null;if(c=b,!this.game.cache.checkImageKey(c))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+
c+'"'),null}if("string"==typeof b&&(b=this.getTilesetIndex(b),null===b&&this.format===a.Tilemap.TILED_JSON))return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+c+'"'),null;if(this.tilesets[b])return this.tilesets[b].setImage(this.game.cache.getImage(c)),this.tilesets[b];b=new a.Tileset(c,h,e,d,f,g,{});b.setImage(this.game.cache.getImage(c));this.tilesets.push(b);c=this.tilesets.length-1;for(var l=f,m=f,p=0,q=0,t=0,x=h;x<h+b.total&&(this.tiles[x]=
[l,m,c],l+=e+g,p++,p!==b.total)&&(q++,q!==b.columns||(l=f,m+=d+g,q=0,t++,t!==b.rows));x++);return b},createFromObjects:function(b,c,e,d,f,g,h,l,m){if("undefined"==typeof f&&(f=!0),"undefined"==typeof g&&(g=!1),"undefined"==typeof h&&(h=this.game.world),"undefined"==typeof l&&(l=a.Sprite),"undefined"==typeof m&&(m=!0),!this.objects[b])return void console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+b);for(var p,q=0,t=this.objects[b].length;t>q;q++)if(this.objects[b][q].gid===
c){p=new l(this.game,this.objects[b][q].x,this.objects[b][q].y,e,d);p.name=this.objects[b][q].name;p.visible=this.objects[b][q].visible;p.autoCull=g;p.exists=f;this.objects[b][q].rotation&&(p.angle=this.objects[b][q].rotation);m&&(p.y-=p.height);h.add(p);for(var x in this.objects[b][q].properties)h.set(p,x,this.objects[b][q].properties[x],!1,!1,0,!0)}},createFromTiles:function(b,c,e,d,f,g){"number"==typeof b&&(b=[b]);"undefined"==typeof c||null===c?c=[]:"number"==typeof c&&(c=[c]);d=this.getLayer(d);
"undefined"==typeof f&&(f=this.game.world);"undefined"==typeof g&&(g={});void 0===g.customClass&&(g.customClass=a.Sprite);void 0===g.adjustY&&(g.adjustY=!0);var h=this.layers[d].width,l=this.layers[d].height;if(this.copy(0,0,h,l,d),2>this._results.length)return 0;for(var m,p=0,q=1,t=this._results.length;t>q;q++)if(-1!==b.indexOf(this._results[q].index)){m=new g.customClass(this.game,this._results[q].worldX,this._results[q].worldY,e);for(var x in g)m[x]=g[x];f.add(m);p++}if(1===c.length)for(q=0;q<
b.length;q++)this.replace(b[q],c[0],0,0,h,l,d);else if(1<c.length)for(q=0;q<b.length;q++)this.replace(b[q],c[q],0,0,h,l,d);return p},createLayer:function(b,c,e,d){"undefined"==typeof c&&(c=this.game.width);"undefined"==typeof e&&(e=this.game.height);"undefined"==typeof d&&(d=this.game.world);var f=b;return"string"==typeof b&&(f=this.getLayerIndex(b)),null===f||f>this.layers.length?void console.warn("Tilemap.createLayer: Invalid layer ID given: "+f):d.add(new a.TilemapLayer(this.game,this,f,c,e))},
createBlankLayer:function(b,c,e,d,f,g){if("undefined"==typeof g&&(g=this.game.world),null!==this.getLayerIndex(b))return void console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");for(var h,l={name:b,x:0,y:0,width:c,height:e,widthInPixels:c*d,heightInPixels:e*f,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},m=[],p=0;e>p;p++){h=[];for(var q=0;c>q;q++)h.push(new a.Tile(l,-1,q,p,d,f));m.push(h)}l.data=m;this.layers.push(l);this.currentLayer=
this.layers.length-1;c=l.widthInPixels;l=l.heightInPixels;c>this.game.width&&(c=this.game.width);l>this.game.height&&(l=this.game.height);m=new a.TilemapLayer(this.game,this,this.layers.length-1,c,l);return m.name=b,g.add(m)},getIndex:function(b,a){for(var e=0;e<b.length;e++)if(b[e].name===a)return e;return null},getLayerIndex:function(b){return this.getIndex(this.layers,b)},getTilesetIndex:function(b){return this.getIndex(this.tilesets,b)},getImageIndex:function(b){return this.getIndex(this.images,
b)},getObjectIndex:function(b){return this.getIndex(this.objects,b)},setTileIndexCallback:function(b,a,e,d){if(d=this.getLayer(d),"number"==typeof b)this.layers[d].callbacks[b]={callback:a,callbackContext:e};else for(var f=0,g=b.length;g>f;f++)this.layers[d].callbacks[b[f]]={callback:a,callbackContext:e}},setTileLocationCallback:function(b,a,e,d,f,g,h){if(h=this.getLayer(h),this.copy(b,a,e,d,h),!(2>this._results.length))for(b=1;b<this._results.length;b++)this._results[b].setCollisionCallback(f,g)},
setCollision:function(b,a,e,d){if("undefined"==typeof a&&(a=!0),"undefined"==typeof d&&(d=!0),e=this.getLayer(e),"number"==typeof b)return this.setCollisionByIndex(b,a,e,!0);if(Array.isArray(b)){for(var f=0;f<b.length;f++)this.setCollisionByIndex(b[f],a,e,!1);d&&this.calculateFaces(e)}},setCollisionBetween:function(b,a,e,d,f){if("undefined"==typeof e&&(e=!0),"undefined"==typeof f&&(f=!0),d=this.getLayer(d),!(b>a)){for(;a>=b;b++)this.setCollisionByIndex(b,e,d,!1);f&&this.calculateFaces(d)}},setCollisionByExclusion:function(b,
a,e,d){"undefined"==typeof a&&(a=!0);"undefined"==typeof d&&(d=!0);e=this.getLayer(e);for(var f=0,g=this.tiles.length;g>f;f++)-1===b.indexOf(f)&&this.setCollisionByIndex(f,a,e,!1);d&&this.calculateFaces(e)},setCollisionByIndex:function(b,a,e,d){if("undefined"==typeof a&&(a=!0),"undefined"==typeof e&&(e=this.currentLayer),"undefined"==typeof d&&(d=!0),a)this.collideIndexes.push(b);else{var f=this.collideIndexes.indexOf(b);-1<f&&this.collideIndexes.splice(f,1)}for(f=0;f<this.layers[e].height;f++)for(var g=
0;g<this.layers[e].width;g++){var h=this.layers[e].data[f][g];h&&h.index===b&&(a?h.setCollision(!0,!0,!0,!0):h.resetCollision(),h.faceTop=a,h.faceBottom=a,h.faceLeft=a,h.faceRight=a)}return d&&this.calculateFaces(e),e},getLayer:function(b){return"undefined"==typeof b?b=this.currentLayer:"string"==typeof b?b=this.getLayerIndex(b):b instanceof a.TilemapLayer&&(b=b.index),b},setPreventRecalculate:function(b){if(!0===b&&!0!==this.preventingRecalculate&&(this.preventingRecalculate=!0,this.needToRecalculate=
{}),!1===b&&!0===this.preventingRecalculate){this.preventingRecalculate=!1;for(var a in this.needToRecalculate)this.calculateFaces(a);this.needToRecalculate=!1}},calculateFaces:function(b){if(this.preventingRecalculate)return void(this.needToRecalculate[b]=!0);for(var a=null,e=null,d=null,f=null,g=0,h=this.layers[b].height;h>g;g++)for(var l=0,m=this.layers[b].width;m>l;l++){var p=this.layers[b].data[g][l];p&&(a=this.getTileAbove(b,l,g),e=this.getTileBelow(b,l,g),d=this.getTileLeft(b,l,g),f=this.getTileRight(b,
l,g),p.collides&&(p.faceTop=!0,p.faceBottom=!0,p.faceLeft=!0,p.faceRight=!0),a&&a.collides&&(p.faceTop=!1),e&&e.collides&&(p.faceBottom=!1),d&&d.collides&&(p.faceLeft=!1),f&&f.collides&&(p.faceRight=!1))}},getTileAbove:function(b,a,e){return 0<e?this.layers[b].data[e-1][a]:null},getTileBelow:function(b,a,e){return e<this.layers[b].height-1?this.layers[b].data[e+1][a]:null},getTileLeft:function(b,a,e){return 0<a?this.layers[b].data[e][a-1]:null},getTileRight:function(b,a,e){return a<this.layers[b].width-
1?this.layers[b].data[e][a+1]:null},setLayer:function(b){b=this.getLayer(b);this.layers[b]&&(this.currentLayer=b)},hasTile:function(b,a,e){return e=this.getLayer(e),-1<this.layers[e].data[a][b].index},removeTile:function(b,c,e){if(e=this.getLayer(e),0<=b&&b<this.layers[e].width&&0<=c&&c<this.layers[e].height&&this.hasTile(b,c,e)){var d=this.layers[e].data[c][b];return this.layers[e].data[c][b]=new a.Tile(this.layers[e],-1,b,c,this.tileWidth,this.tileHeight),this.layers[e].dirty=!0,this.calculateFaces(e),
d}},removeTileWorldXY:function(b,a,e,d,f){return f=this.getLayer(f),b=this.game.math.snapToFloor(b,e)/e,a=this.game.math.snapToFloor(a,d)/d,this.removeTile(b,a,f)},putTile:function(b,c,e,d){if(null===b)return this.removeTile(c,e,d);if(d=this.getLayer(d),0<=c&&c<this.layers[d].width&&0<=e&&e<this.layers[d].height){var f;return b instanceof a.Tile?(f=b.index,this.hasTile(c,e,d)?this.layers[d].data[e][c].copy(b):this.layers[d].data[e][c]=new a.Tile(d,f,c,e,b.width,b.height)):(f=b,this.hasTile(c,e,d)?
this.layers[d].data[e][c].index=f:this.layers[d].data[e][c]=new a.Tile(this.layers[d],f,c,e,this.tileWidth,this.tileHeight)),-1<this.collideIndexes.indexOf(f)?this.layers[d].data[e][c].setCollision(!0,!0,!0,!0):this.layers[d].data[e][c].resetCollision(),this.layers[d].dirty=!0,this.calculateFaces(d),this.layers[d].data[e][c]}return null},putTileWorldXY:function(b,a,e,d,f,g){return g=this.getLayer(g),a=this.game.math.snapToFloor(a,d)/d,e=this.game.math.snapToFloor(e,f)/f,this.putTile(b,a,e,g)},searchTileIndex:function(b,
a,e,d){"undefined"==typeof a&&(a=0);"undefined"==typeof e&&(e=!1);d=this.getLayer(d);var f=0;if(e)for(e=this.layers[d].height-1;0<=e;e--)for(var g=this.layers[d].width-1;0<=g;g--){if(this.layers[d].data[e][g].index===b){if(f===a)return this.layers[d].data[e][g];f++}}else for(e=0;e<this.layers[d].height;e++)for(g=0;g<this.layers[d].width;g++)if(this.layers[d].data[e][g].index===b){if(f===a)return this.layers[d].data[e][g];f++}return null},getTile:function(b,a,e,d){return"undefined"==typeof d&&(d=!1),
e=this.getLayer(e),0<=b&&b<this.layers[e].width&&0<=a&&a<this.layers[e].height?-1===this.layers[e].data[a][b].index?d?this.layers[e].data[a][b]:null:this.layers[e].data[a][b]:null},getTileWorldXY:function(b,a,e,d,f){return"undefined"==typeof e&&(e=this.tileWidth),"undefined"==typeof d&&(d=this.tileHeight),f=this.getLayer(f),b=this.game.math.snapToFloor(b,e)/e,a=this.game.math.snapToFloor(a,d)/d,this.getTile(b,a,f)},copy:function(b,a,e,d,f){if(f=this.getLayer(f),!this.layers[f])return void(this._results.length=
0);"undefined"==typeof b&&(b=0);"undefined"==typeof a&&(a=0);"undefined"==typeof e&&(e=this.layers[f].width);"undefined"==typeof d&&(d=this.layers[f].height);0>b&&(b=0);0>a&&(a=0);e>this.layers[f].width&&(e=this.layers[f].width);d>this.layers[f].height&&(d=this.layers[f].height);this._results.length=0;this._results.push({x:b,y:a,width:e,height:d,layer:f});for(var g=a;a+d>g;g++)for(var h=b;b+e>h;h++)this._results.push(this.layers[f].data[g][h]);return this._results},paste:function(b,a,e,d){if("undefined"==
typeof b&&(b=0),"undefined"==typeof a&&(a=0),d=this.getLayer(d),e&&!(2>e.length)){b-=e[1].x;a-=e[1].y;for(var f=1;f<e.length;f++)this.layers[d].data[a+e[f].y][b+e[f].x].copy(e[f]);this.layers[d].dirty=!0;this.calculateFaces(d)}},swap:function(b,a,e,d,f,g,h){h=this.getLayer(h);this.copy(e,d,f,g,h);2>this._results.length||(this._tempA=b,this._tempB=a,this._results.forEach(this.swapHandler,this),this.paste(e,d,this._results,h))},swapHandler:function(b){b.index===this._tempA?b.index=this._tempB:b.index===
this._tempB&&(b.index=this._tempA)},forEach:function(b,a,e,d,f,g,h){h=this.getLayer(h);this.copy(e,d,f,g,h);2>this._results.length||(this._results.forEach(b,a),this.paste(e,d,this._results,h))},replace:function(b,a,e,d,f,g,h){if(h=this.getLayer(h),this.copy(e,d,f,g,h),!(2>this._results.length)){for(f=1;f<this._results.length;f++)this._results[f].index===b&&(this._results[f].index=a);this.paste(e,d,this._results,h)}},random:function(b,a,e,d,f){if(f=this.getLayer(f),this.copy(b,a,e,d,f),!(2>this._results.length)){e=
[];for(d=1;d<this._results.length;d++)if(this._results[d].index){var g=this._results[d].index;-1===e.indexOf(g)&&e.push(g)}for(d=1;d<this._results.length;d++)this._results[d].index=this.game.rnd.pick(e);this.paste(b,a,this._results,f)}},shuffle:function(b,c,e,d,f){if(f=this.getLayer(f),this.copy(b,c,e,d,f),!(2>this._results.length)){e=[];for(d=1;d<this._results.length;d++)this._results[d].index&&e.push(this._results[d].index);a.Utils.shuffle(e);for(d=1;d<this._results.length;d++)this._results[d].index=
e[d-1];this.paste(b,c,this._results,f)}},fill:function(b,a,e,d,f,g){if(g=this.getLayer(g),this.copy(a,e,d,f,g),!(2>this._results.length)){for(d=1;d<this._results.length;d++)this._results[d].index=b;this.paste(a,e,this._results,g)}},removeAllLayers:function(){this.currentLayer=this.layers.length=0},dump:function(){for(var b="",a=[""],e=0;e<this.layers[this.currentLayer].height;e++){for(var d=0;d<this.layers[this.currentLayer].width;d++)b+="%c  ",a.push(1<this.layers[this.currentLayer].data[e][d]?this.debugMap[this.layers[this.currentLayer].data[e][d]]?
"background: "+this.debugMap[this.layers[this.currentLayer].data[e][d]]:"background: #ffffff":"background: rgb(0, 0, 0)");b+="\n"}a[0]=b;console.log.apply(console,a)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};a.Tilemap.prototype.constructor=a.Tilemap;Object.defineProperty(a.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(b){b!==this.currentLayer&&this.setLayer(b)}});a.TilemapLayer=function(b,c,e,d,f){d|=0;f|=0;PIXI.Sprite.call(this,
PIXI.TextureCache.__default);a.Component.Core.init.call(this,b,0,0,null,null);this.map=c;this.index=e;this.layer=c.layers[e];this.canvas=a.Canvas.create(d,f);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new a.Frame(0,0,0,d,f,"tilemapLayer",b.rnd.uuid());this.physicsType=this.type=a.TILEMAPLAYER;this.renderSettings={enableScrollDelta:!0,overdrawRatio:.2,copyCanvas:null};this.debug=!1;this.exists=
!0;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorY=this.scrollFactorX=1;this.dirty=!0;this.rayStepRate=4;this._wrap=!1;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:c.tileWidth,tileHeight:c.tileHeight,cw:c.tileWidth,ch:c.tileHeight,tilesets:[]};this._scrollY=this._scrollX=0;this._results=[];b.device.canvasBitBltShift||
(this.renderSettings.copyCanvas=a.TilemapLayer.ensureSharedCopyCanvas());this.fixedToCamera=!0};a.TilemapLayer.prototype=Object.create(PIXI.Sprite.prototype);a.TilemapLayer.prototype.constructor=a.TilemapLayer;a.Component.Core.install.call(a.TilemapLayer.prototype,["Bounds","Destroy","FixedToCamera","Reset","Smoothed"]);a.TilemapLayer.sharedCopyCanvas=null;a.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=a.Canvas.create(2,2)),this.sharedCopyCanvas};
a.TilemapLayer.prototype.preUpdate=function(){return a.Component.Core.preUpdate.call(this),!0};a.TilemapLayer.prototype.postUpdate=function(){a.Component.Core.prototype.postUpdate.call(this);var b=this.game.camera;this.scrollX=b.x*this.scrollFactorX/this.scale.x;this.scrollY=b.y*this.scrollFactorY/this.scale.y;this.render()};a.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};a.TilemapLayer.prototype._fixX=
function(b){return 0>b&&(b=0),1===this.scrollFactorX?b:this._scrollX+(b-this._scrollX/this.scrollFactorX)};a.TilemapLayer.prototype._unfixX=function(b){return 1===this.scrollFactorX?b:this._scrollX/this.scrollFactorX+(b-this._scrollX)};a.TilemapLayer.prototype._fixY=function(b){return 0>b&&(b=0),1===this.scrollFactorY?b:this._scrollY+(b-this._scrollY/this.scrollFactorY)};a.TilemapLayer.prototype._unfixY=function(b){return 1===this.scrollFactorY?b:this._scrollY/this.scrollFactorY+(b-this._scrollY)};
a.TilemapLayer.prototype.getTileX=function(b){return Math.floor(this._fixX(b)/this._mc.tileWidth)};a.TilemapLayer.prototype.getTileY=function(b){return Math.floor(this._fixY(b)/this._mc.tileHeight)};a.TilemapLayer.prototype.getTileXY=function(b,a,e){return e.x=this.getTileX(b),e.y=this.getTileY(a),e};a.TilemapLayer.prototype.getRayCastTiles=function(b,a,e,d){a||(a=this.rayStepRate);"undefined"==typeof e&&(e=!1);"undefined"==typeof d&&(d=!1);e=this.getTiles(b.x,b.y,b.width,b.height,e,d);if(0===e.length)return[];
b=b.coordinatesOnLine(a);a=[];for(d=0;d<e.length;d++)for(var f=0;f<b.length;f++){var g=e[d],h=b[f];if(g.containsPoint(h[0],h[1])){a.push(g);break}}return a};a.TilemapLayer.prototype.getTiles=function(b,a,e,d,f,g){"undefined"==typeof f&&(f=!1);"undefined"==typeof g&&(g=!1);var h=!(f||g);b=this._fixX(b);a=this._fixY(a);var l=Math.floor(b/(this._mc.cw*this.scale.x)),m=Math.floor(a/(this._mc.ch*this.scale.y));b=Math.ceil((b+e)/(this._mc.cw*this.scale.x))-l;for(a=Math.ceil((a+d)/(this._mc.ch*this.scale.y))-
m;this._results.length;)this._results.pop();for(d=m;m+a>d;d++)for(e=l;l+b>e;e++){var p=this.layer.data[d];p&&p[e]&&(h||p[e].isInteresting(f,g))&&this._results.push(p[e])}return this._results.slice()};Object.defineProperty(a.TilemapLayer.prototype,"tileColor",{get:function(){return this.debugSettings.missingImageFill},set:function(b){this.debugSettings.missingImageFill=b}});Object.defineProperty(a.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(b){this._wrap=b;this.dirty=
!0}});a.TilemapLayer.prototype.resolveTileset=function(b){var a=this._mc.tilesets;if(2E3>b)for(;a.length<b;)a.push(void 0);var e=this.map.tiles[b]&&this.map.tiles[b][2];return null!=e&&(e=this.map.tilesets[e])&&e.containsTileIndex(b)?a[b]=e:a[b]=null};a.TilemapLayer.prototype.resetTilesetCache=function(){for(var b=this._mc.tilesets;b.length;)b.pop()};a.TilemapLayer.prototype.setScale=function(b,a){b=b||1;a=a||b;for(var e=0;e<this.layer.data.length;e++)for(var d=this.layer.data[e],f=0;f<d.length;f++){var g=
d[f];g.width=this.map.tileWidth*b;g.height=this.map.tileHeight*a;g.worldX=g.x*g.width;g.worldY=g.y*g.height}this.scale.setTo(b,a)};a.TilemapLayer.prototype.shiftCanvas=function(b,a,e){var d=b.canvas,f=d.width-Math.abs(a),g=d.height-Math.abs(e),h=0,l=0,m=a,p=e;0>a&&(h=-a,m=0);0>e&&(l=-e,p=0);(a=this.renderSettings.copyCanvas)?((a.width<f||a.height<g)&&(a.width=f,a.height=g),e=a.getContext("2d"),e.clearRect(0,0,f,g),e.drawImage(d,h,l,f,g,0,0,f,g),b.clearRect(m,p,f,g),b.drawImage(a,0,0,f,g,m,p,f,g)):
(b.save(),b.globalCompositeOperation="copy",b.drawImage(d,h,l,f,g,m,p,f,g),b.restore())};a.TilemapLayer.prototype.renderRegion=function(b,a,e,d,f,g){var h=this.context,l=this.layer.width,m=this.layer.height,p=this._mc.tileWidth,q=this._mc.tileHeight,t=this._mc.tilesets,x=0/0;this._wrap||(f>=e&&(e=Math.max(0,e),f=Math.min(l-1,f)),g>=d&&(d=Math.max(0,d),g=Math.min(m-1,g)));var v,w,r=e*p-b,F=(e+1048576*l)%l;h.fillStyle=this.tileColor;b=(d+1048576*m)%m;g-=d;for(d=d*q-a;0<=g;b++,g--,d+=q){b>=m&&(b-=m);
var C=this.layer.data[b];v=F;w=f-e;for(a=r;0<=w;v++,w--,a+=p){v>=l&&(v-=l);var D=C[v];if(D&&!(0>D.index)){var I=D.index,A=t[I];void 0===A&&(A=this.resolveTileset(I));D.alpha===x||this.debug||(h.globalAlpha=D.alpha,x=D.alpha);A?D.rotation||D.flipped?(h.save(),h.translate(a+D.centerX,d+D.centerY),h.rotate(D.rotation),D.flipped&&h.scale(-1,1),A.draw(h,-D.centerX,-D.centerY,I),h.restore()):A.draw(h,a,d,I):this.debugSettings.missingImageFill&&(h.fillStyle=this.debugSettings.missingImageFill,h.fillRect(a,
d,p,q));D.debug&&this.debugSettings.debuggedTileOverfill&&(h.fillStyle=this.debugSettings.debuggedTileOverfill,h.fillRect(a,d,p,q))}}}};a.TilemapLayer.prototype.renderDeltaScroll=function(b,a){var e=this._mc.scrollX,d=this._mc.scrollY,f=this.canvas.width,g=this.canvas.height,h=this._mc.tileWidth,l=this._mc.tileHeight,m=0,p=-h,q=0,t=-l;if(0>b?(m=f+b,p=f-1):0<b&&(p=b),0>a?(q=g+a,t=g-1):0<a&&(t=a),this.shiftCanvas(this.context,b,a),m=Math.floor((m+e)/h),p=Math.floor((p+e)/h),q=Math.floor((q+d)/l),t=
Math.floor((t+d)/l),p>=m)this.context.clearRect(m*h-e,0,(p-m+1)*h,g),this.renderRegion(e,d,m,Math.floor((0+d)/l),p,Math.floor((g-1+d)/l));t>=q&&(this.context.clearRect(0,q*l-d,f,(t-q+1)*l),this.renderRegion(e,d,Math.floor((0+e)/h),q,Math.floor((f-1+e)/h),t))};a.TilemapLayer.prototype.renderFull=function(){var b=this._mc.scrollX,a=this._mc.scrollY,e=this.canvas.width,d=this.canvas.height,f=this._mc.tileWidth,g=this._mc.tileHeight,h=Math.floor(b/f),f=Math.floor((e-1+b)/f),l=Math.floor(a/g),g=Math.floor((d-
1+a)/g);this.context.clearRect(0,0,e,d);this.renderRegion(b,a,h,l,f,g)};a.TilemapLayer.prototype.render=function(){var b=!1;if(this.visible){this.context.save();(this.dirty||this.layer.dirty)&&(this.layer.dirty=!1,b=!0);var a=this.canvas.width,e=this.canvas.height,d=0|this._scrollX,f=0|this._scrollY,g=this._mc,h=g.scrollX-d,l=g.scrollY-f;if(b||0!==h||0!==l||g.renderWidth!==a||g.renderHeight!==e)return g.scrollX=d,g.scrollY=f,(g.renderWidth!==a||g.renderHeight!==e)&&(g.renderWidth=a,g.renderHeight=
e),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(b=!0)),!b&&this.renderSettings.enableScrollDelta&&Math.abs(h)+Math.abs(l)<Math.min(a,e)?this.renderDeltaScroll(h,l):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}};a.TilemapLayer.prototype.renderDebug=function(){var b,a,e,d,f,g;d=this._mc.scrollX;b=this._mc.scrollY;var h=this.context,l=this.layer.width,
m=this.layer.height,p=this._mc.tileWidth,q=this._mc.tileHeight,t=Math.floor(d/p),x=Math.floor((this.canvas.width-1+d)/p);a=Math.floor(b/q);g=Math.floor((this.canvas.height-1+b)/q);var v=t*p-d,w=(t+1048576*l)%l;h.strokeStyle=this.debugSettings.facingEdgeStroke;d=(a+1048576*m)%m;g-=a;for(a=a*q-b;0<=g;d++,g--,a+=q){d>=m&&(d-=m);var r=this.layer.data[d];e=w;f=x-t;for(b=v;0<=f;e++,f--,b+=p){e>=l&&(e-=l);var F=r[e];!F||0>F.index||!F.collides||(this.debugSettings.collidingTileOverfill&&(h.fillStyle=this.debugSettings.collidingTileOverfill,
h.fillRect(b,a,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(h.beginPath(),F.faceTop&&(h.moveTo(b,a),h.lineTo(b+this._mc.cw,a)),F.faceBottom&&(h.moveTo(b,a+this._mc.ch),h.lineTo(b+this._mc.cw,a+this._mc.ch)),F.faceLeft&&(h.moveTo(b,a),h.lineTo(b,a+this._mc.ch)),F.faceRight&&(h.moveTo(b+this._mc.cw,a),h.lineTo(b+this._mc.cw,a+this._mc.ch)),h.stroke()))}}};Object.defineProperty(a.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(b){this._scrollX=b}});
Object.defineProperty(a.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(b){this._scrollY=b}});Object.defineProperty(a.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(b){this._mc.cw=0|b;this.dirty=!0}});Object.defineProperty(a.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(b){this._mc.ch=0|b;this.dirty=!0}});a.TilemapParser={parse:function(b,c,e,d,f,g){if("undefined"==typeof e&&(e=
32),"undefined"==typeof d&&(d=32),"undefined"==typeof f&&(f=10),"undefined"==typeof g&&(g=10),"undefined"==typeof c)return this.getEmptyData();if(null===c)return this.getEmptyData(e,d,f,g);if(b=b.cache.getTilemapData(c)){if(b.format===a.Tilemap.CSV)return this.parseCSV(c,b.data,e,d);if(!b.format||b.format===a.Tilemap.TILED_JSON)return this.parseTiledJSON(b.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+c)},parseCSV:function(b,c,e,d){var f=this.getEmptyData();c=c.trim();
var g=[];c=c.split("\n");for(var h=c.length,l=0,m=0;m<c.length;m++){g[m]=[];for(var p=c[m].split(","),q=0;q<p.length;q++)g[m][q]=new a.Tile(f.layers[0],parseInt(p[q],10),q,m,e,d);0===l&&(l=p.length)}return f.format=a.Tilemap.CSV,f.name=b,f.width=l,f.height=h,f.tileWidth=e,f.tileHeight=d,f.widthInPixels=l*e,f.heightInPixels=h*d,f.layers[0].width=l,f.layers[0].height=h,f.layers[0].widthInPixels=f.widthInPixels,f.layers[0].heightInPixels=f.heightInPixels,f.layers[0].data=g,f},getEmptyData:function(b,
a,e,d){var f={width:0,height:0,tileWidth:0,tileHeight:0};"undefined"!=typeof b&&null!==b&&(f.tileWidth=b);"undefined"!=typeof a&&null!==a&&(f.tileHeight=a);"undefined"!=typeof e&&null!==e&&(f.width=e);"undefined"!=typeof d&&null!==d&&(f.height=d);f.orientation="orthogonal";f.version="1";f.properties={};f.widthInPixels=0;f.heightInPixels=0;b=[];return b.push({name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}),
f.layers=b,f.images=[],f.objects={},f.collision={},f.tilesets=[],f.tiles=[],f},parseTiledJSON:function(b){function c(b,a){var c={},d;for(d in a){var e=a[d];b[e]&&(c[e]=b[e])}return c}if("orthogonal"!==b.orientation)return console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser"),null;var e={};e.width=b.width;e.height=b.height;e.tileWidth=b.tilewidth;e.tileHeight=b.tileheight;e.orientation=b.orientation;e.format=a.Tilemap.TILED_JSON;e.version=
b.version;e.properties=b.properties;e.widthInPixels=e.width*e.tileWidth;e.heightInPixels=e.height*e.tileHeight;for(var d=[],f=0;f<b.layers.length;f++)if("tilelayer"===b.layers[f].type){var g={name:b.layers[f].name,x:b.layers[f].x,y:b.layers[f].y,width:b.layers[f].width,height:b.layers[f].height,widthInPixels:b.layers[f].width*b.tilewidth,heightInPixels:b.layers[f].height*b.tileheight,alpha:b.layers[f].opacity,visible:b.layers[f].visible,properties:{},indexes:[],callbacks:[],bodies:[]};b.layers[f].properties&&
(g.properties=b.layers[f].properties);for(var h,l,m,p,q=0,t=[],x=[],v=0,w=b.layers[f].data.length;w>v;v++){if(h=0,l=!1,p=b.layers[f].data[v],536870912<p)switch(m=0,2147483648<p&&(p-=2147483648,m+=4),1073741824<p&&(p-=1073741824,m+=2),536870912<p&&(p-=536870912,m+=1),m){case 5:h=Math.PI/2;break;case 6:h=Math.PI;break;case 3:h=3*Math.PI/2;break;case 4:h=0;l=!0;break;case 7:h=Math.PI/2;l=!0;break;case 2:h=Math.PI;l=!0;break;case 1:h=3*Math.PI/2,l=!0}0<p?(t.push(new a.Tile(g,p,q,x.length,b.tilewidth,
b.tileheight)),t[t.length-1].rotation=h,t[t.length-1].flipped=l):t.push(new a.Tile(g,-1,q,x.length,b.tilewidth,b.tileheight));q++;q===b.layers[f].width&&(x.push(t),q=0,t=[])}g.data=x;d.push(g)}e.layers=d;w=[];for(f=0;f<b.layers.length;f++)"imagelayer"===b.layers[f].type&&(q={name:b.layers[f].name,image:b.layers[f].image,x:b.layers[f].x,y:b.layers[f].y,alpha:b.layers[f].opacity,visible:b.layers[f].visible,properties:{}},b.layers[f].properties&&(q.properties=b.layers[f].properties),w.push(q));e.images=
w;w=[];for(f=0;f<b.tilesets.length;f++){var r=b.tilesets[f];r.image?(q=new a.Tileset(r.name,r.firstgid,r.tilewidth,r.tileheight,r.margin,r.spacing,r.properties),r.tileproperties&&(q.tileProperties=r.tileproperties),q.updateTileData(r.imagewidth,r.imageheight),w.push(q)):console.warn("Phaser.TilemapParser - Image Collection Tilesets are not support")}e.tilesets=w;q={};v={};for(f=0;f<b.layers.length;f++)if("objectgroup"===b.layers[f].type)for(q[b.layers[f].name]=[],v[b.layers[f].name]=[],g=0,w=b.layers[f].objects.length;w>
g;g++){if(b.layers[f].objects[g].gid)t={gid:b.layers[f].objects[g].gid,name:b.layers[f].objects[g].name,type:b.layers[f].objects[g].hasOwnProperty("type")?b.layers[f].objects[g].type:"",x:b.layers[f].objects[g].x,y:b.layers[f].objects[g].y,visible:b.layers[f].objects[g].visible,properties:b.layers[f].objects[g].properties},b.layers[f].objects[g].rotation&&(t.rotation=b.layers[f].objects[g].rotation);else if(b.layers[f].objects[g].polyline){t={name:b.layers[f].objects[g].name,type:b.layers[f].objects[g].type,
x:b.layers[f].objects[g].x,y:b.layers[f].objects[g].y,width:b.layers[f].objects[g].width,height:b.layers[f].objects[g].height,visible:b.layers[f].objects[g].visible,properties:b.layers[f].objects[g].properties};b.layers[f].objects[g].rotation&&(t.rotation=b.layers[f].objects[g].rotation);t.polyline=[];for(d=0;d<b.layers[f].objects[g].polyline.length;d++)t.polyline.push([b.layers[f].objects[g].polyline[d].x,b.layers[f].objects[g].polyline[d].y]);v[b.layers[f].name].push(t)}else if(b.layers[f].objects[g].polygon)for(t=
c(b.layers[f].objects[g],"name type x y visible rotation properties".split(" ")),t.polygon=[],d=0;d<b.layers[f].objects[g].polygon.length;d++)t.polygon.push([b.layers[f].objects[g].polygon[d].x,b.layers[f].objects[g].polygon[d].y]);else b.layers[f].objects[g].ellipse?t=c(b.layers[f].objects[g],"name type ellipse x y width height visible rotation properties".split(" ")):(t=c(b.layers[f].objects[g],"name type x y width height visible rotation properties".split(" ")),t.rectangle=!0);q[b.layers[f].name].push(t)}e.objects=
q;e.collision=v;e.tiles=[];for(f=0;f<e.tilesets.length;f++)for(r=e.tilesets[f],b=q=r.tileMargin,t=g=w=0,v=r.firstgid;v<r.firstgid+r.total&&(e.tiles[v]=[q,b,f],q+=r.tileWidth+r.tileSpacing,w++,w!==r.total)&&(g++,g!==r.columns||(q=r.tileMargin,b+=r.tileHeight+r.tileSpacing,g=0,t++,t!==r.rows));v++);for(var F,f=0;f<e.layers.length;f++)for(g=e.layers[f],w=0;w<g.data.length;w++)for(t=g.data[w],q=0;q<t.length;q++)b=t[q],0>b.index||(F=e.tiles[b.index][2],r=e.tilesets[F],r.tileProperties&&r.tileProperties[b.index-
r.firstgid]&&(b.properties=a.Utils.mixin(r.tileProperties[b.index-r.firstgid],b.properties)));return e}};a.Tileset=function(b,a,e,d,f,g,h){("undefined"==typeof e||0>=e)&&(e=32);("undefined"==typeof d||0>=d)&&(d=32);"undefined"==typeof f&&(f=0);"undefined"==typeof g&&(g=0);this.name=b;this.firstgid=0|a;this.tileWidth=0|e;this.tileHeight=0|d;this.tileMargin=0|f;this.tileSpacing=0|g;this.properties=h||{};this.image=null;this.total=this.columns=this.rows=0;this.drawCoords=[]};a.Tileset.prototype={draw:function(b,
a,e,d){d=d-this.firstgid<<1;0<=d&&d+1<this.drawCoords.length&&b.drawImage(this.image,this.drawCoords[d],this.drawCoords[d+1],this.tileWidth,this.tileHeight,a,e,this.tileWidth,this.tileHeight)},containsTileIndex:function(a){return a>=this.firstgid&&a<this.firstgid+this.total},setImage:function(a){this.image=a;this.updateTileData(a.width,a.height)},setSpacing:function(a,c){this.tileMargin=0|a;this.tileSpacing=0|c;this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(a,
c){var e=(c-2*this.tileMargin+this.tileSpacing)/(this.tileHeight+this.tileSpacing),d=(a-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);0===e%1&&0===d%1||console.warn("Phaser.Tileset - image tile area is not an even multiple of tile size");e=Math.floor(e);d=Math.floor(d);(this.rows&&this.rows!==e||this.columns&&this.columns!==d)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ");this.rows=e;this.columns=d;this.total=e*d;this.drawCoords.length=
0;for(var d=e=this.tileMargin,f=0;f<this.rows;f++){for(var g=0;g<this.columns;g++)this.drawCoords.push(e),this.drawCoords.push(d),e+=this.tileWidth+this.tileSpacing;e=this.tileMargin;d+=this.tileHeight+this.tileSpacing}}};a.Tileset.prototype.constructor=a.Tileset;a.Particles=function(a){this.game=a;this.emitters={};this.ID=0};a.Particles.prototype={add:function(a){return this.emitters[a.name]=a,a},remove:function(a){delete this.emitters[a.name]},update:function(){for(var a in this.emitters)this.emitters[a].exists&&
this.emitters[a].update()}};a.Particles.prototype.constructor=a.Particles;a.Particles.Arcade={};a.Particles.Arcade.Emitter=function(b,c,e,d){this.maxParticles=d||50;a.Group.call(this,b);this.name="emitter"+this.game.particles.ID++;this.type=a.EMITTER;this.physicsType=a.GROUP;this.area=new a.Rectangle(c,e,1,1);this.minParticleSpeed=new a.Point(-100,-100);this.maxParticleSpeed=new a.Point(100,100);this.maxParticleScale=this.minParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=
360;this.maxParticleAlpha=this.minParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=a.Particle;this.particleDrag=new a.Point;this.angularDrag=0;this.frequency=100;this.lifespan=2E3;this.bounce=new a.Point;this.on=!1;this.particleAnchor=new a.Point(.5,.5);this.blendMode=a.blendModes.NORMAL;this.emitX=c;this.emitY=e;this.particleSendToBack=this.particleBringToTop=this.autoAlpha=this.autoScale=!1;this._minParticleScale=new a.Point(1,1);this._maxParticleScale=new a.Point(1,1);this._flowTotal=
this._flowQuantity=this._counter=this._timer=this._quantity=0;this._explode=!0;this._frames=null};a.Particles.Arcade.Emitter.prototype=Object.create(a.Group.prototype);a.Particles.Arcade.Emitter.prototype.constructor=a.Particles.Arcade.Emitter;a.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,0!==this._flowTotal)if(0<this._flowQuantity)for(var a=0;a<this._flowQuantity;a++){if(this.emitParticle()&&
(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,0<this._quantity&&this._counter>=this._quantity&&(this.on=!1));for(a=this.children.length;a--;)this.children[a].exists&&this.children[a].update()};a.Particles.Arcade.Emitter.prototype.makeParticles=function(a,c,e,d,f){"undefined"==typeof c&&(c=0);"undefined"==
typeof e&&(e=this.maxParticles);"undefined"==typeof d&&(d=!1);"undefined"==typeof f&&(f=!1);var g,h=0,l=a,m=c;this._frames=c;for(e>this.maxParticles&&(this.maxParticles=e);e>h;)Array.isArray(a)&&(l=this.game.rnd.pick(a)),Array.isArray(c)&&(m=this.game.rnd.pick(c)),g=new this.particleClass(this.game,0,0,l,m),this.game.physics.arcade.enable(g,!1),d?(g.body.checkCollision.any=!0,g.body.checkCollision.none=!1):g.body.checkCollision.none=!0,g.body.collideWorldBounds=f,g.body.skipQuadTree=!0,g.exists=!1,
g.visible=!1,g.anchor.copyFrom(this.particleAnchor),this.add(g),h++;return this};a.Particles.Arcade.Emitter.prototype.kill=function(){this.exists=this.alive=this.on=!1};a.Particles.Arcade.Emitter.prototype.revive=function(){this.exists=this.alive=!0};a.Particles.Arcade.Emitter.prototype.explode=function(a,c){this._flowTotal=0;this.start(!0,a,0,c,!1)};a.Particles.Arcade.Emitter.prototype.flow=function(a,c,e,d,f){"undefined"!=typeof e&&0!==e||(e=1);"undefined"==typeof d&&(d=-1);"undefined"==typeof f&&
(f=!0);e>this.maxParticles&&(e=this.maxParticles);this._counter=0;this._flowQuantity=e;this._flowTotal=d;f?(this.start(!0,a,c,e),this._counter+=e,this.on=!0,this._timer=this.game.time.time+c*this.game.time.slowMotion):this.start(!1,a,c,e)};a.Particles.Arcade.Emitter.prototype.start=function(a,c,e,d,f){if("undefined"==typeof a&&(a=!0),"undefined"==typeof c&&(c=0),("undefined"==typeof e||null===e)&&(e=250),"undefined"==typeof d&&(d=0),"undefined"==typeof f&&(f=!1),d>this.maxParticles&&(d=this.maxParticles),
this.revive(),this.visible=!0,this.lifespan=c,this.frequency=e,a||f)for(a=0;d>a;a++)this.emitParticle();else this.on=!0,this._quantity+=d,this._counter=0,this._timer=this.game.time.time+e*this.game.time.slowMotion};a.Particles.Arcade.Emitter.prototype.emitParticle=function(){var a=this.getFirstExists(!1);return null===a?!1:(1<this.width||1<this.height?a.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom)):a.reset(this.emitX,this.emitY),a.angle=
0,a.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(a):this.particleSendToBack&&this.sendToBack(a),this.autoScale?a.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?a.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale)):(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y)&&a.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,
this._maxParticleScale.y)),a.frame=Array.isArray("object"===this._frames)?this.game.rnd.pick(this._frames):this._frames,this.autoAlpha?a.setAlphaData(this.alphaData):a.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha),a.blendMode=this.blendMode,a.body.updateBounds(),a.body.bounce.setTo(this.bounce.x,this.bounce.y),a.body.velocity.x=this.game.rnd.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),a.body.velocity.y=this.game.rnd.between(this.minParticleSpeed.y,this.maxParticleSpeed.y),
a.body.angularVelocity=this.game.rnd.between(this.minRotation,this.maxRotation),a.body.gravity.y=this.gravity,a.body.drag.x=this.particleDrag.x,a.body.drag.y=this.particleDrag.y,a.body.angularDrag=this.angularDrag,a.onEmit(),!0)};a.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);a.Group.prototype.destroy.call(this,!0,!1)};a.Particles.Arcade.Emitter.prototype.setSize=function(a,c){this.area.width=a;this.area.height=c};a.Particles.Arcade.Emitter.prototype.setXSpeed=
function(a,c){this.minParticleSpeed.x=a||0;this.maxParticleSpeed.x=c||0};a.Particles.Arcade.Emitter.prototype.setYSpeed=function(a,c){this.minParticleSpeed.y=a||0;this.maxParticleSpeed.y=c||0};a.Particles.Arcade.Emitter.prototype.setRotation=function(a,c){this.minRotation=a||0;this.maxRotation=c||0};a.Particles.Arcade.Emitter.prototype.setAlpha=function(b,c,e,d,f){if("undefined"==typeof b&&(b=1),"undefined"==typeof c&&(c=1),"undefined"==typeof e&&(e=0),"undefined"==typeof d&&(d=a.Easing.Linear.None),
"undefined"==typeof f&&(f=!1),this.minParticleAlpha=b,this.maxParticleAlpha=c,this.autoAlpha=!1,0<e&&b!==c)b=this.game.make.tween({v:b}).to({v:c},e,d),b.yoyo(f),this.alphaData=b.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0};a.Particles.Arcade.Emitter.prototype.setScale=function(b,c,e,d,f,g,h){if("undefined"==typeof b&&(b=1),"undefined"==typeof c&&(c=1),"undefined"==typeof e&&(e=1),"undefined"==typeof d&&(d=1),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g=a.Easing.Linear.None),
"undefined"==typeof h&&(h=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(b,e),this._maxParticleScale.set(c,d),this.autoScale=!1,0<f&&(b!==c||e!==d))b=this.game.make.tween({x:b,y:e}).to({x:c,y:d},f,g),b.yoyo(h),this.scaleData=b.generateData(60),this.scaleData.reverse(),this.autoScale=!0};a.Particles.Arcade.Emitter.prototype.at=function(a){a.center?(this.emitX=a.center.x,this.emitY=a.center.y):(this.emitX=a.world.x+a.anchor.x*a.width,this.emitY=a.world.y+a.anchor.y*a.height)};
Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(a){this.area.width=a}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(a){this.area.height=a}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(a){this.emitX=a}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},
set:function(a){this.emitY=a}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+
this.area.height/2)}});void 0===PIXI.blendModes&&(PIXI.blendModes=a.blendModes);void 0===PIXI.scaleModes&&(PIXI.scaleModes=a.scaleModes);void 0===PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture));void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new PIXI.Matrix);void 0===PIXI.RenderTexture.tempMatrix&&(PIXI.RenderTexture.tempMatrix=new PIXI.Matrix);void 0===PIXI.Graphics.POLY&&(PIXI.Graphics.POLY=a.POLYGON,PIXI.Graphics.RECT=a.RECTANGLE,
PIXI.Graphics.CIRC=a.CIRCLE,PIXI.Graphics.ELIP=a.ELLIPSE,PIXI.Graphics.RREC=a.ROUNDEDRECTANGLE);"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.Phaser=a):"undefined"!=typeof define&&define.amd?define("Phaser",this.Phaser=a):this.Phaser=a}).call(this);var gridSize=16,width=48*gridSize,height=32*gridSize;SAGDX.introState=function(h){};
SAGDX.introState.prototype={timeMultiplier:400,debugMode:!1,justToggled:null,dialogue:"Initiating diagnostic procedure;Press left arrow to move left;Press right arrow to move right;Press space to jump;FATAL ERROR: Core component 0x5AFF missing;Press R to sabotage own systems".split(";"),tutorialPoint:0,textTimer:0,preload:function(){this.game.world.alpha=0;this.game.add.tween(this.game.world).to({alpha:1},750).start()},create:function(){this.game.renderer.renderSession.roundPixels=!0;this.bgMap=this.game.add.tilemap("introBackgroundLayerMap");
this.bgMap.addTilesetImage("tileset");this.backgroundLayer=this.bgMap.createLayer("backgroundLayer");this.backgroundLayer.renderSettings.enableScrollDelta=!1;this.collisionMap=this.game.add.tilemap("introCollisionLayerMap");this.collisionMap.addTilesetImage("tileset");this.collisionLayer=this.collisionMap.createLayer("collisionLayer");this.collisionMap.setCollision(1,!0,this.collisionLayer);this.collisionLayer.visible=!1;this.parabgsBack=this.game.add.group();this.parabg1=new ParaBackground(this,
this.game,0,1,this.parabgsBack,"parabackground3");this.parabg1.animations.add("full");this.parabg1.animations.play("full",30,!0);this.game.physics.startSystem(Phaser.Physics.ARCADE);this.game.stage.backgroundColor=0;this.player=new Player(this,this.game,15*gridSize,10*gridSize,"player");this.keyboard=this.game.input.keyboard;this.game.world.bringToTop(this.backgroundLayer);this.game.world.bringToTop(this.player);this.dialogueBox=this.game.add.sprite(0,535,"dialogbox");this.dialogueBox.anchor.setTo(0,
1);this.dialogueBox.fixedToCamera=!0;this.dialogueText=this.game.add.text(50,410,"",{font:"20px Lato Black",fill:"#000"});this.dialogueText.fixedToCamera=!0;this.lifts=this.game.add.group();for(var h=0;5>h;h++){var a=this.game.add.sprite((12+4*h)*gridSize,20*gridSize,"lift");this.game.physics.arcade.enable(a);this.lifts.add(a)}},update:function(){this.processTutorial();this.player.cState.hurt||this.game.physics.arcade.collide(this.player,this.lifts,this.customTileContact,null,this);this.game.physics.arcade.collide(this.player,
this.collisionLayer,this.customTileContact,null,this);this.player.cState.outOfBounds&&this.goToState("Intro2")},customMobContact:function(h,a){h.mobContact(a)},customTileContact:function(h,a){h.tileContact(a)},setText:function(h){this.dialogueText.text=this.dialogue[h]},processTutorial:function(){this.tutorialPoint<this.dialogue.length&&this.setText(this.tutorialPoint);switch(this.tutorialPoint){case 0:this.textTimer++;300<this.textTimer&&(this.tutorialPoint++,this.textTimer=0);break;case 1:this.keyboard.isDown(37)&&
this.tutorialPoint++;break;case 2:this.keyboard.isDown(39)&&this.tutorialPoint++;break;case 3:this.keyboard.isDown(32)&&this.tutorialPoint++;break;case 4:this.textTimer++;300<this.textTimer&&(this.tutorialPoint++,this.textTimer=0);break;case 5:this.keyboard.isDown(82)&&(this.tutorialPoint++,this.dialogueBox.destroy(),this.dialogueText.text="",this.endTutorial())}},endTutorial:function(){this.player.animations.play("hurtLeft");this.player.cState.inputDisabled=!0;this.game.time.events.add(1500,function(){this.lifts.destroy(!0)},
this)},goToState:function(h){var a=this.game.add.tween(this.game.world).to({alpha:0},750);a.onComplete.add(function(){this.state.start(h)},this);a.start()}};window.onload=function(){var h=new Phaser.Game(width,height,Phaser.CANVAS,document.getElementById("main"));WebFontConfig={google:{families:["Lato"]}};h.state.add("Boot",SAGDX.Boot);h.state.add("Preloader",SAGDX.Preloader);h.state.add("Intro",SAGDX.introState);h.state.add("Intro2",SAGDX.intro2State);h.state.add("Level1",SAGDX.level1State);h.state.add("Level2",SAGDX.level2State);h.state.add("Credits",SAGDX.Credits);h.state.start("Boot")};