var BigBlast=function(e,a,g,h,k,m,b,c){"undefined"===typeof k&&(k=a.world);"undefined"===typeof b&&(b=3);Phaser.Sprite.call(this,a,g,h,"bigblast");a.physics.arcade.enable(this);k.add(this);this.body.setSize(48,48,16,16);this.game.debugMode&&(g=(new Phaser.Graphics).beginFill(9013641).drawRect(0,0,48,48),a=a.add.sprite(16,16,g.generateTexture()),a.alpha=.5,this.addChild(a));this.mobType="bigblast";this.conflux=e;this.body.customSeparateX=!0;this.body.customSeparateY=!0;this.body.allowGravity=!1;this.sfx=
this.game.add.audio("sfx");this.sfx.addMarker("blast",7,1,.3,!1);this.animations.add("left",[0,1,2,3,4,5,12,13,14,15,16,17,24,25,26,27,28,29,36,37,38,39,40,41,48,49,50,51,52,53]);this.animations.add("right",[6,7,8,9,10,11,18,19,20,21,22,23,30,31,32,33,34,35,42,43,44,45,46,47,54,55,56,57,58,59]);this.cConstants={speed:b*gridSize,animationPausedOffset:60};this.cState={markDestroyed:!1,paused:!1,facing:m};1==this.cState.facing?this.animations.play("right",20,!0):-1==this.cState.facing&&this.animations.play("left",
20,!0);this.update=function(){this.body.velocity.x=this.cState.paused?0:this.cConstants.speed*this.cState.facing;this.cState.markDestroyed&&(new LittleBlast(this.conflux,this.game,this.x,this.y+16,this.conflux.blasts,-1*this.cState.facing,this.cConstants.speed/gridSize*2,!1),this.destroy())};this.mobContact=function(b){b.hit();this.cState.markDestroyed=!0};this.hit=function(){};this.tileContact=function(b){this.cState.markDestroyed=!0};this.debugString=function(){return"[pos:"+Math.floor(this.x)+
"/"+Math.floor(this.y)+"]"};this.setPause=function(b){this.sfx.stop();this.cState.paused!=b&&(this.animations.frame=b?this.animations.frame+this.cConstants.animationPausedOffset:this.animations.frame-this.cConstants.animationPausedOffset,this.animations.paused=b,this.cState.paused=b)};this.setPause(!!c);this.sfx.play("blast")};BigBlast.prototype=Object.create(Phaser.Sprite.prototype);BigBlast.prototype.constructor=BigBlast;var SAGDX={Boot:function(e){}};
SAGDX.Boot.prototype={preload:function(){this.load.image("loadBar","assets/loadBar.png",350,50);this.load.image("SAGDlogo","assets/SA.png",135,135)},create:function(){this.input.maxPointers=1;this.stage.disableVisibilityChange=!0;this.game.device.desktop?this.scale.pageAlignHorizontally=!0:(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.minWidth=384,this.scale.minHeight=256,this.scale.maxWidth=768,this.scale.maxHeight=512,this.scale.forceLandscape=!0,this.scale.pageAlignHorizontally=!0,
this.scale.setScreenSize(!0));this.state.start("Preloader")}};var Carrier=function(e,a,g,h,k,m,b,c,f,d){"undefined"===typeof k&&(k=a.world);"undefined"===typeof c&&(c=0);"undefined"===typeof f&&(f=10);Phaser.Sprite.call(this,a,g,h,"carrier");a.physics.arcade.enable(this);k.add(this);this.body.setSize(64,31,5,0);this.mobType="carrier";this.outOfBoundsKill=this.body.immovable=!0;this.waypoints=b;this.conflux=e;this.animations.add("plain",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]);this.animations.play("plain",20,!0);this.sfx=this.game.add.audio("sfx");this.sfx.addMarker("idle",
9.5,.5,.05,!0);this.cConstants={speed:f*gridSize,animationPausedOffset:16};this.cState={waiting:!1,waitUntil:0,paused:!1,facing:m};this.nextWaypoint={index:c,x:this.waypoints[c].x*gridSize,y:this.waypoints[c].y*gridSize};this.update=function(){this.body.velocity.x=0;this.body.velocity.y=0;this.cState.paused||(this.sfx.isPlaying||this.sfx.play("idle"),this.cState.waiting?(this.body.velocity.x=0,this.body.velocity.y=0,this.game.time.now>this.cState.waitUntil&&(this.cState.waiting=!1,this.setNextWaypoint())):
this.moveToWaypoint())};this.moveToWaypoint=function(){reachedX=(reachedX=0==this.nextWaypoint.directionX||0>this.nextWaypoint.directionX&&this.body.x<this.nextWaypoint.x)||0<this.nextWaypoint.directionX&&this.body.x>this.nextWaypoint.x;reachedY=(reachedY=0==this.nextWaypoint.directionY||0>this.nextWaypoint.directionY&&this.body.y<this.nextWaypoint.y)||0<this.nextWaypoint.directionY&&this.body.y>this.nextWaypoint.y;reachedX&&(this.body.x=this.nextWaypoint.x);reachedY&&(this.body.y=this.nextWaypoint.y);
reachedX&&reachedY?(this.body.velocity.x=0,this.body.velocity.y=0,this.setNextWaypoint()):(reachedX||(this.body.velocity.x=this.nextWaypoint.directionX*this.cConstants.speed),reachedY||(this.body.velocity.y=this.nextWaypoint.directionY*this.cConstants.speed))};this.hit=function(){this.setPause(!1)};this.setNextWaypoint=function(){this.nextWaypoint.index+=1;this.nextWaypoint.index>=this.waypoints.length&&(this.nextWaypoint.index=0);var b=this.waypoints[this.nextWaypoint.index];b.wait?(this.cState.waiting=
!0,this.cState.waitUntil=this.game.time.now+b.wait*e.timeMultiplier):b.destroy?this.destroy():(this.nextWaypoint.x=b.x*gridSize,this.nextWaypoint.y=b.y*gridSize,this.setWaypointDirection(),this.body.velocity.x=this.nextWaypoint.directionX*this.cConstants.speed,this.body.velocity.y=this.nextWaypoint.directionY*this.cConstants.speed)};this.setWaypointDirection=function(){this.nextWaypoint.directionX=this.nextWaypoint.x<this.body.x?-1:this.nextWaypoint.x>this.body.x?1:0;this.nextWaypoint.directionY=
this.nextWaypoint.y<this.body.y?-1:this.nextWaypoint.y>this.body.y?1:0};this.setWaypointDirection();this.debugString=function(){return"CARRIER: [pos:"+Math.floor(this.body.x)+"/"+Math.floor(this.body.y)+"][target:"+this.nextWaypoint.x+"/"+this.nextWaypoint.y+"][looking:"+this.nextWaypoint.directionX+"/"+this.nextWaypoint.directionY+"][moving:"+this.body.velocity.x+"/"+this.body.velocity.y+"]"};this.setPause=function(b){this.sfx.stop();this.cState.paused!=b&&(this.animations.frame=b?this.animations.frame+
this.cConstants.animationPausedOffset:this.animations.frame-this.cConstants.animationPausedOffset,this.animations.paused=b,this.cState.paused=b)};this.setPause(!!d)};Carrier.prototype=Object.create(Phaser.Sprite.prototype);Carrier.prototype.constructor=Carrier;var gridSize=16,width=48*gridSize,height=32*gridSize;SAGDX.ending1State=function(e){};
SAGDX.ending1State.prototype={timeMultiplier:400,debugMode:!1,justToggled:null,dialogueTexts:["Target acquired.","The Doctor's performing destructive analysis\nin the back right now.","Even if the Factory makes more of these things\nwe'll be ready.","The mission is a success.","Tell the boys we're coming home."],dialoguePoint:0,textTimer:0,dialogues:[],dialogueY:2,preload:function(){},create:function(){this.game.world.alpha=1;this.game.renderer.renderSession.roundPixels=!0;this.game.physics.startSystem(Phaser.Physics.ARCADE);
this.game.stage.backgroundColor=0;this.player=this.game.add.sprite(35*gridSize,25*gridSize,"player");this.player.animations.add("hurtLeft",[73]);this.player.animations.play("hurtLeft",2,!0);this.title=this.game.add.sprite(width/2,height/2,"title");this.title.anchor.setTo(.5,.5);this.title.alpha=0;for(var e,a=0;a<this.dialogueTexts.length;a+=1)e=this.game.add.text(3*gridSize,this.dialogueY*gridSize,this.dialogueTexts[a],{font:"25px Lato Black",fill:"#4444FF"}),e.alpha=0,e.anchor.set(0),this.dialogueY+=
5,this.dialogues.push(e),this.game.add.tween(e).to({alpha:1},2500,"Linear",!0,2500*a)},update:function(){},endEnding:function(){},goToState:function(e){this.state.start(e)}};SAGDX.ending2State=function(e){};
SAGDX.ending2State.prototype={timeMultiplier:400,debugMode:!1,justToggled:null,dialogueTexts:"Unit Reset to Factory Defaults.;Components repaired. Data logged.\nMemory banks purged.;Testing...     Testing...\nAll tests nominal.;Prototype program assessment: Success.\nPrototype unit transferred to scrapyard for recycling.;Initial order of 2000 combat-ready production units set.;Beginning production run immediately.".split(";"),dialoguePoint:0,textTimer:0,dialogues:[],dialogueY:2,preload:function(){},
create:function(){this.game.world.alpha=1;this.game.renderer.renderSession.roundPixels=!0;this.game.physics.startSystem(Phaser.Physics.ARCADE);this.game.stage.backgroundColor=0;this.player=this.game.add.sprite(35*gridSize,25*gridSize,"player");this.player.animations.add("hurtLeft",[73]);this.player.animations.play("hurtLeft",2,!0);this.title=this.game.add.sprite(width/2,height/2,"title");this.title.anchor.setTo(.5,.5);this.title.alpha=0;for(var e,a=0;a<this.dialogueTexts.length;a+=1)e=this.game.add.text(2*
gridSize,this.dialogueY*gridSize,this.dialogueTexts[a],{font:"25px Lato Black",fill:"#FF4444"}),e.alpha=0,e.anchor.set(0),this.dialogueY+=5,this.dialogues.push(e),this.game.add.tween(e).to({alpha:1},2500,"Linear",!0,2500*a)},update:function(){},endEnding:function(){},goToState:function(e){this.state.start(e)}};SAGDX.ending3State=function(e){};
SAGDX.ending3State.prototype={timeMultiplier:400,debugMode:!1,justToggled:null,dialogueTexts:"SYSTEM INFORMATION: DANGER!\nHEAT DAMAGE CRITICAL!;Servos: OFFLINE\nCommunications: OFFLINE;Pausebreaker P-PB14: OFFLINE;Emergency Breakers Tripped.;Activating Component P23.;Game Paused".split(";"),dialoguePoint:0,textTimer:0,dialogues:[],dialogueY:2,preload:function(){},create:function(){this.game.world.alpha=1;this.game.renderer.renderSession.roundPixels=!0;this.game.physics.startSystem(Phaser.Physics.ARCADE);this.game.stage.backgroundColor=
0;this.player=this.game.add.sprite(22*gridSize,14*gridSize,"player");this.player.animations.add("paused",[124]);this.player.animations.play("paused",1,!0);this.title=this.game.add.sprite(width/2,height/2,"title");this.title.anchor.setTo(.5,.5);this.title.alpha=0;for(var e,a=0;a<this.dialogueTexts.length;a+=1)e=this.game.add.text(2*gridSize,this.dialogueY*gridSize,this.dialogueTexts[a],{font:"25px Lato Black",fill:"#FFF"}),e.alpha=0,e.anchor.set(0),this.dialogueY+=5,this.dialogues.push(e),this.game.add.tween(e).to({alpha:1},
2500,"Linear",!0,2500*a)},update:function(){},endEnding:function(){},goToState:function(e){this.state.start(e)}};var Floater=function(e,a,g,h,k,m,b,c,f,d){"undefined"===typeof k&&(k=a.world);"undefined"===typeof c&&(c=0);"undefined"===typeof f&&(f=10);Phaser.Sprite.call(this,a,g,h,"floater");a.physics.arcade.enable(this);k.add(this);this.body.setSize(40,40,10,6);this.mobType="floater";this.body.immovable=!0;this.outOfBoundsKill=!1;this.waypoints=b;this.conflux=e;this.animations.add("right",[0,1,2,6,7,8,12,13,14]);this.animations.add("left",[3,4,5,9,10,11,15,16,17]);this.sfx=this.game.add.audio("sfx");this.sfx.addMarker("floaterChase",
.5,2.5,1,!1);this.sfx.addMarker("idle",9.5,.5,.05,!0);this.cConstants={speed:f*gridSize,chaseDistance:30*gridSize,boostDistance:8*gridSize,chaseAccel:10*gridSize,maxChaseVelocity:15*gridSize,maxBoostVelocity:30*gridSize,dropSpeed:5*gridSize,boostTime:60,animationPausedOffset:18};this.cState={waiting:!1,waitUntil:0,paused:!1,boosting:!1,boostTimer:0,playerOnTop:!1,facing:m};this.nextWaypoint={index:c,x:this.waypoints[c].x*gridSize,y:this.waypoints[c].y*gridSize};this.nextWaypoint.directionX=this.nextWaypoint.x<
this.body.x?-1:this.nextWaypoint.x>this.body.x?1:0;this.nextWaypoint.directionY=this.nextWaypoint.y<this.body.y?-1:this.nextWaypoint.y>this.body.y?1:0;this.body.velocity.x=this.nextWaypoint.directionX*this.cConstants.speed;this.body.velocity.y=this.nextWaypoint.directionY*this.cConstants.speed;this.processAnimation=function(){this.cState.paused||(this.body.x<this.conflux.player.body.x?this.animations.play("left"):this.body.x>this.conflux.player.body.x&&this.animations.play("right"))};this.update=
function(){this.cState.paused||this.sfx.isPlaying||this.sfx.play("idle");this.processAnimation();this.cState.paused?(this.body.velocity.x=0,this.body.velocity.y=0,this.body.x=this.pauseCoords[0],this.body.y=this.pauseCoords[1]):this.cState.playerOnTop?(this.body.velocity.x=this.conflux.player.cState.facing*this.cConstants.speed/2,this.body.velocity.y=this.cConstants.dropSpeed):this.cState.boosting?(this.cState.boostTimer++,this.cState.boostTimer>this.cConstants.boostTime&&(this.cState.boosting=!1)):
Phaser.Math.distance(this.body.x,this.body.y,this.conflux.player.body.x+this.conflux.player.body.width/2,this.conflux.player.body.y+16)<=this.cConstants.boostDistance?(this.sfx.play("floaterChase"),this.cState.boosting=!0,this.body.velocity.x=0,this.body.velocity.y=0,this.game.physics.arcade.accelerateToXY(this,this.conflux.player.body.x+this.conflux.player.body.width/2,this.conflux.player.body.y+16,2*this.cConstants.chaseAccel,this.cConstants.maxBoostVelocity,this.cConstants.maxBoostVelocity),this.cState.boostTimer=
0):Phaser.Math.distance(this.body.x,this.body.y,this.conflux.player.body.x+this.conflux.player.body.width/2,this.conflux.player.body.y+16)<=this.cConstants.chaseDistance?this.game.physics.arcade.accelerateToXY(this,this.conflux.player.body.x+this.conflux.player.body.width/2,e.player.body.y+16,this.cConstants.chaseAccel,this.cConstants.maxChaseVelocity,this.cConstants.maxChaseVelocity):this.cState.waiting?(this.body.velocity.x=0,this.body.velocity.y=0,this.game.time.now>this.cState.waitUntil&&(this.cState.waiting=
!1,this.setNextWaypoint())):this.moveToWaypoint();this.cState.playerOnTop=!1};this.moveToWaypoint=function(){reachedX=(reachedX=0==this.nextWaypoint.directionX||0>this.nextWaypoint.directionX&&this.body.x<this.nextWaypoint.x)||0<this.nextWaypoint.directionX&&this.body.x>this.nextWaypoint.x;reachedY=(reachedY=0==this.nextWaypoint.directionY||0>this.nextWaypoint.directionY&&this.body.y<this.nextWaypoint.y)||0<this.nextWaypoint.directionY&&this.body.y>this.nextWaypoint.y;reachedX&&(this.body.velocity.x=
0);reachedY&&(this.body.velocity.y=0);reachedX&&reachedY?this.setNextWaypoint():(reachedX||(this.body.velocity.x=this.nextWaypoint.directionX*this.cConstants.speed),reachedY||(this.body.velocity.y=this.nextWaypoint.directionY*this.cConstants.speed))};this.setNextWaypoint=function(){this.nextWaypoint.index+=1;this.nextWaypoint.index>=this.waypoints.length&&(this.nextWaypoint.index=0);var b=this.waypoints[this.nextWaypoint.index];b.wait?(this.cState.waiting=!0,this.cState.waitUntil=this.game.time.now+
b.wait*this.conflux.timeMultiplier):b.destroy?this.destroy():(this.nextWaypoint.x=b.x*gridSize,this.nextWaypoint.y=b.y*gridSize,this.nextWaypoint.directionX=this.nextWaypoint.x<this.body.x?-1:this.nextWaypoint.x>this.body.x?1:0,this.nextWaypoint.directionY=this.nextWaypoint.y<this.body.y?-1:this.nextWaypoint.y>this.body.y?1:0,this.body.velocity.x=this.nextWaypoint.directionX*this.cConstants.speed,this.body.velocity.y=this.nextWaypoint.directionY*this.cConstants.speed)};this.hit=function(){this.setPause(!1)};
this.debugString=function(){return"FLOATER: [pos:"+Math.floor(this.body.x)+"/"+Math.floor(this.body.y)+"][target:"+this.nextWaypoint.x+"/"+this.nextWaypoint.y+"][looking:"+this.nextWaypoint.directionX+"/"+this.nextWaypoint.directionY+"][moving:"+this.body.velocity.x+"/"+this.body.velocity.y+"]"};this.setPause=function(b){this.sfx.stop();this.cState.paused!=b&&(this.animations.frame=b?this.animations.frame+this.cConstants.animationPausedOffset:this.animations.frame-this.cConstants.animationPausedOffset,
this.pauseCoords=[this.body.x,this.body.y],this.animations.paused=b,this.cState.paused=b)};this.setPause(!!d)};Floater.prototype=Object.create(Phaser.Sprite.prototype);Floater.prototype.constructor=Floater;SAGDX.intro2State=function(e){};
SAGDX.intro2State.prototype={timeMultiplier:400,debugMode:!1,justToggled:null,dialogue:["Something... is missing.","I am... flawed.","I am... incomplete.","I am still operational."],dialoguePoint:0,textTimer:0,preload:function(){},create:function(){this.game.world.alpha=1;this.game.renderer.renderSession.roundPixels=!0;this.game.physics.startSystem(Phaser.Physics.ARCADE);this.game.stage.backgroundColor=0;this.player=this.game.add.sprite(5*gridSize,10*gridSize,"player");this.player.animations.add("fallRight",
[40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]);this.player.animations.play("fallRight",30,!0);this.dialogueText=this.game.add.text(20*gridSize,10*gridSize,"",{font:"25px Lato Black",fill:"#FFF"});this.dialogueText.fixedToCamera=!0;this.title=this.game.add.sprite(width/2,height/2,"title");this.title.anchor.setTo(.5,.5);this.title.alpha=0},update:function(){this.dialoguePoint<=this.dialogue.length&&this.processIntro()},setText:function(e){this.dialogueText.text=this.dialogue[e]},processIntro:function(){this.dialoguePoint==
this.dialogue.length?(this.dialoguePoint++,this.endIntro()):(this.setText(this.dialoguePoint),this.textTimer++,200<this.textTimer&&(this.dialoguePoint++,this.textTimer=0))},endIntro:function(){this.game.add.tween(this.player).to({alpha:0},750).start();this.game.add.tween(this.dialogueText).to({alpha:0},750).start();var e=this.game.add.tween(this.title).to({alpha:1},1E4);e.onComplete.add(function(){this.goToState("Level1")},this);e.start()},goToState:function(e){var a=this.game.add.tween(this.game.world).to({alpha:0},
750);a.onComplete.add(function(){this.state.start(e)},this);a.start()}};SAGDX.introState=function(e){};
SAGDX.introState.prototype={timeMultiplier:400,debugMode:!1,justToggled:null,dialogue:"Initiating diagnostic procedure;Press left arrow to move left;Press right arrow to move right;Press space to jump;FATAL ERROR: Core component 0x5AFF missing;Error cannot be rescued. Unit is defective.;Press R to activate self-destruct sequence.".split(";"),tutorialPoint:0,textTimer:0,create:function(){this.game.world.alpha=1;this.game.renderer.renderSession.roundPixels=!0;this.bgMap=this.game.add.tilemap("introBackgroundLayerMap");
this.bgMap.addTilesetImage("tileset");this.backgroundLayer=this.bgMap.createLayer("backgroundLayer");this.backgroundLayer.renderSettings.enableScrollDelta=!1;this.collisionMap=this.game.add.tilemap("introCollisionLayerMap");this.collisionMap.addTilesetImage("tileset");this.collisionLayer=this.collisionMap.createLayer("collisionLayer");this.collisionMap.setCollision(1,!0,this.collisionLayer);this.collisionLayer.visible=!1;this.parabgsBack=this.game.add.group();this.parabg1=new ParaBackground(this,
this.game,0,.5,.8,this.parabgsBack,"parabackground3");this.parabg1.animations.add("full");this.parabg1.animations.play("full",30,!0);this.parabg2=new ParaBackground(this,this.game,768,.5,.8,this.parabgsBack,"parabackground3");this.parabg2.animations.add("full");this.parabg2.animations.play("full",30,!0);this.overlays=this.game.add.group();this.overlay1=new ParaBackground(this,this.game,0,0,.8,this.overlays,"overlay");var e=(new Phaser.Graphics).beginFill(0).drawRect(0,0,this.game.camera.width,this.game.camera.height);
this.distanceFilter1=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter1.alpha=.1;this.distanceFilter2=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter2.alpha=.6;this.game.physics.startSystem(Phaser.Physics.ARCADE);this.game.stage.backgroundColor=0;this.player=new Player(this,this.game,15*gridSize,10*gridSize,"player");this.player.cState.leftDisabled=!0;this.player.cState.rightDisabled=!0;this.player.cState.jumpDisabled=!0;this.keyboard=this.game.input.keyboard;this.game.world.bringToTop(this.parabgsBack);
this.game.world.bringToTop(this.distanceFilter2);this.game.world.bringToTop(this.distanceFilter1);this.game.world.bringToTop(this.overlays);this.game.world.bringToTop(this.backgroundLayer);this.game.world.bringToTop(this.player);this.dialogueBox=this.game.add.sprite(30,380,"instructionbox");this.dialogueBox.fixedToCamera=!0;this.dialogueText=this.game.add.text(50,50,"",{font:"20px Lato Black",fill:"#000"});this.dialogueBox.addChild(this.dialogueText);this.lifts=this.game.add.group();for(e=0;5>e;e++){var a=
this.game.add.sprite((12+4*e)*gridSize,20*gridSize,"lift",1);this.game.physics.arcade.enable(a);this.lifts.add(a)}ambience.play("",0,.8,!0)},update:function(){this.processTutorial();this.player.cState.hurt||this.game.physics.arcade.collide(this.player,this.lifts,this.customTileContact,null,this);this.game.physics.arcade.collide(this.player,this.collisionLayer,this.customTileContact,null,this);this.player.cState.outOfBounds&&this.goToState("Intro2")},customMobContact:function(e,a){e.mobContact(a)},
customTileContact:function(e,a){e.tileContact(a)},setText:function(e){this.dialogueText.text=this.dialogue[e]},processTutorial:function(){this.tutorialPoint<this.dialogue.length&&this.setText(this.tutorialPoint);switch(this.tutorialPoint){case 0:this.textTimer++;150<this.textTimer&&(this.tutorialPoint++,this.textTimer=0,this.player.cState.leftDisabled=!1);break;case 1:this.keyboard.isDown(37)&&(this.tutorialPoint++,this.player.cState.rightDisabled=!1);break;case 2:this.keyboard.isDown(39)&&(this.tutorialPoint++,
this.player.cState.jumpDisabled=!1);break;case 3:this.keyboard.isDown(32)&&this.tutorialPoint++;break;case 4:case 5:this.textTimer++;150<this.textTimer&&(this.tutorialPoint++,this.textTimer=0);break;case 6:this.keyboard.isDown(82)&&(this.tutorialPoint++,this.dialogueBox.destroy(),this.dialogueText.text="",this.endTutorial())}},endTutorial:function(){this.player.animations.play("hurtLeft");this.player.cState.inputDisabled=!0;this.game.time.events.add(1500,function(){this.lifts.destroy(!0)},this)},
goToState:function(e){this.state.start(e)}};SAGDX.level1State=function(e){};
SAGDX.level1State.prototype={timeMultiplier:400,debugMode:!1,justToggled:null,paused:!1,events:[],eventSpawns:[],eventActivations:[],dialogue:null,textIndent:"           ",create:function(){this.game.world.alpha=1;this.mobs=this.game.add.group();this.lifts=this.game.add.group();this.turrets=this.game.add.group();this.blasts=this.game.add.group();this.game.renderer.renderSession.roundPixels=!0;this.map=this.game.add.tilemap("level1ForegroundLayerMap");this.map.addTilesetImage("tileset");this.foregroundLayer=
this.map.createLayer("foregroundLayer");this.foregroundLayer.resizeWorld();this.foregroundLayer.renderSettings.enableScrollDelta=!1;this.bgMap=this.game.add.tilemap("level1BackgroundLayerMap");this.bgMap.addTilesetImage("tileset");this.backgroundLayer=this.bgMap.createLayer("backgroundLayer");this.backgroundLayer.renderSettings.enableScrollDelta=!1;this.collisionMap=this.game.add.tilemap("level1CollisionLayerMap");this.collisionMap.addTilesetImage("tileset");this.collisionLayer=this.collisionMap.createLayer("collisionLayer");
this.collisionMap.setCollision(1,!0,this.collisionLayer);this.collisionLayer.visible=!1;this.parabgsBack=this.game.add.group();this.parabg1=new ParaBackground(this,this.game,0,.5,.8,this.parabgsBack,"parabackground3");this.parabg1.animations.add("full");this.parabg1.animations.play("full",30,!0);this.parabg2=new ParaBackground(this,this.game,768,.5,.8,this.parabgsBack,"parabackground3");this.parabg2.animations.add("full");this.parabg2.animations.play("full",30,!0);this.parabgsBackPaused=this.game.add.group();
this.parabg1p=new ParaBackground(this,this.game,0,.5,.8,this.parabgsBackPaused,"parabackground3p");this.parabg1p.animations.add("full");this.parabg2p=new ParaBackground(this,this.game,768,.5,.8,this.parabgsBackPaused,"parabackground3p");this.parabg2p.animations.add("full");this.parabg2p.visible=!1;this.parabgsFront=this.game.add.group();this.parabg3=new ParaBackground(this,this.game,0,.45,.8,this.parabgsFront,"parabackground1");this.parabg3.animations.add("full");this.parabg3.animations.play("full",
30,!0);this.parabg4=new ParaBackground(this,this.game,768,.45,.8,this.parabgsFront,"parabackground1");this.parabg4.animations.add("full");this.parabg4.animations.play("full",30,!0);this.parabgsFrontPaused=this.game.add.group();this.parabg3p=new ParaBackground(this,this.game,0,.45,.8,this.parabgsFrontPaused,"parabackground1p");this.parabg3p.animations.add("full");this.parabg4p=new ParaBackground(this,this.game,768,.45,.8,this.parabgsFrontPaused,"parabackground1p");this.parabg4p.animations.add("full");
this.parabg4p.visible=!1;this.overlays=this.game.add.group();this.overlay1=new ParaBackground(this,this.game,0,0,.8,this.overlays,"overlay");var e=(new Phaser.Graphics).beginFill(0).drawRect(0,0,this.game.camera.width,this.game.camera.height);this.distanceFilter1=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter1.alpha=.1;this.distanceFilter1.fixedToCamera=!0;this.distanceFilter2=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter2.alpha=.6;this.distanceFilter2.fixedToCamera=
!0;this.distanceFilter1p=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter1p.alpha=.1;this.distanceFilter1p.fixedToCamera=!0;this.distanceFilter1p.visible=!1;this.distanceFilter2p=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter2p.alpha=.6;this.distanceFilter2p.fixedToCamera=!0;this.distanceFilter1p.visible=!1;this.pauseTexts=[];this.game.physics.startSystem(Phaser.Physics.ARCADE);this.game.stage.backgroundColor=0;this.player=new Player(this,this.game,3*gridSize,15*
gridSize,"player");this.game.camera.follow(this.player);this.bonuses=this.game.add.group();this.bonus1=this.game.add.sprite(48*gridSize,1*gridSize,"tinroof");this.bonus1.animations.add("full");this.bonus1.animations.play("full",10,!0);this.bonuses.add(this.bonus1);this.bonus2=this.game.add.sprite(161*gridSize,63*gridSize,"showerwithdad");this.bonus2.animations.add("full");this.bonus2.animations.play("full",10,!0);this.bonuses.add(this.bonus2);this.door=this.game.add.sprite(268*gridSize,73*gridSize+
4,"door");this.door.frame=1;this.bonuses.add(this.door);this.backtrash=this.game.add.group();this.trash1=this.game.add.sprite(-3*gridSize,31*gridSize,"trashpile");this.trash1.frame=0;this.backtrash.add(this.trash1);this.trash2=this.game.add.sprite(4*gridSize,35*gridSize,"trashpile");this.trash2.frame=0;this.backtrash.add(this.trash2);this.fronttrash=this.game.add.group();this.trash3=this.game.add.sprite(3*gridSize,34*gridSize+9,"smalltrashpile");this.trash3.frame=0;this.fronttrash.add(this.trash3);
this.trash4=this.game.add.sprite(14*gridSize,34*gridSize+9,"smalltrashpile");this.trash4.frame=0;this.fronttrash.add(this.trash4);this.keyboard=this.game.input.keyboard;this.timerEvents=[];this.eventSpawns=[];for(var a=JSON.parse(this.game.cache.getText("level1Spawns")),g,e=0;e<a.length;e+=1)if(g=a[e],g.trigger)this.eventSpawns.push(g);else for(var h=0;h<g.spawns.length;h+=1)"once"==g.type?this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint):"continous"==g.type&&
(this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint),this.timerEvents.push(this.game.time.events.loop(g.interval*this.timeMultiplier,this.spawnMob,this,g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize)));this.events=JSON.parse(this.game.cache.getText("level1Events"));for(e=0;e<this.events.length;e+=1)a=this.events[e],a.triggered=!1,a.x&&(a.x*=gridSize),a.y&&(a.y*=gridSize),a.x2&&(a.x2*=gridSize),a.y2&&(a.y2*=gridSize),"dialogue"==a.type?a.resultCallbackName=
"sendDialogue":"transition"==a.type?a.resultCallbackName="touchDoor":"spawn"==a.type?a.resultCallbackName="spawnEvent":"activation"==a.type&&(a.resultCallbackName="checkActivations");this.game.world.bringToTop(this.parabgsBackPaused);this.game.world.bringToTop(this.distanceFilter2p);this.game.world.bringToTop(this.parabgsFrontPaused);this.game.world.bringToTop(this.distanceFilter1p);this.game.world.bringToTop(this.parabgsBack);this.game.world.bringToTop(this.distanceFilter2);this.game.world.bringToTop(this.parabgsFront);
this.game.world.bringToTop(this.distanceFilter1);this.game.world.bringToTop(this.overlays);this.game.world.bringToTop(this.backtrash);this.game.world.bringToTop(this.turrets);this.game.world.bringToTop(this.backgroundLayer);this.game.world.bringToTop(this.mobs);this.game.world.bringToTop(this.lifts);this.game.world.bringToTop(this.bonuses);this.game.world.bringToTop(this.player);this.game.world.bringToTop(this.blasts);this.game.world.bringToTop(this.foregroundLayer);this.game.world.bringToTop(this.fronttrash);
this.debugMode&&(this.debugText=this.game.add.text(5,50,"DEBUG INFO ",{fontSize:"10px",fill:"#FFF"}),this.debugText.fixedToCamera=!0);music.isPlaying||music.play("",0,1,!0);music.volume=1;ambience.volume=.5},update:function(){this.debugMode&&(this.debugText.text="");this.dialogue?this.processDialogue():(this.checkInput(),this.game.physics.arcade.collide(this.mobs,this.lifts),this.player.cState.hurt||this.game.physics.arcade.collide(this.player,this.mobs,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,
this.turrets,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,this.collisionLayer,this.customTileContact,null,this),this.game.physics.arcade.collide(this.mobs,this.collisionLayer),this.game.physics.arcade.collide(this.player,this.lifts,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,this.blasts,this.customMobContactedBy,null,this),this.game.physics.arcade.collide(this.blasts,this.collisionLayer,this.customTileContact,null,this),this.game.physics.arcade.collide(this.blasts,
this.blasts,this.customMobContact,null,this),this.game.physics.arcade.collide(this.blasts,this.turrets,this.customMobContact,null,this),this.game.physics.arcade.collide(this.blasts,this.mobs,this.customMobContact,null,this),this.debugMode&&(this.debugText.text+="Player: "+this.player.debugString()+"\n",conflux=this,this.mobs.forEach(function(e){conflux.debugText.text+=e.mobType+": "+e.debugString()+"\n"}),this.lifts.forEach(function(e){conflux.debugText.text+=e.mobType+": "+e.debugString()+"\n"})),
this.checkEvents());this.player.cState.outOfBounds&&this.goToState("Level1")},customMobContact:function(e,a){e.mobContact(a)},customMobContactedBy:function(e,a){a.mobContact(e)},customTileContact:function(e,a){e.tileContact(a)},spawnMob:function(e,a,g,h){var k;"truck"==e.type?k=new Truck(this,this.game,a,g,this.mobs,e.facing,e.speed,e.paused):"carrier"==e.type?k=new Carrier(this,this.game,a,g,this.lifts,e.facing,e.waypoints,h,e.speed,e.paused):"lift"==e.type?k=new Lift(this,this.game,a,g,this.lifts,
e):"turret"==e.type?k=new Turret(this,this.game,a,g,this.turrets,e):"bigblast"==e.type?k=new BigBlast(this,this.game,a,g,this.blasts,e.facing,e.speed,e.paused):"littleblast"==e.type?k=new LittleBlast(this,this.game,a,g,this.blasts,e.facing,e.speed,e.paused):"floater"==e.type?k=new Floater(this,this.game,a,g,this.mobs,e.facing,e.waypoints,h,e.speed,e.paused):"flag"==e.type&&(k=this.add.sprite(a,g,"flag"));return k},checkInput:function(){this.justToggled?this.keyboard.isDown(this.justToggled)||(this.justToggled=
null):(this.keyboard.isDown(72)&&(this.justToggled=72,this.player.cState.hurt?this.player.cancelHurt():this.player.hurt(),this.backgroundLayer.visible=!1),this.keyboard.isDown(70)&&(this.justToggled=70,this.player.cState.flying=this.player.cState.flying?!1:!0),this.keyboard.isDown(13)&&(this.justToggled=13,this.enablePause()),this.player.cState.paused&&(this.keyboard.isDown(32)||this.player.cursors.left.isDown||this.player.cursors.right.isDown||this.player.cursors.up.isDown||this.player.cursors.down.isDown)&&
this.player.setPause(!1),this.keyboard.isDown(82)&&(this.justToggled=82,this.goToState("Level1")))},newPauseText:function(){var e=this.game.add.sprite(this.game.camera.x+this.game.camera.width/2,this.game.camera.y+this.game.camera.height/2-10,"pausetext");e.anchor.setTo(.5,.5);return e},enablePause:function(){music.volume=.3;ambience.volume=0;sfx.stop();this.pauseTexts.push(this.newPauseText());this.mobs.forEach(function(a){a.setPause(!0)});this.turrets.forEach(function(a){a.setPause(!0)});this.lifts.forEach(function(a){a.setPause(!0)});
this.blasts.forEach(function(a){a.setPause(!0)});if(!this.paused){this.parabg1.animations.paused=!0;this.parabg1.visible=!1;this.parabg1p.visible=!0;this.parabg1p.animations.frame=this.parabg1.animations.frame;this.parabg2.animations.paused=!0;this.parabg2.visible=!1;this.parabg2p.visible=!0;this.parabg2p.animations.frame=this.parabg2.animations.frame;this.parabg3.animations.paused=!0;this.parabg3.visible=!1;this.parabg3p.visible=!0;this.parabg3p.animations.frame=this.parabg3.animations.frame;this.parabg4.animations.paused=
!0;this.parabg4.visible=!1;this.parabg4p.visible=!0;this.parabg4p.animations.frame=this.parabg4.animations.frame;this.distanceFilter1.visible=!1;this.distanceFilter2.visible=!1;this.distanceFilter1p.visible=!0;this.distanceFilter2p.visible=!0;for(var e=0;54>e;e+=1)this.bgMap.swap(e,e+54),this.map.swap(e,e+54)}this.player.setPause(!0);for(e=0;e<this.timerEvents.length;e++)this.game.time.events.remove(this.timerEvents[e]);this.paused=!0},checkEvents:function(){for(var e,a=0;a<this.events.length;a+=
1)if(e=this.events[a],!e.triggered)if("pass"==e.triggerType)e.x<this.player.body.x&&this.triggerEvent(e);else if("inside"==e.triggerType){var g=this.player.body.y>e.y&&this.player.body.bottom<e.y2;this.player.body.x>e.x&&this.player.body.right<e.x2&&g&&this.triggerEvent(e)}},triggerEvent:function(e){e.repeats||(e.triggered=!0);this[e.resultCallbackName](e)},sendDialogue:function(e){this.enablePause();e=e.dialogue;var a=e[0].speaker,g=this.textIndent+e[0].text;"Unknown"==a?(this.dialogueBox=this.game.add.sprite(30,
220,"unknownDialogBox"),this.speakerPortrait=this.game.add.sprite(4,4,"unknownFace")):"Factory"==a&&(this.dialogueBox=this.game.add.sprite(30,220,"factoryDialogBox"),this.speakerPortrait=this.game.add.sprite(8,8,"factoryFace"));this.speakerPortrait.animations.add("full");this.speakerPortrait.animations.play("full",10,!0);this.dialogueBox.addChild(this.speakerPortrait);this.dialogueBox.fixedToCamera=!0;this.speakerName=this.game.add.text(120,15,a,{font:"16px Lato",fill:"#000",wordWrap:!0,wordWrapWidth:200});
this.dialogueBox.addChild(this.speakerName);this.dialogueText=this.game.add.text(45,50,g,{font:"20px Lato Black",fill:"#000",wordWrap:!0,wordWrapWidth:600});this.dialogueBox.addChild(this.dialogueText);this.dialogue={index:0,element:e};this.keyboard.isDown(32)&&(this.justToggled=32)},spawnEvent:function(e){var a,g;for(a=0;a<this.eventSpawns.length;a+=1)if(g=this.eventSpawns[a],g.trigger==e.name)for(var h=0;h<g.spawns.length;h+=1)"once"==g.type?this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*
gridSize,g.spawns[h].firstWaypoint):"continous"==g.type&&(this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint),this.timerEvents.push(this.game.time.events.loop(g.interval*this.timeMultiplier,this.spawnMob,this,g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint)))},checkActivations:function(e){for(var a=0;a<this.eventActivations.length;a+=1)0<=this.eventActivations[a].activatedBy.indexOf(e.activates)&&this.eventActivations[a].activate(e.activates)},
processDialogue:function(){this.justToggled?this.keyboard.isDown(this.justToggled)||(this.justToggled=null):this.keyboard.isDown(32)&&(this.justToggled=32,this.advanceDialogue())},advanceDialogue:function(){this.dialogue.index+=1;if(this.dialogue.element[this.dialogue.index]){var e=this.dialogue.element[this.dialogue.index];"Unknown"==e.speaker?(this.dialogueBox.loadTexture("unknownDialogBox"),this.speakerPortrait.loadTexture("unknownFace")):"Factory"==e.speaker&&(this.dialogueBox.loadTexture("factoryDialogBox"),
this.speakerPortrait.loadTexture("factoryFace"));this.speakerName.text=e.speaker;this.dialogueText.text=this.textIndent+e.text}else this.dialogueText.text="",this.speakerName.text="",this.dialogue=null,this.dialogueBox.destroy()},touchDoor:function(e){this.player.cState.inputDisabled=!0;this.player.steps.stop();this.goToState(e.target)},goToState:function(e){this.events=[];this.eventSpawns=[];this.eventActivations=[];this.paused=!1;this.player.steps.stop();this.state.start(e)}};SAGDX.level2State=function(e){};
SAGDX.level2State.prototype={timeMultiplier:400,debugMode:!1,justToggled:null,paused:!1,events:[],eventSpawns:[],eventActivations:[],dialogue:null,textIndent:"           ",preload:function(){},create:function(){this.game.world.alpha=1;this.mobs=this.game.add.group();this.lifts=this.game.add.group();this.turrets=this.game.add.group();this.blasts=this.game.add.group();this.game.renderer.renderSession.roundPixels=!0;this.map=this.game.add.tilemap("level2ForegroundLayerMap");this.map.addTilesetImage("tileset");
this.foregroundLayer=this.map.createLayer("foregroundLayer");this.foregroundLayer.resizeWorld();this.foregroundLayer.renderSettings.enableScrollDelta=!1;this.bgMap=this.game.add.tilemap("level2BackgroundLayerMap");this.bgMap.addTilesetImage("tileset");this.backgroundLayer=this.bgMap.createLayer("backgroundLayer");this.backgroundLayer.renderSettings.enableScrollDelta=!1;this.collisionMap=this.game.add.tilemap("level2CollisionLayerMap");this.collisionMap.addTilesetImage("tileset");this.collisionLayer=
this.collisionMap.createLayer("collisionLayer");this.collisionMap.setCollision(1,!0,this.collisionLayer);this.collisionLayer.visible=!1;this.parabgsBack=this.game.add.group();this.parabg1=new ParaBackground(this,this.game,0,.5,.8,this.parabgsBack,"parabackground3");this.parabg1.animations.add("full");this.parabg1.animations.play("full",30,!0);this.parabg2=new ParaBackground(this,this.game,768,.5,.8,this.parabgsBack,"parabackground3");this.parabg2.animations.add("full");this.parabg2.animations.play("full",
30,!0);this.parabgsBackPaused=this.game.add.group();this.parabg1p=new ParaBackground(this,this.game,0,.5,.8,this.parabgsBackPaused,"parabackground3p");this.parabg1p.animations.add("full");this.parabg2p=new ParaBackground(this,this.game,768,.5,.8,this.parabgsBackPaused,"parabackground3p");this.parabg2p.animations.add("full");this.parabg2p.visible=!1;this.parabgsFront=this.game.add.group();this.parabg3=new ParaBackground(this,this.game,0,.45,.8,this.parabgsFront,"parabackground1");this.parabg3.animations.add("full");
this.parabg3.animations.play("full",30,!0);this.parabg4=new ParaBackground(this,this.game,768,.45,.8,this.parabgsFront,"parabackground1");this.parabg4.animations.add("full");this.parabg4.animations.play("full",30,!0);this.parabgsFrontPaused=this.game.add.group();this.parabg3p=new ParaBackground(this,this.game,0,.45,.8,this.parabgsFrontPaused,"parabackground1p");this.parabg3p.animations.add("full");this.parabg4p=new ParaBackground(this,this.game,768,.45,.8,this.parabgsFrontPaused,"parabackground1p");
this.parabg4p.animations.add("full");this.parabg4p.visible=!1;this.overlays=this.game.add.group();this.overlay1=new ParaBackground(this,this.game,0,0,.8,this.overlays,"overlay");var e=(new Phaser.Graphics).beginFill(0).drawRect(0,0,this.game.camera.width,this.game.camera.height);this.distanceFilter1=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter1.alpha=.1;this.distanceFilter1.fixedToCamera=!0;this.distanceFilter2=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter2.alpha=
.6;this.distanceFilter2.fixedToCamera=!0;this.distanceFilter1p=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter1p.alpha=.1;this.distanceFilter1p.fixedToCamera=!0;this.distanceFilter1p.visible=!1;this.distanceFilter2p=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter2p.alpha=.6;this.distanceFilter2p.fixedToCamera=!0;this.distanceFilter1p.visible=!1;this.pauseTexts=[];this.game.physics.startSystem(Phaser.Physics.ARCADE);this.game.stage.backgroundColor=0;this.player=
new Player(this,this.game,3*gridSize,66*gridSize,"player");this.game.camera.follow(this.player);this.floorbuttons=this.game.add.group();this.floorbutton1=this.add.sprite(109*gridSize,69*gridSize-5,"floorbutton");this.floorbuttons.add(this.floorbutton1);this.bonuses=this.game.add.group();this.bonus1=this.game.add.sprite(52*gridSize,3*gridSize,"interstellaria");this.bonus1.animations.add("full");this.bonus1.animations.play("full",10,!0);this.bonuses.add(this.bonus1);this.door=this.game.add.sprite(3*
gridSize,65*gridSize+4,"door");this.door.frame=0;this.bonuses.add(this.door);this.keyboard=this.game.input.keyboard;this.timerEvents=[];this.eventSpawns=[];for(var a=JSON.parse(this.game.cache.getText("level2Spawns")),g,e=0;e<a.length;e+=1)if(g=a[e],g.trigger)this.eventSpawns.push(g);else for(var h=0;h<g.spawns.length;h+=1)"once"==g.type?this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint):"continous"==g.type&&(this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*
gridSize,g.spawns[h].firstWaypoint),this.timerEvents.push(this.game.time.events.loop(g.interval*this.timeMultiplier,this.spawnMob,this,g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize)));this.events=JSON.parse(this.game.cache.getText("level2Events"));for(e=0;e<this.events.length;e+=1)a=this.events[e],a.triggered=!1,a.x&&(a.x*=gridSize),a.y&&(a.y*=gridSize),a.x2&&(a.x2*=gridSize),a.y2&&(a.y2*=gridSize),"dialogue"==a.type?a.resultCallbackName="sendDialogue":"transition"==a.type?a.resultCallbackName=
"touchDoor":"spawn"==a.type?a.resultCallbackName="spawnEvent":"activation"==a.type&&(a.resultCallbackName="checkActivations");this.game.world.bringToTop(this.parabgsBackPaused);this.game.world.bringToTop(this.distanceFilter2p);this.game.world.bringToTop(this.parabgsFrontPaused);this.game.world.bringToTop(this.distanceFilter1p);this.game.world.bringToTop(this.parabgsBack);this.game.world.bringToTop(this.distanceFilter2);this.game.world.bringToTop(this.parabgsFront);this.game.world.bringToTop(this.distanceFilter1);
this.game.world.bringToTop(this.overlays);this.game.world.bringToTop(this.turrets);this.game.world.bringToTop(this.backgroundLayer);this.game.world.bringToTop(this.mobs);this.game.world.bringToTop(this.lifts);this.game.world.bringToTop(this.floorbuttons);this.game.world.bringToTop(this.bonuses);this.game.world.bringToTop(this.player);this.game.world.bringToTop(this.blasts);this.game.world.bringToTop(this.foregroundLayer);this.debugMode&&(this.debugText=this.game.add.text(5,50,"DEBUG INFO ",{fontSize:"10px",
fill:"#FFF"}),this.debugText.fixedToCamera=!0);music.volume=1;ambience.volume=.3},update:function(){this.debugMode&&(this.debugText.text="");this.dialogue?this.processDialogue():(this.checkInput(),this.game.physics.arcade.collide(this.mobs,this.lifts),this.player.cState.hurt||this.game.physics.arcade.collide(this.player,this.mobs,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,this.turrets,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,
this.collisionLayer,this.customTileContact,null,this),this.game.physics.arcade.collide(this.mobs,this.collisionLayer),this.game.physics.arcade.collide(this.player,this.lifts,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,this.blasts,this.customMobContactedBy,null,this),this.game.physics.arcade.collide(this.blasts,this.collisionLayer,this.customTileContact,null,this),this.game.physics.arcade.collide(this.blasts,this.blasts,this.customMobContact,null,this),this.game.physics.arcade.collide(this.blasts,
this.turrets,this.customMobContact,null,this),this.game.physics.arcade.collide(this.blasts,this.mobs,this.customMobContact,null,this),this.debugMode&&(this.debugText.text+="Player: "+this.player.debugString()+"\n",conflux=this,this.mobs.forEach(function(e){conflux.debugText.text+=e.mobType+": "+e.debugString()+"\n"}),this.lifts.forEach(function(e){conflux.debugText.text+=e.mobType+": "+e.debugString()+"\n"})),this.checkEvents());this.player.cState.outOfBounds&&this.goToState("Level2")},customMobContact:function(e,
a){e.mobContact(a)},customMobContactedBy:function(e,a){a.mobContact(e)},customTileContact:function(e,a){e.tileContact(a)},spawnMob:function(e,a,g,h){var k;"truck"==e.type?k=new Truck(this,this.game,a,g,this.mobs,e.facing,e.speed,e.paused):"carrier"==e.type?k=new Carrier(this,this.game,a,g,this.lifts,e.facing,e.waypoints,h,e.speed,e.paused):"lift"==e.type?k=new Lift(this,this.game,a,g,this.lifts,e):"turret"==e.type?k=new Turret(this,this.game,a,g,this.turrets,e):"bigblast"==e.type?k=new BigBlast(this,
this.game,a,g,this.blasts,e.facing,e.speed,e.paused):"littleblast"==e.type?k=new LittleBlast(this,this.game,a,g,this.blasts,e.facing,e.speed,e.paused):"floater"==e.type&&(k=new Floater(this,this.game,a,g,this.mobs,e.facing,e.waypoints,h,e.speed,e.paused));return k},checkInput:function(){this.justToggled?this.keyboard.isDown(this.justToggled)||(this.justToggled=null):(this.keyboard.isDown(72)&&(this.justToggled=72,this.player.cState.hurt?this.player.cancelHurt():this.player.hurt()),this.keyboard.isDown(70)&&
(this.justToggled=70,this.player.cState.flying=this.player.cState.flying?!1:!0),this.keyboard.isDown(13)&&(this.justToggled=13,this.enablePause()),this.player.cState.paused&&(this.keyboard.isDown(32)||this.player.cursors.left.isDown||this.player.cursors.right.isDown||this.player.cursors.up.isDown||this.player.cursors.down.isDown)&&this.player.setPause(!1),this.keyboard.isDown(82)&&(this.justToggled=82,this.goToState("Level2")))},newPauseText:function(){var e=this.game.add.sprite(this.game.camera.x+
this.game.camera.width/2,this.game.camera.y+this.game.camera.height/2-10,"pausetext");e.anchor.setTo(.5,.5);return e},enablePause:function(){music.volume=.3;ambience.volume=0;sfx.stop();this.pauseTexts.push(this.newPauseText());this.mobs.forEach(function(a){a.setPause(!0)});this.turrets.forEach(function(a){a.setPause(!0)});this.lifts.forEach(function(a){a.setPause(!0)});this.blasts.forEach(function(a){a.setPause(!0)});if(!this.paused){this.parabg1.animations.paused=!0;this.parabg1.visible=!1;this.parabg1p.visible=
!0;this.parabg1p.animations.frame=this.parabg1.animations.frame;this.parabg2.animations.paused=!0;this.parabg2.visible=!1;this.parabg2p.visible=!0;this.parabg2p.animations.frame=this.parabg2.animations.frame;this.parabg3.animations.paused=!0;this.parabg3.visible=!1;this.parabg3p.visible=!0;this.parabg3p.animations.frame=this.parabg3.animations.frame;this.parabg4.animations.paused=!0;this.parabg4.visible=!1;this.parabg4p.visible=!0;this.parabg4p.animations.frame=this.parabg4.animations.frame;this.distanceFilter1.visible=
!1;this.distanceFilter2.visible=!1;this.distanceFilter1p.visible=!0;this.distanceFilter2p.visible=!0;for(var e=0;54>e;e+=1)this.bgMap.swap(e,e+54),this.map.swap(e,e+54);this.door.frame=2}this.player.setPause(!0);for(e=0;e<this.timerEvents.length;e++)this.game.time.events.remove(this.timerEvents[e]);this.paused=!0},checkEvents:function(){for(var e,a=0;a<this.events.length;a+=1)if(e=this.events[a],!e.triggered)if("pass"==e.triggerType)e.x<this.player.body.x&&this.triggerEvent(e);else if("inside"==e.triggerType){var g=
this.player.body.y>e.y&&this.player.body.bottom<e.y2;this.player.body.x>e.x&&this.player.body.right<e.x2&&g&&this.triggerEvent(e)}},triggerEvent:function(e){e.repeats||(e.triggered=!0);this[e.resultCallbackName](e)},sendDialogue:function(e){this.enablePause();e=e.dialogue;var a=e[0].speaker,g=this.textIndent+e[0].text;"Unknown"==a?(this.dialogueBox=this.game.add.sprite(30,220,"unknownDialogBox"),this.speakerPortrait=this.game.add.sprite(4,4,"unknownFace")):"Factory"==a&&(this.dialogueBox=this.game.add.sprite(30,
220,"factoryDialogBox"),this.speakerPortrait=this.game.add.sprite(8,8,"factoryFace"));this.speakerPortrait.animations.add("full");this.speakerPortrait.animations.play("full",10,!0);this.dialogueBox.addChild(this.speakerPortrait);this.dialogueBox.fixedToCamera=!0;this.speakerName=this.game.add.text(120,15,a,{font:"16px Lato",fill:"#000",wordWrap:!0,wordWrapWidth:200});this.dialogueBox.addChild(this.speakerName);this.dialogueText=this.game.add.text(45,50,g,{font:"20px Lato Black",fill:"#000",wordWrap:!0,
wordWrapWidth:600});this.dialogueBox.addChild(this.dialogueText);this.dialogue={index:0,element:e};this.keyboard.isDown(32)&&(this.justToggled=32)},spawnEvent:function(e){var a,g;for(a=0;a<this.eventSpawns.length;a+=1)if(g=this.eventSpawns[a],g.trigger==e.name)for(var h=0;h<g.spawns.length;h+=1)"once"==g.type?this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint):"continous"==g.type&&(this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint),
this.timerEvents.push(this.game.time.events.loop(g.interval*this.timeMultiplier,this.spawnMob,this,g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize)))},checkActivations:function(e){for(var a=0;a<this.eventActivations.length;a+=1)0<=this.eventActivations[a].activatedBy.indexOf(e.activates)&&this.eventActivations[a].activate(e.activates)},processDialogue:function(){this.justToggled?this.keyboard.isDown(this.justToggled)||(this.justToggled=null):this.keyboard.isDown(32)&&(this.justToggled=32,this.advanceDialogue())},
advanceDialogue:function(){this.dialogue.index+=1;if(this.dialogue.element[this.dialogue.index]){var e=this.dialogue.element[this.dialogue.index];"Unknown"==e.speaker?(this.dialogueBox.loadTexture("unknownDialogBox"),this.speakerPortrait.loadTexture("unknownFace")):"Factory"==e.speaker&&(this.dialogueBox.loadTexture("factoryDialogBox"),this.speakerPortrait.loadTexture("factoryFace"));this.speakerName.text=e.speaker;this.dialogueText.text=this.textIndent+e.text}else this.dialogueText.text="",this.speakerName.text=
"",this.dialogue=null,this.dialogueBox.destroy()},touchDoor:function(e){this.goToState(e.target)},goToState:function(e){this.events=[];this.eventSpawns=[];this.eventActivations=[];this.paused=!1;this.player.steps.stop();this.state.start(e)}};SAGDX.level3State=function(e){};
SAGDX.level3State.prototype={timeMultiplier:400,debugMode:!1,justToggled:null,paused:!1,events:[],eventSpawns:[],eventActivations:[],dialogue:null,textIndent:"           ",preload:function(){},create:function(){this.game.world.alpha=1;this.trucks=this.game.add.group();this.floaters=this.game.add.group();this.lifts=this.game.add.group();this.turrets=this.game.add.group();this.blasts=this.game.add.group();this.game.renderer.renderSession.roundPixels=!0;this.map=this.game.add.tilemap("level3ForegroundLayerMap");this.map.addTilesetImage("tileset");
this.foregroundLayer=this.map.createLayer("foregroundLayer");this.foregroundLayer.resizeWorld();this.foregroundLayer.renderSettings.enableScrollDelta=!1;this.bgMap=this.game.add.tilemap("level3BackgroundLayerMap");this.bgMap.addTilesetImage("tileset");this.backgroundLayer=this.bgMap.createLayer("backgroundLayer");this.backgroundLayer.renderSettings.enableScrollDelta=!1;this.collisionMap=this.game.add.tilemap("level3CollisionLayerMap");this.collisionMap.addTilesetImage("tileset");this.collisionLayer=
this.collisionMap.createLayer("collisionLayer");this.collisionMap.setCollision(1,!0,this.collisionLayer);this.collisionLayer.visible=!1;this.parabgsBack=this.game.add.group();this.parabg1=new ParaBackground(this,this.game,0,.5,.8,this.parabgsBack,"parabackground3");this.parabg1.animations.add("full");this.parabg1.animations.play("full",30,!0);this.parabg2=new ParaBackground(this,this.game,768,.5,.8,this.parabgsBack,"parabackground3");this.parabg2.animations.add("full");this.parabg2.animations.play("full",
30,!0);this.parabgsBackPaused=this.game.add.group();this.parabg1p=new ParaBackground(this,this.game,0,.5,.8,this.parabgsBackPaused,"parabackground3p");this.parabg1p.animations.add("full");this.parabg2p=new ParaBackground(this,this.game,768,.5,.8,this.parabgsBackPaused,"parabackground3p");this.parabg2p.animations.add("full");this.parabg2p.visible=!1;this.parabgsFront=this.game.add.group();this.parabg3=new ParaBackground(this,this.game,0,.45,.8,this.parabgsFront,"parabackground1");this.parabg3.animations.add("full");
this.parabg3.animations.play("full",30,!0);this.parabg4=new ParaBackground(this,this.game,768,.45,.8,this.parabgsFront,"parabackground1");this.parabg4.animations.add("full");this.parabg4.animations.play("full",30,!0);this.parabgsFrontPaused=this.game.add.group();this.parabg3p=new ParaBackground(this,this.game,0,.45,.8,this.parabgsFrontPaused,"parabackground1p");this.parabg3p.animations.add("full");this.parabg4p=new ParaBackground(this,this.game,768,.45,.8,this.parabgsFrontPaused,"parabackground1p");
this.parabg4p.animations.add("full");this.parabg4p.visible=!1;this.overlays=this.game.add.group();this.overlay1=new ParaBackground(this,this.game,0,0,.8,this.overlays,"overlay");var e=(new Phaser.Graphics).beginFill(0).drawRect(0,0,this.game.camera.width,this.game.camera.height);this.distanceFilter1=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter1.alpha=.1;this.distanceFilter1.fixedToCamera=!0;this.distanceFilter2=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter2.alpha=
.6;this.distanceFilter2.fixedToCamera=!0;this.distanceFilter1p=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter1p.alpha=.1;this.distanceFilter1p.fixedToCamera=!0;this.distanceFilter1p.visible=!1;this.distanceFilter2p=this.game.add.sprite(0,0,e.generateTexture());this.distanceFilter2p.alpha=.6;this.distanceFilter2p.fixedToCamera=!0;this.distanceFilter1p.visible=!1;this.pauseTexts=[];this.game.physics.startSystem(Phaser.Physics.ARCADE);this.game.stage.backgroundColor=0;this.player=
new Player(this,this.game,26*gridSize,1*gridSize,"player");this.game.camera.follow(this.player);this.bonuses=this.game.add.group();this.bonus1=this.game.add.sprite(55*gridSize,3*gridSize,"echo");this.bonus1.animations.add("full");this.bonus1.animations.play("full",30,!0);this.bonuses.add(this.bonus1);this.bonus2=this.game.add.sprite(61*gridSize,6*gridSize,"echo");this.bonus2.animations.add("full");this.bonus2.animations.play("full",25,!0);this.bonus2.frame=2;this.bonuses.add(this.bonus2);this.bonus3=
this.game.add.sprite(59*gridSize,2*gridSize,"echo");this.bonus3.animations.add("full");this.bonus3.animations.play("full",33,!0);this.bonus3.frame=4;this.bonuses.add(this.bonus3);this.bonus4=this.game.add.sprite(64*gridSize,4*gridSize,"echo");this.bonus4.animations.add("full");this.bonus4.animations.play("full",28,!0);this.bonuses.add(this.bonus4);this.bonus4.frame=5;this.keyboard=this.game.input.keyboard;this.timerEvents=[];this.eventSpawns=[];for(var a=JSON.parse(this.game.cache.getText("level3Spawns")),
g,e=0;e<a.length;e+=1)if(g=a[e],g.trigger)this.eventSpawns.push(g);else for(var h=0;h<g.spawns.length;h+=1)"once"==g.type?this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint):"continous"==g.type&&(this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint),this.timerEvents.push(this.game.time.events.loop(g.interval*this.timeMultiplier,this.spawnMob,this,g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize)));this.events=JSON.parse(this.game.cache.getText("level3Events"));
for(e=0;e<this.events.length;e+=1)a=this.events[e],a.triggered=!1,a.x&&(a.x*=gridSize),a.y&&(a.y*=gridSize),a.x2&&(a.x2*=gridSize),a.y2&&(a.y2*=gridSize),"dialogue"==a.type?a.resultCallbackName="sendDialogue":"transition"==a.type?a.resultCallbackName="touchDoor":"spawn"==a.type?a.resultCallbackName="spawnEvent":"activation"==a.type&&(a.resultCallbackName="checkActivations");this.game.world.bringToTop(this.parabgsBackPaused);this.game.world.bringToTop(this.distanceFilter2p);this.game.world.bringToTop(this.parabgsFrontPaused);
this.game.world.bringToTop(this.distanceFilter1p);this.game.world.bringToTop(this.parabgsBack);this.game.world.bringToTop(this.distanceFilter2);this.game.world.bringToTop(this.parabgsFront);this.game.world.bringToTop(this.distanceFilter1);this.game.world.bringToTop(this.overlays);this.game.world.bringToTop(this.turrets);this.game.world.bringToTop(this.backgroundLayer);this.game.world.bringToTop(this.trucks);this.game.world.bringToTop(this.floaters);this.game.world.bringToTop(this.lifts);this.game.world.bringToTop(this.bonuses);
this.game.world.bringToTop(this.player);this.game.world.bringToTop(this.blasts);this.game.world.bringToTop(this.foregroundLayer);this.debugMode&&(this.debugText=this.game.add.text(5,50,"DEBUG INFO ",{fontSize:"10px",fill:"#FFF"}),this.debugText.fixedToCamera=!0);music.volume=1;ambience.volume=.3},update:function(){this.debugMode&&(this.debugText.text="");this.dialogue?this.processDialogue():(this.checkInput(),this.game.physics.arcade.collide(this.trucks,this.lifts),this.player.cState.hurt||(this.game.physics.arcade.collide(this.player,
this.trucks,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,this.floaters,this.customMobContact,null,this)),this.game.physics.arcade.collide(this.player,this.turrets,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,this.collisionLayer,this.customTileContact,null,this),this.game.physics.arcade.collide(this.trucks,this.collisionLayer),this.game.physics.arcade.collide(this.floaters,this.collisionLayer),this.game.physics.arcade.collide(this.player,
this.lifts,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,this.blasts,this.customMobContactedBy,null,this),this.game.physics.arcade.collide(this.blasts,this.collisionLayer,this.customTileContact,null,this),this.game.physics.arcade.collide(this.blasts,this.blasts,this.customMobContact,null,this),this.game.physics.arcade.collide(this.blasts,this.turrets,this.customMobContact,null,this),this.game.physics.arcade.collide(this.blasts,this.trucks,this.customMobContact,null,
this),this.checkEvents());this.player.cState.outOfBounds&&this.goToState("Level3")},customMobContact:function(e,a){e.mobContact(a)},customMobContactedBy:function(e,a){a.mobContact(e)},customTileContact:function(e,a){e.tileContact(a)},spawnMob:function(e,a,g,h){var k;"truck"==e.type?k=new Truck(this,this.game,a,g,this.trucks,e.facing,e.speed,e.paused):"carrier"==e.type?k=new Carrier(this,this.game,a,g,this.lifts,e.facing,e.waypoints,h,e.speed,e.paused):"lift"==e.type?k=new Lift(this,this.game,a,g,
this.lifts,e):"turret"==e.type?k=new Turret(this,this.game,a,g,this.turrets,e):"bigblast"==e.type?k=new BigBlast(this,this.game,a,g,this.blasts,e.facing,e.speed,e.paused):"littleblast"==e.type?k=new LittleBlast(this,this.game,a,g,this.blasts,e.facing,e.speed,e.paused):"floater"==e.type&&(k=new Floater(this,this.game,a,g,this.floaters,e.facing,e.waypoints,h,e.speed,e.paused));return k},checkInput:function(){this.justToggled?this.keyboard.isDown(this.justToggled)||(this.justToggled=null):(this.keyboard.isDown(72)&&
(this.justToggled=72,this.player.cState.hurt?this.player.cancelHurt():this.player.hurt()),this.keyboard.isDown(70)&&(this.justToggled=70,this.player.cState.flying=this.player.cState.flying?!1:!0),this.keyboard.isDown(13)&&(this.justToggled=13,this.enablePause()),this.player.cState.paused&&(this.keyboard.isDown(32)||this.player.cursors.left.isDown||this.player.cursors.right.isDown||this.player.cursors.up.isDown||this.player.cursors.down.isDown)&&this.player.setPause(!1),this.keyboard.isDown(82)&&(this.justToggled=
82,this.goToState("Level3")))},newPauseText:function(){var e=this.game.add.sprite(this.game.camera.x+this.game.camera.width/2,this.game.camera.y+this.game.camera.height/2-10,"pausetext");e.anchor.setTo(.5,.5);return e},enablePause:function(){music.volume=.3;ambience.volume=0;sfx.stop();this.pauseTexts.push(this.newPauseText());this.trucks.forEach(function(a){a.setPause(!0)});this.floaters.forEach(function(a){a.setPause(!0)});this.turrets.forEach(function(a){a.setPause(!0)});this.lifts.forEach(function(a){a.setPause(!0)});
this.blasts.forEach(function(a){a.setPause(!0)});if(!this.paused){this.parabg1.animations.paused=!0;this.parabg1.visible=!1;this.parabg1p.visible=!0;this.parabg1p.animations.frame=this.parabg1.animations.frame;this.parabg2.animations.paused=!0;this.parabg2.visible=!1;this.parabg2p.visible=!0;this.parabg2p.animations.frame=this.parabg2.animations.frame;this.parabg3.animations.paused=!0;this.parabg3.visible=!1;this.parabg3p.visible=!0;this.parabg3p.animations.frame=this.parabg3.animations.frame;this.parabg4.animations.paused=
!0;this.parabg4.visible=!1;this.parabg4p.visible=!0;this.parabg4p.animations.frame=this.parabg4.animations.frame;this.distanceFilter1.visible=!1;this.distanceFilter2.visible=!1;this.distanceFilter1p.visible=!0;this.distanceFilter2p.visible=!0;for(var e=0;54>e;e+=1)this.bgMap.swap(e,e+54),this.map.swap(e,e+54)}this.player.setPause(!0);for(e=0;e<this.timerEvents.length;e++)this.game.time.events.remove(this.timerEvents[e]);this.paused=!0},checkEvents:function(){for(var e,a=0;a<this.events.length;a+=
1)if(e=this.events[a],!e.triggered)if("pass"==e.triggerType)(e.x<this.player.body.x||e.y<this.player.body.y)&&this.triggerEvent(e);else if("inside"==e.triggerType){var g=this.player.body.y>e.y&&this.player.body.bottom<e.y2;this.player.body.x>e.x&&this.player.body.right<e.x2&&g&&this.triggerEvent(e)}},triggerEvent:function(e){e.repeats||(e.triggered=!0);this[e.resultCallbackName](e)},sendDialogue:function(e){this.enablePause();e=e.dialogue;var a=e[0].speaker,g=this.textIndent+e[0].text;"Unknown"==
a?(this.dialogueBox=this.game.add.sprite(30,220,"unknownDialogBox"),this.speakerPortrait=this.game.add.sprite(4,4,"unknownFace")):"Factory"==a&&(this.dialogueBox=this.game.add.sprite(30,220,"factoryDialogBox"),this.speakerPortrait=this.game.add.sprite(8,8,"factoryFace"));this.speakerPortrait.animations.add("full");this.speakerPortrait.animations.play("full",10,!0);this.dialogueBox.addChild(this.speakerPortrait);this.dialogueBox.fixedToCamera=!0;this.speakerName=this.game.add.text(120,15,a,{font:"16px Lato",
fill:"#000",wordWrap:!0,wordWrapWidth:200});this.dialogueBox.addChild(this.speakerName);this.dialogueText=this.game.add.text(45,50,g,{font:"20px Lato Black",fill:"#000",wordWrap:!0,wordWrapWidth:600});this.dialogueBox.addChild(this.dialogueText);this.dialogue={index:0,element:e};this.keyboard.isDown(32)&&(this.justToggled=32)},spawnEvent:function(e){var a,g;for(a=0;a<this.eventSpawns.length;a+=1)if(g=this.eventSpawns[a],g.trigger==e.name)for(var h=0;h<g.spawns.length;h+=1)"once"==g.type?this.spawnMob(g.unit,
g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint):"continous"==g.type&&(this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint),this.timerEvents.push(this.game.time.events.loop(g.interval*this.timeMultiplier,this.spawnMob,this,g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize)))},checkActivations:function(e){for(var a=0;a<this.eventActivations.length;a+=1)0<=this.eventActivations[a].activatedBy.indexOf(e.activates)&&this.eventActivations[a].activate(e.activates)},
processDialogue:function(){this.justToggled?this.keyboard.isDown(this.justToggled)||(this.justToggled=null):this.keyboard.isDown(32)&&(this.justToggled=32,this.advanceDialogue())},advanceDialogue:function(){this.dialogue.index+=1;if(this.dialogue.element[this.dialogue.index]){var e=this.dialogue.element[this.dialogue.index];"Unknown"==e.speaker?(this.dialogueBox.loadTexture("unknownDialogBox"),this.speakerPortrait.loadTexture("unknownFace")):"Factory"==e.speaker&&(this.dialogueBox.loadTexture("factoryDialogBox"),
this.speakerPortrait.loadTexture("factoryFace"));this.speakerName.text=e.speaker;this.dialogueText.text=this.textIndent+e.text}else this.dialogueText.text="",this.speakerName.text="",this.dialogue=null,this.dialogueBox.destroy()},touchDoor:function(e){this.goToState(e.target)},goToState:function(e){this.events=[];this.eventSpawns=[];this.eventActivations=[];this.paused=!1;this.player.steps.stop();this.state.start(e)}};SAGDX.level4State=function(e){};
SAGDX.level4State.prototype={timeMultiplier:400,debugMode:!1,justToggled:null,paused:!1,events:[],eventSpawns:[],eventActivations:[],dialogue:null,textIndent:"           ",preload:function(){},create:function(){this.game.world.alpha=1;this.trucks=this.game.add.group();this.floaters=this.game.add.group();this.lifts=this.game.add.group();this.turrets=this.game.add.group();this.blasts=this.game.add.group();this.game.renderer.renderSession.roundPixels=!0;this.map=this.game.add.tilemap("level4ForegroundLayerMap");this.map.addTilesetImage("tileset");
this.foregroundLayer=this.map.createLayer("foregroundLayer");this.foregroundLayer.resizeWorld();this.foregroundLayer.renderSettings.enableScrollDelta=!1;this.bgMap=this.game.add.tilemap("level4BackgroundLayerMap");this.bgMap.addTilesetImage("tileset");this.backgroundLayer=this.bgMap.createLayer("backgroundLayer");this.backgroundLayer.renderSettings.enableScrollDelta=!1;this.collisionMap=this.game.add.tilemap("level4CollisionLayerMap");this.collisionMap.addTilesetImage("tileset");this.collisionLayer=
this.collisionMap.createLayer("collisionLayer");this.collisionMap.setCollision(1,!0,this.collisionLayer);this.collisionLayer.visible=!1;this.parabg1=this.game.add.sprite(1400,-60,"parabackgroundSky");this.parabg1p=this.game.add.sprite(1400,-60,"parabackgroundSkyp");this.pauseTexts=[];this.game.physics.startSystem(Phaser.Physics.ARCADE);this.game.stage.backgroundColor=0;this.player=new Player(this,this.game,5*gridSize,41*gridSize,"player");this.game.camera.follow(this.player);this.floorbuttons=this.game.add.group();
this.floorbutton1=this.add.sprite(51*gridSize,59*gridSize-5,"floorbutton");this.floorbuttons.add(this.floorbutton1);var e=(new Phaser.Graphics).beginFill(16711680).drawRect(0,0,this.game.camera.width,this.game.camera.height);this.incin=this.game.add.sprite(0,0,e.generateTexture());this.incin.alpha=0;this.incin.fixedToCamera=!0;this.keyboard=this.game.input.keyboard;this.timerEvents=[];this.eventSpawns=[];for(var a=JSON.parse(this.game.cache.getText("level4Spawns")),g,e=0;e<a.length;e+=1)if(g=a[e],
g.trigger)this.eventSpawns.push(g);else for(var h=0;h<g.spawns.length;h+=1)"once"==g.type?this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint):"continous"==g.type&&(this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint),this.timerEvents.push(this.game.time.events.loop(g.interval*this.timeMultiplier,this.spawnMob,this,g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize)));this.events=JSON.parse(this.game.cache.getText("level4Events"));
for(e=0;e<this.events.length;e+=1)a=this.events[e],a.triggered=!1,a.x&&(a.x*=gridSize),a.y&&(a.y*=gridSize),a.x2&&(a.x2*=gridSize),a.y2&&(a.y2*=gridSize),"dialogue"==a.type?a.resultCallbackName="sendDialogue":"transition"==a.type?a.resultCallbackName="touchDoor":"spawn"==a.type?a.resultCallbackName="spawnEvent":"activation"==a.type&&(a.resultCallbackName="checkActivations");this.game.world.bringToTop(this.parabg1p);this.game.world.bringToTop(this.parabg1);this.game.world.bringToTop(this.turrets);
this.game.world.bringToTop(this.backgroundLayer);this.game.world.bringToTop(this.trucks);this.game.world.bringToTop(this.floaters);this.game.world.bringToTop(this.lifts);this.game.world.bringToTop(this.floorbuttons);this.game.world.bringToTop(this.player);this.game.world.bringToTop(this.blasts);this.game.world.bringToTop(this.foregroundLayer);this.game.world.bringToTop(this.incin);this.debugMode&&(this.debugText=this.game.add.text(5,50,"DEBUG INFO ",{fontSize:"10px",fill:"#FFF"}),this.debugText.fixedToCamera=
!0);music.volume=1;ambience.volume=.3},update:function(){this.player.y>42*gridSize&&this.player.y<51*gridSize&&(this.incin.alpha=this.player.body.right>68*gridSize?1-(100*gridSize-this.player.body.right)/(32*gridSize):0);this.debugMode&&(this.debugText.text="");this.dialogue?this.processDialogue():(this.checkInput(),this.game.physics.arcade.collide(this.trucks,this.lifts),this.player.cState.hurt||(this.game.physics.arcade.collide(this.player,this.trucks,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,
this.floaters,this.customMobContact,null,this)),this.game.physics.arcade.collide(this.player,this.turrets,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,this.collisionLayer,this.customTileContact,null,this),this.game.physics.arcade.collide(this.trucks,this.collisionLayer),this.game.physics.arcade.collide(this.floaters,this.collisionLayer),this.game.physics.arcade.collide(this.player,this.lifts,this.customMobContact,null,this),this.game.physics.arcade.collide(this.player,
this.blasts,this.customMobContactedBy,null,this),this.game.physics.arcade.collide(this.blasts,this.collisionLayer,this.customTileContact,null,this),this.game.physics.arcade.collide(this.blasts,this.blasts,this.customMobContact,null,this),this.game.physics.arcade.collide(this.blasts,this.turrets,this.customMobContact,null,this),this.game.physics.arcade.collide(this.blasts,this.trucks,this.customMobContact,null,this),this.checkEvents());this.player.cState.outOfBounds&&this.goToState("Level4")},customMobContact:function(e,
a){e.mobContact(a)},customMobContactedBy:function(e,a){a.mobContact(e)},customTileContact:function(e,a){e.tileContact(a)},spawnMob:function(e,a,g,h){var k;"truck"==e.type?k=new Truck(this,this.game,a,g,this.trucks,e.facing,e.speed,e.paused):"carrier"==e.type?k=new Carrier(this,this.game,a,g,this.lifts,e.facing,e.waypoints,h,e.speed,e.paused):"lift"==e.type?k=new Lift(this,this.game,a,g,this.lifts,e):"turret"==e.type?k=new Turret(this,this.game,a,g,this.turrets,e):"bigblast"==e.type?k=new BigBlast(this,
this.game,a,g,this.blasts,e.facing,e.speed,e.paused):"littleblast"==e.type?k=new LittleBlast(this,this.game,a,g,this.blasts,e.facing,e.speed,e.paused):"floater"==e.type&&(k=new Floater(this,this.game,a,g,this.floaters,e.facing,e.waypoints,h,e.speed,e.paused));return k},checkInput:function(){this.justToggled?this.keyboard.isDown(this.justToggled)||(this.justToggled=null):(this.keyboard.isDown(72)&&(this.justToggled=72,this.player.cState.hurt?this.player.cancelHurt():this.player.hurt()),this.keyboard.isDown(70)&&
(this.justToggled=70,this.player.cState.flying=this.player.cState.flying?!1:!0),this.keyboard.isDown(13)&&(this.justToggled=13,this.enablePause()),this.player.cState.paused&&(this.keyboard.isDown(32)||this.player.cursors.left.isDown||this.player.cursors.right.isDown||this.player.cursors.up.isDown||this.player.cursors.down.isDown)&&this.player.setPause(!1),this.keyboard.isDown(82)&&(this.justToggled=82,this.goToState("Level4")))},newPauseText:function(){var e=this.game.add.sprite(this.game.camera.x+
this.game.camera.width/2,this.game.camera.y+this.game.camera.height/2-10,"pausetext");e.anchor.setTo(.5,.5);return e},enablePause:function(){music.volume=.3;ambience.volume=0;sfx.stop();this.pauseTexts.push(this.newPauseText());this.trucks.forEach(function(a){a.setPause(!0)});this.floaters.forEach(function(a){a.setPause(!0)});this.turrets.forEach(function(a){a.setPause(!0)});this.lifts.forEach(function(a){a.setPause(!0)});this.blasts.forEach(function(a){a.setPause(!0)});if(!this.paused){this.parabg1.visible=
!1;this.parabg1p.visible=!0;for(var e=0;54>e;e+=1)this.bgMap.swap(e,e+54),this.map.swap(e,e+54)}this.player.setPause(!0);for(e=0;e<this.timerEvents.length;e++)this.game.time.events.remove(this.timerEvents[e]);this.paused=!0},checkEvents:function(){for(var e,a=0;a<this.events.length;a+=1)if(e=this.events[a],!e.triggered)if("pass"==e.triggerType)(e.x<this.player.body.x||e.y<this.player.body.y)&&this.triggerEvent(e);else if("inside"==e.triggerType){var g=this.player.body.y>e.y&&this.player.body.bottom<
e.y2;this.player.body.x>e.x&&this.player.body.right<e.x2&&g&&this.triggerEvent(e)}},triggerEvent:function(e){e.repeats||(e.triggered=!0);this[e.resultCallbackName](e)},sendDialogue:function(e){this.enablePause();e=e.dialogue;var a=e[0].speaker,g=this.textIndent+e[0].text;"Unknown"==a?(this.dialogueBox=this.game.add.sprite(30,220,"unknownDialogBox"),this.speakerPortrait=this.game.add.sprite(4,4,"unknownFace")):"Factory"==a&&(this.dialogueBox=this.game.add.sprite(30,220,"factoryDialogBox"),this.speakerPortrait=
this.game.add.sprite(8,8,"factoryFace"));this.speakerPortrait.animations.add("full");this.speakerPortrait.animations.play("full",10,!0);this.dialogueBox.addChild(this.speakerPortrait);this.dialogueBox.fixedToCamera=!0;this.speakerName=this.game.add.text(120,15,a,{font:"16px Lato",fill:"#000",wordWrap:!0,wordWrapWidth:200});this.dialogueBox.addChild(this.speakerName);this.dialogueText=this.game.add.text(45,50,g,{font:"20px Lato Black",fill:"#000",wordWrap:!0,wordWrapWidth:600});this.dialogueBox.addChild(this.dialogueText);
this.dialogue={index:0,element:e};this.keyboard.isDown(32)&&(this.justToggled=32)},spawnEvent:function(e){var a,g;for(a=0;a<this.eventSpawns.length;a+=1)if(g=this.eventSpawns[a],g.trigger==e.name)for(var h=0;h<g.spawns.length;h+=1)"once"==g.type?this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint):"continous"==g.type&&(this.spawnMob(g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize,g.spawns[h].firstWaypoint),this.timerEvents.push(this.game.time.events.loop(g.interval*
this.timeMultiplier,this.spawnMob,this,g.unit,g.spawns[h].x*gridSize,g.spawns[h].y*gridSize)))},checkActivations:function(e){for(var a=0;a<this.eventActivations.length;a+=1)0<=this.eventActivations[a].activatedBy.indexOf(e.activates)&&this.eventActivations[a].activate(e.activates)},processDialogue:function(){this.justToggled?this.keyboard.isDown(this.justToggled)||(this.justToggled=null):this.keyboard.isDown(32)&&(this.justToggled=32,this.advanceDialogue())},advanceDialogue:function(){this.dialogue.index+=
1;if(this.dialogue.element[this.dialogue.index]){var e=this.dialogue.element[this.dialogue.index];"Unknown"==e.speaker?(this.dialogueBox.loadTexture("unknownDialogBox"),this.speakerPortrait.loadTexture("unknownFace")):"Factory"==e.speaker&&(this.dialogueBox.loadTexture("factoryDialogBox"),this.speakerPortrait.loadTexture("factoryFace"));this.speakerName.text=e.speaker;this.dialogueText.text=this.textIndent+e.text}else this.dialogueText.text="",this.speakerName.text="",this.dialogue=null,this.dialogueBox.destroy()},
touchDoor:function(e){this.player.cState.inputDisabled=!0;this.player.steps.stop();this.goToState(e.target)},goToState:function(e){this.events=[];this.eventSpawns=[];this.eventActivations=[];this.paused=!1;this.player.steps.stop();this.state.start(e)}};var Lift=function(e,a,g,h,k,m){"undefined"===typeof k&&(k=a.world);"undefined"===typeof m.speed&&(m.speed=10);Phaser.Sprite.call(this,a,g,h,"lift");a.physics.arcade.enable(this);k.add(this);this.mobType="lift";this.body.immovable=!0;this.conflux=e;this.animations.add("plain",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]);this.animations.play("plain",10,!0);this.cConstants={speed:m.speed*gridSize,animationPausedOffset:25,actions:[]};this.cState={paused:!1};m.activatedBy&&(this.activatedBy=
m.activatedBy,this.conflux.eventActivations.push(this));for(h=0;h<m.actions.length;h+=1)unitActionList=[],a=m.actions[h],g={},g.type=a.type,g.index=h,a.y&&(g.y=a.y*gridSize),a.x&&(g.x=a.x*gridSize),a.speed&&(g.speed=a.speed*gridSize),a.duration&&(g.duration=a.duration*e.timeMultiplier),g.activation=a.activation,this.cConstants.actions.push(g);this.update=function(){this.body.velocity.x=0;this.body.velocity.y=0;this.cState.paused||("wait"==this.nextAction.type?this.wait():"moveTo"==this.nextAction.type&&
this.moveToWaypoint())};this.wait=function(){this.body.velocity.x=0;this.body.velocity.y=0;"time"==this.nextAction["for"]?this.game.time.now>this.nextAction.until&&this.setNextAction():"activation"==this.nextAction["for"]&&this.nextAction.activated&&this.setNextAction()};this.activate=function(b){b==this.nextAction.activation&&(this.setPause(!1),this.nextAction.activated=!0)};this.moveToWaypoint=function(){reachedX=(reachedX=0==this.nextAction.directionX||0>this.nextAction.directionX&&this.body.x<
this.nextAction.x)||0<this.nextAction.directionX&&this.body.x>this.nextAction.x;reachedY=(reachedY=0==this.nextAction.directionY||0>this.nextAction.directionY&&this.body.y<this.nextAction.y)||0<this.nextAction.directionY&&this.body.y>this.nextAction.y;reachedX&&(this.body.x=this.nextAction.x);reachedY&&(this.body.y=this.nextAction.y);reachedX&&reachedY?(this.body.velocity.x=0,this.body.velocity.y=0,this.setNextAction()):(reachedX||(this.body.velocity.x=this.nextAction.directionX*this.cConstants.speed),
reachedY||(this.body.velocity.y=this.nextAction.directionY*this.cConstants.speed))};this.setWaypointDirection=function(){this.nextAction.directionX=this.nextAction.x<this.body.x?-1:this.nextAction.x>this.body.x?1:0;this.nextAction.directionY=this.nextAction.y<this.body.y?-1:this.nextAction.y>this.body.y?1:0};this.setNextAction=function(){var b=0;this.nextAction&&(b=this.nextAction.index+1);b>=this.cConstants.actions.length&&(b=0);this.nextAction=this.cConstants.actions[b];"wait"==this.nextAction.type?
this.nextAction.duration?(this.nextAction["for"]="time",this.nextAction.until=this.game.time.now+this.nextAction.duration):this.nextAction.activation&&(this.nextAction["for"]="activation",this.nextAction.activated=!1):"destroy"==this.nextAction.type?this.destroy():"moveTo"==this.nextAction.type&&(this.setWaypointDirection(),this.body.velocity.x=this.nextAction.directionX*this.cConstants.speed,this.body.velocity.y=this.nextAction.directionY*this.cConstants.speed)};this.setNextAction();this.setPause=
function(b){this.cState.paused!=b&&(this.animations.frame=b?this.animations.frame+this.cConstants.animationPausedOffset:this.animations.frame-this.cConstants.animationPausedOffset,this.animations.paused=b,this.cState.paused=b)};this.debugString=function(){return"PLATFORM: [pos:"+Math.floor(this.body.x)+"/"+Math.floor(this.body.y)+"][target:"+this.nextAction.x+"/"+this.nextAction.y+"][looking:"+this.nextAction.directionX+"/"+this.nextAction.directionY+"][moving:"+this.body.velocity.x+"/"+this.body.velocity.y+
"]"};this.setPause(!!m.paused)};Lift.prototype=Object.create(Phaser.Sprite.prototype);Lift.prototype.constructor=Lift;var LittleBlast=function(e,a,g,h,k,m,b,c){"undefined"===typeof k&&(k=a.world);"undefined"===typeof b&&(b=3);Phaser.Sprite.call(this,a,g,h,"littleblast");a.physics.arcade.enable(this);k.add(this);this.body.setSize(48,16,16,16);this.game.debugMode&&(g=(new Phaser.Graphics).beginFill(9013641).drawRect(0,0,48,16),a=a.add.sprite(16,32,g.generateTexture()),a.alpha=.5,this.addChild(a));this.mobType="littleblast";this.conflux=e;this.body.customSeparateX=!0;this.body.customSeparateY=!0;this.body.allowGravity=
!1;this.sfx=this.game.add.audio("sfx");this.sfx.addMarker("blast",8.25,.8,1,!1);this.animations.add("left",[0,1,2,3,4,5,12,13,14,15,16,17,24,25,26,27,28,29,36,37,38,39,40,41,48,49,50,51,52,53]);this.animations.add("right",[6,7,8,9,10,11,18,19,20,21,22,23,30,31,32,33,34,35,42,43,44,45,46,47,54,55,56,57,58,59]);this.cConstants={speed:b*gridSize,animationPausedOffset:1};this.cState={markDestroyed:!1,paused:!1,facing:m};1==this.cState.facing?this.animations.play("right",20,!0):-1==this.cState.facing&&
this.animations.play("left",20,!0);this.update=function(){this.body.velocity.x=this.cState.paused?0:this.cConstants.speed*this.cState.facing;this.cState.markDestroyed&&this.destroy()};this.mobContact=function(b){b.hit();this.cState.markDestroyed=!0};this.hit=function(){};this.tileContact=function(b){this.cState.markDestroyed=!0};this.debugString=function(){return"[pos:"+Math.floor(this.x)+"/"+Math.floor(this.y)+"]"};this.setPause=function(b){this.sfx.stop();this.cState.paused!=b&&(this.animations.frame=
b?this.animations.frame+this.cConstants.animationPausedOffset:this.animations.frame-this.cConstants.animationPausedOffset,this.animations.paused=b,this.cState.paused=b)};this.setPause(!!c);this.sfx.play("blast")};LittleBlast.prototype=Object.create(Phaser.Sprite.prototype);LittleBlast.prototype.constructor=LittleBlast;window.onload=function(){var e=new Phaser.Game(width,height,Phaser.CANVAS,document.getElementById("main"));WebFontConfig={google:{families:["Lato"]}};e.state.add("Boot",SAGDX.Boot);e.state.add("Preloader",SAGDX.Preloader);e.state.add("Intro",SAGDX.introState);e.state.add("Intro2",SAGDX.intro2State);e.state.add("Level1",SAGDX.level1State);e.state.add("Level2",SAGDX.level2State);e.state.add("Level3",SAGDX.level3State);e.state.add("Level4",SAGDX.level4State);e.state.add("Ending1",SAGDX.ending1State);
e.state.add("Ending2",SAGDX.ending2State);e.state.add("Ending3",SAGDX.ending3State);e.state.add("Credits",SAGDX.Credits);e.state.start("Boot")};var ParaBackground=function(e,a,g,h,k,m,b){"undefined"===typeof m&&(m=a.world);"undefined"===typeof speed&&(speed=10);Phaser.Sprite.call(this,a,g,a.height/3,b);m.add(this);this.cConstants={offsetX:g,speedX:h,speedY:k};this.cState={paused:!1};this.update=function(){this.x=this.game.camera.x+this.cConstants.offsetX-this.game.camera.x*this.cConstants.speedX%768;this.y=this.game.camera.y-this.game.camera.y*this.cConstants.speedY};this.setPause=function(b){this.cState.paused!=b&&(this.animations.frame=
b?this.animations.frame+this.cConstants.animationPausedOffset:this.animations.frame-this.cConstants.animationPausedOffset,this.pauseCoords=[this.body.x,this.body.y],this.animations.paused=b,this.cState.paused=b)};this.setPause(!1)};ParaBackground.prototype=Object.create(Phaser.Sprite.prototype);ParaBackground.prototype.constructor=ParaBackground;(function(){var e=e||{};e.WEBGL_RENDERER=0;e.CANVAS_RENDERER=1;e.VERSION="v2.2.8";e._UID=0;"undefined"!=typeof Float32Array?(e.Float32Array=Float32Array,e.Uint16Array=Uint16Array,e.Uint32Array=Uint32Array,e.ArrayBuffer=ArrayBuffer):(e.Float32Array=Array,e.Uint16Array=Array);e.PI_2=2*Math.PI;e.RAD_TO_DEG=180/Math.PI;e.DEG_TO_RAD=Math.PI/180;e.RETINA_PREFIX="@2x";e.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1};e.DisplayObject=
function(){this.position=new e.Point(0,0);this.scale=new e.Point(1,1);this.transformCallbackContext=this.transformCallback=null;this.pivot=new e.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.renderable=!1;this.stage=this.parent=null;this.worldAlpha=1;this.worldTransform=new e.Matrix;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new e.Rectangle(0,0,1,1);this._mask=this._currentBounds=null;this._cacheIsDirty=this._cacheAsBitmap=!1};e.DisplayObject.prototype.constructor=
e.DisplayObject;e.DisplayObject.prototype.destroy=function(){if(this.children){for(var a=this.children.length;a--;)this.children[a].destroy();this.children=[]}this._mask=this._currentBounds=this._bounds=this.filterArea=this.worldTransform=this.stage=this.parent=this.hitArea=this.transformCallbackContext=this.transformCallback=null;this.renderable=!1;this._destroyCachedSprite()};Object.defineProperty(e.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);
return!0}});Object.defineProperty(e.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1);(this._mask=a)&&(this._mask.isMask=!0)}});Object.defineProperty(e.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var g=[],e=0;e<a.length;e++)for(var k=a[e].passes,m=0;m<k.length;m++)g.push(k[m]);this._filterBlock={target:this,filterPasses:g}}this._filters=a}});Object.defineProperty(e.DisplayObject.prototype,
"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap!==a&&(a?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=a)}});e.DisplayObject.prototype.updateTransform=function(){if(this.parent){var a,g,h,k,m,b,c=this.parent.worldTransform,f=this.worldTransform;this.rotation%e.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),a=this._cr*this.scale.x,
g=this._sr*this.scale.x,h=-this._sr*this.scale.y,k=this._cr*this.scale.y,m=this.position.x,b=this.position.y,(this.pivot.x||this.pivot.y)&&(m-=this.pivot.x*a+this.pivot.y*h,b-=this.pivot.x*g+this.pivot.y*k),f.a=a*c.a+g*c.c,f.b=a*c.b+g*c.d,f.c=h*c.a+k*c.c,f.d=h*c.b+k*c.d,f.tx=m*c.a+b*c.c+c.tx,f.ty=m*c.b+b*c.d+c.ty):(a=this.scale.x,k=this.scale.y,m=this.position.x-this.pivot.x*a,b=this.position.y-this.pivot.y*k,f.a=a*c.a,f.b=a*c.b,f.c=k*c.c,f.d=k*c.d,f.tx=m*c.a+b*c.c+c.tx,f.ty=m*c.b+b*c.d+c.ty);this.worldAlpha=
this.alpha*this.parent.worldAlpha;this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,f,c)}};e.DisplayObject.prototype.displayObjectUpdateTransform=e.DisplayObject.prototype.updateTransform;e.DisplayObject.prototype.getBounds=function(a){return e.EmptyRectangle};e.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(e.identityMatrix)};e.DisplayObject.prototype.setStageReference=function(a){this.stage=a};e.DisplayObject.prototype.preUpdate=function(){};
e.DisplayObject.prototype.generateTexture=function(a,g,h){var k=this.getLocalBounds();a=new e.RenderTexture(0|k.width,0|k.height,h,g,a);return e.DisplayObject._tempMatrix.tx=-k.x,e.DisplayObject._tempMatrix.ty=-k.y,a.render(this,e.DisplayObject._tempMatrix),a};e.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};e.DisplayObject.prototype.toGlobal=function(a){return this.displayObjectUpdateTransform(),this.worldTransform.apply(a)};e.DisplayObject.prototype.toLocal=function(a,
g){return g&&(a=g.toGlobal(a)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(a)};e.DisplayObject.prototype._renderCachedSprite=function(a){this._cachedSprite.worldAlpha=this.worldAlpha;a.gl?e.Sprite.prototype._renderWebGL.call(this._cachedSprite,a):e.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)};e.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|
a.width,0|a.height);else{var g=new e.RenderTexture(0|a.width,0|a.height);this._cachedSprite=new e.Sprite(g);this._cachedSprite.worldTransform=this.worldTransform}g=this._filters;this._filters=null;this._cachedSprite.filters=g;e.DisplayObject._tempMatrix.tx=-a.x;e.DisplayObject._tempMatrix.ty=-a.y;this._cachedSprite.texture.render(this,e.DisplayObject._tempMatrix,!0);this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._filters=g;this._cacheAsBitmap=!0};e.DisplayObject.prototype._destroyCachedSprite=
function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)};e.DisplayObject.prototype._renderWebGL=function(a){};e.DisplayObject.prototype._renderCanvas=function(a){};Object.defineProperty(e.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}});Object.defineProperty(e.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}});e.DisplayObjectContainer=function(){e.DisplayObject.call(this);
this.children=[]};e.DisplayObjectContainer.prototype=Object.create(e.DisplayObject.prototype);e.DisplayObjectContainer.prototype.constructor=e.DisplayObjectContainer;Object.defineProperty(e.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){var g=this.getLocalBounds().width;this.scale.x=0!==g?a/g:1;this._width=a}});Object.defineProperty(e.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},
set:function(a){var g=this.getLocalBounds().height;this.scale.y=0!==g?a/g:1;this._height=a}});e.DisplayObjectContainer.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)};e.DisplayObjectContainer.prototype.addChildAt=function(a,g){if(0<=g&&g<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(g,0,a),this.stage&&a.setStageReference(this.stage),a;throw Error(a+"addChildAt: The index "+g+" supplied is out of bounds "+this.children.length);
};e.DisplayObjectContainer.prototype.swapChildren=function(a,g){if(a!==g){var e=this.getChildIndex(a),k=this.getChildIndex(g);if(0>e||0>k)throw Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[e]=g;this.children[k]=a}};e.DisplayObjectContainer.prototype.getChildIndex=function(a){a=this.children.indexOf(a);if(-1===a)throw Error("The supplied DisplayObject must be a child of the caller");return a};e.DisplayObjectContainer.prototype.setChildIndex=function(a,
g){if(0>g||g>=this.children.length)throw Error("The supplied index is out of bounds");var e=this.getChildIndex(a);this.children.splice(e,1);this.children.splice(g,0,a)};e.DisplayObjectContainer.prototype.getChildAt=function(a){if(0>a||a>=this.children.length)throw Error("getChildAt: Supplied index "+a+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[a]};e.DisplayObjectContainer.prototype.removeChild=function(a){a=this.children.indexOf(a);
if(-1!==a)return this.removeChildAt(a)};e.DisplayObjectContainer.prototype.removeChildAt=function(a){var g=this.getChildAt(a);return this.stage&&g.removeStageReference(),g.parent=void 0,this.children.splice(a,1),g};e.DisplayObjectContainer.prototype.removeChildren=function(a,g){var e=a||0,k="number"==typeof g?g:this.children.length,m=k-e;if(0<m&&k>=m){e=this.children.splice(e,m);for(k=0;k<e.length;k++)m=e[k],this.stage&&m.removeStageReference(),m.parent=void 0;return e}if(0===m&&0===this.children.length)return[];
throw Error("removeChildren: Range Error, numeric values are outside the acceptable range");};e.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var a=0,g=this.children.length;g>a;a++)this.children[a].updateTransform()};e.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=e.DisplayObjectContainer.prototype.updateTransform;e.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return e.EmptyRectangle;
for(var a,g,h,k=1/0,m=1/0,b=-1/0,c=-1/0,f=!1,d=0,n=this.children.length;n>d;d++)this.children[d].visible&&(f=!0,a=this.children[d].getBounds(),k=k<a.x?k:a.x,m=m<a.y?m:a.y,g=a.width+a.x,h=a.height+a.y,b=b>g?b:g,c=c>h?c:h);if(!f)return e.EmptyRectangle;a=this._bounds;return a.x=k,a.y=m,a.width=b-k,a.height=c-m,a};e.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=e.identityMatrix;for(var g=0,h=this.children.length;h>g;g++)this.children[g].updateTransform();
g=this.getBounds();return this.worldTransform=a,g};e.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a;for(var g=0;g<this.children.length;g++)this.children[g].setStageReference(a)};e.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0;a<this.children.length;a++)this.children[a].removeStageReference();this.stage=null};e.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(0>=this.alpha)){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);
var g;if(this._mask||this._filters){this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock));this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start());for(g=0;g<this.children.length;g++)this.children[g]._renderWebGL(a);a.spriteBatch.stop();this._mask&&a.maskManager.popMask(this._mask,a);this._filters&&a.filterManager.popFilter();a.spriteBatch.start()}else for(g=0;g<this.children.length;g++)this.children[g]._renderWebGL(a)}};e.DisplayObjectContainer.prototype._renderCanvas=
function(a){if(!1!==this.visible&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);this._mask&&a.maskManager.pushMask(this._mask,a);for(var g=0;g<this.children.length;g++)this.children[g]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}};e.Sprite=function(a){e.DisplayObjectContainer.call(this);this.anchor=new e.Point;this.texture=a||e.Texture.emptyTexture;this._height=this._width=0;this.tint=16777215;this.blendMode=e.blendModes.NORMAL;this.shader=null;this.texture.baseTexture.hasLoaded&&
this.onTextureUpdate();this.renderable=!0};e.Sprite.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Sprite.prototype.constructor=e.Sprite;Object.defineProperty(e.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(e.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;
this._height=a}});e.Sprite.prototype.setTexture=function(a){this.texture=a;this.cachedTint=16777215};e.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);this._height&&(this.scale.y=this._height/this.texture.frame.height)};e.Sprite.prototype.getBounds=function(a){var g=this.texture.frame.width,e=this.texture.frame.height,k=g*(1-this.anchor.x),g=g*-this.anchor.x,m=e*(1-this.anchor.y),b=e*-this.anchor.y;a=a||this.worldTransform;var c=a.a,f=a.b,
d=a.c,n=a.d,p=a.tx,l=a.ty;a=-1/0;var e=-1/0,v=1/0,y=1/0;if(0===f&&0===d)0>c&&(c*=-1),0>n&&(n*=-1),v=c*g+p,a=c*k+p,y=n*b+l,e=n*m+l;else{var t=c*g+d*b+p,q=n*b+f*g+l,u=c*k+d*b+p,b=n*b+f*k+l,z=c*k+d*m+p,k=n*m+f*k+l,c=c*g+d*m+p,g=n*m+f*g+l,v=v>t?t:v,v=v>u?u:v,v=v>z?z:v,v=v>c?c:v,y=y>q?q:y,y=y>b?b:y,y=y>k?k:y,y=y>g?g:y;a=t>a?t:a;a=u>a?u:a;a=z>a?z:a;a=c>a?c:a;e=q>e?q:e;e=b>e?b:e;e=k>e?k:e;e=g>e?g:e}g=this._bounds;return g.x=v,g.width=a-v,g.y=y,g.height=e-y,this._currentBounds=g,g};e.Sprite.prototype._renderWebGL=
function(a){if(this.visible&&!(0>=this.alpha)&&this.renderable){var e;if(this._mask||this._filters){var h=a.spriteBatch;this._filters&&(h.flush(),a.filterManager.pushFilter(this._filterBlock));this._mask&&(h.stop(),a.maskManager.pushMask(this.mask,a),h.start());h.render(this);for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(a);h.stop();this._mask&&a.maskManager.popMask(this._mask,a);this._filters&&a.filterManager.popFilter();h.start()}else for(a.spriteBatch.render(this),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(a)}};
e.Sprite.prototype._renderCanvas=function(a){if(!(!1===this.visible||0===this.alpha||!1===this.renderable||0>=this.texture.crop.width||0>=this.texture.crop.height)){if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=e.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a),this.texture.valid){var g=this.texture.baseTexture.resolution/a.resolution;a.context.globalAlpha=this.worldAlpha;a.smoothProperty&&a.scaleMode!==
this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,a.context[a.smoothProperty]=a.scaleMode===e.scaleModes.LINEAR);var h=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,k=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;a.roundPixels?(a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,
this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0),h|=0,k|=0):a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution);16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=e.CanvasTinter.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,
h/g,k/g,this.texture.crop.width/g,this.texture.crop.height/g)):a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,h/g,k/g,this.texture.crop.width/g,this.texture.crop.height/g)}for(g=0;g<this.children.length;g++)this.children[g]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}};e.Sprite.fromFrame=function(a){var g=e.TextureCache[a];if(!g)throw Error('The frameId "'+a+'" does not exist in the texture cache'+
this);return new e.Sprite(g)};e.Sprite.fromImage=function(a,g,h){a=e.Texture.fromImage(a,g,h);return new e.Sprite(a)};e.SpriteBatch=function(a){e.DisplayObjectContainer.call(this);this.textureThing=a;this.ready=!1};e.SpriteBatch.prototype=Object.create(e.DisplayObjectContainer.prototype);e.SpriteBatch.prototype.constructor=e.SpriteBatch;e.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new e.WebGLFastSpriteBatch(a);this.ready=!0};e.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};
e.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||!this.children.length||(this.ready||this.initWebGL(a.gl),this.fastSpriteBatch.gl!==a.gl&&this.fastSpriteBatch.setContext(a.gl),a.spriteBatch.stop(),a.shaderManager.setShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.spriteBatch.start())};e.SpriteBatch.prototype._renderCanvas=function(a){if(this.visible&&!(0>=this.alpha)&&this.children.length){var e=a.context;e.globalAlpha=
this.worldAlpha;this.displayObjectUpdateTransform();for(var h=this.worldTransform,k=!0,m=0;m<this.children.length;m++){var b=this.children[m];if(b.visible){var c=b.texture,f=c.frame;if(e.globalAlpha=this.worldAlpha*b.alpha,0===b.rotation%(2*Math.PI))k&&(e.setTransform(h.a,h.b,h.c,h.d,h.tx,h.ty),k=!1),e.drawImage(c.baseTexture.source,f.x,f.y,f.width,f.height,b.anchor.x*-f.width*b.scale.x+b.position.x+.5|0,b.anchor.y*-f.height*b.scale.y+b.position.y+.5|0,f.width*b.scale.x,f.height*b.scale.y);else{k||
(k=!0);b.displayObjectUpdateTransform();var d=b.worldTransform;a.roundPixels?e.setTransform(d.a,d.b,d.c,d.d,0|d.tx,0|d.ty):e.setTransform(d.a,d.b,d.c,d.d,d.tx,d.ty);e.drawImage(c.baseTexture.source,f.x,f.y,f.width,f.height,b.anchor.x*-f.width+.5|0,b.anchor.y*-f.height+.5|0,f.width,f.height)}}}}};e.Text=function(a,g){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=1;e.Sprite.call(this,e.Texture.fromCanvas(this.canvas));this.setText(a);this.setStyle(g)};
e.Text.prototype=Object.create(e.Sprite.prototype);e.Text.prototype.constructor=e.Text;Object.defineProperty(e.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(e.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=
a/this.texture.frame.height;this._height=a}});e.Text.prototype.setStyle=function(a){a=a||{};a.font=a.font||"bold 20pt Arial";a.fill=a.fill||"black";a.align=a.align||"left";a.stroke=a.stroke||"black";a.strokeThickness=a.strokeThickness||0;a.wordWrap=a.wordWrap||!1;a.wordWrapWidth=a.wordWrapWidth||100;a.dropShadow=a.dropShadow||!1;a.dropShadowAngle=a.dropShadowAngle||Math.PI/6;a.dropShadowDistance=a.dropShadowDistance||4;a.dropShadowColor=a.dropShadowColor||"black";this.style=a;this.dirty=!0};e.Text.prototype.setText=
function(a){this.text=a.toString()||" ";this.dirty=!0};e.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));for(var a=a.split(/(?:\r\n|\r|\n)/),e=[],h=0,k=this.determineFontProperties(this.style.font),m=0;m<a.length;m++){var b=this.context.measureText(a[m]).width;e[m]=b;h=Math.max(h,b)}m=h+this.style.strokeThickness;this.style.dropShadow&&(m+=this.style.dropShadowDistance);
this.canvas.width=(m+this.context.lineWidth)*this.resolution;b=k.fontSize+this.style.strokeThickness;m=b*a.length;this.style.dropShadow&&(m+=this.style.dropShadowDistance);this.canvas.height=m*this.resolution;this.context.scale(this.resolution,this.resolution);navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline=
"alphabetic";var c,f;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;for(var d=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,n=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance,m=0;m<a.length;m++)c=this.style.strokeThickness/2,f=this.style.strokeThickness/2+m*b+k.ascent,"right"===this.style.align?c+=h-e[m]:"center"===this.style.align&&(c+=(h-e[m])/2),this.style.fill&&this.context.fillText(a[m],c+d,f+n)}this.context.fillStyle=this.style.fill;
for(m=0;m<a.length;m++)c=this.style.strokeThickness/2,f=this.style.strokeThickness/2+m*b+k.ascent,"right"===this.style.align?c+=h-e[m]:"center"===this.style.align&&(c+=(h-e[m])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(a[m],c,f),this.style.fill&&this.context.fillText(a[m],c,f);this.updateTexture()};e.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=
this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.texture.baseTexture.dirty()};e.Text.prototype._renderWebGL=function(a){this.dirty&&(this.resolution=a.resolution,this.updateText(),this.dirty=!1);e.Sprite.prototype._renderWebGL.call(this,a)};e.Text.prototype._renderCanvas=function(a){this.dirty&&(this.resolution=a.resolution,this.updateText(),this.dirty=!1);e.Sprite.prototype._renderCanvas.call(this,
a)};e.Text.prototype.determineFontProperties=function(a){var g=e.Text.fontPropertiesCache[a];if(!g){var g={},h=e.Text.fontPropertiesCanvas,k=e.Text.fontPropertiesContext;k.font=a;var m=Math.ceil(k.measureText("|M\u00c9q").width),b=Math.ceil(k.measureText("|M\u00c9q").width),c=2*b,b=1.4*b|0;h.width=m;h.height=c;k.fillStyle="#f00";k.fillRect(0,0,m,c);k.font=a;k.textBaseline="alphabetic";k.fillStyle="#000";k.fillText("|M\u00c9q",0,b);for(var f,h=k.getImageData(0,0,m,c).data,k=h.length,d=4*m,n=0,p=!1,
m=0;b>m;m++){for(f=0;d>f;f+=4)if(255!==h[n+f]){p=!0;break}if(p)break;n+=d}g.ascent=b-m;n=k-d;p=!1;for(m=c;m>b;m--){for(f=0;d>f;f+=4)if(255!==h[n+f]){p=!0;break}if(p)break;n-=d}g.descent=m-b;g.descent+=6;g.fontSize=g.ascent+g.descent;e.Text.fontPropertiesCache[a]=g}return g};e.Text.prototype.wordWrap=function(a){var e="";a=a.split("\n");for(var h=0;h<a.length;h++){for(var k=this.style.wordWrapWidth,m=a[h].split(" "),b=0;b<m.length;b++){var c=this.context.measureText(m[b]).width,f=c+this.context.measureText(" ").width;
0===b||f>k?(0<b&&(e+="\n"),e+=m[b],k=this.style.wordWrapWidth-c):(k-=f,e+=" "+m[b])}h<a.length-1&&(e+="\n")}return e};e.Text.prototype.getBounds=function(a){return this.dirty&&(this.updateText(),this.dirty=!1),e.Sprite.prototype.getBounds.call(this,a)};e.Text.prototype.destroy=function(a){this.canvas=this.context=null;this.texture.destroy(void 0===a?!0:a)};e.Text.fontPropertiesCache={};e.Text.fontPropertiesCanvas=document.createElement("canvas");e.Text.fontPropertiesContext=e.Text.fontPropertiesCanvas.getContext("2d");
e.BitmapText=function(a,g){e.DisplayObjectContainer.call(this);this.maxWidth=this.textHeight=this.textWidth=0;this.anchor=new Phaser.Point(0,0);this._prevAnchor=new Phaser.Point(0,0);this._pool=[];this.setText(a);this.setStyle(g);this.updateText();this.dirty=!1};e.BitmapText.prototype=Object.create(e.DisplayObjectContainer.prototype);e.BitmapText.prototype.constructor=e.BitmapText;e.BitmapText.prototype.setText=function(a){this.text=a||" ";this.dirty=!0};e.BitmapText.prototype.setStyle=function(a){a=
a||{};a.align=a.align||"left";this.style=a;var g=a.font.split(" ");this.fontName=g[g.length-1];this.fontSize=2<=g.length?parseInt(g[g.length-2],10):e.BitmapText.fonts[this.fontName].size;this.dirty=!0;this.tint=a.tint};e.BitmapText.prototype.updateText=function(){for(var a=e.BitmapText.fonts[this.fontName],g=new e.Point,h=null,k=[],m=0,b=[],c=0,f=this.fontSize/a.size,d=0,n=0;n<this.text.length;n++){var p=this.text.charCodeAt(n);if(d=/(\s)/.test(this.text.charAt(n))?n:d,/(?:\r\n|\r|\n)/.test(this.text.charAt(n)))b.push(g.x),
m=Math.max(m,g.x),c++,g.x=0,g.y+=a.lineHeight,h=null;else if(-1!==d&&0<this.maxWidth&&g.x*f>this.maxWidth)k.splice(d,n-d),n=d,d=-1,b.push(lastLineWidth),m=Math.max(m,lastLineWidth),c++,g.x=0,g.y+=a.lineHeight,h=null;else{var l=a.chars[p];l&&(h&&l.kerning[h]&&(g.x+=l.kerning[h]),k.push({texture:l.texture,line:c,charCode:p,position:new e.Point(g.x+l.xOffset,g.y+l.yOffset)}),g.x+=l.xAdvance,h=p)}}b.push(g.x);m=Math.max(m,g.x);h=[];for(n=0;c>=n;n++)d=0,"right"===this.style.align?d=m-b[n]:"center"===this.style.align&&
(d=(m-b[n])/2),h.push(d);c=this.children.length;b=k.length;d=this.tint||16777215;this.textWidth=m*f;this.textHeight=(g.y+a.lineHeight)*f;a=this.textWidth*this.anchor.x;g=this.textHeight*this.anchor.y;for(n=0;b>n;n++)(m=c>n?this.children[n]:this._pool.pop())?m.setTexture(k[n].texture):m=new e.Sprite(k[n].texture),m.position.x=(k[n].position.x+h[k[n].line])*f-a,m.position.y=k[n].position.y*f-g,m.scale.x=m.scale.y=f,m.tint=d,m.parent||this.addChild(m);for(;this.children.length>b;)k=this.getChildAt(this.children.length-
1),this._pool.push(k),this.removeChild(k)};e.BitmapText.prototype.updateTransform=function(){!this.dirty&&this.anchor.equals(this._prevAnchor)||(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor));e.DisplayObjectContainer.prototype.updateTransform.call(this)};e.BitmapText.fonts={};e.Stage=function(a){e.DisplayObjectContainer.call(this);this.worldTransform=new e.Matrix;this.stage=this;this.setBackgroundColor(a)};e.Stage.prototype=Object.create(e.DisplayObjectContainer.prototype);
e.Stage.prototype.constructor=e.Stage;e.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0;a<this.children.length;a++)this.children[a].updateTransform()};e.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0;this.backgroundColorSplit=e.hex2rgb(this.backgroundColor);a=this.backgroundColor.toString(16);a="000000".substr(0,6-a.length)+a;this.backgroundColorString="#"+a};e.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]};e.rgb2hex=function(a){return(255*
a[0]<<16)+(255*a[1]<<8)+255*a[2]};e.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/AP804Oa6AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX//wCKxvRFAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var h=document.createElement("canvas");h.width=6;h.height=1;h=h.getContext("2d");
h.globalCompositeOperation="multiply";h.drawImage(a,0,0);h.drawImage(e,2,0);a=h.getImageData(2,0,1,1).data;return 255===a[0]&&0===a[1]&&0===a[2]};e.getNextPowerOfTwo=function(a){if(0<a&&0===(a&a-1))return a;for(var e=1;a>e;)e<<=1;return e};e.isPowerOfTwo=function(a,e){return 0<a&&0===(a&a-1)&&0<e&&0===(e&e-1)};e.PolyK={};e.PolyK.Triangulate=function(a){var g=!0,h=a.length>>1;if(3>h)return[];for(var k=[],m=[],b=0;h>b;b++)m.push(b);for(var b=0,c=h;3<c;){var f=m[(b+0)%c],d=m[(b+1)%c],n=m[(b+2)%c],p=
a[2*f],l=a[2*f+1],v=a[2*d],y=a[2*d+1],t=a[2*n],q=a[2*n+1],u=!1;if(e.PolyK._convex(p,l,v,y,t,q,g))for(var u=!0,z=0;c>z;z++){var x=m[z];if(x!==f&&x!==d&&x!==n&&e.PolyK._PointInTriangle(a[2*x],a[2*x+1],p,l,v,y,t,q)){u=!1;break}}if(u)k.push(f,d,n),m.splice((b+1)%c,1),c--,b=0;else if(b++>3*c){if(!g)return null;k=[];m=[];for(b=0;h>b;b++)m.push(b);b=0;c=h;g=!1}}return k.push(m[0],m[1],m[2]),k};e.PolyK._PointInTriangle=function(a,e,h,k,m,b,c,f){c-=h;f-=k;m-=h;b-=k;a-=h;h=e-k;e=c*c+f*f;k=c*m+f*b;c=c*a+f*h;
f=m*m+b*b;m=m*a+b*h;b=1/(e*f-k*k);f=(f*c-k*m)*b;c=(e*m-k*c)*b;return 0<=f&&0<=c&&1>f+c};e.PolyK._convex=function(a,e,h,k,m,b,c){return 0<=(e-k)*(m-h)+(h-a)*(b-k)===c};e.initDefaultShaders=function(){};e.CompileVertexShader=function(a,g){return e._CompileShader(a,g,a.VERTEX_SHADER)};e.CompileFragmentShader=function(a,g){return e._CompileShader(a,g,a.FRAGMENT_SHADER)};e._CompileShader=function(a,e,h){e=e.join("\n");h=a.createShader(h);return a.shaderSource(h,e),a.compileShader(h),a.getShaderParameter(h,
a.COMPILE_STATUS)?h:(window.console.log(a.getShaderInfoLog(h)),null)};e.compileProgram=function(a,g,h){h=e.CompileFragmentShader(a,h);g=e.CompileVertexShader(a,g);var k=a.createProgram();return a.attachShader(k,g),a.attachShader(k,h),a.linkProgram(k),a.getProgramParameter(k,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),k};e.PixiShader=function(a){this._UID=e._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;",
"uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.dirty=this.firstRun=!0;this.attributes=[];this.init()};e.PixiShader.prototype.constructor=e.PixiShader;e.PixiShader.prototype.init=function(){var a=this.gl,g=e.compileProgram(a,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(g);this.uSampler=a.getUniformLocation(g,"uSampler");this.projectionVector=a.getUniformLocation(g,"projectionVector");
this.offsetVector=a.getUniformLocation(g,"offsetVector");this.dimensions=a.getUniformLocation(g,"dimensions");this.aVertexPosition=a.getAttribLocation(g,"aVertexPosition");this.aTextureCoord=a.getAttribLocation(g,"aTextureCoord");this.colorAttribute=a.getAttribLocation(g,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var h in this.uniforms)this.uniforms[h].uniformLocation=a.getUniformLocation(g,h);this.initUniforms();
this.program=g};e.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a,e=this.gl,h;for(h in this.uniforms){a=this.uniforms[h];var k=a.type;"sampler2D"===k?(a._init=!1,null!==a.value&&this.initSampler2D(a)):"mat2"===k||"mat3"===k||"mat4"===k?(a.glMatrix=!0,a.glValueLength=1,"mat2"===k?a.glFunc=e.uniformMatrix2fv:"mat3"===k?a.glFunc=e.uniformMatrix3fv:"mat4"===k&&(a.glFunc=e.uniformMatrix4fv)):(a.glFunc=e["uniform"+k],a.glValueLength="2f"===k||"2i"===k?2:"3f"===k||"3i"===k?3:"4f"===
k||"4i"===k?4:1)}};e.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,a.value.baseTexture._glTextures[e.id]),a.textureData){var h=a.textureData,k=h.magFilter?h.magFilter:e.LINEAR,m=h.minFilter?h.minFilter:e.LINEAR,b=h.wrapS?h.wrapS:e.CLAMP_TO_EDGE,c=h.wrapT?h.wrapT:e.CLAMP_TO_EDGE,f=h.luminance?e.LUMINANCE:e.RGBA;(h.repeat&&(b=e.REPEAT,c=e.REPEAT),
e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!h.flipY),h.width)?e.texImage2D(e.TEXTURE_2D,0,f,h.width?h.width:512,h.height?h.height:2,h.border?h.border:0,f,e.UNSIGNED_BYTE,null):e.texImage2D(e.TEXTURE_2D,0,f,e.RGBA,e.UNSIGNED_BYTE,a.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,k);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,m);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,b);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,c)}e.uniform1i(a.uniformLocation,this.textureCount);
a._init=!0;this.textureCount++}};e.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,g=this.gl,h;for(h in this.uniforms)a=this.uniforms[h],1===a.glValueLength?!0===a.glMatrix?a.glFunc.call(g,a.uniformLocation,a.transpose,a.value):a.glFunc.call(g,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(g,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(g,a.uniformLocation,a.value.x,a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(g,a.uniformLocation,
a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(g.activeTexture(g["TEXTURE"+this.textureCount]),a.value.baseTexture._dirty[g.id]?e.instances[g.id].updateTexture(a.value.baseTexture):g.bindTexture(g.TEXTURE_2D,a.value.baseTexture._glTextures[g.id]),g.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))};e.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};e.PixiShader.defaultVertexSrc=
["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];e.PixiFastShader=function(a){this._UID=e._UID++;
this.gl=a;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;",
"uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;",
"}"];this.textureCount=0;this.init()};e.PixiFastShader.prototype.constructor=e.PixiFastShader;e.PixiFastShader.prototype.init=function(){var a=this.gl,g=e.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(g);this.uSampler=a.getUniformLocation(g,"uSampler");this.projectionVector=a.getUniformLocation(g,"projectionVector");this.offsetVector=a.getUniformLocation(g,"offsetVector");this.dimensions=a.getUniformLocation(g,"dimensions");this.uMatrix=a.getUniformLocation(g,"uMatrix");this.aVertexPosition=
a.getAttribLocation(g,"aVertexPosition");this.aPositionCoord=a.getAttribLocation(g,"aPositionCoord");this.aScale=a.getAttribLocation(g,"aScale");this.aRotation=a.getAttribLocation(g,"aRotation");this.aTextureCoord=a.getAttribLocation(g,"aTextureCoord");this.colorAttribute=a.getAttribLocation(g,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=g};e.PixiFastShader.prototype.destroy=
function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};e.StripShader=function(a){this._UID=e._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;",
"uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};e.StripShader.prototype.constructor=e.StripShader;e.StripShader.prototype.init=function(){var a=this.gl,g=e.compileProgram(a,this.vertexSrc,this.fragmentSrc);
a.useProgram(g);this.uSampler=a.getUniformLocation(g,"uSampler");this.projectionVector=a.getUniformLocation(g,"projectionVector");this.offsetVector=a.getUniformLocation(g,"offsetVector");this.colorAttribute=a.getAttribLocation(g,"aColor");this.aVertexPosition=a.getAttribLocation(g,"aVertexPosition");this.aTextureCoord=a.getAttribLocation(g,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=a.getUniformLocation(g,"translationMatrix");this.alpha=a.getUniformLocation(g,
"alpha");this.program=g};e.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};e.PrimitiveShader=function(a){this._UID=e._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;",
"uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};e.PrimitiveShader.prototype.constructor=e.PrimitiveShader;e.PrimitiveShader.prototype.init=function(){var a=this.gl,g=e.compileProgram(a,
this.vertexSrc,this.fragmentSrc);a.useProgram(g);this.projectionVector=a.getUniformLocation(g,"projectionVector");this.offsetVector=a.getUniformLocation(g,"offsetVector");this.tintColor=a.getUniformLocation(g,"tint");this.flipY=a.getUniformLocation(g,"flipY");this.aVertexPosition=a.getAttribLocation(g,"aVertexPosition");this.colorAttribute=a.getAttribLocation(g,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=a.getUniformLocation(g,"translationMatrix");this.alpha=
a.getUniformLocation(g,"alpha");this.program=g};e.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};e.ComplexPrimitiveShader=function(a){this._UID=e._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;",
"uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};e.ComplexPrimitiveShader.prototype.constructor=e.ComplexPrimitiveShader;e.ComplexPrimitiveShader.prototype.init=
function(){var a=this.gl,g=e.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(g);this.projectionVector=a.getUniformLocation(g,"projectionVector");this.offsetVector=a.getUniformLocation(g,"offsetVector");this.tintColor=a.getUniformLocation(g,"tint");this.color=a.getUniformLocation(g,"color");this.flipY=a.getUniformLocation(g,"flipY");this.aVertexPosition=a.getAttribLocation(g,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=a.getUniformLocation(g,
"translationMatrix");this.alpha=a.getUniformLocation(g,"alpha");this.program=g};e.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};e.WebGLGraphics=function(){};e.WebGLGraphics.renderGraphics=function(a,g){var h,k=g.gl,m=g.projection,b=g.offset,c=g.shaderManager.primitiveShader;a.dirty&&e.WebGLGraphics.updateGraphics(a,k);for(var f=a._webGL[k.id],d=0;d<f.data.length;d++)1===f.data[d].mode?(h=f.data[d],g.stencilManager.pushStencil(a,
h,g),k.drawElements(k.TRIANGLE_FAN,4,k.UNSIGNED_SHORT,2*(h.indices.length-4)),g.stencilManager.popStencil(a,h,g)):(h=f.data[d],g.shaderManager.setShader(c),c=g.shaderManager.primitiveShader,k.uniformMatrix3fv(c.translationMatrix,!1,a.worldTransform.toArray(!0)),k.uniform1f(c.flipY,1),k.uniform2f(c.projectionVector,m.x,-m.y),k.uniform2f(c.offsetVector,-b.x,-b.y),k.uniform3fv(c.tintColor,e.hex2rgb(a.tint)),k.uniform1f(c.alpha,a.worldAlpha),k.bindBuffer(k.ARRAY_BUFFER,h.buffer),k.vertexAttribPointer(c.aVertexPosition,
2,k.FLOAT,!1,24,0),k.vertexAttribPointer(c.colorAttribute,4,k.FLOAT,!1,24,8),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,h.indexBuffer),k.drawElements(k.TRIANGLE_STRIP,h.indices.length,k.UNSIGNED_SHORT,0))};e.WebGLGraphics.updateGraphics=function(a,g){var h=a._webGL[g.id];h||(h=a._webGL[g.id]={lastIndex:0,data:[],gl:g});a.dirty=!1;var k;if(a.clearDirty){a.clearDirty=!1;for(k=0;k<h.data.length;k++){var m=h.data[k];m.reset();e.WebGLGraphics.graphicsDataPool.push(m)}h.data=[];h.lastIndex=0}var b;for(k=h.lastIndex;k<
a.graphicsData.length;k++){m=a.graphicsData[k];if(m.type===e.Graphics.POLY){if(m.points=m.shape.points.slice(),m.shape.closed&&(m.points[0]!==m.points[m.points.length-2]||m.points[1]!==m.points[m.points.length-1])&&m.points.push(m.points[0],m.points[1]),m.fill&&6<=m.points.length)12>m.points.length?(b=e.WebGLGraphics.switchMode(h,0),e.WebGLGraphics.buildPoly(m,b)||(b=e.WebGLGraphics.switchMode(h,1),e.WebGLGraphics.buildComplexPoly(m,b))):(b=e.WebGLGraphics.switchMode(h,1),e.WebGLGraphics.buildComplexPoly(m,
b));0<m.lineWidth&&(b=e.WebGLGraphics.switchMode(h,0),e.WebGLGraphics.buildLine(m,b))}else b=e.WebGLGraphics.switchMode(h,0),m.type===e.Graphics.RECT?e.WebGLGraphics.buildRectangle(m,b):m.type===e.Graphics.CIRC||m.type===e.Graphics.ELIP?e.WebGLGraphics.buildCircle(m,b):m.type===e.Graphics.RREC&&e.WebGLGraphics.buildRoundedRectangle(m,b);h.lastIndex++}for(k=0;k<h.data.length;k++)b=h.data[k],b.dirty&&b.upload()};e.WebGLGraphics.switchMode=function(a,g){var h;return a.data.length?(h=a.data[a.data.length-
1],(h.mode!==g||1===g)&&(h=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(a.gl),h.mode=g,a.data.push(h))):(h=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(a.gl),h.mode=g,a.data.push(h)),h.dirty=!0,h};e.WebGLGraphics.buildRectangle=function(a,g){var h=a.shape,k=h.x,m=h.y,b=h.width,h=h.height;if(a.fill){var c=e.hex2rgb(a.fillColor),f=a.fillAlpha,d=c[0]*f,n=c[1]*f,c=c[2]*f,p=g.points,l=g.indices,v=p.length/6;p.push(k,m);p.push(d,n,c,f);p.push(k+b,m);p.push(d,n,c,f);
p.push(k,m+h);p.push(d,n,c,f);p.push(k+b,m+h);p.push(d,n,c,f);l.push(v,v,v+1,v+2,v+3,v+3)}a.lineWidth&&(f=a.points,a.points=[k,m,k+b,m,k+b,m+h,k,m+h,k,m],e.WebGLGraphics.buildLine(a,g),a.points=f)};e.WebGLGraphics.buildRoundedRectangle=function(a,g){var h=a.shape,k=h.x,m=h.y,b=h.width,c=h.height,f=h.radius,h=[];if(h.push(k,m+f),h=h.concat(e.WebGLGraphics.quadraticBezierCurve(k,m+c-f,k,m+c,k+f,m+c)),h=h.concat(e.WebGLGraphics.quadraticBezierCurve(k+b-f,m+c,k+b,m+c,k+b,m+c-f)),h=h.concat(e.WebGLGraphics.quadraticBezierCurve(k+
b,m+f,k+b,m,k+b-f,m)),h=h.concat(e.WebGLGraphics.quadraticBezierCurve(k+f,m,k,m,k,m+f)),a.fill){for(var c=e.hex2rgb(a.fillColor),k=a.fillAlpha,m=c[0]*k,b=c[1]*k,c=c[2]*k,f=g.points,d=g.indices,n=f.length/6,p=e.PolyK.Triangulate(h),l=0,l=0;l<p.length;l+=3)d.push(p[l]+n),d.push(p[l]+n),d.push(p[l+1]+n),d.push(p[l+2]+n),d.push(p[l+2]+n);for(l=0;l<h.length;l++)f.push(h[l],h[++l],m,b,c,k)}a.lineWidth&&(k=a.points,a.points=h,e.WebGLGraphics.buildLine(a,g),a.points=k)};e.WebGLGraphics.quadraticBezierCurve=
function(a,e,h,k,m,b){for(var c,f,d,n,p=[],l=0,v=0;20>=v;v++)l=v/20,c=a+(h-a)*l,f=e+(k-e)*l,d=h+(m-h)*l,n=k+(b-k)*l,c+=(d-c)*l,f+=(n-f)*l,p.push(c,f);return p};e.WebGLGraphics.buildCircle=function(a,g){var h,k,m=a.shape,b=m.x,c=m.y;a.type===e.Graphics.CIRC?(h=m.radius,k=m.radius):(h=m.width,k=m.height);var m=2*Math.PI/40,f=0;if(a.fill){var f=e.hex2rgb(a.fillColor),d=a.fillAlpha,n=f[0]*d,p=f[1]*d,l=f[2]*d,v=g.points,y=g.indices,t=v.length/6;y.push(t);for(f=0;41>f;f++)v.push(b,c,n,p,l,d),v.push(b+Math.sin(m*
f)*h,c+Math.cos(m*f)*k,n,p,l,d),y.push(t++,t++);y.push(t-1)}if(a.lineWidth){d=a.points;a.points=[];for(f=0;41>f;f++)a.points.push(b+Math.sin(m*f)*h,c+Math.cos(m*f)*k);e.WebGLGraphics.buildLine(a,g);a.points=d}};e.WebGLGraphics.buildLine=function(a,g){var h=0,k=a.points;if(0!==k.length){if(a.lineWidth%2)for(h=0;h<k.length;h++)k[h]+=.5;var m=new e.Point(k[0],k[1]),b=new e.Point(k[k.length-2],k[k.length-1]);if(m.x===b.x&&m.y===b.y){k=k.slice();k.pop();k.pop();var b=new e.Point(k[k.length-2],k[k.length-
1]),c=b.x+.5*(m.x-b.x),m=b.y+.5*(m.y-b.y);k.unshift(c,m);k.push(c,m)}var f,d,n,p,l,v,y,t,q,u,z,x,r,w,G,B,F,I,A,c=g.points,m=g.indices,b=k.length/2,D=k.length,H=c.length/6,C=a.lineWidth/2,h=e.hex2rgb(a.lineColor),E=a.lineAlpha,L=h[0]*E,K=h[1]*E,M=h[2]*E;n=k[0];p=k[1];l=k[2];v=k[3];q=-(p-v);u=n-l;A=Math.sqrt(q*q+u*u);q=q/A*C;u=u/A*C;c.push(n-q,p-u,L,K,M,E);c.push(n+q,p+u,L,K,M,E);for(h=1;b-1>h;h++)n=k[2*(h-1)],p=k[2*(h-1)+1],l=k[2*h],v=k[2*h+1],y=k[2*(h+1)],t=k[2*(h+1)+1],q=-(p-v),u=n-l,A=Math.sqrt(q*
q+u*u),q/=A,u/=A,q*=C,u*=C,z=-(v-t),x=l-y,A=Math.sqrt(z*z+x*x),z/=A,x/=A,z*=C,x*=C,G=-u+p-(-u+v),B=-q+l-(-q+n),n=(-q+n)*(-u+v)-(-q+l)*(-u+p),p=-x+t-(-x+v),F=-z+l-(-z+y),y=(-z+y)*(-x+v)-(-z+l)*(-x+t),t=G*F-p*B,.1>Math.abs(t)?(c.push(l-q,v-u,L,K,M,E),c.push(l+q,v+u,L,K,M,E)):(f=(B*y-F*n)/t,d=(p*n-G*y)/t,I=(f-l)*(f-l)+(d-v)+(d-v),19600<I?(r=q-z,w=u-x,A=Math.sqrt(r*r+w*w),r/=A,w/=A,r*=C,w*=C,c.push(l-r,v-w),c.push(L,K,M,E),c.push(l+r,v+w),c.push(L,K,M,E),c.push(l-r,v-w),c.push(L,K,M,E),D++):(c.push(f,
d),c.push(L,K,M,E),c.push(l-(f-l),v-(d-v)),c.push(L,K,M,E)));n=k[2*(b-2)];p=k[2*(b-2)+1];l=k[2*(b-1)];v=k[2*(b-1)+1];q=-(p-v);u=n-l;A=Math.sqrt(q*q+u*u);q/=A;u/=A;q*=C;u*=C;c.push(l-q,v-u);c.push(L,K,M,E);c.push(l+q,v+u);c.push(L,K,M,E);m.push(H);for(h=0;D>h;h++)m.push(H++);m.push(H-1)}};e.WebGLGraphics.buildComplexPoly=function(a,g){var h=a.points.slice();if(!(6>h.length)){var k=g.indices;g.points=h;g.alpha=a.fillAlpha;g.color=e.hex2rgb(a.fillColor);for(var m,b,c=1/0,f=-1/0,d=1/0,n=-1/0,p=0;p<h.length;p+=
2)m=h[p],b=h[p+1],c=c>m?m:c,f=m>f?m:f,d=d>b?b:d,n=b>n?b:n;h.push(c,d,f,d,f,n,c,n);h=h.length/2;for(p=0;h>p;p++)k.push(p)}};e.WebGLGraphics.buildPoly=function(a,g){var h=a.points;if(!(6>h.length)){var k=g.points,m=g.indices,b=h.length/2,c=e.hex2rgb(a.fillColor),f=a.fillAlpha,d=c[0]*f,n=c[1]*f,c=c[2]*f,p=e.PolyK.Triangulate(h);if(!p)return!1;for(var l=k.length/6,v=0,v=0;v<p.length;v+=3)m.push(p[v]+l),m.push(p[v]+l),m.push(p[v+1]+l),m.push(p[v+2]+l),m.push(p[v+2]+l);for(v=0;b>v;v++)k.push(h[2*v],h[2*
v+1],d,n,c,f);return!0}};e.WebGLGraphics.graphicsDataPool=[];e.WebGLGraphicsData=function(a){this.gl=a;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.alpha=this.mode=1;this.dirty=!0};e.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};e.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new e.Float32Array(this.points);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.bufferData(a.ARRAY_BUFFER,
this.glPoints,a.STATIC_DRAW);this.glIndicies=new e.Uint16Array(this.indices);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW);this.dirty=!1};e.glContexts=[];e.instances=[];e.WebGLRenderer=function(a,g,h){if(h)for(var k in e.defaultRenderOptions)"undefined"==typeof h[k]&&(h[k]=e.defaultRenderOptions[k]);else h=e.defaultRenderOptions;e.defaultRenderer||(e.defaultRenderer=this);this.type=e.WEBGL_RENDERER;this.resolution=h.resolution;
this.transparent=h.transparent;this.autoResize=h.autoResize||!1;this.preserveDrawingBuffer=h.preserveDrawingBuffer;this.clearBeforeRender=h.clearBeforeRender;this.width=a||800;this.height=g||600;this.view=h.view||document.createElement("canvas");this.contextLostBound=this.handleContextLost.bind(this);this.contextRestoredBound=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLostBound,!1);this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,
!1);this._contextOptions={alpha:this.transparent,antialias:h.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:h.preserveDrawingBuffer};this.projection=new e.Point;this.offset=new e.Point(0,0);this.shaderManager=new e.WebGLShaderManager;this.spriteBatch=new e.WebGLSpriteBatch;this.maskManager=new e.WebGLMaskManager;this.filterManager=new e.WebGLFilterManager;this.stencilManager=new e.WebGLStencilManager;this.blendModeManager=new e.WebGLBlendModeManager;
this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};
e.WebGLRenderer.prototype.constructor=e.WebGLRenderer;e.WebGLRenderer.prototype.initContext=function(){var a=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=a,!a)throw Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=a.id=e.WebGLRenderer.glContextId++;e.glContexts[this.glContextId]=a;e.instances[this.glContextId]=this;a.disable(a.DEPTH_TEST);a.disable(a.CULL_FACE);a.enable(a.BLEND);
this.shaderManager.setContext(a);this.spriteBatch.setContext(a);this.maskManager.setContext(a);this.filterManager.setContext(a);this.blendModeManager.setContext(a);this.stencilManager.setContext(a);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};e.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(this.__stage=a);a.updateTransform();var e=this.gl;e.viewport(0,0,this.width,this.height);e.bindFramebuffer(e.FRAMEBUFFER,null);this.clearBeforeRender&&
(this.transparent?e.clearColor(0,0,0,0):e.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1),e.clear(e.COLOR_BUFFER_BIT));this.renderDisplayObject(a,this.projection)}};e.WebGLRenderer.prototype.renderDisplayObject=function(a,g,h){this.renderSession.blendModeManager.setBlendMode(e.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=h?-1:1;this.renderSession.projection=g;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);
this.filterManager.begin(this.renderSession,h);a._renderWebGL(this.renderSession);this.spriteBatch.end()};e.WebGLRenderer.prototype.resize=function(a,e){this.width=a*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px");this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=
-this.height/2/this.resolution};e.WebGLRenderer.prototype.updateTexture=function(a){if(a.hasLoaded){var g=this.gl;return a._glTextures[g.id]||(a._glTextures[g.id]=g.createTexture()),g.bindTexture(g.TEXTURE_2D,a._glTextures[g.id]),g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,a.source),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,a.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST),a.mipmap&&e.isPowerOfTwo(a.width,
a.height)?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,a.scaleMode===e.scaleModes.LINEAR?g.LINEAR_MIPMAP_LINEAR:g.NEAREST_MIPMAP_NEAREST),g.generateMipmap(g.TEXTURE_2D)):g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,a.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST),a._powerOf2?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT)):(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,
g.CLAMP_TO_EDGE)),a._dirty[g.id]=!1,a._glTextures[g.id]}};e.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault();this.contextLost=!0};e.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var a in e.TextureCache)e.TextureCache[a].baseTexture._glTextures=[];this.contextLost=!1};e.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound);this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound);
this.offset=this.projection=e.glContexts[this.glContextId]=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.renderSession=this.gl=this.filterManager=this.maskManager=this.spriteBatch=this.shaderManager=null;e.instances[this.glContextId]=null;e.WebGLRenderer.glContextId--};e.WebGLRenderer.prototype.mapBlendModes=function(){var a=this.gl;e.blendModesWebGL||(e.blendModesWebGL=[],e.blendModesWebGL[e.blendModes.NORMAL]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],
e.blendModesWebGL[e.blendModes.ADD]=[a.SRC_ALPHA,a.DST_ALPHA],e.blendModesWebGL[e.blendModes.MULTIPLY]=[a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SCREEN]=[a.SRC_ALPHA,a.ONE],e.blendModesWebGL[e.blendModes.OVERLAY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.DARKEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.LIGHTEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR_DODGE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR_BURN]=
[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.HARD_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SOFT_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.DIFFERENCE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.EXCLUSION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.HUE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SATURATION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR]=[a.ONE,
a.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.LUMINOSITY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA])};e.WebGLRenderer.glContextId=0;e.WebGLBlendModeManager=function(){this.currentBlendMode=99999};e.WebGLBlendModeManager.prototype.constructor=e.WebGLBlendModeManager;e.WebGLBlendModeManager.prototype.setContext=function(a){this.gl=a};e.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;a=e.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(a[0],
a[1]),!0};e.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};e.WebGLMaskManager=function(){};e.WebGLMaskManager.prototype.constructor=e.WebGLMaskManager;e.WebGLMaskManager.prototype.setContext=function(a){this.gl=a};e.WebGLMaskManager.prototype.pushMask=function(a,g){var h=g.gl;a.dirty&&e.WebGLGraphics.updateGraphics(a,h);a._webGL[h.id].data.length&&g.stencilManager.pushStencil(a,a._webGL[h.id].data[0],g)};e.WebGLMaskManager.prototype.popMask=function(a,e){e.stencilManager.popStencil(a,
a._webGL[this.gl.id].data[0],e)};e.WebGLMaskManager.prototype.destroy=function(){this.gl=null};e.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=!0;this.count=0};e.WebGLStencilManager.prototype.setContext=function(a){this.gl=a};e.WebGLStencilManager.prototype.pushStencil=function(a,e,h){var k=this.gl;this.bindGraphics(a,e,h);0===this.stencilStack.length&&(k.enable(k.STENCIL_TEST),k.clear(k.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(e);a=this.count;k.colorMask(!1,
!1,!1,!1);k.stencilFunc(k.ALWAYS,0,255);k.stencilOp(k.KEEP,k.KEEP,k.INVERT);1===e.mode?(k.drawElements(k.TRIANGLE_FAN,e.indices.length-4,k.UNSIGNED_SHORT,0),this.reverse?(k.stencilFunc(k.EQUAL,255-a,255),k.stencilOp(k.KEEP,k.KEEP,k.DECR)):(k.stencilFunc(k.EQUAL,a,255),k.stencilOp(k.KEEP,k.KEEP,k.INCR)),k.drawElements(k.TRIANGLE_FAN,4,k.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?k.stencilFunc(k.EQUAL,255-(a+1),255):k.stencilFunc(k.EQUAL,a+1,255),this.reverse=!this.reverse):(this.reverse?(k.stencilFunc(k.EQUAL,
a,255),k.stencilOp(k.KEEP,k.KEEP,k.INCR)):(k.stencilFunc(k.EQUAL,255-a,255),k.stencilOp(k.KEEP,k.KEEP,k.DECR)),k.drawElements(k.TRIANGLE_STRIP,e.indices.length,k.UNSIGNED_SHORT,0),this.reverse?k.stencilFunc(k.EQUAL,a+1,255):k.stencilFunc(k.EQUAL,255-(a+1),255));k.colorMask(!0,!0,!0,!0);k.stencilOp(k.KEEP,k.KEEP,k.KEEP);this.count++};e.WebGLStencilManager.prototype.bindGraphics=function(a,g,h){this._currentGraphics=a;var k,m=this.gl,b=h.projection,c=h.offset;1===g.mode?(k=h.shaderManager.complexPrimitiveShader,
h.shaderManager.setShader(k),m.uniform1f(k.flipY,h.flipY),m.uniformMatrix3fv(k.translationMatrix,!1,a.worldTransform.toArray(!0)),m.uniform2f(k.projectionVector,b.x,-b.y),m.uniform2f(k.offsetVector,-c.x,-c.y),m.uniform3fv(k.tintColor,e.hex2rgb(a.tint)),m.uniform3fv(k.color,g.color),m.uniform1f(k.alpha,a.worldAlpha*g.alpha),m.bindBuffer(m.ARRAY_BUFFER,g.buffer),m.vertexAttribPointer(k.aVertexPosition,2,m.FLOAT,!1,8,0),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,g.indexBuffer)):(k=h.shaderManager.primitiveShader,
h.shaderManager.setShader(k),m.uniformMatrix3fv(k.translationMatrix,!1,a.worldTransform.toArray(!0)),m.uniform1f(k.flipY,h.flipY),m.uniform2f(k.projectionVector,b.x,-b.y),m.uniform2f(k.offsetVector,-c.x,-c.y),m.uniform3fv(k.tintColor,e.hex2rgb(a.tint)),m.uniform1f(k.alpha,a.worldAlpha),m.bindBuffer(m.ARRAY_BUFFER,g.buffer),m.vertexAttribPointer(k.aVertexPosition,2,m.FLOAT,!1,24,0),m.vertexAttribPointer(k.colorAttribute,4,m.FLOAT,!1,24,8),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,g.indexBuffer))};e.WebGLStencilManager.prototype.popStencil=
function(a,e,h){var k=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)k.disable(k.STENCIL_TEST);else{var m=this.count;this.bindGraphics(a,e,h);k.colorMask(!1,!1,!1,!1);1===e.mode?(this.reverse=!this.reverse,this.reverse?(k.stencilFunc(k.EQUAL,255-(m+1),255),k.stencilOp(k.KEEP,k.KEEP,k.INCR)):(k.stencilFunc(k.EQUAL,m+1,255),k.stencilOp(k.KEEP,k.KEEP,k.DECR)),k.drawElements(k.TRIANGLE_FAN,4,k.UNSIGNED_SHORT,2*(e.indices.length-4)),k.stencilFunc(k.ALWAYS,0,255),k.stencilOp(k.KEEP,
k.KEEP,k.INVERT),k.drawElements(k.TRIANGLE_FAN,e.indices.length-4,k.UNSIGNED_SHORT,0),this.reverse?k.stencilFunc(k.EQUAL,m,255):k.stencilFunc(k.EQUAL,255-m,255)):(this.reverse?(k.stencilFunc(k.EQUAL,m+1,255),k.stencilOp(k.KEEP,k.KEEP,k.DECR)):(k.stencilFunc(k.EQUAL,255-(m+1),255),k.stencilOp(k.KEEP,k.KEEP,k.INCR)),k.drawElements(k.TRIANGLE_STRIP,e.indices.length,k.UNSIGNED_SHORT,0),this.reverse?k.stencilFunc(k.EQUAL,m,255):k.stencilFunc(k.EQUAL,255-m,255));k.colorMask(!0,!0,!0,!0);k.stencilOp(k.KEEP,
k.KEEP,k.KEEP)}};e.WebGLStencilManager.prototype.destroy=function(){this.gl=this.stencilStack=null};e.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var a=0;a<this.maxAttibs;a++)this.attribState[a]=!1;this.stack=[]};e.WebGLShaderManager.prototype.constructor=e.WebGLShaderManager;e.WebGLShaderManager.prototype.setContext=function(a){this.gl=a;this.primitiveShader=new e.PrimitiveShader(a);this.complexPrimitiveShader=new e.ComplexPrimitiveShader(a);this.defaultShader=
new e.PixiShader(a);this.fastShader=new e.PixiFastShader(a);this.stripShader=new e.StripShader(a);this.setShader(this.defaultShader)};e.WebGLShaderManager.prototype.setAttribs=function(a){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<a.length;e++)this.tempAttribState[a[e]]=!0;a=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?a.enableVertexAttribArray(e):
a.disableVertexAttribArray(e))};e.WebGLShaderManager.prototype.setShader=function(a){return this._currentId===a._UID?!1:(this._currentId=a._UID,this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes),!0)};e.WebGLShaderManager.prototype.destroy=function(){this.tempAttribState=this.attribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};e.WebGLSpriteBatch=
function(){this.vertSize=5;this.size=2E3;var a=6*this.size;this.vertices=new e.ArrayBuffer(16*this.size*this.vertSize);this.positions=new e.Float32Array(this.vertices);this.colors=new e.Uint32Array(this.vertices);this.indices=new e.Uint16Array(a);for(var g=this.lastIndexCount=0,h=0;a>g;g+=6,h+=4)this.indices[g+0]=h+0,this.indices[g+1]=h+1,this.indices[g+2]=h+2,this.indices[g+3]=h+0,this.indices[g+4]=h+2,this.indices[g+5]=h+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=
!0;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new e.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};e.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,
this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW);this.currentBlendMode=99999;var g=new e.PixiShader(a);g.fragmentSrc=this.defaultShader.fragmentSrc;g.uniforms={};g.init();this.defaultShader.shaders[a.id]=g};e.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};e.WebGLSpriteBatch.prototype.end=function(){this.flush()};e.WebGLSpriteBatch.prototype.render=
function(a){var e=a.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture);var h=e._uvs;if(h){var k,m,b,c;m=a.anchor.x;var f=a.anchor.y;e.trim?(b=e.trim,m=b.x-m*b.width,k=m+e.crop.width,c=b.y-f*b.height,b=c+e.crop.height):(k=e.frame.width*(1-m),m=e.frame.width*-m,b=e.frame.height*(1-f),c=e.frame.height*-f);var f=4*this.currentBatchSize*this.vertSize,d=e.baseTexture.resolution,n=a.worldTransform,e=n.a/d,p=n.b/d,l=n.c/d,d=n.d/d,v=n.tx,y=n.ty,n=this.colors,t=this.positions;
this.renderSession.roundPixels?(t[f]=e*m+l*c+v|0,t[f+1]=d*c+p*m+y|0,t[f+5]=e*k+l*c+v|0,t[f+6]=d*c+p*k+y|0,t[f+10]=e*k+l*b+v|0,t[f+11]=d*b+p*k+y|0,t[f+15]=e*m+l*b+v|0,t[f+16]=d*b+p*m+y|0):(t[f]=e*m+l*c+v,t[f+1]=d*c+p*m+y,t[f+5]=e*k+l*c+v,t[f+6]=d*c+p*k+y,t[f+10]=e*k+l*b+v,t[f+11]=d*b+p*k+y,t[f+15]=e*m+l*b+v,t[f+16]=d*b+p*m+y);t[f+2]=h.x0;t[f+3]=h.y0;t[f+7]=h.x1;t[f+8]=h.y1;t[f+12]=h.x2;t[f+13]=h.y2;t[f+17]=h.x3;t[f+18]=h.y3;h=a.tint;n[f+4]=n[f+9]=n[f+14]=n[f+19]=(h>>16)+(65280&h)+((255&h)<<16)+(255*
a.worldAlpha<<24);this.sprites[this.currentBatchSize++]=a}};e.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var g=a.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=g.baseTexture);a._uvs||(a._uvs=new e.TextureUvs);var h=a._uvs;a.tilePosition.x%=g.baseTexture.width*a.tileScaleOffset.x;a.tilePosition.y%=g.baseTexture.height*a.tileScaleOffset.y;var k=a.tilePosition.x/(g.baseTexture.width*a.tileScaleOffset.x),m=a.tilePosition.y/(g.baseTexture.height*a.tileScaleOffset.y),
b=a.width/g.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),c=a.height/g.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);h.x0=0-k;h.y0=0-m;h.x1=1*b-k;h.y1=0-m;h.x2=1*b-k;h.y2=1*c-m;h.x3=0-k;h.y3=1*c-m;var k=a.tint,k=(k>>16)+(65280&k)+((255&k)<<16)+(255*a.alpha<<24),m=this.positions,b=this.colors,f=a.width,d=a.height,n=a.anchor.x,p=a.anchor.y,c=f*(1-n),f=f*-n,n=d*(1-p),d=d*-p,p=4*this.currentBatchSize*this.vertSize,l=g.baseTexture.resolution,v=a.worldTransform,g=v.a/l,y=v.b/l,t=v.c/l,
l=v.d/l,q=v.tx,v=v.ty;m[p++]=g*f+t*d+q;m[p++]=l*d+y*f+v;m[p++]=h.x0;m[p++]=h.y0;b[p++]=k;m[p++]=g*c+t*d+q;m[p++]=l*d+y*c+v;m[p++]=h.x1;m[p++]=h.y1;b[p++]=k;m[p++]=g*c+t*n+q;m[p++]=l*n+y*c+v;m[p++]=h.x2;m[p++]=h.y2;b[p++]=k;m[p++]=g*f+t*n+q;m[p++]=l*n+y*f+v;m[p++]=h.x3;m[p++]=h.y3;b[p++]=k;this.sprites[this.currentBatchSize++]=a};e.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a,g=this.gl;if(this.dirty){this.dirty=!1;g.activeTexture(g.TEXTURE0);g.bindBuffer(g.ARRAY_BUFFER,
this.vertexBuffer);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a=this.defaultShader.shaders[g.id];var h=4*this.vertSize;g.vertexAttribPointer(a.aVertexPosition,2,g.FLOAT,!1,h,0);g.vertexAttribPointer(a.aTextureCoord,2,g.FLOAT,!1,h,8);g.vertexAttribPointer(a.colorAttribute,4,g.UNSIGNED_BYTE,!0,h,16)}this.currentBatchSize>.5*this.size?g.bufferSubData(g.ARRAY_BUFFER,0,this.vertices):(a=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize),g.bufferSubData(g.ARRAY_BUFFER,0,a));for(var k,
m,b,c,f=h=0,d=null,n=this.renderSession.blendModeManager.currentBlendMode,p=null,l=!1,v=!1,y=0,t=this.currentBatchSize;t>y;y++){if(c=this.sprites[y],k=c.texture.baseTexture,m=c.blendMode,b=c.shader||this.defaultShader,l=n!==m,v=p!==b,(d!==k||l||v)&&(this.renderBatch(d,h,f),f=y,h=0,d=k,l&&(n=m,this.renderSession.blendModeManager.setBlendMode(n)),v)){p=b;(a=p.shaders[g.id])||(a=new e.PixiShader(g),a.fragmentSrc=p.fragmentSrc,a.uniforms=p.uniforms,a.init(),p.shaders[g.id]=a);this.renderSession.shaderManager.setShader(a);
a.dirty&&a.syncUniforms();var q=this.renderSession.projection;g.uniform2f(a.projectionVector,q.x,q.y);q=this.renderSession.offset;g.uniform2f(a.offsetVector,q.x,q.y)}h++}this.renderBatch(d,h,f);this.currentBatchSize=0}};e.WebGLSpriteBatch.prototype.renderBatch=function(a,e,h){if(0!==e){var k=this.gl;a._dirty[k.id]?this.renderSession.renderer.updateTexture(a):k.bindTexture(k.TEXTURE_2D,a._glTextures[k.id]);k.drawElements(k.TRIANGLES,6*e,k.UNSIGNED_SHORT,12*h);this.renderSession.drawCount++}};e.WebGLSpriteBatch.prototype.stop=
function(){this.flush();this.dirty=!0};e.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0};e.WebGLSpriteBatch.prototype.destroy=function(){this.indices=this.vertices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.gl=this.currentBaseTexture=null};e.WebGLFastSpriteBatch=function(a){this.vertSize=10;this.size=this.maxSize=6E3;var g=6*this.maxSize;this.vertices=new e.Float32Array(4*this.size*this.vertSize);this.indices=new e.Uint16Array(g);this.indexBuffer=
this.vertexBuffer=null;for(var h=this.lastIndexCount=0,k=0;g>h;h+=6,k+=4)this.indices[h+0]=k+0,this.indices[h+1]=k+1,this.indices[h+2]=k+2,this.indices[h+3]=k+0,this.indices[h+4]=k+2,this.indices[h+5]=k+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.matrix=this.shader=this.renderSession=null;this.setContext(a)};e.WebGLFastSpriteBatch.prototype.constructor=e.WebGLFastSpriteBatch;e.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=
a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW)};e.WebGLFastSpriteBatch.prototype.begin=function(a,e){this.renderSession=e;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=a.worldTransform.toArray(!0);this.start()};e.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};
e.WebGLFastSpriteBatch.prototype.render=function(a){a=a.children;var e=a[0];if(e.texture._uvs){this.currentBaseTexture=e.texture.baseTexture;e.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(e.blendMode));for(var e=0,h=a.length;h>e;e++)this.renderSprite(a[e]);this.flush()}};e.WebGLFastSpriteBatch.prototype.renderSprite=function(a){if(a.visible&&(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=
a.texture.baseTexture,a.texture._uvs))){var e,h,k,m,b,c,f=this.vertices;(e=a.texture._uvs,a.texture.trim)?(m=a.texture.trim,k=m.x-a.anchor.x*m.width,h=k+a.texture.crop.width,b=m.y-a.anchor.y*m.height,m=b+a.texture.crop.height):(h=a.texture.frame.width*(1-a.anchor.x),k=a.texture.frame.width*-a.anchor.x,m=a.texture.frame.height*(1-a.anchor.y),b=a.texture.frame.height*-a.anchor.y);c=4*this.currentBatchSize*this.vertSize;f[c++]=k;f[c++]=b;f[c++]=a.position.x;f[c++]=a.position.y;f[c++]=a.scale.x;f[c++]=
a.scale.y;f[c++]=a.rotation;f[c++]=e.x0;f[c++]=e.y1;f[c++]=a.alpha;f[c++]=h;f[c++]=b;f[c++]=a.position.x;f[c++]=a.position.y;f[c++]=a.scale.x;f[c++]=a.scale.y;f[c++]=a.rotation;f[c++]=e.x1;f[c++]=e.y1;f[c++]=a.alpha;f[c++]=h;f[c++]=m;f[c++]=a.position.x;f[c++]=a.position.y;f[c++]=a.scale.x;f[c++]=a.scale.y;f[c++]=a.rotation;f[c++]=e.x2;f[c++]=e.y2;f[c++]=a.alpha;f[c++]=k;f[c++]=m;f[c++]=a.position.x;f[c++]=a.position.y;f[c++]=a.scale.x;f[c++]=a.scale.y;f[c++]=a.rotation;f[c++]=e.x3;f[c++]=e.y3;f[c++]=
a.alpha;this.currentBatchSize++;this.currentBatchSize>=this.size&&this.flush()}};e.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*
this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,e)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++}};e.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,
e.x,e.y);a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);e=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,e,0);a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,e,8);a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,e,16);a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,e,24);a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,e,28);a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,!1,e,36)};e.WebGLFilterManager=function(){this.filterStack=
[];this.offsetY=this.offsetX=0};e.WebGLFilterManager.prototype.constructor=e.WebGLFilterManager;e.WebGLFilterManager.prototype.setContext=function(a){this.gl=a;this.texturePool=[];this.initShaderBuffers()};e.WebGLFilterManager.prototype.begin=function(a,e){this.renderSession=a;this.defaultShader=a.shaderManager.defaultShader;var h=this.renderSession.projection;this.width=2*h.x;this.height=2*-h.y;this.buffer=e};e.WebGLFilterManager.prototype.pushFilter=function(a){var g=this.gl,h=this.renderSession.projection,
k=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds();this.filterStack.push(a);var m=a.filterPasses[0];this.offsetX+=a._filterArea.x;this.offsetY+=a._filterArea.y;var b=this.texturePool.pop();b?b.resize(this.width,this.height):b=new e.FilterTexture(this.gl,this.width,this.height);g.bindTexture(g.TEXTURE_2D,b.texture);var c=a._filterArea,m=m.padding;c.x-=m;c.y-=m;c.width+=2*m;c.height+=2*m;0>c.x&&(c.x=0);c.width>this.width&&(c.width=this.width);0>c.y&&(c.y=0);c.height>
this.height&&(c.height=this.height);g.bindFramebuffer(g.FRAMEBUFFER,b.frameBuffer);g.viewport(0,0,c.width,c.height);h.x=c.width/2;h.y=-c.height/2;k.x=-c.x;k.y=-c.y;g.colorMask(!0,!0,!0,!0);g.clearColor(0,0,0,0);g.clear(g.COLOR_BUFFER_BIT);a._glFilterTexture=b};e.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,g=this.filterStack.pop(),h=g._filterArea,k=g._glFilterTexture,m=this.renderSession.projection,b=this.renderSession.offset;if(1<g.filterPasses.length){a.viewport(0,0,h.width,h.height);
a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=h.height;this.vertexArray[2]=h.width;this.vertexArray[3]=h.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=h.width;this.vertexArray[7]=0;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=h.width/this.width;this.uvArray[5]=h.height/this.height;this.uvArray[6]=h.width/this.width;this.uvArray[7]=h.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,
0,this.uvArray);var c=this.texturePool.pop();c||(c=new e.FilterTexture(this.gl,this.width,this.height));c.resize(this.width,this.height);a.bindFramebuffer(a.FRAMEBUFFER,c.frameBuffer);a.clear(a.COLOR_BUFFER_BIT);a.disable(a.BLEND);for(var f=0;f<g.filterPasses.length-1;f++){var d=g.filterPasses[f];a.bindFramebuffer(a.FRAMEBUFFER,c.frameBuffer);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,k.texture);this.applyFilterPass(d,h,h.width,h.height);d=k;k=c;c=d}a.enable(a.BLEND);this.texturePool.push(c)}c=
g.filterPasses[g.filterPasses.length-1];this.offsetX-=h.x;this.offsetY-=h.y;var f=this.width,d=this.height,n=0,p=0,l=this.buffer;0===this.filterStack.length?a.colorMask(!0,!0,!0,!0):(l=this.filterStack[this.filterStack.length-1],h=l._filterArea,f=h.width,d=h.height,n=h.x,p=h.y,l=l._glFilterTexture.frameBuffer);m.x=f/2;m.y=-d/2;b.x=n;b.y=p;h=g._filterArea;m=h.x-n;b=h.y-p;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=m;this.vertexArray[1]=b+h.height;this.vertexArray[2]=m+h.width;
this.vertexArray[3]=b+h.height;this.vertexArray[4]=m;this.vertexArray[5]=b;this.vertexArray[6]=m+h.width;this.vertexArray[7]=b;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=h.width/this.width;this.uvArray[5]=h.height/this.height;this.uvArray[6]=h.width/this.width;this.uvArray[7]=h.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);a.viewport(0,0,f*this.renderSession.resolution,d*this.renderSession.resolution);a.bindFramebuffer(a.FRAMEBUFFER,
l);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,k.texture);this.applyFilterPass(c,h,f,d);this.texturePool.push(k);g._glFilterTexture=null};e.WebGLFilterManager.prototype.applyFilterPass=function(a,g,h,k){g=this.gl;var m=a.shaders[g.id];m||(m=new e.PixiShader(g),m.fragmentSrc=a.fragmentSrc,m.uniforms=a.uniforms,m.init(),a.shaders[g.id]=m);this.renderSession.shaderManager.setShader(m);g.uniform2f(m.projectionVector,h/2,-k/2);g.uniform2f(m.offsetVector,0,0);a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=
this.width,a.uniforms.dimensions.value[1]=this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],a.uniforms.dimensions.value[3]=this.vertexArray[5]);m.syncUniforms();g.bindBuffer(g.ARRAY_BUFFER,this.vertexBuffer);g.vertexAttribPointer(m.aVertexPosition,2,g.FLOAT,!1,0,0);g.bindBuffer(g.ARRAY_BUFFER,this.uvBuffer);g.vertexAttribPointer(m.aTextureCoord,2,g.FLOAT,!1,0,0);g.bindBuffer(g.ARRAY_BUFFER,this.colorBuffer);g.vertexAttribPointer(m.colorAttribute,2,g.FLOAT,!1,0,0);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,
this.indexBuffer);g.drawElements(g.TRIANGLES,6,g.UNSIGNED_SHORT,0);this.renderSession.drawCount++};e.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer();this.uvBuffer=a.createBuffer();this.colorBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.vertexArray=new e.Float32Array([0,0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW);this.uvArray=new e.Float32Array([0,
0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW);this.colorArray=new e.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)};e.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;
this.filterStack=null;for(var e=this.offsetY=this.offsetX=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null;a.deleteBuffer(this.vertexBuffer);a.deleteBuffer(this.uvBuffer);a.deleteBuffer(this.colorBuffer);a.deleteBuffer(this.indexBuffer)};e.FilterTexture=function(a,g,h,k){this.gl=a;this.frameBuffer=a.createFramebuffer();this.texture=a.createTexture();k=k||e.scaleModes.DEFAULT;a.bindTexture(a.TEXTURE_2D,this.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,
k===e.scaleModes.LINEAR?a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,k===e.scaleModes.LINEAR?a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer);a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);this.renderBuffer=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,
this.renderBuffer);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderBuffer);this.resize(g,h)};e.FilterTexture.prototype.constructor=e.FilterTexture;e.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT)};e.FilterTexture.prototype.resize=function(a,e){if(this.width!==a||this.height!==e){this.width=a;this.height=e;var h=this.gl;h.bindTexture(h.TEXTURE_2D,this.texture);h.texImage2D(h.TEXTURE_2D,0,h.RGBA,a,
e,0,h.RGBA,h.UNSIGNED_BYTE,null);h.bindRenderbuffer(h.RENDERBUFFER,this.renderBuffer);h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,a,e)}};e.FilterTexture.prototype.destroy=function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer);a.deleteTexture(this.texture);this.texture=this.frameBuffer=null};e.CanvasBuffer=function(a,e){this.width=a;this.height=e;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=a;this.canvas.height=e};e.CanvasBuffer.prototype.constructor=
e.CanvasBuffer;e.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};e.CanvasBuffer.prototype.resize=function(a,e){this.width=this.canvas.width=a;this.height=this.canvas.height=e};e.CanvasMaskManager=function(){};e.CanvasMaskManager.prototype.constructor=e.CanvasMaskManager;e.CanvasMaskManager.prototype.pushMask=function(a,g){var h=g.context;h.save();var k=a.alpha,m=a.worldTransform,b=g.resolution;h.setTransform(m.a*b,
m.b*b,m.c*b,m.d*b,m.tx*b,m.ty*b);e.CanvasGraphics.renderGraphicsMask(a,h);h.clip();a.worldAlpha=k};e.CanvasMaskManager.prototype.popMask=function(a){a.context.restore()};e.CanvasTinter=function(){};e.CanvasTinter.getTintedTexture=function(a,g){var h=a.texture,k=e.CanvasTinter.canvas||document.createElement("canvas");(e.CanvasTinter.tintMethod(h,g,k),e.CanvasTinter.convertTintToImage)?(new Image).src=k.toDataURL():e.CanvasTinter.canvas=null;return k};e.CanvasTinter.tintWithMultiply=function(a,e,h){var k=
h.getContext("2d"),m=a.crop;h.width=m.width;h.height=m.height;k.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6);k.fillRect(0,0,m.width,m.height);k.globalCompositeOperation="multiply";k.drawImage(a.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height);k.globalCompositeOperation="destination-atop";k.drawImage(a.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height)};e.CanvasTinter.tintWithOverlay=function(a,e,h){var k=h.getContext("2d"),m=a.crop;h.width=m.width;h.height=
m.height;k.globalCompositeOperation="copy";k.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6);k.fillRect(0,0,m.width,m.height);k.globalCompositeOperation="destination-atop";k.drawImage(a.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height)};e.CanvasTinter.tintWithPerPixel=function(a,g,h){var k=h.getContext("2d"),m=a.crop;h.width=m.width;h.height=m.height;k.globalCompositeOperation="copy";k.drawImage(a.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height);h=e.hex2rgb(g);
a=h[0];g=h[1];h=h[2];for(var m=k.getImageData(0,0,m.width,m.height),b=m.data,c=0;c<b.length;c+=4)if(b[c+0]*=a,b[c+1]*=g,b[c+2]*=h,!e.CanvasTinter.canHandleAlpha){var f=b[c+3];b[c+0]/=255/f;b[c+1]/=255/f;b[c+2]/=255/f}k.putImageData(m,0,0)};e.CanvasTinter.roundColor=function(a){var g=e.CanvasTinter.cacheStepsPerColorChannel;a=e.hex2rgb(a);return a[0]=Math.min(255,a[0]/g*g),a[1]=Math.min(255,a[1]/g*g),a[2]=Math.min(255,a[2]/g*g),e.rgb2hex(a)};e.CanvasTinter.checkInverseAlpha=function(){var a=new e.CanvasBuffer(2,
1);a.context.fillStyle="rgba(10, 20, 30, 0.5)";a.context.fillRect(0,0,1,1);var g=a.context.getImageData(0,0,1,1);a.context.putImageData(g,1,0);a=a.context.getImageData(1,0,1,1);return a.data[0]===g.data[0]&&a.data[1]===g.data[1]&&a.data[2]===g.data[2]&&a.data[3]===g.data[3]};e.CanvasTinter.cacheStepsPerColorChannel=8;e.CanvasTinter.convertTintToImage=!1;e.CanvasTinter.canHandleAlpha=e.CanvasTinter.checkInverseAlpha();e.CanvasTinter.canUseMultiply=e.canUseNewCanvasBlendModes();e.CanvasTinter.tintMethod=
e.CanvasTinter.canUseMultiply?e.CanvasTinter.tintWithMultiply:e.CanvasTinter.tintWithPerPixel;e.CanvasRenderer=function(a,g,h){if(h)for(var k in e.defaultRenderOptions)"undefined"==typeof h[k]&&(h[k]=e.defaultRenderOptions[k]);else h=e.defaultRenderOptions;e.defaultRenderer||(e.defaultRenderer=this);this.type=e.CANVAS_RENDERER;this.resolution=h.resolution;this.clearBeforeRender=h.clearBeforeRender;this.transparent=h.transparent;this.autoResize=h.autoResize||!1;this.width=a||800;this.height=g||600;
this.width*=this.resolution;this.height*=this.resolution;this.view=h.view||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.view.width=this.width*this.resolution;this.view.height=this.height*this.resolution;this.count=0;this.maskManager=new e.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1};this.mapBlendModes();this.resize(a,g);"imageSmoothingEnabled"in
this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")};e.CanvasRenderer.prototype.constructor=
e.CanvasRenderer;e.CanvasRenderer.prototype.render=function(a){a.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=e.blendModes.NORMAL;this.context.globalCompositeOperation=e.blendModesCanvas[e.blendModes.NORMAL];navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=a.backgroundColorString,
this.context.fillRect(0,0,this.width,this.height)));this.renderDisplayObject(a)};e.CanvasRenderer.prototype.destroy=function(a){"undefined"==typeof a&&(a=!0);a&&this.view.parent&&this.view.parent.removeChild(this.view);this.renderSession=this.maskManager=this.context=this.view=null};e.CanvasRenderer.prototype.resize=function(a,e){this.width=a*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+
"px",this.view.style.height=this.height/this.resolution+"px")};e.CanvasRenderer.prototype.renderDisplayObject=function(a,e){this.renderSession.context=e||this.context;this.renderSession.resolution=this.resolution;a._renderCanvas(this.renderSession)};e.CanvasRenderer.prototype.mapBlendModes=function(){e.blendModesCanvas||(e.blendModesCanvas=[],e.canUseNewCanvasBlendModes()?(e.blendModesCanvas[e.blendModes.NORMAL]="source-over",e.blendModesCanvas[e.blendModes.ADD]="lighter",e.blendModesCanvas[e.blendModes.MULTIPLY]=
"multiply",e.blendModesCanvas[e.blendModes.SCREEN]="screen",e.blendModesCanvas[e.blendModes.OVERLAY]="overlay",e.blendModesCanvas[e.blendModes.DARKEN]="darken",e.blendModesCanvas[e.blendModes.LIGHTEN]="lighten",e.blendModesCanvas[e.blendModes.COLOR_DODGE]="color-dodge",e.blendModesCanvas[e.blendModes.COLOR_BURN]="color-burn",e.blendModesCanvas[e.blendModes.HARD_LIGHT]="hard-light",e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="soft-light",e.blendModesCanvas[e.blendModes.DIFFERENCE]="difference",e.blendModesCanvas[e.blendModes.EXCLUSION]=
"exclusion",e.blendModesCanvas[e.blendModes.HUE]="hue",e.blendModesCanvas[e.blendModes.SATURATION]="saturation",e.blendModesCanvas[e.blendModes.COLOR]="color",e.blendModesCanvas[e.blendModes.LUMINOSITY]="luminosity"):(e.blendModesCanvas[e.blendModes.NORMAL]="source-over",e.blendModesCanvas[e.blendModes.ADD]="lighter",e.blendModesCanvas[e.blendModes.MULTIPLY]="source-over",e.blendModesCanvas[e.blendModes.SCREEN]="source-over",e.blendModesCanvas[e.blendModes.OVERLAY]="source-over",e.blendModesCanvas[e.blendModes.DARKEN]=
"source-over",e.blendModesCanvas[e.blendModes.LIGHTEN]="source-over",e.blendModesCanvas[e.blendModes.COLOR_DODGE]="source-over",e.blendModesCanvas[e.blendModes.COLOR_BURN]="source-over",e.blendModesCanvas[e.blendModes.HARD_LIGHT]="source-over",e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="source-over",e.blendModesCanvas[e.blendModes.DIFFERENCE]="source-over",e.blendModesCanvas[e.blendModes.EXCLUSION]="source-over",e.blendModesCanvas[e.blendModes.HUE]="source-over",e.blendModesCanvas[e.blendModes.SATURATION]=
"source-over",e.blendModesCanvas[e.blendModes.COLOR]="source-over",e.blendModesCanvas[e.blendModes.LUMINOSITY]="source-over"))};e.CanvasGraphics=function(){};e.CanvasGraphics.renderGraphics=function(a,g){var h=a.worldAlpha;a.dirty&&(this.updateGraphicsTint(a),a.dirty=!1);for(var k=0;k<a.graphicsData.length;k++){var m=a.graphicsData[k],b=m.shape,c=m._fillTint,f=m._lineTint;if(g.lineWidth=m.lineWidth,m.type===e.Graphics.POLY){g.beginPath();var d=b.points;g.moveTo(d[0],d[1]);for(var n=1;n<d.length/2;n++)g.lineTo(d[2*
n],d[2*n+1]);b.closed&&g.lineTo(d[0],d[1]);d[0]===d[d.length-2]&&d[1]===d[d.length-1]&&g.closePath();m.fill&&(g.globalAlpha=m.fillAlpha*h,g.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),g.fill());m.lineWidth&&(g.globalAlpha=m.lineAlpha*h,g.strokeStyle="#"+("00000"+(0|f).toString(16)).substr(-6),g.stroke())}else if(m.type===e.Graphics.RECT)(m.fillColor||0===m.fillColor)&&(g.globalAlpha=m.fillAlpha*h,g.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),g.fillRect(b.x,b.y,b.width,b.height)),
m.lineWidth&&(g.globalAlpha=m.lineAlpha*h,g.strokeStyle="#"+("00000"+(0|f).toString(16)).substr(-6),g.strokeRect(b.x,b.y,b.width,b.height));else if(m.type===e.Graphics.CIRC)g.beginPath(),g.arc(b.x,b.y,b.radius,0,2*Math.PI),g.closePath(),m.fill&&(g.globalAlpha=m.fillAlpha*h,g.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),g.fill()),m.lineWidth&&(g.globalAlpha=m.lineAlpha*h,g.strokeStyle="#"+("00000"+(0|f).toString(16)).substr(-6),g.stroke());else if(m.type===e.Graphics.ELIP){var p=2*b.width,
n=2*b.height,d=b.x-p/2,b=b.y-n/2;g.beginPath();var l=p/2*.5522848,v=n/2*.5522848,y=d+p,t=b+n,p=d+p/2,n=b+n/2;g.moveTo(d,n);g.bezierCurveTo(d,n-v,p-l,b,p,b);g.bezierCurveTo(p+l,b,y,n-v,y,n);g.bezierCurveTo(y,n+v,p+l,t,p,t);g.bezierCurveTo(p-l,t,d,n+v,d,n);g.closePath();m.fill&&(g.globalAlpha=m.fillAlpha*h,g.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),g.fill());m.lineWidth&&(g.globalAlpha=m.lineAlpha*h,g.strokeStyle="#"+("00000"+(0|f).toString(16)).substr(-6),g.stroke())}else m.type===e.Graphics.RREC&&
(d=b.x,n=b.y,l=b.width,v=b.height,b=b.radius,y=Math.min(l,v)/2|0,b=b>y?y:b,g.beginPath(),g.moveTo(d,n+b),g.lineTo(d,n+v-b),g.quadraticCurveTo(d,n+v,d+b,n+v),g.lineTo(d+l-b,n+v),g.quadraticCurveTo(d+l,n+v,d+l,n+v-b),g.lineTo(d+l,n+b),g.quadraticCurveTo(d+l,n,d+l-b,n),g.lineTo(d+b,n),g.quadraticCurveTo(d,n,d,n+b),g.closePath(),(m.fillColor||0===m.fillColor)&&(g.globalAlpha=m.fillAlpha*h,g.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),g.fill()),m.lineWidth&&(g.globalAlpha=m.lineAlpha*h,g.strokeStyle=
"#"+("00000"+(0|f).toString(16)).substr(-6),g.stroke()))}};e.CanvasGraphics.renderGraphicsMask=function(a,g){var h=a.graphicsData.length;if(0!==h){g.beginPath();for(var k=0;h>k;k++){var m=a.graphicsData[k],b=m.shape;if(m.type===e.Graphics.POLY){m=b.points;g.moveTo(m[0],m[1]);for(var c=1;c<m.length/2;c++)g.lineTo(m[2*c],m[2*c+1]);m[0]===m[m.length-2]&&m[1]===m[m.length-1]&&g.closePath()}else if(m.type===e.Graphics.RECT)g.rect(b.x,b.y,b.width,b.height),g.closePath();else if(m.type===e.Graphics.CIRC)g.arc(b.x,
b.y,b.radius,0,2*Math.PI),g.closePath();else if(m.type===e.Graphics.ELIP){var f=2*b.width,c=2*b.height,m=b.x-f/2,b=b.y-c/2,d=f/2*.5522848,n=c/2*.5522848,p=m+f,l=b+c,f=m+f/2,c=b+c/2;g.moveTo(m,c);g.bezierCurveTo(m,c-n,f-d,b,f,b);g.bezierCurveTo(f+d,b,p,c-n,p,c);g.bezierCurveTo(p,c+n,f+d,l,f,l);g.bezierCurveTo(f-d,l,m,c+n,m,c);g.closePath()}else m.type===e.Graphics.RREC&&(m=b.x,c=b.y,d=b.width,n=b.height,b=b.radius,p=Math.min(d,n)/2|0,b=b>p?p:b,g.moveTo(m,c+b),g.lineTo(m,c+n-b),g.quadraticCurveTo(m,
c+n,m+b,c+n),g.lineTo(m+d-b,c+n),g.quadraticCurveTo(m+d,c+n,m+d,c+n-b),g.lineTo(m+d,c+b),g.quadraticCurveTo(m+d,c,m+d-b,c),g.lineTo(m+b,c),g.quadraticCurveTo(m,c,m,c+b),g.closePath())}}};e.CanvasGraphics.updateGraphicsTint=function(a){if(16777215!==a.tint)for(var e=(a.tint>>16&255)/255,h=(a.tint>>8&255)/255,k=(255&a.tint)/255,m=0;m<a.graphicsData.length;m++){var b=a.graphicsData[m],c=0|b.fillColor,f=0|b.lineColor;b._fillTint=((c>>16&255)/255*e*255<<16)+((c>>8&255)/255*h*255<<8)+(255&c)/255*k*255;
b._lineTint=((f>>16&255)/255*e*255<<16)+((f>>8&255)/255*h*255<<8)+(255&f)/255*k*255}};e.Graphics=function(){e.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineColor=this.lineWidth=0;this.graphicsData=[];this.tint=16777215;this.blendMode=e.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=!1;this.boundsPadding=0;this._localBounds=new e.Rectangle(0,0,1,1);this.dirty=!0;this.cachedSpriteDirty=this.webGLDirty=!1};e.Graphics.prototype=Object.create(e.DisplayObjectContainer.prototype);
e.Graphics.prototype.constructor=e.Graphics;e.Graphics.prototype.lineStyle=function(a,g,h){return this.lineWidth=a||0,this.lineColor=g||0,this.lineAlpha=void 0===h?1:h,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new e.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this};e.Graphics.prototype.moveTo=function(a,g){return this.drawShape(new e.Polygon([a,
g])),this};e.Graphics.prototype.lineTo=function(a,e){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(a,e),this.dirty=!0,this};e.Graphics.prototype.quadraticCurveTo=function(a,e,h,k){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var m,b,c=this.currentPath.shape.points;0===c.length&&this.moveTo(0,0);for(var f=c[c.length-2],d=c[c.length-1],n=0,p=1;20>=p;++p)n=p/20,m=f+(a-f)*n,b=d+(e-d)*n,c.push(m+(a+(h-a)*
n-m)*n,b+(e+(k-e)*n-b)*n);return this.dirty=!0,this};e.Graphics.prototype.bezierCurveTo=function(a,e,h,k,m,b){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var c,f,d,n,p,l=this.currentPath.shape.points,v=l[l.length-2],y=l[l.length-1],t=0,q=1;20>=q;++q)t=q/20,c=1-t,f=c*c,d=f*c,n=t*t,p=n*t,l.push(d*v+3*f*t*a+3*c*n*h+p*m,d*y+3*f*t*e+3*c*n*k+p*b);return this.dirty=!0,this};e.Graphics.prototype.arcTo=function(a,e,h,k,m){this.currentPath?
0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(a,e):this.moveTo(a,e);var b=this.currentPath.shape.points,c=b[b.length-1]-e,f=b[b.length-2]-a;k-=e;h-=a;var d=Math.abs(c*h-f*k);if(1E-8>d||0===m)b[b.length-2]===a&&b[b.length-1]===e||b.push(a,e);else{var n=c*c+f*f,p=k*k+h*h,l=c*k+f*h,b=m*Math.sqrt(n)/d,d=m*Math.sqrt(p)/d,n=b*l/n,v=d*l/p,p=b*h+d*f,l=b*k+d*c,y=h*(b+v),b=k*(b+v),d=Math.atan2(c*(d+n)-l,f*(d+n)-p),b=Math.atan2(b-l,y-p);this.arc(p+a,l+e,m,d,b,f*k>h*c)}return this.dirty=
!0,this};e.Graphics.prototype.arc=function(a,e,h,k,m,b){if(k===m)return this;"undefined"==typeof b&&(b=!1);!b&&k>=m?m+=2*Math.PI:b&&m>=k&&(k+=2*Math.PI);m=b?-1*(k-m):m-k;var c=40*Math.ceil(Math.abs(m)/(2*Math.PI));if(0===m)return this;var f=a+Math.cos(k)*h,d=e+Math.sin(k)*h;b&&this.filling?this.moveTo(a,e):this.moveTo(f,d);b=this.currentPath.shape.points;m/=2*c;for(var f=2*m,d=Math.cos(m),n=Math.sin(m),c=c-1,p=c%1/c,l=0;c>=l;l++){var v=m+k+f*(l+p*l),y=Math.cos(v),v=-Math.sin(v);b.push((d*y+n*v)*h+
a,(d*-v+n*y)*h+e)}return this.dirty=!0,this};e.Graphics.prototype.beginFill=function(a,e){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&2>=this.currentPath.shape.points.length&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this};e.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this};e.Graphics.prototype.drawRect=function(a,g,h,k){return this.drawShape(new e.Rectangle(a,
g,h,k)),this};e.Graphics.prototype.drawRoundedRect=function(a,g,h,k,m){return this.drawShape(new e.RoundedRectangle(a,g,h,k,m)),this};e.Graphics.prototype.drawCircle=function(a,g,h){return this.drawShape(new e.Circle(a,g,h)),this};e.Graphics.prototype.drawEllipse=function(a,g,h,k){return this.drawShape(new e.Ellipse(a,g,h,k)),this};e.Graphics.prototype.drawPolygon=function(a){var e=a;if(!Array.isArray(e))for(var e=Array(arguments.length),h=0;h<e.length;++h)e[h]=arguments[h];return this.drawShape(new Phaser.Polygon(e)),
this};e.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this};e.Graphics.prototype.generateTexture=function(a,g){a=a||1;var h=this.getBounds(),k=new e.CanvasBuffer(h.width*a,h.height*a),m=e.Texture.fromCanvas(k.canvas,g);return m.baseTexture.resolution=a,k.context.scale(a,a),k.context.translate(-h.x,-h.y),e.CanvasGraphics.renderGraphics(this,k.context),m};e.Graphics.prototype._renderWebGL=function(a){if(!1!==this.visible&&
0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void e.Sprite.prototype._renderWebGL.call(this._cachedSprite,a);if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==
a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var g=e.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(g[0],g[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),e.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(g=0;g<this.children.length;g++)this.children[g]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(this.mask,a);a.drawCount++;
a.spriteBatch.start()}};e.Graphics.prototype._renderCanvas=function(a){if(!0!==this.isMask){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void e.Sprite.prototype._renderCanvas.call(this._cachedSprite,a);var g=a.context,h=this.worldTransform;this.blendMode!==a.currentBlendMode&&
(a.currentBlendMode=this.blendMode,g.globalCompositeOperation=e.blendModesCanvas[a.currentBlendMode]);this._mask&&a.maskManager.pushMask(this._mask,a);var k=a.resolution;g.setTransform(h.a*k,h.b*k,h.c*k,h.d*k,h.tx*k,h.ty*k);e.CanvasGraphics.renderGraphics(this,g);for(g=0;g<this.children.length;g++)this.children[g]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}};e.Graphics.prototype.getBounds=function(a){if(!this._currentBounds){if(!this.renderable)return e.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),
this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var g=this._localBounds,h=g.x,k=g.width+g.x,m=g.y,b=g.height+g.y;a=a||this.worldTransform;var c=a.a,f=a.b,d=a.c,n=a.d,p=a.tx,l=a.ty,v=c*k+d*b+p,g=n*b+f*k+l;a=c*h+d*b+p;var b=n*b+f*h+l,y=c*h+d*m+p,h=n*m+f*h+l,c=c*k+d*m+p,k=n*m+f*k+l,m=v,f=g,v=v>a?a:v,v=v>y?y:v,v=v>c?c:v,g=g>b?b:g,g=g>h?h:g,g=g>k?k:g,m=a>m?a:m,m=y>m?y:m,f=b>f?b:f,f=h>f?h:f;this._bounds.x=v;this._bounds.width=(c>m?c:m)-v;this._bounds.y=g;this._bounds.height=(k>f?k:f)-g;this._currentBounds=
this._bounds}return this._currentBounds};e.Graphics.prototype.containsPoint=function(a){this.worldTransform.applyInverse(a,tempPoint);a=this.graphicsData;for(var e=0;e<a.length;e++){var h=a[e];if(h.fill&&h.shape&&h.shape.contains(tempPoint.x,tempPoint.y))return!0}return!1};e.Graphics.prototype.updateLocalBounds=function(){var a=1/0,g=-1/0,h=1/0,k=-1/0;if(this.graphicsData.length)for(var m,b,c,f,d,n=0;n<this.graphicsData.length;n++)if(m=this.graphicsData[n],f=m.type,d=m.lineWidth,m=m.shape,f===e.Graphics.RECT||
f===e.Graphics.RREC)b=m.x-d/2,c=m.y-d/2,f=m.width+d,d=m.height+d,a=a>b?b:a,g=b+f>g?b+f:g,h=h>c?c:h,k=c+d>k?c+d:k;else if(f===e.Graphics.CIRC)b=m.x,c=m.y,f=m.radius+d/2,d=m.radius+d/2,a=a>b-f?b-f:a,g=b+f>g?b+f:g,h=h>c-d?c-d:h,k=c+d>k?c+d:k;else if(f===e.Graphics.ELIP)b=m.x,c=m.y,f=m.width+d/2,d=m.height+d/2,a=a>b-f?b-f:a,g=b+f>g?b+f:g,h=h>c-d?c-d:h,k=c+d>k?c+d:k;else for(m=m.points,f=0;f<m.length;f++)m[f]instanceof Phaser.Point?(b=m[f].x,c=m[f].y):(b=m[f],c=m[f+1],f<m.length-1&&f++),a=a>b-d?b-d:a,
g=b+d>g?b+d:g,h=h>c-d?c-d:h,k=c+d>k?c+d:k;else k=h=g=a=0;b=this.boundsPadding;this._localBounds.x=a-b;this._localBounds.width=g-a+2*b;this._localBounds.y=h-b;this._localBounds.height=k-h+2*b};e.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var g=new e.CanvasBuffer(a.width,a.height),h=e.Texture.fromCanvas(g.canvas);this._cachedSprite=new e.Sprite(h);this._cachedSprite.buffer=g;this._cachedSprite.worldTransform=
this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._cachedSprite.buffer.context.translate(-a.x,-a.y);this.worldAlpha=1;e.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};e.Graphics.prototype.updateCachedSpriteTexture=function(){var a=this._cachedSprite,e=a.texture,h=a.buffer.canvas;e.baseTexture.width=h.width;e.baseTexture.height=h.height;e.crop.width=e.frame.width=h.width;e.crop.height=
e.frame.height=h.height;a._width=h.width;a._height=h.height;e.baseTexture.dirty()};e.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};e.Graphics.prototype.drawShape=function(a){this.currentPath&&2>=this.currentPath.shape.points.length&&this.graphicsData.pop();this.currentPath=null;a instanceof e.Polygon&&a.flatten();a=new e.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,a);return this.graphicsData.push(a),
a.type===e.Graphics.POLY&&(a.shape.closed=this.filling,this.currentPath=a),this.dirty=!0,a};Object.defineProperty(e.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){(this._cacheAsBitmap=a)?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}});e.GraphicsData=function(a,e,h,k,m,b,c){this.lineWidth=a;this.lineColor=e;this.lineAlpha=h;this._lineTint=e;this.fillColor=k;this.fillAlpha=m;this._fillTint=k;this.fill=b;this.shape=c;this.type=
c.type};e.GraphicsData.prototype.constructor=e.GraphicsData;e.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};e.Strip=function(a){e.DisplayObjectContainer.call(this);this.texture=a;this.uvs=new e.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new e.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new e.Float32Array([1,1,1,1]);this.indices=new e.Uint16Array([0,1,2,3]);this.dirty=!0;this.blendMode=
e.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=e.Strip.DrawModes.TRIANGLE_STRIP};e.Strip.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Strip.prototype.constructor=e.Strip;e.Strip.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||(a.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(a),a.shaderManager.setShader(a.shaderManager.stripShader),this._renderStrip(a),a.spriteBatch.start())};e.Strip.prototype._initWebGL=function(a){a=a.gl;this._vertexBuffer=a.createBuffer();
this._indexBuffer=a.createBuffer();this._uvBuffer=a.createBuffer();this._colorBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvs,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colors,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,
a.STATIC_DRAW)};e.Strip.prototype._renderStrip=function(a){var g=a.gl,h=a.projection,k=a.offset,m=a.shaderManager.stripShader,b=this.drawMode===e.Strip.DrawModes.TRIANGLE_STRIP?g.TRIANGLE_STRIP:g.TRIANGLES;a.blendModeManager.setBlendMode(this.blendMode);g.uniformMatrix3fv(m.translationMatrix,!1,this.worldTransform.toArray(!0));g.uniform2f(m.projectionVector,h.x,-h.y);g.uniform2f(m.offsetVector,-k.x,-k.y);g.uniform1f(m.alpha,this.worldAlpha);this.dirty?(this.dirty=!1,g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer),
g.bufferData(g.ARRAY_BUFFER,this.vertices,g.STATIC_DRAW),g.vertexAttribPointer(m.aVertexPosition,2,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,this._uvBuffer),g.bufferData(g.ARRAY_BUFFER,this.uvs,g.STATIC_DRAW),g.vertexAttribPointer(m.aTextureCoord,2,g.FLOAT,!1,0,0),g.activeTexture(g.TEXTURE0),this.texture.baseTexture._dirty[g.id]?a.renderer.updateTexture(this.texture.baseTexture):g.bindTexture(g.TEXTURE_2D,this.texture.baseTexture._glTextures[g.id]),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBuffer),
g.bufferData(g.ELEMENT_ARRAY_BUFFER,this.indices,g.STATIC_DRAW)):(g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer),g.bufferSubData(g.ARRAY_BUFFER,0,this.vertices),g.vertexAttribPointer(m.aVertexPosition,2,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,this._uvBuffer),g.vertexAttribPointer(m.aTextureCoord,2,g.FLOAT,!1,0,0),g.activeTexture(g.TEXTURE0),this.texture.baseTexture._dirty[g.id]?a.renderer.updateTexture(this.texture.baseTexture):g.bindTexture(g.TEXTURE_2D,this.texture.baseTexture._glTextures[g.id]),
g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBuffer));g.drawElements(b,this.indices.length,g.UNSIGNED_SHORT,0)};e.Strip.prototype._renderCanvas=function(a){var g=a.context,h=this.worldTransform;a.roundPixels?g.setTransform(h.a,h.b,h.c,h.d,0|h.tx,0|h.ty):g.setTransform(h.a,h.b,h.c,h.d,h.tx,h.ty);this.drawMode===e.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(g):this._renderCanvasTriangles(g)};e.Strip.prototype._renderCanvasTriangleStrip=function(a){var e=this.vertices,h=this.uvs,
k=e.length/2;this.count++;for(var m=0;k-2>m;m++){var b=2*m;this._renderCanvasDrawTriangle(a,e,h,b,b+2,b+4)}};e.Strip.prototype._renderCanvasTriangles=function(a){var e=this.vertices,h=this.uvs,k=this.indices,m=k.length;this.count++;for(var b=0;m>b;b+=3)this._renderCanvasDrawTriangle(a,e,h,2*k[b],2*k[b+1],2*k[b+2])};e.Strip.prototype._renderCanvasDrawTriangle=function(a,e,h,k,m,b){var c=this.texture.baseTexture.source,f=this.texture.width,d=this.texture.height,n=e[k],p=e[m],l=e[b],v=e[k+1],y=e[m+1];
e=e[b+1];var t=h[k]*f,q=h[m]*f,f=h[b]*f;k=h[k+1]*d;m=h[m+1]*d;h=h[b+1]*d;if(0<this.canvasPadding){b=this.canvasPadding/this.worldTransform.a;var d=this.canvasPadding/this.worldTransform.d,u=(n+p+l)/3,z=(v+y+e)/3,x=n-u,r=v-z,w=Math.sqrt(x*x+r*r),n=u+x/w*(w+b),v=z+r/w*(w+d),x=p-u,r=y-z,w=Math.sqrt(x*x+r*r),p=u+x/w*(w+b),y=z+r/w*(w+d),x=l-u,r=e-z,w=Math.sqrt(x*x+r*r),l=u+x/w*(w+b);e=z+r/w*(w+d)}a.save();a.beginPath();a.moveTo(n,v);a.lineTo(p,y);a.lineTo(l,e);a.closePath();a.clip();b=t*m+k*f+q*h-m*f-
k*q-t*h;a.transform((n*m+k*l+p*h-m*l-k*p-n*h)/b,(v*m+k*e+y*h-m*e-k*y-v*h)/b,(t*p+n*f+q*l-p*f-n*q-t*l)/b,(t*y+v*f+q*e-y*f-v*q-t*e)/b,(t*m*l+k*p*f+n*q*h-n*m*f-k*q*l-t*p*h)/b,(t*m*e+k*y*f+v*q*h-v*m*f-k*q*e-t*y*h)/b);a.drawImage(c,0,0);a.restore()};e.Strip.prototype.renderStripFlat=function(a){var e=this.context;a=a.vertices;var h=a.length/2;this.count++;e.beginPath();for(var k=1;h-2>k;k++){var m=2*k,b=a[m+2],c=a[m+4],f=a[m+3],d=a[m+5];e.moveTo(a[m],a[m+1]);e.lineTo(b,f);e.lineTo(c,d)}e.fillStyle="#FF0000";
e.fill();e.closePath()};e.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0};e.Strip.prototype.getBounds=function(a){var g=a||this.worldTransform;a=g.a;for(var h=g.b,k=g.c,m=g.d,b=g.tx,c=g.ty,g=-1/0,f=-1/0,d=1/0,n=1/0,p=this.vertices,l=0,v=p.length;v>l;l+=2)var y=p[l],t=p[l+1],q=a*y+k*t+b,y=m*t+h*y+c,d=d>q?q:d,n=n>y?y:n,g=q>g?q:g,f=y>f?y:f;if(d===-1/0||1/0===f)return e.EmptyRectangle;a=this._bounds;return a.x=d,a.width=g-d,a.y=n,a.height=f-n,this._currentBounds=a,a};e.Strip.DrawModes=
{TRIANGLE_STRIP:0,TRIANGLES:1};e.Rope=function(a,g){e.Strip.call(this,a);this.points=g;this.vertices=new e.Float32Array(4*g.length);this.uvs=new e.Float32Array(4*g.length);this.colors=new e.Float32Array(2*g.length);this.indices=new e.Uint16Array(2*g.length);this.refresh()};e.Rope.prototype=Object.create(e.Strip.prototype);e.Rope.prototype.constructor=e.Rope;e.Rope.prototype.refresh=function(){var a=this.points;if(!(1>a.length)){var e=this.uvs,h=this.indices,k=this.colors;this.count-=.2;e[0]=0;e[1]=
0;e[2]=0;e[3]=1;k[0]=1;k[1]=1;h[0]=0;h[1]=1;for(var m,b=a.length,c=1;b>c;c++)a=4*c,m=c/(b-1),e[a]=m,e[a+1]=0,e[a+2]=m,e[a+3]=1,a=2*c,k[a]=1,k[a+1]=1,a=2*c,h[a]=a,h[a+1]=a+1}};e.Rope.prototype.updateTransform=function(){var a=this.points;if(!(1>a.length)){var g,h=a[0],k=g=0;this.count-=.2;for(var m,b,c,f=this.vertices,d=a.length,n=0;d>n;n++)m=a[n],b=4*n,g=n<a.length-1?a[n+1]:m,k=-(g.x-h.x),g=g.y-h.y,h=Math.sqrt(g*g+k*k),c=this.texture.height/2,g/=h,k/=h,g*=c,k*=c,f[b]=m.x+g,f[b+1]=m.y+k,f[b+2]=m.x-
g,f[b+3]=m.y-k,h=m;e.DisplayObjectContainer.prototype.updateTransform.call(this)}};e.Rope.prototype.setTexture=function(a){this.texture=a};e.TilingSprite=function(a,g,h){e.Sprite.call(this,a);this._width=g||100;this._height=h||100;this.tileScale=new e.Point(1,1);this.tileScaleOffset=new e.Point(1,1);this.tilePosition=new e.Point(0,0);this.renderable=!0;this.tint=16777215;this.blendMode=e.blendModes.NORMAL};e.TilingSprite.prototype=Object.create(e.Sprite.prototype);e.TilingSprite.prototype.constructor=
e.TilingSprite;Object.defineProperty(e.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}});Object.defineProperty(e.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}});e.TilingSprite.prototype.setTexture=function(a){this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215)};e.TilingSprite.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha){var e,h;this._mask&&
(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start());this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock));!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(a.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)):a.spriteBatch.renderTilingSprite(this);e=0;for(h=this.children.length;h>e;e++)this.children[e]._renderWebGL(a);a.spriteBatch.stop();
this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(this._mask,a);a.spriteBatch.start()}};e.TilingSprite.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){var g=a.context;this._mask&&a.maskManager.pushMask(this._mask,a);g.globalAlpha=this.worldAlpha;var h;h=this.worldTransform;var k=a.resolution;if(g.setTransform(h.a*k,h.b*k,h.c*k,h.d*k,h.tx*k,h.ty*k),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;
this.__tilePattern=g.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,g.globalCompositeOperation=e.blendModesCanvas[a.currentBlendMode]);h=this.tilePosition;k=this.tileScale;h.x%=this.tilingTexture.baseTexture.width;h.y%=this.tilingTexture.baseTexture.height;g.scale(k.x,k.y);g.translate(h.x+this.anchor.x*-this._width,h.y+this.anchor.y*-this._height);g.fillStyle=this.__tilePattern;g.fillRect(-h.x,-h.y,this._width/
k.x,this._height/k.y);g.scale(1/k.x,1/k.y);g.translate(-h.x+this.anchor.x*this._width,-h.y+this.anchor.y*this._height);this._mask&&a.maskManager.popMask(a);g=0;for(h=this.children.length;h>g;g++)this.children[g]._renderCanvas(a)}};e.TilingSprite.prototype.getBounds=function(){var a=this._width,e=this._height,h=a*(1-this.anchor.x),k=a*-this.anchor.x,m=e*(1-this.anchor.y),b=e*-this.anchor.y,e=this.worldTransform,c=e.a,f=e.b,d=e.c,n=e.d,p=e.tx,l=e.ty,e=c*k+d*b+p,a=n*b+f*k+l,v=c*h+d*b+p,b=n*b+f*h+l,y=
c*h+d*m+p,h=n*m+f*h+l,c=c*k+d*m+p,k=n*m+f*k+l,m=-1/0,f=-1/0,n=1/0,d=1/0,n=n>e?e:n,n=n>v?v:n,n=n>y?y:n,n=n>c?c:n,d=d>a?a:d,d=d>b?b:d,d=d>h?h:d,d=d>k?k:d,m=e>m?e:m,m=v>m?v:m,m=y>m?y:m,f=a>f?a:f,f=b>f?b:f,f=h>f?h:f,e=this._bounds;return e.x=n,e.width=(c>m?c:m)-n,e.y=d,e.height=(k>f?k:f)-d,this._currentBounds=e,e};e.TilingSprite.prototype.onTextureUpdate=function(){};e.TilingSprite.prototype.generateTilingTexture=function(a){if(this.texture.baseTexture.hasLoaded){var g,h,k=this.originalTexture||this.texture,
m=k.frame,b=m.width!==k.baseTexture.width||m.height!==k.baseTexture.height,c=!1;if(a?(k.crop?(g=e.getNextPowerOfTwo(k.crop.width),h=e.getNextPowerOfTwo(k.crop.height)):(g=e.getNextPowerOfTwo(m.width),h=e.getNextPowerOfTwo(m.height)),c=!0):b&&(k.crop?(g=k.crop.width,h=k.crop.height):(g=m.width,h=m.height),c=!0),c){var f;this.tilingTexture&&this.tilingTexture.isTiling?(f=this.tilingTexture.canvasBuffer,f.resize(g,h),this.tilingTexture.baseTexture.width=g,this.tilingTexture.baseTexture.height=h,this.tilingTexture.needsUpdate=
!0):(f=new e.CanvasBuffer(g,h),this.tilingTexture=e.Texture.fromCanvas(f.canvas),this.tilingTexture.canvasBuffer=f,this.tilingTexture.isTiling=!0);f.context.drawImage(k.baseTexture.source,k.crop.x,k.crop.y,k.crop.width,k.crop.height,0,0,g,h);this.tileScaleOffset.x=m.width/g;this.tileScaleOffset.y=m.height/h}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=k;this.refreshTexture=!1;this.originalTexture=
this.texture;this.texture=this.tilingTexture;this.tilingTexture.baseTexture._powerOf2=!0}};e.TilingSprite.prototype.destroy=function(){e.Sprite.prototype.destroy.call(this);this.tilePosition=this.tileScaleOffset=this.tileScale=null;this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)};e.BaseTextureCache={};e.BaseTextureCacheIdGenerator=0;e.BaseTexture=function(a,g){this.resolution=1;this.height=this.width=100;this.scaleMode=g||e.scaleModes.DEFAULT;this.hasLoaded=!1;this.source=
a;this._UID=e._UID++;this.premultipliedAlpha=!0;this._glTextures=[];this.mipmap=!1;this._dirty=[!0,!0,!0,!0];a&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.imageUrl=null,this._powerOf2=!1)};e.BaseTexture.prototype.constructor=e.BaseTexture;e.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete e.BaseTextureCache[this.imageUrl],
delete e.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete e.BaseTextureCache[this.source._pixiId];this.source=null;this.unloadFromGPU()};e.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1;this.source.src=null;this.source.src=a};e.BaseTexture.prototype.dirty=function(){for(var a=0;a<this._glTextures.length;a++)this._dirty[a]=!0};e.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var a=
this._glTextures.length-1;0<=a;a--){var g=this._glTextures[a],h=e.glContexts[a];h&&g&&h.deleteTexture(g)}this._glTextures.length=0;this.dirty()};e.BaseTexture.fromImage=function(a,g,h){var k=e.BaseTextureCache[a];(void 0===g&&-1===a.indexOf("data:")&&(g=!0),k)||(k=new Image,g&&(k.crossOrigin=""),k.src=a,k=new e.BaseTexture(k,h),k.imageUrl=a,e.BaseTextureCache[a]=k,-1!==a.indexOf(e.RETINA_PREFIX+".")&&(k.resolution=2));return k};e.BaseTexture.fromCanvas=function(a,g){a._pixiId||(a._pixiId="canvas_"+
e.TextureCacheIdGenerator++);var h=e.BaseTextureCache[a._pixiId];return h||(h=new e.BaseTexture(a,g),e.BaseTextureCache[a._pixiId]=h),h};e.TextureCache={};e.FrameCache={};e.TextureSilentFail=!1;e.TextureCacheIdGenerator=0;e.Texture=function(a,g,h,k){this.noFrame=!1;g||(this.noFrame=!0,g=new e.Rectangle(0,0,1,1));a instanceof e.Texture&&(a=a.baseTexture);this.baseTexture=a;this.frame=g;this.trim=k;this.requiresUpdate=this.valid=!1;this._uvs=null;this.height=this.width=0;this.crop=h||new e.Rectangle(0,
0,1,1);a.hasLoaded&&(this.noFrame&&(g=new e.Rectangle(0,0,a.width,a.height)),this.setFrame(g))};e.Texture.prototype.constructor=e.Texture;e.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;this.noFrame&&(this.frame=new e.Rectangle(0,0,a.width,a.height));this.setFrame(this.frame)};e.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy();this.valid=!1};e.Texture.prototype.setFrame=function(a){if(this.noFrame=!1,this.frame=a,this.width=a.width,this.height=a.height,
this.crop.x=a.x,this.crop.y=a.y,this.crop.width=a.width,this.crop.height=a.height,!this.trim&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height)){if(!e.TextureSilentFail)throw Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);return void(this.valid=!1)}this.valid=a&&a.width&&a.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=
this.trim.height);this.valid&&this._updateUvs()};e.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new e.TextureUvs);var a=this.crop,g=this.baseTexture.width,h=this.baseTexture.height;this._uvs.x0=a.x/g;this._uvs.y0=a.y/h;this._uvs.x1=(a.x+a.width)/g;this._uvs.y1=a.y/h;this._uvs.x2=(a.x+a.width)/g;this._uvs.y2=(a.y+a.height)/h;this._uvs.x3=a.x/g;this._uvs.y3=(a.y+a.height)/h};e.Texture.fromImage=function(a,g,h){var k=e.TextureCache[a];return k||(k=new e.Texture(e.BaseTexture.fromImage(a,
g,h)),e.TextureCache[a]=k),k};e.Texture.fromFrame=function(a){var g=e.TextureCache[a];if(!g)throw Error('The frameId "'+a+'" does not exist in the texture cache ');return g};e.Texture.fromCanvas=function(a,g){var h=e.BaseTexture.fromCanvas(a,g);return new e.Texture(h)};e.Texture.addTextureToCache=function(a,g){e.TextureCache[g]=a};e.Texture.removeTextureFromCache=function(a){var g=e.TextureCache[a];return delete e.TextureCache[a],delete e.BaseTextureCache[a],g};e.TextureUvs=function(){this.y3=this.x3=
this.y2=this.x2=this.y1=this.x1=this.y0=this.x0=0};e.RenderTexture=function(a,g,h,k,m){(this.width=a||100,this.height=g||100,this.resolution=m||1,this.frame=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new e.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=
this.resolution,this.baseTexture.scaleMode=k||e.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,e.Texture.call(this,this.baseTexture,new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=h||e.defaultRenderer,this.renderer.type===e.WEBGL_RENDERER)?(a=this.renderer.gl,this.baseTexture._dirty[a.id]=!1,this.textureBuffer=new e.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[a.id]=this.textureBuffer.texture,this.render=
this.renderWebGL,this.projection=new e.Point(.5*this.width,.5*-this.height)):(this.render=this.renderCanvas,this.textureBuffer=new e.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas);this.valid=!0;this._updateUvs()};e.RenderTexture.prototype=Object.create(e.Texture.prototype);e.RenderTexture.prototype.constructor=e.RenderTexture;e.RenderTexture.prototype.resize=function(a,g,h){(a!==this.width||g!==this.height)&&(this.valid=0<a&&
0<g,this.width=a,this.height=g,this.frame.width=this.crop.width=a*this.resolution,this.frame.height=this.crop.height=g*this.resolution,h&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===e.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))};e.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===e.WEBGL_RENDERER&&
this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())};e.RenderTexture.prototype.renderWebGL=function(a,e,h){if(this.valid){var k=a.worldTransform;k.identity();k.translate(0,2*this.projection.y);e&&k.append(e);k.scale(1,-1);a.worldAlpha=1;e=a.children;for(var k=0,m=e.length;m>k;k++)e[k].updateTransform();e=this.renderer.gl;e.viewport(0,0,this.width*this.resolution,this.height*this.resolution);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer);
h&&this.textureBuffer.clear();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer);this.renderer.spriteBatch.dirty=!0}};e.RenderTexture.prototype.renderCanvas=function(a,e,h){if(this.valid){var k=a.worldTransform;k.identity();e&&k.append(e);a.worldAlpha=1;e=a.children;for(var k=0,m=e.length;m>k;k++)e[k].updateTransform();h&&this.textureBuffer.clear();h=this.textureBuffer.context;e=this.renderer.resolution;this.renderer.resolution=this.resolution;
this.renderer.renderDisplayObject(a,h);this.renderer.resolution=e}};e.RenderTexture.prototype.getImage=function(){var a=new Image;return a.src=this.getBase64(),a};e.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};e.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===e.WEBGL_RENDERER){var a=this.renderer.gl,g=this.textureBuffer.width,h=this.textureBuffer.height,k=new Uint8Array(4*g*h);a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer);
a.readPixels(0,0,g,h,a.RGBA,a.UNSIGNED_BYTE,k);a.bindFramebuffer(a.FRAMEBUFFER,null);a=new e.CanvasBuffer(g,h);g=a.context.getImageData(0,0,g,h);return g.data.set(k),a.context.putImageData(g,0,0),a.canvas}return this.textureBuffer.canvas};e.AbstractFilter=function(a,e){this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms=e||{};this.fragmentSrc=a||[]};e.AbstractFilter.prototype.constructor=e.AbstractFilter;e.AbstractFilter.prototype.syncUniforms=function(){for(var a=0,e=this.shaders.length;e>
a;a++)this.shaders[a].dirty=!0};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.PIXI=e):"undefined"!=typeof define&&define.amd?define("PIXI",this.PIXI=e):this.PIXI=e}).call(this);
(function(){function e(b,c){this._scaleFactor=b;this._deltaMode=c;this.originalEvent=null}var a=a||{VERSION:"2.3.0",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,
blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};if(Math.trunc||(Math.trunc=function(b){return 0>b?Math.ceil(b):Math.floor(b)}),Function.prototype.bind||(Function.prototype.bind=function(){var b=Array.prototype.slice;return function(c){function a(){var e=n.concat(b.call(arguments));d.apply(this instanceof
a?this:c,e)}var d=this,n=b.call(arguments,1);if("function"!=typeof d)throw new TypeError;return a.prototype=function l(b){return b&&(l.prototype=b),this instanceof l?void 0:new l}(d.prototype),a}}()),Array.isArray||(Array.isArray=function(b){return"[object Array]"==Object.prototype.toString.call(b)}),Array.prototype.forEach||(Array.prototype.forEach=function(b){if(void 0===this||null===this)throw new TypeError;var c=Object(this),a=c.length>>>0;if("function"!=typeof b)throw new TypeError;for(var d=
2<=arguments.length?arguments[1]:void 0,n=0;a>n;n++)n in c&&b.call(d,c[n],n,c)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array){var g=function(b){window[b]=function(b){if("number"==typeof b){Array.call(this,b);this.length=b;for(var a=0;a<this.length;a++)this[a]=0}else for(Array.call(this,b.length),this.length=b.length,a=0;a<this.length;a++)this[a]=b[a]};window[b].prototype=[];window[b].constructor=window[b]};g("Uint32Array");g("Int16Array")}window.console||(window.console=
{},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){});a.Utils={getProperty:function(b,c){for(var a=c.split("."),d=a.pop(),n=a.length,e=1,l=a[0];n>e&&(b=b[l]);)l=a[e],e++;return b?b[d]:null},setProperty:function(b,c,a){c=c.split(".");for(var d=c.pop(),n=c.length,e=1,l=c[0];n>e&&(b=b[l]);)l=c[e],e++;return b&&(b[d]=a),b},chanceRoll:function(b){return"undefined"==typeof b&&(b=50),0<b&&100*Math.random()<=b},randomChoice:function(b,c){return.5>
Math.random()?b:c},transposeArray:function(b){return a.ArrayUtils.transposeMatrix(b)},rotateArray:function(b,c){return a.ArrayUtils.rotateMatrix(b,c)},shuffle:function(b){return a.ArrayUtils.shuffle(b)},parseDimension:function(b,c){var a=0,d=0;return"string"==typeof b?"%"===b.substr(-1)?(a=parseInt(b,10)/100,d=0===c?window.innerWidth*a:window.innerHeight*a):d=parseInt(b,10):d=b,d},pad:function(b,c,a,d){"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a=" ");"undefined"==typeof d&&(d=3);var n=
0;if(c+1>=b.length)switch(d){case 1:b=Array(c+1-b.length).join(a)+b;break;case 3:c=Math.ceil((n=c-b.length)/2);b=Array(n-c+1).join(a)+b+Array(c+1).join(a);break;default:b+=Array(c+1-b.length).join(a)}return b},isPlainObject:function(b){if("object"!=typeof b||b.nodeType||b===b.window)return!1;try{if(b.constructor&&!{}.hasOwnProperty.call(b.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}return!0},extend:function(){var b,c,f,d,n,e,l=arguments[0]||{},g=1,h=arguments.length,k=!1;"boolean"==
typeof l&&(k=l,l=arguments[1]||{},g=2);for(h===g&&(l=this,--g);h>g;g++)if(null!=(b=arguments[g]))for(c in b)f=l[c],d=b[c],l!==d&&(k&&d&&(a.Utils.isPlainObject(d)||(n=Array.isArray(d)))?(n?(n=!1,e=f&&Array.isArray(f)?f:[]):e=f&&a.Utils.isPlainObject(f)?f:{},l[c]=a.Utils.extend(k,e,d)):void 0!==d&&(l[c]=d));return l},mixinPrototype:function(b,c,a){"undefined"==typeof a&&(a=!1);for(var d=Object.keys(c),n=0;n<d.length;n++){var e=d[n],l=c[e];!a&&e in b||(!l||"function"!=typeof l.get&&"function"!=typeof l.set?
b[e]=l:"function"==typeof l.clone?b[e]=l.clone():Object.defineProperty(b,e,l))}},mixin:function(b,c){if(!b||"object"!=typeof b)return c;for(var f in b){var d=b[f];if(!d.childNodes&&!d.cloneNode){var n=typeof b[f];c[f]=b[f]&&"object"===n?typeof c[f]===n?a.Utils.mixin(b[f],c[f]):a.Utils.mixin(b[f],new d.constructor):b[f]}}return c}};a.Circle=function(b,c,f){f=f||0;this.x=b||0;this.y=c||0;this._diameter=f;this._radius=0;0<f&&(this._radius=.5*f);this.type=a.CIRCLE};a.Circle.prototype={circumference:function(){return 2*
Math.PI*this._radius},getBounds:function(){return new a.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(b,c,a){return this.x=b,this.y=c,this._diameter=a,this._radius=.5*a,this},copyFrom:function(b){return this.setTo(b.x,b.y,b.diameter)},copyTo:function(b){return b.x=this.x,b.y=this.y,b.diameter=this._diameter,b},distance:function(b,c){var f=a.Math.distance(this.x,this.y,b.x,b.y);return c?Math.round(f):f},clone:function(b){return"undefined"==typeof b||null===
b?b=new a.Circle(this.x,this.y,this.diameter):b.setTo(this.x,this.y,this.diameter),b},contains:function(b,c){return a.Circle.contains(this,b,c)},circumferencePoint:function(b,c,f){return a.Circle.circumferencePoint(this,b,c,f)},offset:function(b,c){return this.x+=b,this.y+=c,this},offsetPoint:function(b){return this.offset(b.x,b.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};a.Circle.prototype.constructor=a.Circle;
Object.defineProperty(a.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(b){0<b&&(this._diameter=b,this._radius=.5*b)}});Object.defineProperty(a.Circle.prototype,"radius",{get:function(){return this._radius},set:function(b){0<b&&(this._radius=b,this._diameter=2*b)}});Object.defineProperty(a.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(b){b>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-b}});Object.defineProperty(a.Circle.prototype,
"right",{get:function(){return this.x+this._radius},set:function(b){b<this.x?(this._radius=0,this._diameter=0):this.radius=b-this.x}});Object.defineProperty(a.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(b){b>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-b}});Object.defineProperty(a.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(b){b<this.y?(this._radius=0,this._diameter=0):this.radius=b-this.y}});Object.defineProperty(a.Circle.prototype,
"area",{get:function(){return 0<this._radius?Math.PI*this._radius*this._radius:0}});Object.defineProperty(a.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(b){!0===b&&this.setTo(0,0,0)}});a.Circle.contains=function(b,c,a){return 0<b.radius&&c>=b.left&&c<=b.right&&a>=b.top&&a<=b.bottom?(b.x-c)*(b.x-c)+(b.y-a)*(b.y-a)<=b.radius*b.radius:!1};a.Circle.equals=function(b,c){return b.x==c.x&&b.y==c.y&&b.diameter==c.diameter};a.Circle.intersects=function(b,c){return a.Math.distance(b.x,
b.y,c.x,c.y)<=b.radius+c.radius};a.Circle.circumferencePoint=function(b,c,f,d){return"undefined"==typeof f&&(f=!1),"undefined"==typeof d&&(d=new a.Point),!0===f&&(c=a.Math.degToRad(c)),d.x=b.x+b.radius*Math.cos(c),d.y=b.y+b.radius*Math.sin(c),d};a.Circle.intersectsRectangle=function(b,c){var a=Math.abs(b.x-c.x-c.halfWidth);if(a>c.halfWidth+b.radius)return!1;var d=Math.abs(b.y-c.y-c.halfHeight);if(d>c.halfHeight+b.radius)return!1;if(a<=c.halfWidth||d<=c.halfHeight)return!0;a-=c.halfWidth;d-=c.halfHeight;
return b.radius*b.radius>=a*a+d*d};PIXI.Circle=a.Circle;a.Ellipse=function(b,c,f,d){this.x=b||0;this.y=c||0;this.width=f||0;this.height=d||0;this.type=a.ELLIPSE};a.Ellipse.prototype={setTo:function(b,c,a,d){return this.x=b,this.y=c,this.width=a,this.height=d,this},getBounds:function(){return new a.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(b){return this.setTo(b.x,b.y,b.width,b.height)},copyTo:function(b){return b.x=this.x,b.y=this.y,b.width=this.width,
b.height=this.height,b},clone:function(b){return"undefined"==typeof b||null===b?b=new a.Ellipse(this.x,this.y,this.width,this.height):b.setTo(this.x,this.y,this.width,this.height),b},contains:function(b,c){return a.Ellipse.contains(this,b,c)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};a.Ellipse.prototype.constructor=a.Ellipse;Object.defineProperty(a.Ellipse.prototype,"left",{get:function(){return this.x},set:function(b){this.x=
b}});Object.defineProperty(a.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(b){this.width=b<this.x?0:b-this.x}});Object.defineProperty(a.Ellipse.prototype,"top",{get:function(){return this.y},set:function(b){this.y=b}});Object.defineProperty(a.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(b){this.height=b<this.y?0:b-this.y}});Object.defineProperty(a.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},
set:function(b){!0===b&&this.setTo(0,0,0,0)}});a.Ellipse.contains=function(b,c,a){if(0>=b.width||0>=b.height)return!1;c=(c-b.x)/b.width-.5;b=(a-b.y)/b.height-.5;return c*=c,b*=b,.25>c+b};PIXI.Ellipse=a.Ellipse;a.Line=function(b,c,f,d){f=f||0;d=d||0;this.start=new a.Point(b||0,c||0);this.end=new a.Point(f,d);this.type=a.LINE};a.Line.prototype={setTo:function(b,c,a,d){return this.start.setTo(b,c),this.end.setTo(a,d),this},fromSprite:function(b,c,a){return"undefined"==typeof a&&(a=!1),a?this.setTo(b.center.x,
b.center.y,c.center.x,c.center.y):this.setTo(b.x,b.y,c.x,c.y)},fromAngle:function(b,c,a,d){return this.start.setTo(b,c),this.end.setTo(b+Math.cos(a)*d,c+Math.sin(a)*d),this},intersects:function(b,c,f){return a.Line.intersectsPoints(this.start,this.end,b.start,b.end,c,f)},reflect:function(b){return a.Line.reflect(this,b)},pointOnLine:function(b,c){return(b-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(c-this.start.y)},pointOnSegment:function(b,c){var a=Math.min(this.start.x,
this.end.x),d=Math.max(this.start.x,this.end.x),n=Math.min(this.start.y,this.end.y),e=Math.max(this.start.y,this.end.y);return this.pointOnLine(b,c)&&b>=a&&d>=b&&c>=n&&e>=c},coordinatesOnLine:function(b,c){"undefined"==typeof b&&(b=1);"undefined"==typeof c&&(c=[]);var a=Math.round(this.start.x),d=Math.round(this.start.y),n=Math.round(this.end.x),e=Math.round(this.end.y),l=Math.abs(n-a),g=Math.abs(e-d),h=n>a?1:-1,k=e>d?1:-1,m=l-g;c.push([a,d]);for(var u=1;a!=n||d!=e;){var z=m<<1;z>-g&&(m-=g,a+=h);
l>z&&(m+=l,d+=k);0===u%b&&c.push([a,d]);u++}return c},clone:function(b){return"undefined"==typeof b||null===b?b=new a.Line(this.start.x,this.start.y,this.end.x,this.end.y):b.setTo(this.start.x,this.start.y,this.end.x,this.end.y),b}};Object.defineProperty(a.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(a.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-
this.start.y,this.end.x-this.start.x)}});Object.defineProperty(a.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(a.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(a.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(a.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});
Object.defineProperty(a.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(a.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(a.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(a.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(a.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-
this.end.x)}});Object.defineProperty(a.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(a.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(a.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(a.Line.prototype,"normalAngle",{get:function(){return a.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});a.Line.intersectsPoints=
function(b,c,f,d,n,e){"undefined"==typeof n&&(n=!0);"undefined"==typeof e&&(e=new a.Point);var l=c.y-b.y,g=d.y-f.y,h=b.x-c.x,k=f.x-d.x,m=c.x*b.y-b.x*c.y,u=d.x*f.y-f.x*d.y,z=l*k-g*h;return 0===z?null:(e.x=(h*u-k*m)/z,e.y=(g*m-l*u)/z,n)?(n=(d.y-f.y)*(c.x-b.x)-(d.x-f.x)*(c.y-b.y),d=((d.x-f.x)*(b.y-f.y)-(d.y-f.y)*(b.x-f.x))/n,b=((c.x-b.x)*(b.y-f.y)-(c.y-b.y)*(b.x-f.x))/n,0<=d&&1>=d&&0<=b&&1>=b?e:null):e};a.Line.intersects=function(b,c,f,d){return a.Line.intersectsPoints(b.start,b.end,c.start,c.end,f,
d)};a.Line.reflect=function(b,c){return 2*c.normalAngle-3.141592653589793-b.angle};a.Matrix=function(){this.a=1;this.c=this.b=0;this.d=1;this.ty=this.tx=0;this.type=a.MATRIX};a.Matrix.prototype.fromArray=function(b){this.a=b[0];this.b=b[1];this.c=b[3];this.d=b[4];this.tx=b[2];this.ty=b[5]};a.Matrix.prototype.toArray=function(b){this.array||(this.array=new PIXI.Float32Array(9));var c=this.array;return b?(c[0]=this.a,c[1]=this.b,c[2]=0,c[3]=this.c,c[4]=this.d,c[5]=0,c[6]=this.tx,c[7]=this.ty,c[8]=1):
(c[0]=this.a,c[1]=this.c,c[2]=this.tx,c[3]=this.b,c[4]=this.d,c[5]=this.ty,c[6]=0,c[7]=0,c[8]=1),c};a.Matrix.prototype.apply=function(b,c){c=c||new a.Point;var f=b.x,d=b.y;return c.x=this.a*f+this.c*d+this.tx,c.y=this.b*f+this.d*d+this.ty,c};a.Matrix.prototype.applyInverse=function(b,c){c=c||new a.Point;var f=1/(this.a*this.d+this.c*-this.b),d=b.x,n=b.y;return c.x=this.d*f*d+-this.c*f*n+(this.ty*this.c-this.tx*this.d)*f,c.y=this.a*f*n+-this.b*f*d+(-this.ty*this.a+this.tx*this.b)*f,c};a.Matrix.prototype.translate=
function(b,c){return this.tx+=b,this.ty+=c,this};a.Matrix.prototype.scale=function(b,c){return this.a*=b,this.d*=c,this.c*=b,this.b*=c,this.tx*=b,this.ty*=c,this};a.Matrix.prototype.rotate=function(b){var c=Math.cos(b);b=Math.sin(b);var a=this.a,d=this.c,n=this.tx;return this.a=a*c-this.b*b,this.b=a*b+this.b*c,this.c=d*c-this.d*b,this.d=d*b+this.d*c,this.tx=n*c-this.ty*b,this.ty=n*b+this.ty*c,this};a.Matrix.prototype.append=function(b){var c=this.a,a=this.b,d=this.c,n=this.d;return this.a=b.a*c+b.b*
d,this.b=b.a*a+b.b*n,this.c=b.c*c+b.d*d,this.d=b.c*a+b.d*n,this.tx=b.tx*c+b.ty*d+this.tx,this.ty=b.tx*a+b.ty*n+this.ty,this};a.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this};a.identityMatrix=new a.Matrix;PIXI.Matrix=a.Matrix;PIXI.identityMatrix=a.identityMatrix;a.Point=function(b,c){this.x=b||0;this.y=c||0;this.type=a.POINT};a.Point.prototype={copyFrom:function(b){return this.setTo(b.x,b.y)},invert:function(){return this.setTo(this.y,this.x)},
setTo:function(b,c){return this.x=b||0,this.y=c||(0!==c?this.x:0),this},set:function(b,c){return this.x=b||0,this.y=c||(0!==c?this.x:0),this},add:function(b,c){return this.x+=b,this.y+=c,this},subtract:function(b,c){return this.x-=b,this.y-=c,this},multiply:function(b,c){return this.x*=b,this.y*=c,this},divide:function(b,c){return this.x/=b,this.y/=c,this},clampX:function(b,c){return this.x=a.Math.clamp(this.x,b,c),this},clampY:function(b,c){return this.y=a.Math.clamp(this.y,b,c),this},clamp:function(b,
c){return this.x=a.Math.clamp(this.x,b,c),this.y=a.Math.clamp(this.y,b,c),this},clone:function(b){return"undefined"==typeof b||null===b?b=new a.Point(this.x,this.y):b.setTo(this.x,this.y),b},copyTo:function(b){return b.x=this.x,b.y=this.y,b},distance:function(b,c){return a.Point.distance(this,b,c)},equals:function(b){return b.x===this.x&&b.y===this.y},angle:function(b,c){return"undefined"==typeof c&&(c=!1),c?a.Math.radToDeg(Math.atan2(b.y-this.y,b.x-this.x)):Math.atan2(b.y-this.y,b.x-this.x)},rotate:function(b,
c,f,d,n){return a.Point.rotate(this,b,c,f,d,n)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(b){return this.normalize().multiply(b,b)},normalize:function(){if(!this.isZero()){var b=this.getMagnitude();this.x/=b;this.y/=b}return this},isZero:function(){return 0===this.x&&0===this.y},dot:function(b){return this.x*b.x+this.y*b.y},cross:function(b){return this.x*b.y-this.y*b.x},perp:function(){return this.setTo(-this.y,
this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};a.Point.prototype.constructor=a.Point;a.Point.add=function(b,c,f){return"undefined"==typeof f&&(f=new a.Point),f.x=b.x+c.x,f.y=b.y+c.y,f};a.Point.subtract=function(b,
c,f){return"undefined"==typeof f&&(f=new a.Point),f.x=b.x-c.x,f.y=b.y-c.y,f};a.Point.multiply=function(b,c,f){return"undefined"==typeof f&&(f=new a.Point),f.x=b.x*c.x,f.y=b.y*c.y,f};a.Point.divide=function(b,c,f){return"undefined"==typeof f&&(f=new a.Point),f.x=b.x/c.x,f.y=b.y/c.y,f};a.Point.equals=function(b,c){return b.x===c.x&&b.y===c.y};a.Point.angle=function(b,c){return Math.atan2(b.y-c.y,b.x-c.x)};a.Point.negative=function(b,c){return"undefined"==typeof c&&(c=new a.Point),c.setTo(-b.x,-b.y)};
a.Point.multiplyAdd=function(b,c,f,d){return"undefined"==typeof d&&(d=new a.Point),d.setTo(b.x+c.x*f,b.y+c.y*f)};a.Point.interpolate=function(b,c,f,d){return"undefined"==typeof d&&(d=new a.Point),d.setTo(b.x+(c.x-b.x)*f,b.y+(c.y-b.y)*f)};a.Point.perp=function(b,c){return"undefined"==typeof c&&(c=new a.Point),c.setTo(-b.y,b.x)};a.Point.rperp=function(b,c){return"undefined"==typeof c&&(c=new a.Point),c.setTo(b.y,-b.x)};a.Point.distance=function(b,c,f){b=a.Math.distance(b.x,b.y,c.x,c.y);return f?Math.round(b):
b};a.Point.project=function(b,c,f){"undefined"==typeof f&&(f=new a.Point);b=b.dot(c)/c.getMagnitudeSq();return 0!==b&&f.setTo(b*c.x,b*c.y),f};a.Point.projectUnit=function(b,c,f){"undefined"==typeof f&&(f=new a.Point);b=b.dot(c);return 0!==b&&f.setTo(b*c.x,b*c.y),f};a.Point.normalRightHand=function(b,c){return"undefined"==typeof c&&(c=new a.Point),c.setTo(-1*b.y,b.x)};a.Point.normalize=function(b,c){"undefined"==typeof c&&(c=new a.Point);var f=b.getMagnitude();return 0!==f&&c.setTo(b.x/f,b.y/f),c};
a.Point.rotate=function(b,c,f,d,n,e){e=e||null;n&&(d=a.Math.degToRad(d));null===e&&(e=Math.sqrt((c-b.x)*(c-b.x)+(f-b.y)*(f-b.y)));d+=Math.atan2(b.y-f,b.x-c);return b.setTo(c+e*Math.cos(d),f+e*Math.sin(d))};a.Point.centroid=function(b,c){if("undefined"==typeof c&&(c=new a.Point),"[object Array]"!==Object.prototype.toString.call(b))throw Error("Phaser.Point. Parameter 'points' must be an array");var f=b.length;if(1>f)throw Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===f)return c.copyFrom(b[0]),
c;for(var d=0;f>d;d++)a.Point.add(c,b[d],c);return c.divide(f,f),c};a.Point.parse=function(b,c,f){c=c||"x";f=f||"y";var d=new a.Point;return b[c]&&(d.x=parseInt(b[c],10)),b[f]&&(d.y=parseInt(b[f],10)),d};PIXI.Point=a.Point;a.Polygon=function(){this.area=0;this._points=[];0<arguments.length&&this.setTo.apply(this,arguments);this.closed=!0;this.type=a.POLYGON};a.Polygon.prototype={toNumberArray:function(b){"undefined"==typeof b&&(b=[]);for(var c=0;c<this._points.length;c++)"number"==typeof this._points[c]?
(b.push(this._points[c]),b.push(this._points[c+1]),c++):(b.push(this._points[c].x),b.push(this._points[c].y));return b},flatten:function(){return this._points=this.toNumberArray(),this},clone:function(b){var c=this._points.slice();return"undefined"==typeof b||null===b?b=new a.Polygon(c):b.setTo(c),b},contains:function(b,c){for(var a=this._points.length,d=!1,n=-1,e=a-1;++n<a;e=n){var l=this._points[n].x,g=this._points[n].y,h=this._points[e].x,e=this._points[e].y;(c>=g&&e>c||c>=e&&g>c)&&(h-l)*(c-g)/
(e-g)+l>b&&(d=!d)}return d},setTo:function(b){if(this.area=0,this._points=[],0<arguments.length){Array.isArray(b)||(b=Array.prototype.slice.call(arguments));for(var c=Number.MAX_VALUE,a=0,d=b.length;d>a;a++){if("number"==typeof b[a]){var n=new PIXI.Point(b[a],b[a+1]);a++}else n=new PIXI.Point(b[a].x,b[a].y);this._points.push(n);n.y<c&&(c=n.y)}this.calculateArea(c)}return this},calculateArea:function(b){for(var c,a,d,n=0,e=this._points.length;e>n;n++)c=this._points[n],a=n===e-1?this._points[0]:this._points[n+
1],d=(c.y-b+(a.y-b))/2,c=c.x-a.x,this.area+=d*c;return this.area}};a.Polygon.prototype.constructor=a.Polygon;Object.defineProperty(a.Polygon.prototype,"points",{get:function(){return this._points},set:function(b){null!=b?this.setTo(b):this.setTo()}});PIXI.Polygon=a.Polygon;a.Rectangle=function(b,c,f,d){this.x=b||0;this.y=c||0;this.width=f||0;this.height=d||0;this.type=a.RECTANGLE};a.Rectangle.prototype={offset:function(b,c){return this.x+=b,this.y+=c,this},offsetPoint:function(b){return this.offset(b.x,
b.y)},setTo:function(b,c,a,d){return this.x=b,this.y=c,this.width=a,this.height=d,this},scale:function(b,c){return"undefined"==typeof c&&(c=b),this.width*=b,this.height*=c,this},centerOn:function(b,c){return this.centerX=b,this.centerY=c,this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(b){return this.setTo(b.x,b.y,
b.width,b.height)},copyTo:function(b){return b.x=this.x,b.y=this.y,b.width=this.width,b.height=this.height,b},inflate:function(b,c){return a.Rectangle.inflate(this,b,c)},size:function(b){return a.Rectangle.size(this,b)},clone:function(b){return a.Rectangle.clone(this,b)},contains:function(b,c){return a.Rectangle.contains(this,b,c)},containsRect:function(b){return a.Rectangle.containsRect(b,this)},equals:function(b){return a.Rectangle.equals(this,b)},intersection:function(b,c){return a.Rectangle.intersection(this,
b,c)},intersects:function(b){return a.Rectangle.intersects(this,b)},intersectsRaw:function(b,c,f,d,n){return a.Rectangle.intersectsRaw(this,b,c,f,d,n)},union:function(b,c){return a.Rectangle.union(this,b,c)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(a.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(a.Rectangle.prototype,"halfHeight",
{get:function(){return Math.round(this.height/2)}});Object.defineProperty(a.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(b){this.height=b<=this.y?0:b-this.y}});Object.defineProperty(a.Rectangle.prototype,"bottomRight",{get:function(){return new a.Point(this.right,this.bottom)},set:function(b){this.right=b.x;this.bottom=b.y}});Object.defineProperty(a.Rectangle.prototype,"left",{get:function(){return this.x},set:function(b){this.width=b>=this.right?0:this.right-
b;this.x=b}});Object.defineProperty(a.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(b){this.width=b<=this.x?0:b-this.x}});Object.defineProperty(a.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(a.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}});Object.defineProperty(a.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(b){this.x=b-this.halfWidth}});
Object.defineProperty(a.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(b){this.y=b-this.halfHeight}});Object.defineProperty(a.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}});Object.defineProperty(a.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}});Object.defineProperty(a.Rectangle.prototype,"top",{get:function(){return this.y},set:function(b){b>=this.bottom?(this.height=0,this.y=
b):this.height=this.bottom-b}});Object.defineProperty(a.Rectangle.prototype,"topLeft",{get:function(){return new a.Point(this.x,this.y)},set:function(b){this.x=b.x;this.y=b.y}});Object.defineProperty(a.Rectangle.prototype,"topRight",{get:function(){return new a.Point(this.x+this.width,this.y)},set:function(b){this.right=b.x;this.y=b.y}});Object.defineProperty(a.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(b){!0===b&&this.setTo(0,0,0,0)}});a.Rectangle.prototype.constructor=
a.Rectangle;a.Rectangle.inflate=function(b,c,a){return b.x-=c,b.width+=2*c,b.y-=a,b.height+=2*a,b};a.Rectangle.inflatePoint=function(b,c){return a.Rectangle.inflate(b,c.x,c.y)};a.Rectangle.size=function(b,c){return"undefined"==typeof c||null===c?c=new a.Point(b.width,b.height):c.setTo(b.width,b.height),c};a.Rectangle.clone=function(b,c){return"undefined"==typeof c||null===c?c=new a.Rectangle(b.x,b.y,b.width,b.height):c.setTo(b.x,b.y,b.width,b.height),c};a.Rectangle.contains=function(b,c,a){return 0>=
b.width||0>=b.height?!1:c>=b.x&&c<b.right&&a>=b.y&&a<b.bottom};a.Rectangle.containsRaw=function(b,c,a,d,n,e){return n>=b&&b+a>n&&e>=c&&c+d>e};a.Rectangle.containsPoint=function(b,c){return a.Rectangle.contains(b,c.x,c.y)};a.Rectangle.containsRect=function(b,c){return b.volume>c.volume?!1:b.x>=c.x&&b.y>=c.y&&b.right<c.right&&b.bottom<c.bottom};a.Rectangle.equals=function(b,c){return b.x==c.x&&b.y==c.y&&b.width==c.width&&b.height==c.height};a.Rectangle.sameDimensions=function(b,c){return b.width===
c.width&&b.height===c.height};a.Rectangle.intersection=function(b,c,f){return"undefined"==typeof f&&(f=new a.Rectangle),a.Rectangle.intersects(b,c)&&(f.x=Math.max(b.x,c.x),f.y=Math.max(b.y,c.y),f.width=Math.min(b.right,c.right)-f.x,f.height=Math.min(b.bottom,c.bottom)-f.y),f};a.Rectangle.intersects=function(b,c){return 0>=b.width||0>=b.height||0>=c.width||0>=c.height?!1:!(b.right<c.x||b.bottom<c.y||b.x>c.right||b.y>c.bottom)};a.Rectangle.intersectsRaw=function(b,c,a,d,n,e){return"undefined"==typeof e&&
(e=0),!(c>b.right+e||a<b.left-e||d>b.bottom+e||n<b.top-e)};a.Rectangle.union=function(b,c,f){return"undefined"==typeof f&&(f=new a.Rectangle),f.setTo(Math.min(b.x,c.x),Math.min(b.y,c.y),Math.max(b.right,c.right)-Math.min(b.left,c.left),Math.max(b.bottom,c.bottom)-Math.min(b.top,c.top))};a.Rectangle.aabb=function(b,c){"undefined"==typeof c&&(c=new a.Rectangle);var f=Number.MIN_VALUE,d=Number.MAX_VALUE,n=Number.MIN_VALUE,e=Number.MAX_VALUE;return b.forEach(function(b){b.x>f&&(f=b.x);b.x<d&&(d=b.x);
b.y>n&&(n=b.y);b.y<e&&(e=b.y)}),c.setTo(d,e,f-d,n-e),c};PIXI.Rectangle=a.Rectangle;PIXI.EmptyRectangle=new a.Rectangle(0,0,0,0);a.RoundedRectangle=function(b,c,f,d,n){this.x=b||0;this.y=c||0;this.width=f||0;this.height=d||0;this.radius=n||20;this.type=a.ROUNDEDRECTANGLE};a.RoundedRectangle.prototype.clone=function(){return new a.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};a.RoundedRectangle.prototype.contains=function(b,c){if(0>=this.width||0>=this.height)return!1;var a=this.x;
return b>=a&&b<=a+this.width&&(a=this.y,c>=a&&c<=a+this.height)?!0:!1};a.RoundedRectangle.prototype.constructor=a.RoundedRectangle;PIXI.RoundedRectangle=a.RoundedRectangle;a.Camera=function(b,c,f,d,n,e){this.game=b;this.world=b.world;this.id=0;this.view=new a.Rectangle(f,d,n,e);this.screenView=new a.Rectangle(f,d,n,e);this.bounds=new a.Rectangle(f,d,n,e);this.deadzone=null;this.roundPx=this.visible=!0;this.atLimit={x:!1,y:!1};this.scale=this.displayObject=this.target=null;this.totalInView=0;this._targetPosition=
new a.Point;this._edge=0;this._position=new a.Point};a.Camera.FOLLOW_LOCKON=0;a.Camera.FOLLOW_PLATFORMER=1;a.Camera.FOLLOW_TOPDOWN=2;a.Camera.FOLLOW_TOPDOWN_TIGHT=3;a.Camera.prototype={preUpdate:function(){this.totalInView=0},follow:function(b,c){"undefined"==typeof c&&(c=a.Camera.FOLLOW_LOCKON);this.target=b;var f;switch(c){case a.Camera.FOLLOW_PLATFORMER:f=this.width/8;var d=this.height/3;this.deadzone=new a.Rectangle((this.width-f)/2,(this.height-d)/2-.25*d,f,d);break;case a.Camera.FOLLOW_TOPDOWN:f=
Math.max(this.width,this.height)/4;this.deadzone=new a.Rectangle((this.width-f)/2,(this.height-f)/2,f,f);break;case a.Camera.FOLLOW_TOPDOWN_TIGHT:f=Math.max(this.width,this.height)/8;this.deadzone=new a.Rectangle((this.width-f)/2,(this.height-f)/2,f,f);break;case a.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(b){this.setPosition(Math.round(b.x-this.view.halfWidth),Math.round(b.y-this.view.halfHeight))},focusOnXY:function(b,
c){this.setPosition(Math.round(b-this.view.halfWidth),Math.round(c-this.view.halfHeight))},update:function(){this.target&&this.updateTarget();this.bounds&&this.checkBounds();this.roundPx&&this.view.floor();this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){this._targetPosition.copyFrom(this.target);this.target.parent&&this._targetPosition.multiply(this.target.parent.worldTransform.a,this.target.parent.worldTransform.d);this.deadzone?(this._edge=
this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this._targetPosition.x-this.deadzone.left:this._edge>this.deadzone.right&&(this.view.x=this._targetPosition.x-this.deadzone.right),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this._targetPosition.y-this.deadzone.top:this._edge>this.deadzone.bottom&&(this.view.y=this._targetPosition.y-this.deadzone.bottom)):(this.view.x=this._targetPosition.x-this.view.halfWidth,this.view.y=this._targetPosition.y-
this.view.halfHeight)},setBoundsToWorld:function(){this.bounds&&this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=!1;this.atLimit.y=!1;this.view.x<=this.bounds.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x);this.view.right>=this.bounds.right&&(this.atLimit.x=!0,this.view.x=this.bounds.right-this.width);this.view.y<=this.bounds.top&&(this.atLimit.y=!0,this.view.y=this.bounds.top);
this.view.bottom>=this.bounds.bottom&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom-this.height)},setPosition:function(b,c){this.view.x=b;this.view.y=c;this.bounds&&this.checkBounds()},setSize:function(b,c){this.view.width=b;this.view.height=c},reset:function(){this.target=null;this.view.x=0;this.view.y=0}};a.Camera.prototype.constructor=a.Camera;Object.defineProperty(a.Camera.prototype,"x",{get:function(){return this.view.x},set:function(b){this.view.x=b;this.bounds&&this.checkBounds()}});Object.defineProperty(a.Camera.prototype,
"y",{get:function(){return this.view.y},set:function(b){this.view.y=b;this.bounds&&this.checkBounds()}});Object.defineProperty(a.Camera.prototype,"position",{get:function(){return this._position.set(this.view.centerX,this.view.centerY),this._position},set:function(b){"undefined"!=typeof b.x&&(this.view.x=b.x);"undefined"!=typeof b.y&&(this.view.y=b.y);this.bounds&&this.checkBounds()}});Object.defineProperty(a.Camera.prototype,"width",{get:function(){return this.view.width},set:function(b){this.view.width=
b}});Object.defineProperty(a.Camera.prototype,"height",{get:function(){return this.view.height},set:function(b){this.view.height=b}});a.State=function(){this.game=null;this.key="";this.rnd=this.physics=this.particles=this.world=this.tweens=this.time=this.stage=this.scale=this.sound=this.math=this.load=this.input=this.cache=this.camera=this.make=this.add=null};a.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},
render:function(){},resize:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}};a.State.prototype.constructor=a.State;a.StateManager=function(b,c){this.game=b;this.states={};this._pendingState=null;"undefined"!=typeof c&&null!==c&&(this._pendingState=c);this._created=this._clearCache=this._clearWorld=!1;this._args=[];this.current="";this.onShutDownCallback=this.onPauseUpdateCallback=this.onResumedCallback=this.onPausedCallback=this.onLoadRenderCallback=this.onLoadUpdateCallback=
this.onPreRenderCallback=this.onResizeCallback=this.onRenderCallback=this.onUpdateCallback=this.onCreateCallback=this.onPreloadCallback=this.onInitCallback=null};a.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(b,c,f){"undefined"==typeof f&&(f=!1);var d;return c instanceof a.State?d=c:"object"==typeof c?(d=
c,d.game=this.game):"function"==typeof c&&(d=new c(this.game)),this.states[b]=d,f&&(this.game.isBooted?this.start(b):this._pendingState=b),d},remove:function(b){this.current===b&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=
null,this.onResumedCallback=null,this.onPauseUpdateCallback=null);delete this.states[b]},start:function(b,c,a){"undefined"==typeof c&&(c=!0);"undefined"==typeof a&&(a=!1);this.checkState(b)&&(this._pendingState=b,this._clearWorld=c,this._clearCache=a,3<arguments.length&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(b,c){"undefined"==typeof b&&(b=!0);"undefined"==typeof c&&(c=!1);this._pendingState=this.current;this._clearWorld=b;this._clearCache=c;2<arguments.length&&(this._args=
Array.prototype.splice.call(arguments,2))},dummy:function(){},preUpdate:function(){this._pendingState&&this.game.isBooted&&(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.current===this._pendingState)&&(this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete())},
clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),!0===this._clearCache&&this.game.cache.destroy()))},checkState:function(b){if(this.states[b]){var c=!1;return(this.states[b].preload||
this.states[b].create||this.states[b].update||this.states[b].render)&&(c=!0),!1===c?(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):!0}return console.warn("Phaser.StateManager - No state found with the key: "+b),!1},link:function(b){this.states[b].game=this.game;this.states[b].add=this.game.add;this.states[b].make=this.game.make;this.states[b].camera=this.game.camera;this.states[b].cache=this.game.cache;
this.states[b].input=this.game.input;this.states[b].load=this.game.load;this.states[b].math=this.game.math;this.states[b].sound=this.game.sound;this.states[b].scale=this.game.scale;this.states[b].state=this;this.states[b].stage=this.game.stage;this.states[b].time=this.game.time;this.states[b].tweens=this.game.tweens;this.states[b].world=this.game.world;this.states[b].particles=this.game.particles;this.states[b].rnd=this.game.rnd;this.states[b].physics=this.game.physics;this.states[b].key=b},unlink:function(b){this.states[b]&&
(this.states[b].game=null,this.states[b].add=null,this.states[b].make=null,this.states[b].camera=null,this.states[b].cache=null,this.states[b].input=null,this.states[b].load=null,this.states[b].math=null,this.states[b].sound=null,this.states[b].scale=null,this.states[b].state=null,this.states[b].stage=null,this.states[b].time=null,this.states[b].tweens=null,this.states[b].world=null,this.states[b].particles=null,this.states[b].rnd=null,this.states[b].physics=null)},setCurrentState:function(b){this.callbackContext=
this.states[b];this.link(b);this.onInitCallback=this.states[b].init||this.dummy;this.onPreloadCallback=this.states[b].preload||null;this.onLoadRenderCallback=this.states[b].loadRender||null;this.onLoadUpdateCallback=this.states[b].loadUpdate||null;this.onCreateCallback=this.states[b].create||null;this.onUpdateCallback=this.states[b].update||null;this.onPreRenderCallback=this.states[b].preRender||null;this.onRenderCallback=this.states[b].render||null;this.onResizeCallback=this.states[b].resize||null;
this.onPausedCallback=this.states[b].paused||null;this.onResumedCallback=this.states[b].resumed||null;this.onPauseUpdateCallback=this.states[b].pauseUpdate||null;this.onShutDownCallback=this.states[b].shutdown||this.dummy;""!==this.current&&this.game.physics.reset();this.current=b;this._created=!1;this.onInitCallback.apply(this.callbackContext,this._args);b===this._pendingState&&(this._args=[]);this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){!1===
this._created&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created&&this.onUpdateCallback?this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&
this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created&&this.onPauseUpdateCallback?this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(b){this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,b)},resize:function(b,c){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,b,c)},render:function(){this._created&&
this.onRenderCallback?this.game.renderType===a.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this.clearCurrentState();this.game=this.onPauseUpdateCallback=this.onResumedCallback=this.onPausedCallback=this.onRenderCallback=
this.onUpdateCallback=this.onCreateCallback=this.onLoadUpdateCallback=this.onLoadRenderCallback=this.onPreloadCallback=this.onShutDownCallback=this.onInitCallback=this.callbackContext=null;this.states={};this._pendingState=null;this.current=""}};a.StateManager.prototype.constructor=a.StateManager;a.Signal=function(){};a.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(b,c){if("function"!=typeof b)throw Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",
c));},_registerListener:function(b,c,f,d){var n,e=this._indexOfListener(b,f);if(-1!==e){if(n=this._bindings[e],n.isOnce()!==c)throw Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.");}else n=new a.SignalBinding(this,b,c,f,d),this._addBinding(n);return this.memorize&&this._prevParams&&n.execute(this._prevParams),n},_addBinding:function(b){this._bindings||(this._bindings=[]);var c=this._bindings.length;do c--;while(this._bindings[c]&&
b._priority<=this._bindings[c]._priority);this._bindings.splice(c+1,0,b)},_indexOfListener:function(b,c){if(!this._bindings)return-1;"undefined"==typeof c&&(c=null);for(var a,d=this._bindings.length;d--;)if(a=this._bindings[d],a._listener===b&&a.context===c)return d;return-1},has:function(b,c){return-1!==this._indexOfListener(b,c)},add:function(b,c,a){return this.validateListener(b,"add"),this._registerListener(b,!1,c,a)},addOnce:function(b,c,a){return this.validateListener(b,"addOnce"),this._registerListener(b,
!0,c,a)},remove:function(b,c){this.validateListener(b,"remove");var a=this._indexOfListener(b,c);return-1!==a&&(this._bindings[a]._destroy(),this._bindings.splice(a,1)),b},removeAll:function(b){if("undefined"==typeof b&&(b=null),this._bindings){for(var c=this._bindings.length;c--;)b?this._bindings[c].context===b&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)):this._bindings[c]._destroy();b||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:
0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var b,c=Array.prototype.slice.call(arguments),a=this._bindings.length;if(this.memorize&&(this._prevParams=c),a){b=this._bindings.slice();this._shouldPropagate=!0;do a--;while(b[a]&&this._shouldPropagate&&!1!==b[a].execute(c))}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll();this._bindings=null;this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+
this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(a.Signal.prototype,"boundDispatch",{get:function(){var b=this;return this._boundDispatch||(this._boundDispatch=function(){return b.dispatch.apply(b,arguments)})}});a.Signal.prototype.constructor=a.Signal;a.SignalBinding=function(b,c,a,d,n){this._listener=c;a&&(this._isOnce=!0);null!=d&&(this.context=d);this._signal=b;n&&(this._priority=n)};a.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,callCount:0,active:!0,
params:null,execute:function(b){var c,a;return this.active&&this._listener&&(a=this.params?this.params.concat(b):b,c=this._listener.apply(this.context,a),this.callCount++,this._isOnce&&this.detach()),c},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;
delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};a.SignalBinding.prototype.constructor=a.SignalBinding;a.Filter=function(b,c,f){this.game=b;this.type=a.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.prevPoint=new a.Point;b=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,
y:0}},date:{type:"4fv",value:[b.getFullYear(),b.getMonth(),b.getDate(),3600*b.getHours()+60*b.getMinutes()+b.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},c)for(var d in c)this.uniforms[d]=c[d];this.fragmentSrc=f||[]};a.Filter.prototype={init:function(){},
setResolution:function(b,c){this.uniforms.resolution.value.x=b;this.uniforms.resolution.value.y=c},update:function(b){if("undefined"!=typeof b){var c=b.x/this.game.width;b=1-b.y/this.game.height;c===this.prevPoint.x&&b===this.prevPoint.y||(this.uniforms.mouse.value.x=c.toFixed(2),this.uniforms.mouse.value.y=b.toFixed(2),this.prevPoint.set(c,b))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}};a.Filter.prototype.constructor=a.Filter;Object.defineProperty(a.Filter.prototype,
"width",{get:function(){return this.uniforms.resolution.value.x},set:function(b){this.uniforms.resolution.value.x=b}});Object.defineProperty(a.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(b){this.uniforms.resolution.value.y=b}});a.Plugin=function(b,c){"undefined"==typeof c&&(c=null);this.game=b;this.parent=c;this.hasPostRender=this.hasRender=this.hasPostUpdate=this.hasUpdate=this.hasPreUpdate=this.visible=this.active=!1};a.Plugin.prototype={preUpdate:function(){},
update:function(){},render:function(){},postRender:function(){},destroy:function(){this.parent=this.game=null;this.visible=this.active=!1}};a.Plugin.prototype.constructor=a.Plugin;a.PluginManager=function(b){this.game=b;this.plugins=[];this._i=this._len=0};a.PluginManager.prototype={add:function(b){var c=Array.prototype.splice.call(arguments,1),a=!1;return"function"==typeof b?b=new b(this.game,this):(b.game=this.game,b.parent=this),"function"==typeof b.preUpdate&&(b.hasPreUpdate=!0,a=!0),"function"==
typeof b.update&&(b.hasUpdate=!0,a=!0),"function"==typeof b.postUpdate&&(b.hasPostUpdate=!0,a=!0),"function"==typeof b.render&&(b.hasRender=!0,a=!0),"function"==typeof b.postRender&&(b.hasPostRender=!0,a=!0),a?((b.hasPreUpdate||b.hasUpdate||b.hasPostUpdate)&&(b.active=!0),(b.hasRender||b.hasPostRender)&&(b.visible=!0),this._len=this.plugins.push(b),"function"==typeof b.init&&b.init.apply(b,c),b):null},remove:function(b){for(this._i=this._len;this._i--;)if(this.plugins[this._i]===b)return b.destroy(),
this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this._len=this.plugins.length=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=
this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll();this.game=null}};a.PluginManager.prototype.constructor=
a.PluginManager;a.Stage=function(b){this.game=b;PIXI.Stage.call(this,0);this.name="_stage_root";this.disableVisibilityChange=!1;this.exists=!0;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._backgroundColor=0;b.config&&this.parseConfig(b.config)};a.Stage.prototype=Object.create(PIXI.Stage.prototype);a.Stage.prototype.constructor=a.Stage;a.Stage.prototype.parseConfig=function(b){b.disableVisibilityChange&&(this.disableVisibilityChange=b.disableVisibilityChange);b.backgroundColor&&
(this.backgroundColor=b.backgroundColor)};a.Stage.prototype.boot=function(){a.DOM.getOffset(this.game.canvas,this.offset);a.Canvas.setUserSelect(this.game.canvas,"none");a.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};a.Stage.prototype.preUpdate=function(){for(var b=this.currentRenderOrderID=0;b<this.children.length;b++)this.children[b].preUpdate()};a.Stage.prototype.update=function(){for(var b=this.children.length;b--;)this.children[b].update()};a.Stage.prototype.postUpdate=
function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate();this.game.world.camera.update();for(var b=this.children.length;b--;)this.children[b]!==this.game.world.camera.target&&this.children[b].postUpdate()}else for(this.game.world.camera.update(),b=this.children.length;b--;)this.children[b].postUpdate()};a.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var b=0;b<this.children.length;b++)this.children[b].updateTransform()};a.Stage.prototype.checkVisibility=
function(){this._hiddenVar=void 0!==document.webkitHidden?"webkitvisibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":void 0!==document.hidden?"visibilitychange":null;var b=this;this._onChange=function(c){return b.visibilityChange(c)};this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1);window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;
this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){a.Stage.prototype.visibilityChange.call(b,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){a.Stage.prototype.visibilityChange.call(b,{type:"resume"})}))};a.Stage.prototype.visibilityChange=function(b){return"pagehide"===b.type||"blur"===b.type||"pageshow"===b.type||"focus"===b.type?void("pagehide"===b.type||"blur"===b.type?this.game.focusLoss(b):("pageshow"===b.type||"focus"===b.type)&&this.game.focusGain(b)):
void(this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===b.type?this.game.gamePaused(b):this.game.gameResumed(b)))};a.Stage.prototype.setBackgroundColor=function(b){b=a.Color.valueToColor(b);this._backgroundColor=a.Color.getColor(b.r,b.g,b.b);this.backgroundColorSplit=[b.r/255,b.g/255,b.b/255];this.backgroundColorString=a.Color.RGBtoString(b.r,b.g,b.b,255,"#")};a.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,
this._onChange,!1);window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(a.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(b){this.game.transparent||this.setBackgroundColor(b)}});Object.defineProperty(a.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(b){PIXI.scaleModes.DEFAULT=b?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}});a.Group=
function(b,c,f,d,n,e){"undefined"==typeof d&&(d=!1);"undefined"==typeof n&&(n=!1);"undefined"==typeof e&&(e=a.Physics.ARCADE);this.game=b;"undefined"==typeof c&&(c=b.world);this.name=f||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);d?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):c&&(c.addChild(this),this.z=c.children.length);this.physicsType=this.type=a.GROUP;this.exists=this.alive=!0;this.ignoreDestroy=!1;this.classType=a.Sprite;this.scale=new a.Point(1,1);this.cursor=
null;this.enableBody=n;this.enableBodyDebug=!1;this.physicsBodyType=e;this.onDestroy=new a.Signal;this.cursorIndex=0;this.fixedToCamera=!1;this.cameraOffset=new a.Point;this._hash=[];this._sortProperty="z"};a.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);a.Group.prototype.constructor=a.Group;a.Group.RETURN_NONE=0;a.Group.RETURN_TOTAL=1;a.Group.RETURN_CHILD=2;a.Group.SORT_ASCENDING=-1;a.Group.SORT_DESCENDING=1;a.Group.prototype.add=function(b,c){return"undefined"==typeof c&&
(c=!1),b.parent!==this&&(this.enableBody&&this.game.physics.enable(b,this.physicsBodyType),this.addChild(b),this._hash.push(b),b.z=this.children.length,!c&&b.events&&b.events.onAddedToGroup$dispatch(b,this),null===this.cursor&&(this.cursor=b)),b};a.Group.prototype.addMultiple=function(b,c){if(Array.isArray(b))for(var a=0;a<b.length;a++)this.add(b[a],c);return b};a.Group.prototype.addAt=function(b,c,a){return"undefined"==typeof a&&(a=!1),b.parent!==this&&(this.enableBody&&this.game.physics.enable(b,
this.physicsBodyType),this.addChildAt(b,c),this._hash.push(b),this.updateZ(),!a&&b.events&&b.events.onAddedToGroup$dispatch(b,this),null===this.cursor&&(this.cursor=b)),b};a.Group.prototype.getAt=function(b){return 0>b||b>=this.children.length?-1:this.getChildAt(b)};a.Group.prototype.create=function(b,c,a,d,n){"undefined"==typeof n&&(n=!0);b=new this.classType(this.game,b,c,a,d);return this.enableBody&&this.game.physics.enable(b,this.physicsBodyType,this.enableBodyDebug),b.exists=n,b.visible=n,b.alive=
n,this.addChild(b),this._hash.push(b),b.z=this.children.length,b.events&&b.events.onAddedToGroup$dispatch(b,this),null===this.cursor&&(this.cursor=b),b};a.Group.prototype.createMultiple=function(b,c,a,d){"undefined"==typeof d&&(d=!1);for(var n=0;b>n;n++)this.create(0,0,c,a,d)};a.Group.prototype.updateZ=function(){for(var b=this.children.length;b--;)this.children[b].z=b};a.Group.prototype.resetCursor=function(b){return"undefined"==typeof b&&(b=0),b>this.children.length-1&&(b=0),this.cursor?(this.cursorIndex=
b,this.cursor=this.children[this.cursorIndex],this.cursor):void 0};a.Group.prototype.next=function(){return this.cursor?(this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor):void 0};a.Group.prototype.previous=function(){return this.cursor?(0===this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor):void 0};a.Group.prototype.swap=function(b,
c){this.swapChildren(b,c);this.updateZ()};a.Group.prototype.bringToTop=function(b){return b.parent===this&&this.getIndex(b)<this.children.length&&(this.remove(b,!1,!0),this.add(b,!0)),b};a.Group.prototype.sendToBack=function(b){return b.parent===this&&0<this.getIndex(b)&&(this.remove(b,!1,!0),this.addAt(b,0,!0)),b};a.Group.prototype.moveUp=function(b){if(b.parent===this&&this.getIndex(b)<this.children.length-1){var c=this.getIndex(b);(c=this.getAt(c+1))&&this.swap(b,c)}return b};a.Group.prototype.moveDown=
function(b){if(b.parent===this&&0<this.getIndex(b)){var c=this.getIndex(b);(c=this.getAt(c-1))&&this.swap(b,c)}return b};a.Group.prototype.xy=function(b,c,a){return 0>b||b>this.children.length?-1:(this.getChildAt(b).x=c,void(this.getChildAt(b).y=a))};a.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};a.Group.prototype.getIndex=function(b){return this.children.indexOf(b)};a.Group.prototype.replace=function(b,c){var f=this.getIndex(b);return-1!==f?(c.parent&&(c.parent instanceof
a.Group?c.parent.remove(c):c.parent.removeChild(c)),this.remove(b),this.addAt(c,f),b):void 0};a.Group.prototype.hasProperty=function(b,c){var a=c.length;return 1===a&&c[0]in b?!0:2===a&&c[0]in b&&c[1]in b[c[0]]?!0:3===a&&c[0]in b&&c[1]in b[c[0]]&&c[2]in b[c[0]][c[1]]?!0:4===a&&c[0]in b&&c[1]in b[c[0]]&&c[2]in b[c[0]][c[1]]&&c[3]in b[c[0]][c[1]][c[2]]?!0:!1};a.Group.prototype.setProperty=function(b,c,a,d,n){if("undefined"==typeof n&&(n=!1),d=d||0,!this.hasProperty(b,c)&&(!n||0<d))return!1;n=c.length;
return 1===n?0===d?b[c[0]]=a:1==d?b[c[0]]+=a:2==d?b[c[0]]-=a:3==d?b[c[0]]*=a:4==d&&(b[c[0]]/=a):2===n?0===d?b[c[0]][c[1]]=a:1==d?b[c[0]][c[1]]+=a:2==d?b[c[0]][c[1]]-=a:3==d?b[c[0]][c[1]]*=a:4==d&&(b[c[0]][c[1]]/=a):3===n?0===d?b[c[0]][c[1]][c[2]]=a:1==d?b[c[0]][c[1]][c[2]]+=a:2==d?b[c[0]][c[1]][c[2]]-=a:3==d?b[c[0]][c[1]][c[2]]*=a:4==d&&(b[c[0]][c[1]][c[2]]/=a):4===n&&(0===d?b[c[0]][c[1]][c[2]][c[3]]=a:1==d?b[c[0]][c[1]][c[2]][c[3]]+=a:2==d?b[c[0]][c[1]][c[2]][c[3]]-=a:3==d?b[c[0]][c[1]][c[2]][c[3]]*=
a:4==d&&(b[c[0]][c[1]][c[2]][c[3]]/=a)),!0};a.Group.prototype.checkProperty=function(b,c,f,d){return"undefined"==typeof d&&(d=!1),!a.Utils.getProperty(b,c)&&d?!1:a.Utils.getProperty(b,c)!==f?!1:!0};a.Group.prototype.set=function(b,c,a,d,n,e,l){return"undefined"==typeof l&&(l=!1),c=c.split("."),"undefined"==typeof d&&(d=!1),"undefined"==typeof n&&(n=!1),(!1===d||d&&b.alive)&&(!1===n||n&&b.visible)?this.setProperty(b,c,a,e,l):void 0};a.Group.prototype.setAll=function(b,c,a,d,n,e){"undefined"==typeof a&&
(a=!1);"undefined"==typeof d&&(d=!1);"undefined"==typeof e&&(e=!1);b=b.split(".");n=n||0;for(var l=0;l<this.children.length;l++)(!a||a&&this.children[l].alive)&&(!d||d&&this.children[l].visible)&&this.setProperty(this.children[l],b,c,n,e)};a.Group.prototype.setAllChildren=function(b,c,f,d,n,e){"undefined"==typeof f&&(f=!1);"undefined"==typeof d&&(d=!1);"undefined"==typeof e&&(e=!1);n=n||0;for(var l=0;l<this.children.length;l++)(!f||f&&this.children[l].alive)&&(!d||d&&this.children[l].visible)&&(this.children[l]instanceof
a.Group?this.children[l].setAllChildren(b,c,f,d,n,e):this.setProperty(this.children[l],b.split("."),c,n,e))};a.Group.prototype.checkAll=function(b,c,a,d,n){"undefined"==typeof a&&(a=!1);"undefined"==typeof d&&(d=!1);"undefined"==typeof n&&(n=!1);for(var e=0;e<this.children.length;e++)if((!a||a&&this.children[e].alive)&&(!d||d&&this.children[e].visible)&&!this.checkProperty(this.children[e],b,c,n))return!1;return!0};a.Group.prototype.addAll=function(b,c,a,d){this.setAll(b,c,a,d,1)};a.Group.prototype.subAll=
function(b,c,a,d){this.setAll(b,c,a,d,2)};a.Group.prototype.multiplyAll=function(b,c,a,d){this.setAll(b,c,a,d,3)};a.Group.prototype.divideAll=function(b,c,a,d){this.setAll(b,c,a,d,4)};a.Group.prototype.callAllExists=function(b,c){var a;if(2<arguments.length){a=[];for(var d=2;d<arguments.length;d++)a.push(arguments[d])}for(d=0;d<this.children.length;d++)this.children[d].exists===c&&this.children[d][b]&&this.children[d][b].apply(this.children[d],a)};a.Group.prototype.callbackFromArray=function(b,c,
a){if(1==a){if(b[c[0]])return b[c[0]]}else if(2==a){if(b[c[0]][c[1]])return b[c[0]][c[1]]}else if(3==a){if(b[c[0]][c[1]][c[2]])return b[c[0]][c[1]][c[2]]}else if(4==a){if(b[c[0]][c[1]][c[2]][c[3]])return b[c[0]][c[1]][c[2]][c[3]]}else if(b[c])return b[c];return!1};a.Group.prototype.callAll=function(b,c){if("undefined"!=typeof b){b=b.split(".");var a=b.length;if("undefined"==typeof c||null===c||""===c)c=null;else if("string"==typeof c){c=c.split(".");var d=c.length}var n;if(2<arguments.length){n=[];
for(var e=2;e<arguments.length;e++)n.push(arguments[e])}for(var l=null,g=null,e=0;e<this.children.length;e++)l=this.callbackFromArray(this.children[e],b,a),c&&l?(g=this.callbackFromArray(this.children[e],c,d),l&&l.apply(g,n)):l&&l.apply(this.children[e],n)}};a.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var b=this.children.length;b--;)this.children[b].preUpdate();return!0};a.Group.prototype.update=function(){for(var b=this.children.length;b--;)this.children[b].update()};
a.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var b=this.children.length;b--;)this.children[b].postUpdate()};a.Group.prototype.filter=function(b,c){for(var f=-1,d=this.children.length,n=[];++f<d;){var e=this.children[f];(!c||c&&e.exists)&&b(e,f,this.children)&&n.push(e)}return new a.ArraySet(n)};a.Group.prototype.forEach=function(b,c,a){if("undefined"==typeof a&&(a=!1),3>=arguments.length)for(var d=
0;d<this.children.length;d++)(!a||a&&this.children[d].exists)&&b.call(c,this.children[d]);else{for(var n=[null],d=3;d<arguments.length;d++)n.push(arguments[d]);for(d=0;d<this.children.length;d++)(!a||a&&this.children[d].exists)&&(n[0]=this.children[d],b.apply(c,n))}};a.Group.prototype.forEachExists=function(b,c){var f;if(2<arguments.length){f=[null];for(var d=2;d<arguments.length;d++)f.push(arguments[d])}this.iterate("exists",!0,a.Group.RETURN_TOTAL,b,c,f)};a.Group.prototype.forEachAlive=function(b,
c){var f;if(2<arguments.length){f=[null];for(var d=2;d<arguments.length;d++)f.push(arguments[d])}this.iterate("alive",!0,a.Group.RETURN_TOTAL,b,c,f)};a.Group.prototype.forEachDead=function(b,c){var f;if(2<arguments.length){f=[null];for(var d=2;d<arguments.length;d++)f.push(arguments[d])}this.iterate("alive",!1,a.Group.RETURN_TOTAL,b,c,f)};a.Group.prototype.sort=function(b,c){2>this.children.length||("undefined"==typeof b&&(b="z"),"undefined"==typeof c&&(c=a.Group.SORT_ASCENDING),this._sortProperty=
b,this.children.sort(c===a.Group.SORT_ASCENDING?this.ascendingSortHandler.bind(this):this.descendingSortHandler.bind(this)),this.updateZ())};a.Group.prototype.customSort=function(b,c){2>this.children.length||(this.children.sort(b.bind(c)),this.updateZ())};a.Group.prototype.ascendingSortHandler=function(b,c){return b[this._sortProperty]<c[this._sortProperty]?-1:b[this._sortProperty]>c[this._sortProperty]?1:b.z<c.z?-1:1};a.Group.prototype.descendingSortHandler=function(b,c){return b[this._sortProperty]<
c[this._sortProperty]?1:b[this._sortProperty]>c[this._sortProperty]?-1:0};a.Group.prototype.iterate=function(b,c,f,d,n,e){if(f===a.Group.RETURN_TOTAL&&0===this.children.length)return 0;for(var l=0,g=0;g<this.children.length;g++)if(this.children[g][b]===c&&(l++,d&&(e?(e[0]=this.children[g],d.apply(n,e)):d.call(n,this.children[g])),f===a.Group.RETURN_CHILD))return this.children[g];return f===a.Group.RETURN_TOTAL?l:null};a.Group.prototype.getFirstExists=function(b){return"boolean"!=typeof b&&(b=!0),
this.iterate("exists",b,a.Group.RETURN_CHILD)};a.Group.prototype.getFirstAlive=function(){return this.iterate("alive",!0,a.Group.RETURN_CHILD)};a.Group.prototype.getFirstDead=function(){return this.iterate("alive",!1,a.Group.RETURN_CHILD)};a.Group.prototype.getTop=function(){return 0<this.children.length?this.children[this.children.length-1]:void 0};a.Group.prototype.getBottom=function(){return 0<this.children.length?this.children[0]:void 0};a.Group.prototype.countLiving=function(){return this.iterate("alive",
!0,a.Group.RETURN_TOTAL)};a.Group.prototype.countDead=function(){return this.iterate("alive",!1,a.Group.RETURN_TOTAL)};a.Group.prototype.getRandom=function(b,c){return 0===this.children.length?null:(b=b||0,c=c||this.children.length,a.ArrayUtils.getRandomItem(this.children,b,c))};a.Group.prototype.remove=function(b,c,a){if("undefined"==typeof c&&(c=!1),"undefined"==typeof a&&(a=!1),0===this.children.length||-1===this.children.indexOf(b))return!1;a||!b.events||b.destroyPhase||b.events.onRemovedFromGroup$dispatch(b,
this);a=this.removeChild(b);var d=this._hash.indexOf(a);return-1!==d&&this._hash.splice(d,1),this.updateZ(),this.cursor===b&&this.next(),c&&a&&a.destroy(!0),!0};a.Group.prototype.removeAll=function(b,c){if("undefined"==typeof b&&(b=!1),"undefined"==typeof c&&(c=!1),0!==this.children.length){do{!c&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var a=this.removeChild(this.children[0]),d=this._hash.indexOf(a);-1!==d&&this._hash.splice(d,1);b&&a&&
a.destroy(!0)}while(0<this.children.length);this._hash=[];this.cursor=null}};a.Group.prototype.removeBetween=function(b,c,a,d){if("undefined"==typeof c&&(c=this.children.length-1),"undefined"==typeof a&&(a=!1),"undefined"==typeof d&&(d=!1),0!==this.children.length){if(b>c||0>b||c>this.children.length)return!1;for(;c>=b;){!d&&this.children[c].events&&this.children[c].events.onRemovedFromGroup$dispatch(this.children[c],this);var n=this.removeChild(this.children[c]),e=this._hash.indexOf(n);-1!==e&&this._hash.splice(e,
1);a&&n&&n.destroy(!0);this.cursor===this.children[c]&&(this.cursor=null);c--}this.updateZ()}};a.Group.prototype.destroy=function(b,c){null===this.game||this.ignoreDestroy||("undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=!1),this.onDestroy.dispatch(this,b,c),this.removeAll(b),this.cursor=null,this.filters=null,c||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))};Object.defineProperty(a.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,a.Group.RETURN_TOTAL)}});
Object.defineProperty(a.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(a.Group.prototype,"angle",{get:function(){return a.Math.radToDeg(this.rotation)},set:function(b){this.rotation=a.Math.degToRad(b)}});a.World=function(b){a.Group.call(this,b,null,"__world",!1);this.bounds=new a.Rectangle(0,0,b.width,b.height);this.camera=null;this._definedSize=!1;this._width=b.width;this._height=b.height};a.World.prototype=Object.create(a.Group.prototype);a.World.prototype.constructor=
a.World;a.World.prototype.boot=function(){this.camera=new a.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this;this.camera.scale=this.scale;this.game.camera=this.camera;this.game.stage.addChild(this)};a.World.prototype.setBounds=function(b,c,a,d){this._definedSize=!0;this._width=a;this._height=d;this.bounds.setTo(b,c,a,d);this.x=b;this.y=c;this.camera.bounds&&this.camera.bounds.setTo(b,c,Math.max(a,this.game.width),Math.max(d,this.game.height));this.game.physics.setBoundsToWorld()};
a.World.prototype.resize=function(b,c){this._definedSize&&(b<this._width&&(b=this._width),c<this._height&&(c=this._height));this.bounds.width=b;this.bounds.height=c;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};a.World.prototype.shutdown=function(){this.destroy(!0,!0)};a.World.prototype.wrap=function(b,c,a,d,n){"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a=!1);"undefined"==typeof d&&(d=!0);"undefined"==typeof n&&(n=!0);a?(b.getBounds(),d&&(b.x+b._currentBounds.width<
this.bounds.x?b.x=this.bounds.right:b.x>this.bounds.right&&(b.x=this.bounds.left)),n&&(b.y+b._currentBounds.height<this.bounds.top?b.y=this.bounds.bottom:b.y>this.bounds.bottom&&(b.y=this.bounds.top))):(d&&b.x+c<this.bounds.x?b.x=this.bounds.right+c:d&&b.x-c>this.bounds.right&&(b.x=this.bounds.left-c),n&&b.y+c<this.bounds.top?b.y=this.bounds.bottom+c:n&&b.y-c>this.bounds.bottom&&(b.y=this.bounds.top-c))};Object.defineProperty(a.World.prototype,"width",{get:function(){return this.bounds.width},set:function(b){b<
this.game.width&&(b=this.game.width);this._width=this.bounds.width=b;this._definedSize=!0}});Object.defineProperty(a.World.prototype,"height",{get:function(){return this.bounds.height},set:function(b){b<this.game.height&&(b=this.game.height);this._height=this.bounds.height=b;this._definedSize=!0}});Object.defineProperty(a.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}});Object.defineProperty(a.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}});Object.defineProperty(a.World.prototype,
"randomX",{get:function(){return 0>this.bounds.x?this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}});Object.defineProperty(a.World.prototype,"randomY",{get:function(){return 0>this.bounds.y?this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}});a.FlexGrid=function(b,c,f){this.game=b.game;this.manager=b;
this.width=c;this.height=f;this.boundsCustom=new a.Rectangle(0,0,c,f);this.boundsFluid=new a.Rectangle(0,0,c,f);this.boundsFull=new a.Rectangle(0,0,c,f);this.boundsNone=new a.Rectangle(0,0,c,f);this.positionCustom=new a.Point(0,0);this.positionFluid=new a.Point(0,0);this.positionFull=new a.Point(0,0);this.positionNone=new a.Point(0,0);this.scaleCustom=new a.Point(1,1);this.scaleFluid=new a.Point(1,1);this.scaleFluidInversed=new a.Point(1,1);this.scaleFull=new a.Point(1,1);this.scaleNone=new a.Point(1,
1);this.customOffsetY=this.customOffsetX=this.customHeight=this.customWidth=0;this.ratioH=c/f;this.ratioV=f/c;this.multiplier=0;this.layers=[]};a.FlexGrid.prototype={setSize:function(b,c){this.width=b;this.height=c;this.ratioH=b/c;this.ratioV=c/b;this.scaleNone=new a.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(b,c,f,d){"undefined"==typeof d&&(d=!0);this.customWidth=b;this.customHeight=c;this.boundsCustom.width=b;this.boundsCustom.height=
c;b=new a.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return d&&this.game.world.add(b),this.layers.push(b),"undefined"!=typeof f&&null!==typeof f&&b.addMultiple(f),b},createFluidLayer:function(b,c){"undefined"==typeof c&&(c=!0);var f=new a.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return c&&this.game.world.add(f),this.layers.push(f),"undefined"!=typeof b&&null!==typeof b&&f.addMultiple(b),f},createFullLayer:function(b){var c=new a.FlexLayer(this,
this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(c),this.layers.push(c),"undefined"!=typeof b&&c.addMultiple(b),c},createFixedLayer:function(b){var c=new a.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(c),this.layers.push(c),"undefined"!=typeof b&&c.addMultiple(b),c},reset:function(){for(var b=this.layers.length;b--;)this.layers[b].persist||(this.layers[b].position=null,this.layers[b].scale=null,this.layers.slice(b,1))},onResize:function(b,
c){this.ratioH=b/c;this.ratioV=c/b;this.refresh(b,c)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width);this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/
this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(b){this.manager.scaleSprite(b);
b.x=this.manager.bounds.centerX;b.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}};a.FlexGrid.prototype.constructor=a.FlexGrid;a.FlexLayer=function(b,c,f,d){a.Group.call(this,b.game,null,"__flexLayer"+b.game.rnd.uuid(),!1);this.manager=b.manager;this.grid=b;this.persist=!1;this.position=c;this.bounds=f;this.scale=d;this.topLeft=
f.topLeft;this.topMiddle=new a.Point(f.halfWidth,0);this.topRight=f.topRight;this.bottomLeft=f.bottomLeft;this.bottomMiddle=new a.Point(f.halfWidth,f.bottom);this.bottomRight=f.bottomRight};a.FlexLayer.prototype=Object.create(a.Group.prototype);a.FlexLayer.prototype.constructor=a.FlexLayer;a.FlexLayer.prototype.resize=function(){};a.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,
"rgba(0,0,255,0.9",!1);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};a.ScaleManager=function(b,c,f){this.game=b;this.dom=a.DOM;this.grid=null;this.height=this.width=0;this.maxHeight=this.minHeight=this.maxWidth=this.minWidth=null;this.offset=new a.Point;this._pageAlignVertically=this._pageAlignHorizontally=this.incorrectOrientation=this.forcePortrait=this.forceLandscape=
!1;this.maxIterations=5;this.onOrientationChange=new a.Signal;this.enterLandscape=new a.Signal;this.enterPortrait=new a.Signal;this.enterIncorrectOrientation=new a.Signal;this.leaveIncorrectOrientation=new a.Signal;this._createdFullScreenTarget=this.fullScreenTarget=null;this.onFullScreenInit=new a.Signal;this.onFullScreenChange=new a.Signal;this.onFullScreenError=new a.Signal;this.enterFullScreen=new a.Signal;this.leaveFullScreen=new a.Signal;this.fullScreenFailed=this.onFullScreenError;this.screenOrientation=
this.dom.getScreenOrientation();this.scaleFactor=new a.Point(1,1);this.scaleFactorInversed=new a.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new a.Rectangle;this.sourceAspectRatio=this.aspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""};this._fullScreenScaleMode=this._scaleMode=
a.ScaleManager.NO_SCALE;this.parentIsWindow=!1;this.parentNode=null;this.parentScaleFactor=new a.Point(1,1);this.trackParentInterval=2E3;this.onSizeChange=new a.Signal;this._fullScreenRestore=this.onResizeContext=this.onResize=null;this._gameSize=new a.Rectangle;this._userScaleFactor=new a.Point(1,1);this._userScaleTrim=new a.Point(0,0);this._updateThrottle=this._lastUpdate=0;this._updateThrottleReset=100;this._parentBounds=new a.Rectangle;this._tempBounds=new a.Rectangle;this._lastReportedCanvasSize=
new a.Rectangle;this._lastReportedGameSize=new a.Rectangle;b.config&&this.parseConfig(b.config);this.setupScale(c,f)};a.ScaleManager.EXACT_FIT=0;a.ScaleManager.NO_SCALE=1;a.ScaleManager.SHOW_ALL=2;a.ScaleManager.RESIZE=3;a.ScaleManager.USER_SCALE=4;a.ScaleManager.prototype={boot:function(){var b=this.compatibility;b.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(b.scrollTo=this.game.device.android&&
!this.game.device.chrome?new a.Point(0,1):new a.Point(0,0));this.game.device.desktop?(b.orientationFallback="screen",b.clickTrampoline="when-not-mouse"):(b.orientationFallback="",b.clickTrampoline="");var c=this;this._orientationChange=function(b){return c.orientationChange(b)};this._windowResize=function(b){return c.windowResize(b)};window.addEventListener("orientationchange",this._orientationChange,!1);window.addEventListener("resize",this._windowResize,!1);this.compatibility.supportsFullScreen&&
(this._fullScreenChange=function(b){return c.fullScreenChange(b)},this._fullScreenError=function(b){return c.fullScreenError(b)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),
document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1));this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);
this.grid=new a.FlexGrid(this,this.width,this.height)},parseConfig:function(b){b.scaleMode&&(this.scaleMode=b.scaleMode);b.fullScreenScaleMode&&(this.fullScreenScaleMode=b.fullScreenScaleMode);b.fullScreenTarget&&(this.fullScreenTarget=b.fullScreenTarget)},setupScale:function(b,c){var f,d=new a.Rectangle;""!==this.game.parent&&("string"==typeof this.game.parent?f=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(f=this.game.parent));f?(this.parentNode=f,this.parentIsWindow=
!1,this.getParentBounds(this._parentBounds),d.width=this._parentBounds.width,d.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,d.width=this.dom.visualBounds.width,d.height=this.dom.visualBounds.height,this.offset.set(0,0));var n=f=0;"number"==typeof b?f=b:(this.parentScaleFactor.x=parseInt(b,10)/100,f=d.width*this.parentScaleFactor.x);"number"==typeof c?n=c:(this.parentScaleFactor.y=parseInt(c,10)/100,n=d.height*
this.parentScaleFactor.y);this._gameSize.setTo(0,0,f,n);this.updateDimensions(f,n,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(b,c){this._gameSize.setTo(0,0,b,c);this.currentScaleMode!==a.ScaleManager.RESIZE&&this.updateDimensions(b,c,!0);this.queueUpdate(!0)},setUserScale:function(b,c,a,d){this._userScaleFactor.setTo(b,c);this._userScaleTrim.setTo(0|a,0|d);this.queueUpdate(!0)},setResizeCallback:function(b,c){this.onResize=b;this.onResizeContext=c},signalSizeChange:function(){if(!a.Rectangle.sameDimensions(this,
this._lastReportedCanvasSize)||!a.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var b=this.width,c=this.height;this._lastReportedCanvasSize.setTo(0,0,b,c);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);this.grid.onResize(b,c);this.onSizeChange.dispatch(this,b,c);this.currentScaleMode===a.ScaleManager.RESIZE&&(this.game.state.resize(b,c),this.game.load.resize(b,c))}},setMinMax:function(b,c,a,d){this.minWidth=b;this.minHeight=c;"undefined"!=typeof a&&(this.maxWidth=
a);"undefined"!=typeof d&&(this.maxHeight=d)},preUpdate:function(){if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){var b=this._updateThrottle;this._updateThrottleReset=400<=b?0:100;this.dom.getOffset(this.game.canvas,this.offset);var c=this._parentBounds.width,f=this._parentBounds.height,d=this.getParentBounds(this._parentBounds),c=d.width!==c||d.height!==f,f=this.updateOrientationState();(c||f)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,d),this.updateLayout(),
this.signalSizeChange());d=2*this._updateThrottle;this._updateThrottle<b&&(d=Math.min(b,this._updateThrottleReset));this._updateThrottle=a.Math.clamp(d,25,this.trackParentInterval);this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(b,c,a){this.width=b*this.parentScaleFactor.x;this.height=c*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/
this.height;this.updateScalingAndBounds();a&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;this.game.canvas&&this.dom.getOffset(this.game.canvas,
this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(b,c){"undefined"==typeof c&&(c=!1);this.forceLandscape=b;this.forcePortrait=c;this.queueUpdate(!0)},classifyOrientation:function(b){return"portrait-primary"===b||"portrait-secondary"===b?"portrait":"landscape-primary"===b||"landscape-secondary"===b?"landscape":null},updateOrientationState:function(){var b=
this.screenOrientation,c=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var a=b!==this.screenOrientation,d=c!==this.incorrectOrientation;return a&&(this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0)),d&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():
this.leaveIncorrectOrientation.dispatch()),(a||d)&&this.onOrientationChange.dispatch(this,b,c),a||d},orientationChange:function(b){this.event=b;this.queueUpdate(!0)},windowResize:function(b){this.event=b;this.queueUpdate(!0)},scrollTop:function(){var b=this.compatibility.scrollTo;b&&window.scrollTo(b.x,b.y)},refresh:function(){this.scrollTop();this.queueUpdate(!0)},updateLayout:function(){var b=this.currentScaleMode;if(b===a.ScaleManager.RESIZE)return void this.reflowGame();(this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&
(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():b===a.ScaleManager.EXACT_FIT?this.setExactFit():b===a.ScaleManager.SHOW_ALL?!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent?(this.setShowAll(!0),this.resetCanvas(),this.setShowAll()):this.setShowAll():b===a.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):b===a.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-
this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),this.compatibility.canExpandParent||b!==a.ScaleManager.SHOW_ALL&&b!==a.ScaleManager.USER_SCALE)||(b=this.getParentBounds(this._tempBounds),this.width=Math.min(this.width,b.width),this.height=Math.min(this.height,b.height));this.width|=0;this.height|=0;this.reflowCanvas()},getParentBounds:function(b){b=b||new a.Rectangle;var c=this.boundingParent,f=this.dom.visualBounds,d=this.dom.layoutBounds;if(c){c=
c.getBoundingClientRect();b.setTo(c.left,c.top,c.width,c.height);c=this.windowConstraints;if(c.right){var n="layout"===c.right?d:f;b.right=Math.min(b.right,n.width)}c.bottom&&(n="layout"===c.bottom?d:f,b.bottom=Math.min(b.bottom,n.height))}else b.setTo(0,0,f.width,f.height);return b.setTo(Math.round(b.x),Math.round(b.y),Math.round(b.width),Math.round(b.height)),b},alignCanvas:function(b,c){var a=this.getParentBounds(this._tempBounds),d=this.game.canvas,n=this.margin;if(b){n.left=n.right=0;var e=d.getBoundingClientRect();
if(this.width<a.width&&!this.incorrectOrientation){var l=e.left-a.x,g=a.width/2-this.width/2,g=Math.max(g,0);n.left=Math.round(g-l)}d.style.marginLeft=n.left+"px";0!==n.left&&(n.right=-(a.width-e.width-n.left),d.style.marginRight=n.right+"px")}c&&(n.top=n.bottom=0,e=d.getBoundingClientRect(),this.height<a.height&&!this.incorrectOrientation&&(l=e.top-a.y,g=a.height/2-this.height/2,g=Math.max(g,0),n.top=Math.round(g-l)),d.style.marginTop=n.top+"px",0!==n.top&&(n.bottom=-(a.height-e.height-n.top),d.style.marginBottom=
n.bottom+"px"));n.x=n.left;n.y=n.top},reflowGame:function(){this.resetCanvas("","");var b=this.getParentBounds(this._tempBounds);this.updateDimensions(b.width,b.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=a.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=a.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height));this.resetCanvas();this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,
!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically));this.updateScalingAndBounds()},resetCanvas:function(b,c){"undefined"==typeof b&&(b=this.width+"px");"undefined"==typeof c&&(c=this.height+"px");var a=this.game.canvas;this.compatibility.noMargins||(a.style.marginLeft="",a.style.marginTop="",a.style.marginRight="",a.style.marginBottom="");a.style.width=b;a.style.height=c},queueUpdate:function(b){b&&(this._parentBounds.width=0,this._parentBounds.height=0);this._updateThrottle=
this._updateThrottleReset},reset:function(b){b&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(b){var c=this.getParentBounds(this._tempBounds),a=c.width,c=c.height;b=b?Math.max(c/this.game.height,a/this.game.width):Math.min(c/this.game.height,a/this.game.width);this.width=Math.round(this.game.width*b);this.height=Math.round(this.game.height*b)},setExactFit:function(){var b=this.getParentBounds(this._tempBounds);
this.width=b.width;this.height=b.height;this.isFullScreen||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var b=document.createElement("div");return b.style.margin="0",b.style.padding="0",b.style.background="#000",b},startFullScreen:function(b,c){if(this.isFullScreen)return!1;if(!this.compatibility.supportsFullScreen){var f=this;return void setTimeout(function(){f.fullScreenError()},
10)}if("when-not-mouse"===this.compatibility.clickTrampoline){var d=this.game.input;if(d.activePointer&&d.activePointer!==d.mousePointer&&(c||!1!==c))return void d.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[b,!1])}"undefined"!=typeof b&&this.game.renderType===a.CANVAS&&(this.game.stage.smoothed=b);(d=this.fullScreenTarget)||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),d=this._createdFullScreenTarget);if(this.onFullScreenInit.dispatch(this,
{targetElement:d}),this._createdFullScreenTarget){var n=this.game.canvas;n.parentNode.insertBefore(d,n);d.appendChild(n)}return this.game.device.fullscreenKeyboard?d[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):d[this.game.device.requestFullscreen](),!0},stopFullScreen:function(){return this.isFullScreen&&this.compatibility.supportsFullScreen?(document[this.game.device.cancelFullscreen](),!0):!1},cleanupCreatedTarget:function(){var b=this._createdFullScreenTarget;if(b&&b.parentNode){var c=
b.parentNode;c.insertBefore(this.game.canvas,b);c.removeChild(b)}this._createdFullScreenTarget=null},prepScreenMode:function(b){var c=!!this._createdFullScreenTarget,f=this._createdFullScreenTarget||this.fullScreenTarget;b?(c||this.fullScreenScaleMode===a.ScaleManager.EXACT_FIT)&&f!==this.game.canvas&&(this._fullScreenRestore={targetWidth:f.style.width,targetHeight:f.style.height},f.style.width="100%",f.style.height="100%"):(this._fullScreenRestore&&(f.style.width=this._fullScreenRestore.targetWidth,
f.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(b){this.event=b;this.isFullScreen?(this.prepScreenMode(!0),this.updateLayout(),this.queueUpdate(!0),this.enterFullScreen.dispatch(this.width,this.height)):(this.prepScreenMode(!1),this.cleanupCreatedTarget(),this.updateLayout(),this.queueUpdate(!0),this.leaveFullScreen.dispatch(this.width,this.height));
this.onFullScreenChange.dispatch(this)},fullScreenError:function(b){this.event=b;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(b,c,a,d){if("undefined"==typeof c&&(c=this.width),"undefined"==typeof a&&(a=this.height),"undefined"==typeof d&&(d=!1),b.scale.set(1),0>=b.width||0>=b.height||0>=c||0>=a)return b;var n=b.height*c/b.width,e=b.width*a/b.height,
l=e>c;return l=l?d:!d,l?(b.width=Math.floor(c),b.height=Math.floor(n)):(b.width=Math.floor(e),b.height=Math.floor(a)),b},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,!1);window.removeEventListener("resize",this._windowResize,!1);this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,
!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}};a.ScaleManager.prototype.constructor=a.ScaleManager;
a.ScaleManager.prototype.checkResize=a.ScaleManager.prototype.windowResize;a.ScaleManager.prototype.checkOrientation=a.ScaleManager.prototype.orientationChange;a.ScaleManager.prototype.setScreenSize=a.ScaleManager.prototype.updateLayout;a.ScaleManager.prototype.setSize=a.ScaleManager.prototype.reflowCanvas;a.ScaleManager.prototype.checkOrientationState=function(){var b=this.updateOrientationState();return b&&this.refresh(),b};Object.defineProperty(a.ScaleManager.prototype,"boundingParent",{get:function(){return this.parentIsWindow||
this.isFullScreen&&!this._createdFullScreenTarget?null:this.game.canvas&&this.game.canvas.parentNode||null}});Object.defineProperty(a.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(b){return b!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=b),this._scaleMode}});Object.defineProperty(a.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},
set:function(b){return b!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=b,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=b),this._fullScreenScaleMode}});Object.defineProperty(a.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(a.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},
set:function(b){b!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=b,this.queueUpdate(!0))}});Object.defineProperty(a.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(b){b!==this._pageAlignVertically&&(this._pageAlignVertically=b,this.queueUpdate(!0))}});Object.defineProperty(a.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||
document.msFullscreenElement)}});Object.defineProperty(a.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}});Object.defineProperty(a.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}});Object.defineProperty(a.ScaleManager.prototype,"orientation",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)?0:90}});Object.defineProperty(a.ScaleManager.prototype,
"isGamePortrait",{get:function(){return this.height>this.width}});Object.defineProperty(a.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}});a.Game=function(b,c,f,d,n,e,l,g){return this.id=a.GAMES.push(this)-1,this.config=null,this.physicsConfig=g,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.renderer=null,this.renderType=a.AUTO,this.state=
null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=a.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.lockRender=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,
this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new a.Signal,this.forceSingleUpdate=!1,this._nextFpsNotification=0,1===arguments.length&&"object"==typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},"undefined"!=typeof b&&(this._width=b),"undefined"!=typeof c&&(this._height=c),"undefined"!=
typeof f&&(this.renderType=f),"undefined"!=typeof d&&(this.parent=d),"undefined"!=typeof e&&(this.transparent=e),"undefined"!=typeof l&&(this.antialias=l),this.rnd=new a.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new a.StateManager(this,n)),this.device.whenReady(this.boot,this),this};a.Game.prototype={parseConfig:function(b){this.config=b;"undefined"==typeof b.enableDebug&&(this.config.enableDebug=!0);b.width&&(this._width=b.width);b.height&&(this._height=b.height);b.renderer&&
(this.renderType=b.renderer);b.parent&&(this.parent=b.parent);b.transparent&&(this.transparent=b.transparent);b.antialias&&(this.antialias=b.antialias);b.resolution&&(this.resolution=b.resolution);b.preserveDrawingBuffer&&(this.preserveDrawingBuffer=b.preserveDrawingBuffer);b.physicsConfig&&(this.physicsConfig=b.physicsConfig);var c=[(Date.now()*Math.random()).toString()];b.seed&&(c=b.seed);this.rnd=new a.RandomDataGenerator(c);c=null;b.state&&(c=b.state);this.state=new a.StateManager(this,c)},boot:function(){this.isBooted||
(this.onPause=new a.Signal,this.onResume=new a.Signal,this.onBlur=new a.Signal,this.onFocus=new a.Signal,this.isBooted=!0,this.math=a.Math,this.scale=new a.ScaleManager(this,this._width,this._height),this.stage=new a.Stage(this),this.setUpRenderer(),this.world=new a.World(this),this.add=new a.GameObjectFactory(this),this.make=new a.GameObjectCreator(this),this.cache=new a.Cache(this),this.load=new a.Loader(this),this.time=new a.Time(this),this.tweens=new a.TweenManager(this),this.input=new a.Input(this),
this.sound=new a.SoundManager(this),this.physics=new a.Physics(this,this.physicsConfig),this.particles=new a.Particles(this),this.plugins=new a.PluginManager(this),this.net=new a.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new a.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){}},this.showDebugHeader(),this.isRunning=
!0,this.raf=this.config&&this.config.forceSetTimeOut?new a.RequestAnimationFrame(this,this.config.forceSetTimeOut):new a.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.raf.start())},showDebugHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var b=a.VERSION,c="Canvas",f="HTML Audio",d=1;if(this.renderType===a.WEBGL?(c="WebGL",d++):this.renderType==a.HEADLESS&&
(c="Headless"),this.device.webAudio&&(f="WebAudio",d++),this.device.chrome){b=["%c %c %c Phaser v"+b+" | Pixi.js "+PIXI.VERSION+" | "+c+" | "+f+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #9854d8","background: #6c2ca7","color: #ffffff; background: #450f78;","background: #6c2ca7","background: #9854d8","background: #ffffff"];for(c=0;3>c;c++)b.push(d>c?"color: #ff2424; background: #fff":"color: #959595; background: #fff");console.log.apply(console,b)}else window.console&&console.log("Phaser v"+
b+" | Pixi.js "+PIXI.VERSION+" | "+c+" | "+f+" | http://phaser.io")}},setUpRenderer:function(){if(this.canvas=this.config.canvasID?a.Canvas.create(this.width,this.height,this.config.canvasID):a.Canvas.create(this.width,this.height),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===a.CANVAS?!0:!1),this.renderType===a.HEADLESS||this.renderType===a.CANVAS||
this.renderType===a.AUTO&&!1===this.device.webGL){if(!this.device.canvas)throw Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.");this.renderType===a.AUTO&&(this.renderType=a.CANVAS);this.renderer=new PIXI.CanvasRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,clearBeforeRender:!0});this.context=this.renderer.context}else this.renderType=a.WEBGL,this.renderer=new PIXI.WebGLRenderer(this.width,this.height,{view:this.canvas,
transparent:this.transparent,resolution:this.resolution,antialias:this.antialias,preserveDrawingBuffer:this.preserveDrawingBuffer}),this.context=null;this.renderType!==a.HEADLESS&&(this.stage.smoothed=this.antialias,a.Canvas.addToDOM(this.canvas,this.parent,!1),a.Canvas.setTouchAction(this.canvas))},update:function(b){if(this.time.update(b),this._kickstart)return this.updateLogic(1/this.time.desiredFps),this.stage.updateTransform(),this.updateRender(this.time.slowMotion*this.time.desiredFps),void(this._kickstart=
!1);if(1<this._spiraling&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1E4,this.fpsProblemNotifier.dispatch()),this._spiraling=this._deltaTime=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{b=1E3*this.time.slowMotion/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(3*b,this.time.elapsed),0);var c=0;this.updatesThisFrame=Math.floor(this._deltaTime/b);for(this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,
this.updatesThisFrame));this._deltaTime>=b&&(this._deltaTime-=b,this.currentUpdateID=c,this.updateLogic(1/this.time.desiredFps),this.stage.updateTransform(),c++,!this.forceSingleUpdate||1!==c););c>this._lastCount?this._spiraling++:c<this._lastCount&&(this._spiraling=0);this._lastCount=c;this.updateRender(this._deltaTime/b)}},updateLogic:function(b){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),
this.debug.preUpdate(),this.world.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(b),this.plugins.preUpdate(b),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(b),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate())},updateRender:function(b){this.lockRender||(this.state.preRender(b),this.renderer.render(this.stage),this.plugins.render(b),this.state.render(b),
this.plugins.postRender(b))},enableStep:function(){this.stepping=!0;this.pendingStep=!1;this.stepCount=0},disableStep:function(){this.pendingStep=this.stepping=!1},step:function(){this.pendingStep=!1;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.world=this.time=this.stage=this.sound=this.load=this.input=this.cache=this.state=null;this.isBooted=!1;this.renderer.destroy(!1);
a.Canvas.removeFromDOM(this.canvas);a.GAMES[this.id]=null},gamePaused:function(b){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(b))},gameResumed:function(b){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(b))},focusLoss:function(b){this.onBlur.dispatch(b);this.stage.disableVisibilityChange||this.gamePaused(b)},focusGain:function(b){this.onFocus.dispatch(b);
this.stage.disableVisibilityChange||this.gameResumed(b)}};a.Game.prototype.constructor=a.Game;Object.defineProperty(a.Game.prototype,"paused",{get:function(){return this._paused},set:function(b){!0===b?(!1===this._paused&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}});a.Input=function(b){this.game=
b;this.hitContext=this.hitCanvas=null;this.moveCallbacks=[];this.moveCallback=null;this.moveCallbackContext=this;this.pollRate=0;this.enabled=!0;this.multiInputOverride=a.Input.MOUSE_TOUCH_COMBINE;this.scale=this.circle=this.speed=this.position=null;this.maxPointers=-1;this.currentPointers=0;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2E3;this.justReleasedRate=this.justPressedRate=200;this.recordPointerHistory=!1;this.recordLimit=this.recordRate=100;this.pointer10=this.pointer9=this.pointer8=
this.pointer7=this.pointer6=this.pointer5=this.pointer4=this.pointer3=this.pointer2=this.pointer1=null;this.pointers=[];this.gamepad=this.mspointer=this.touch=this.keyboard=this.mouse=this.mousePointer=this.activePointer=null;this.resetLocked=!1;this.onHold=this.onTap=this.onUp=this.onDown=null;this.minPriorityID=0;this.interactiveItems=new a.ArraySet;this._localPoint=new a.Point;this._pollCounter=0;this._oldPosition=null;this._y=this._x=0};a.Input.MOUSE_OVERRIDES_TOUCH=0;a.Input.TOUCH_OVERRIDES_MOUSE=
1;a.Input.MOUSE_TOUCH_COMBINE=2;a.Input.MAX_POINTERS=10;a.Input.prototype={boot:function(){this.mousePointer=new a.Pointer(this.game,0);this.addPointer();this.addPointer();this.mouse=new a.Mouse(this.game);this.touch=new a.Touch(this.game);this.mspointer=new a.MSPointer(this.game);a.Keyboard&&(this.keyboard=new a.Keyboard(this.game));a.Gamepad&&(this.gamepad=new a.Gamepad(this.game));this.onDown=new a.Signal;this.onUp=new a.Signal;this.onTap=new a.Signal;this.onHold=new a.Signal;this.scale=new a.Point(1,
1);this.speed=new a.Point;this.position=new a.Point;this._oldPosition=new a.Point;this.circle=new a.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.touch.start();this.mspointer.start();this.mousePointer.active=!0;this.keyboard&&this.keyboard.start();var b=this;this._onClickTrampoline=function(c){b.onClickTrampoline(c)};
this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();this.keyboard&&this.keyboard.stop();this.gamepad&&this.gamepad.stop();this.moveCallbacks=[];this.game.canvas.removeEventListener("click",this._onClickTrampoline)},addMoveCallback:function(b,c){return this.moveCallbacks.push({callback:b,context:c})-1},deleteMoveCallback:function(b){this.moveCallbacks[b]&&this.moveCallbacks.splice(b,1)},addPointer:function(){if(this.pointers.length>=
a.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: only "+a.Input.MAX_POINTERS+" pointer allowed"),null;var b=this.pointers.length+1,c=new a.Pointer(this.game,b);return this.pointers.push(c),this["pointer"+b]=c,c},update:function(){if(this.keyboard&&this.keyboard.update(),0<this.pollRate&&this._pollCounter<this.pollRate)return void this._pollCounter++;this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);
this.mousePointer.update();this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var b=0;b<this.pointers.length;b++)this.pointers[b].update();this._pollCounter=0},reset:function(b){if(this.game.isBooted&&!this.resetLocked){"undefined"==typeof b&&(b=!1);this.mousePointer.reset();this.keyboard&&this.keyboard.reset(b);this.gamepad&&this.gamepad.reset();for(var c=0;c<this.pointers.length;c++)this.pointers[c].reset();this.currentPointers=0;"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor=
"inherit");b&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new a.Signal,this.onUp=new a.Signal,this.onTap=new a.Signal,this.onHold=new a.Signal,this.moveCallbacks=[]);this._pollCounter=0}},resetSpeed:function(b,c){this._oldPosition.setTo(b,c);this.speed.setTo(0,0)},startPointer:function(b){if(0<=this.maxPointers&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(b);if(!this.pointer2.active)return this.pointer2.start(b);
for(var c=2;c<this.pointers.length;c++){var a=this.pointers[c];if(!a.active)return a.start(b)}return null},updatePointer:function(b){if(this.pointer1.active&&this.pointer1.identifier===b.identifier)return this.pointer1.move(b);if(this.pointer2.active&&this.pointer2.identifier===b.identifier)return this.pointer2.move(b);for(var c=2;c<this.pointers.length;c++){var a=this.pointers[c];if(a.active&&a.identifier===b.identifier)return a.move(b)}return null},stopPointer:function(b){if(this.pointer1.active&&
this.pointer1.identifier===b.identifier)return this.pointer1.stop(b);if(this.pointer2.active&&this.pointer2.identifier===b.identifier)return this.pointer2.stop(b);for(var c=2;c<this.pointers.length;c++){var a=this.pointers[c];if(a.active&&a.identifier===b.identifier)return a.stop(b)}return null},countActivePointers:function(b){"undefined"==typeof b&&(b=this.pointers.length);for(var c=b,a=0;a<this.pointers.length&&0<c;a++)this.pointers[a].active&&c--;return this.currentPointers=b-c,b-c},getPointer:function(b){"undefined"==
typeof b&&(b=!1);for(var c=0;c<this.pointers.length;c++){var a=this.pointers[c];if(a.active===b)return a}return null},getPointerFromIdentifier:function(b){for(var c=0;c<this.pointers.length;c++){var a=this.pointers[c];if(a.identifier===b)return a}return null},getPointerFromId:function(b){for(var c=0;c<this.pointers.length;c++){var a=this.pointers[c];if(a.pointerId===b)return a}return null},getLocalPosition:function(b,c,f){"undefined"==typeof f&&(f=new a.Point);b=b.worldTransform;var d=1/(b.a*b.d+
b.c*-b.b);return f.setTo(b.d*d*c.x+-b.c*d*c.y+(b.ty*b.c-b.tx*b.d)*d,b.a*d*c.y+-b.b*d*c.x+(-b.ty*b.a+b.tx*b.b)*d)},hitTest:function(b,c,f){if(!b.worldVisible)return!1;if(this.getLocalPosition(b,c,this._localPoint),f.copyFrom(this._localPoint),b.hitArea&&b.hitArea.contains)return b.hitArea.contains(this._localPoint.x,this._localPoint.y);if(b instanceof a.TileSprite){var d=b.width,n=b.height,e=-d*b.anchor.x;if(this._localPoint.x>=e&&this._localPoint.x<e+d&&(d=-n*b.anchor.y,this._localPoint.y>=d&&this._localPoint.y<
d+n))return!0}else if(b instanceof PIXI.Sprite){if(d=b.texture.frame.width,n=b.texture.frame.height,e=-d*b.anchor.x,this._localPoint.x>=e&&this._localPoint.x<e+d&&(d=-n*b.anchor.y,this._localPoint.y>=d&&this._localPoint.y<d+n))return!0}else if(b instanceof a.Graphics)for(n=0;n<b.graphicsData.length;n++)if(d=b.graphicsData[n],d.fill&&d.shape&&d.shape.contains(this._localPoint.x,this._localPoint.y))return!0;n=0;for(d=b.children.length;d>n;n++)if(this.hitTest(b.children[n],c,f))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};
a.Input.prototype.constructor=a.Input;Object.defineProperty(a.Input.prototype,"x",{get:function(){return this._x},set:function(b){this._x=Math.floor(b)}});Object.defineProperty(a.Input.prototype,"y",{get:function(){return this._y},set:function(b){this._y=Math.floor(b)}});Object.defineProperty(a.Input.prototype,"pollLocked",{get:function(){return 0<this.pollRate&&this._pollCounter<this.pollRate}});Object.defineProperty(a.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-
this.countActivePointers()}});Object.defineProperty(a.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(a.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(a.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});Object.defineProperty(a.Input.prototype,"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});a.Mouse=function(b){this.callbackContext=
this.game=b;this.mouseWheelCallback=this.mouseOverCallback=this.mouseOutCallback=this.mouseUpCallback=this.mouseMoveCallback=this.mouseDownCallback=null;this.capture=!1;this.button=-1;this.wheelDelta=0;this.enabled=!0;this.stopOnGameOut=this.locked=!1;this.pointerLock=new a.Signal;this._wheelEvent=this._onMouseWheel=this._onMouseOver=this._onMouseOut=this._onMouseUp=this._onMouseMove=this._onMouseDown=this.event=null};a.Mouse.NO_BUTTON=-1;a.Mouse.LEFT_BUTTON=0;a.Mouse.MIDDLE_BUTTON=1;a.Mouse.RIGHT_BUTTON=
2;a.Mouse.WHEEL_UP=1;a.Mouse.WHEEL_DOWN=-1;a.Mouse.prototype={start:function(){if((!this.game.device.android||!1!==this.game.device.chrome)&&null===this._onMouseDown){var b=this;this._onMouseDown=function(c){return b.onMouseDown(c)};this._onMouseMove=function(c){return b.onMouseMove(c)};this._onMouseUp=function(c){return b.onMouseUp(c)};this._onMouseUpGlobal=function(c){return b.onMouseUpGlobal(c)};this._onMouseOut=function(c){return b.onMouseOut(c)};this._onMouseOver=function(c){return b.onMouseOver(c)};
this._onMouseWheel=function(c){return b.onMouseWheel(c)};this.game.canvas.addEventListener("mousedown",this._onMouseDown,!0);this.game.canvas.addEventListener("mousemove",this._onMouseMove,!0);this.game.canvas.addEventListener("mouseup",this._onMouseUp,!0);this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),this.game.canvas.addEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.addEventListener("mouseout",this._onMouseOut,!0));var c=this.game.device.wheelEvent;
c&&(this.game.canvas.addEventListener(c,this._onMouseWheel,!0),"mousewheel"===c?this._wheelEvent=new e(-.025,1):"DOMMouseScroll"===c&&(this._wheelEvent=new e(1,1)))}},onMouseDown:function(b){this.event=b;this.capture&&b.preventDefault();this.button=b.button;this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&(b.identifier=0,this.game.input.mousePointer.start(b))},onMouseMove:function(b){this.event=b;this.capture&&b.preventDefault();this.mouseMoveCallback&&
this.mouseMoveCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&(b.identifier=0,this.game.input.mousePointer.move(b))},onMouseUp:function(b){this.event=b;this.capture&&b.preventDefault();this.button=a.Mouse.NO_BUTTON;this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&(b.identifier=0,this.game.input.mousePointer.stop(b))},onMouseUpGlobal:function(b){this.game.input.mousePointer.withinGame||(this.button=a.Mouse.NO_BUTTON,
this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,b),b.identifier=0,this.game.input.mousePointer.stop(b))},onMouseOut:function(b){this.event=b;this.capture&&b.preventDefault();this.game.input.mousePointer.withinGame=!1;this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&this.stopOnGameOut&&(b.identifier=0,this.game.input.mousePointer.stop(b))},onMouseWheel:function(b){this._wheelEvent&&(b=this._wheelEvent.bindEvent(b));
this.event=b;this.capture&&b.preventDefault();this.wheelDelta=a.Math.clamp(-b.deltaY,-1,1);this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,b)},onMouseOver:function(b){this.event=b;this.capture&&b.preventDefault();this.game.input.mousePointer.withinGame=!0;this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,b);!this.game.input.enabled||!this.enabled},requestPointerLock:function(){if(this.game.device.pointerLock){var b=this.game.canvas;b.requestPointerLock=
b.requestPointerLock||b.mozRequestPointerLock||b.webkitRequestPointerLock;b.requestPointerLock();var c=this;this._pointerLockChange=function(b){return c.pointerLockChange(b)};document.addEventListener("pointerlockchange",this._pointerLockChange,!0);document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(b){var c=this.game.canvas;document.pointerLockElement===c||document.mozPointerLockElement===
c||document.webkitPointerLockElement===c?(this.locked=!0,this.pointerLock.dispatch(!0,b)):(this.locked=!1,this.pointerLock.dispatch(!1,b))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.removeEventListener("webkitpointerlockchange",
this._pointerLockChange,!0)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,!0);this.game.canvas.removeEventListener("mousemove",this._onMouseMove,!0);this.game.canvas.removeEventListener("mouseup",this._onMouseUp,!0);this.game.canvas.removeEventListener("mouseover",this._onMouseOver,!0);this.game.canvas.removeEventListener("mouseout",this._onMouseOut,!0);var b=this.game.device.wheelEvent;b&&this.game.canvas.removeEventListener(b,this._onMouseWheel,!0);window.removeEventListener("mouseup",
this._onMouseUpGlobal,!0);document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}};a.Mouse.prototype.constructor=a.Mouse;Object.defineProperty(a.Mouse.prototype,"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});e.prototype={};e.prototype.constructor=e;e.prototype.bindEvent=function(b){if(!e._stubsGenerated&&
b){var c=function(b){return function(){var c=this.originalEvent[b];return"function"!=typeof c?c:c.bind(this.originalEvent)}},a;for(a in b)a in e.prototype||Object.defineProperty(e.prototype,a,{get:c(a)});e._stubsGenerated=!0}return this.originalEvent=b,this};Object.defineProperties(e.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*
this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});a.MSPointer=function(b){this.callbackContext=this.game=b;this.pointerUpCallback=this.pointerMoveCallback=this.pointerDownCallback=null;this.capture=!0;this.button=-1;this.event=null;this.enabled=!0;this._onMSPointerUp=this._onMSPointerMove=this._onMSPointerDown=null};a.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var b=this;this.game.device.mspointer&&(this._onMSPointerDown=function(c){return b.onPointerDown(c)},this._onMSPointerMove=
function(c){return b.onPointerMove(c)},this._onMSPointerUp=function(c){return b.onPointerUp(c)},this.game.canvas.addEventListener("MSPointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("MSPointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("MSPointerUp",this._onMSPointerUp,!1),this.game.canvas.addEventListener("pointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("pointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("pointerUp",
this._onMSPointerUp,!1),this.game.canvas.style["-ms-content-zooming"]="none",this.game.canvas.style["-ms-touch-action"]="none")}},onPointerDown:function(b){this.event=b;this.capture&&b.preventDefault();this.button=b.button;this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&(b.identifier=b.pointerId,this.game.input.startPointer(b))},onPointerMove:function(b){this.event=b;this.capture&&b.preventDefault();this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,
b);this.game.input.enabled&&this.enabled&&(b.identifier=b.pointerId,this.game.input.updatePointer(b))},onPointerUp:function(b){this.event=b;this.capture&&b.preventDefault();this.button=a.Mouse.NO_BUTTON;this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&(b.identifier=b.pointerId,this.game.input.stopPointer(b))},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("MSPointerMove",
this._onMSPointerMove);this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}};a.MSPointer.prototype.constructor=a.MSPointer;Object.defineProperty(a.MSPointer.prototype,"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});a.Pointer=function(b,
c){this.game=b;this.id=c;this.type=a.POINTER;this.exists=!0;this.identifier=0;this.button=this.target=this.pointerId=null;this._holdSent=!1;this._history=[];this._nextDrop=0;this.withinGame=this._stateReset=!1;this.screenY=this.screenX=this.pageY=this.pageX=this.clientY=this.clientX=-1;this.movementY=this.movementX=this.rawMovementY=this.rawMovementX=0;this.y=this.x=-1;this.isDown=this.isMouse=!1;this.isUp=!0;this.totalTouches=this.previousTapTime=this.timeUp=this.timeDown=0;this.msSinceLastClick=
Number.MAX_VALUE;this.targetObject=null;this.dirty=this.active=!1;this.position=new a.Point;this.positionDown=new a.Point;this.positionUp=new a.Point;this.circle=new a.Circle(0,0,44);0===c&&(this.isMouse=!0);this._trampolineTargetObject=this._clickTrampolines=null};a.Pointer.prototype={start:function(b){return b.pointerId&&(this.pointerId=b.pointerId),this.identifier=b.identifier,this.target=b.target,"undefined"!=typeof b.button&&(this.button=b.button),this._history=[],this.active=!0,this.withinGame=
!0,this.isDown=!0,this.isUp=!1,this.dirty=!1,this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(b,!0),this.positionDown.setTo(this.x,this.y),(this.game.input.multiInputOverride===a.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===a.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===a.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&
(this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.x,this.y),this.game.input.onDown.dispatch(this,b),this.game.input.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,this.isMouse||this.game.input.currentPointers++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){this.active&&(this.dirty&&(0<this.game.input.interactiveItems.total&&this.processInteractiveObjects(!1),this.dirty=!1),!1===this._holdSent&&this.duration>=
this.game.input.holdRate&&((this.game.input.multiInputOverride==a.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==a.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==a.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&this.game.input.onHold.dispatch(this),this._holdSent=!0),this.game.input.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+this.game.input.recordRate,this._history.push({x:this.position.x,y:this.position.y}),
this._history.length>this.game.input.recordLimit&&this._history.shift()))},move:function(b,c){if(!this.game.input.pollLocked){if("undefined"==typeof c&&(c=!1),"undefined"!=typeof b.button&&(this.button=b.button),this.clientX=b.clientX,this.clientY=b.clientY,this.pageX=b.pageX,this.pageY=b.pageY,this.screenX=b.screenX,this.screenY=b.screenY,this.isMouse&&this.game.input.mouse.locked&&!c&&(this.rawMovementX=b.movementX||b.mozMovementX||b.webkitMovementX||0,this.rawMovementY=b.movementY||b.mozMovementY||
b.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*this.game.input.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*this.game.input.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(this.game.input.multiInputOverride===a.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===a.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===a.Input.TOUCH_OVERRIDES_MOUSE&&
0===this.game.input.currentPointers)&&(this.game.input.activePointer=this,this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.game.input.x,this.game.input.y),this.game.input.circle.x=this.game.input.x,this.game.input.circle.y=this.game.input.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;for(var f=this.game.input.moveCallbacks.length;f--;)this.game.input.moveCallbacks[f].callback.call(this.game.input.moveCallbacks[f].context,
this,this.x,this.y,c);return null!==this.targetObject&&!0===this.targetObject.isDragged?!1===this.targetObject.update(this)&&(this.targetObject=null):0<this.game.input.interactiveItems.total&&this.processInteractiveObjects(c),this}},processInteractiveObjects:function(b){for(var c=Number.MAX_VALUE,a=-1,d=null,n=this.game.input.interactiveItems.first;n;)n.checked=!1,n.validForInput(a,c,!1)&&(n.checked=!0,(b&&n.checkPointerDown(this,!0)||!b&&n.checkPointerOver(this,!0))&&(c=n.sprite.renderOrderID,a=
n.priorityID,d=n)),n=this.game.input.interactiveItems.next;for(n=this.game.input.interactiveItems.first;n;)!n.checked&&n.validForInput(a,c,!0)&&(b&&n.checkPointerDown(this,!1)||!b&&n.checkPointerOver(this,!1))&&(c=n.sprite.renderOrderID,a=n.priorityID,d=n),n=this.game.input.interactiveItems.next;return null===d?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):null===this.targetObject?(this.targetObject=d,d._pointerOverHandler(this)):this.targetObject===d?!1===
d.update(this)&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=d,this.targetObject._pointerOverHandler(this)),null!==this.targetObject},leave:function(b){this.withinGame=!1;this.move(b,!1)},stop:function(b){return this._stateReset&&this.withinGame?void b.preventDefault():(this.timeUp=this.game.time.time,(this.game.input.multiInputOverride===a.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===a.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===
a.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.onUp.dispatch(this,b),0<=this.duration&&this.duration<=this.game.input.tapRate&&(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate?this.game.input.onTap.dispatch(this,!0):this.game.input.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),0<this.id&&(this.active=!1),this.withinGame=!1,this.isDown=!1,this.isUp=!0,this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),!1===
this.isMouse&&this.game.input.currentPointers--,this.game.input.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this)},justPressed:function(b){return b=b||this.game.input.justPressedRate,!0===this.isDown&&this.timeDown+b>this.game.time.time},justReleased:function(b){return b=b||this.game.input.justReleasedRate,!0===this.isUp&&this.timeUp+b>this.game.time.time},addClickTrampoline:function(b,c,a,d){if(this.isDown){for(var n=
this._clickTrampolines=this._clickTrampolines||[],e=0;e<n.length;e++)if(n[e].name===b){n.splice(e,1);break}n.push({name:b,targetObject:this.targetObject,callback:c,callbackContext:a,callbackArgs:d})}},processClickTrampolines:function(){var b=this._clickTrampolines;if(b){for(var c=0;c<b.length;c++){var a=b[c];a.targetObject===this._trampolineTargetObject&&a.callback.apply(a.callbackContext,a.callbackArgs)}this._trampolineTargetObject=this._clickTrampolines=null}},reset:function(){!1===this.isMouse&&
(this.active=!1);this.identifier=this.pointerId=null;this.isDown=this.dirty=!1;this.isUp=!0;this.totalTouches=0;this._holdSent=!1;this._history.length=0;this._stateReset=!0;this.targetObject&&this.targetObject._releasedHandler(this);this.targetObject=null},resetMovement:function(){this.movementY=this.movementX=0}};a.Pointer.prototype.constructor=a.Pointer;Object.defineProperty(a.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}});Object.defineProperty(a.Pointer.prototype,
"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(a.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});a.Touch=function(b){this.game=b;this.enabled=!0;this.callbackContext=this.game;this.touchCancelCallback=this.touchLeaveCallback=this.touchEnterCallback=this.touchEndCallback=this.touchMoveCallback=this.touchStartCallback=null;this.preventDefault=!0;this._onTouchMove=this._onTouchCancel=this._onTouchLeave=this._onTouchEnter=
this._onTouchEnd=this._onTouchMove=this._onTouchStart=this.event=null};a.Touch.prototype={start:function(){if(null===this._onTouchStart){var b=this;this.game.device.touch&&(this._onTouchStart=function(c){return b.onTouchStart(c)},this._onTouchMove=function(c){return b.onTouchMove(c)},this._onTouchEnd=function(c){return b.onTouchEnd(c)},this._onTouchEnter=function(c){return b.onTouchEnter(c)},this._onTouchLeave=function(c){return b.onTouchLeave(c)},this._onTouchCancel=function(c){return b.onTouchCancel(c)},
this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=
function(b){b.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(b){if(this.event=b,this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,b),this.game.input.enabled&&this.enabled){this.preventDefault&&b.preventDefault();for(var c=0;c<b.changedTouches.length;c++)this.game.input.startPointer(b.changedTouches[c])}},onTouchCancel:function(b){if(this.event=b,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,
b),this.game.input.enabled&&this.enabled){this.preventDefault&&b.preventDefault();for(var c=0;c<b.changedTouches.length;c++)this.game.input.stopPointer(b.changedTouches[c])}},onTouchEnter:function(b){this.event=b;this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,b);this.game.input.enabled&&this.enabled&&this.preventDefault&&b.preventDefault()},onTouchLeave:function(b){this.event=b;this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,b);this.preventDefault&&
b.preventDefault()},onTouchMove:function(b){this.event=b;this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,b);this.preventDefault&&b.preventDefault();for(var c=0;c<b.changedTouches.length;c++)this.game.input.updatePointer(b.changedTouches[c])},onTouchEnd:function(b){this.event=b;this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,b);this.preventDefault&&b.preventDefault();for(var c=0;c<b.changedTouches.length;c++)this.game.input.stopPointer(b.changedTouches[c])},
stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}};a.Touch.prototype.constructor=a.Touch;Object.defineProperty(a.Touch.prototype,
"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});a.InputHandler=function(b){this.sprite=b;this.game=b.game;this.checked=this.enabled=!1;this.priorityID=0;this.isDragged=this._setHandCursor=this.useHandCursor=!1;this.allowVerticalDrag=this.allowHorizontalDrag=!0;this.bringToTop=!1;this.snapOffset=null;this.snapOnRelease=this.snapOnDrag=!1;this.snapOffsetY=this.snapOffsetX=this.snapY=this.snapX=0;this.pixelPerfectClick=this.pixelPerfectOver=!1;this.pixelPerfectAlpha=
255;this.draggable=!1;this.boundsSprite=this.boundsRect=null;this.scaleLayer=this.consumePointerEvent=!1;this.dragOffset=new a.Point;this.dragFromCenter=!1;this.dragStartPoint=new a.Point;this._dragPoint=new a.Point;this._wasEnabled=this._dragPhase=!1;this._tempPoint=new a.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})};a.InputHandler.prototype={start:function(b,c){if(b=b||
0,"undefined"==typeof c&&(c=!1),!1===this.enabled){this.game.input.interactiveItems.add(this);this.useHandCursor=c;this.priorityID=b;for(var f=0;10>f;f++)this._pointerData[f]={id:f,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new a.Point;this._wasEnabled=this.enabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.flagged=
!1,this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.flagged=this.enabled=!1;for(var b=0;10>b;b++)this._pointerData[b]={id:b,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){!1!==this.enabled&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},
destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(b,c,a){return"undefined"==typeof a&&(a=!0),0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID?!1:(a||!this.pixelPerfectClick&&!this.pixelPerfectOver)&&(this.priorityID>
b||this.priorityID===b&&this.sprite.renderOrderID<c)?!0:!1},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(b){return b=b||0,this._pointerData[b].x},pointerY:function(b){return b=b||0,this._pointerData[b].y},pointerDown:function(b){return b=b||0,this._pointerData[b].isDown},pointerUp:function(b){return b=b||0,this._pointerData[b].isUp},pointerTimeDown:function(b){return b=b||0,this._pointerData[b].timeDown},pointerTimeUp:function(b){return b=b||0,
this._pointerData[b].timeUp},pointerOver:function(b){if(this.enabled){if("undefined"!=typeof b)return this._pointerData[b].isOver;for(b=0;10>b;b++)if(this._pointerData[b].isOver)return!0}return!1},pointerOut:function(b){if(this.enabled){if("undefined"!=typeof b)return this._pointerData[b].isOut;for(b=0;10>b;b++)if(this._pointerData[b].isOut)return!0}return!1},pointerTimeOver:function(b){return b=b||0,this._pointerData[b].timeOver},pointerTimeOut:function(b){return b=b||0,this._pointerData[b].timeOut},
pointerDragged:function(b){return b=b||0,this._pointerData[b].isDragged},checkPointerDown:function(b,c){return b.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&this.game.input.hitTest(this.sprite,b,this._tempPoint)?("undefined"==typeof c&&(c=!1),!c&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPointerOver:function(b,c){return this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&
this.game.input.hitTest(this.sprite,b,this._tempPoint)?("undefined"==typeof c&&(c=!1),!c&&this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPixel:function(b,c,a){if(this.sprite.texture.baseTexture.source){null===b&&null===c&&(this.game.input.getLocalPosition(this.sprite,a,this._tempPoint),b=this._tempPoint.x,c=this._tempPoint.y);if(0!==this.sprite.anchor.x&&(b-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(c-=-this.sprite.texture.frame.height*
this.sprite.anchor.y),b+=this.sprite.texture.frame.x,c+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(b-=this.sprite.texture.trim.x,c-=this.sprite.texture.trim.y,b<this.sprite.texture.crop.x||b>this.sprite.texture.crop.right||c<this.sprite.texture.crop.y||c>this.sprite.texture.crop.bottom))return this._dx=b,this._dy=c,!1;this._dx=b;this._dy=c;this.game.input.hitContext.clearRect(0,0,1,1);this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,b,c,1,1,0,0,1,1);if(this.game.input.hitContext.getImageData(0,
0,1,1).data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(b){return null!==this.sprite&&void 0!==this.sprite.parent?this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this.draggable&&this._draggedPointerID===b.id?this.updateDrag(b):this._pointerData[b.id].isOver?this.checkPointerOver(b)?(this._pointerData[b.id].x=b.x-this.sprite.x,this._pointerData[b.id].y=b.y-this.sprite.y,!0):(this._pointerOutHandler(b),!1):void 0:(this._pointerOutHandler(b),!1):void 0},_pointerOverHandler:function(b){null!==
this.sprite&&(!1===this._pointerData[b.id].isOver||b.dirty)&&(this._pointerData[b.id].isOver=!0,this._pointerData[b.id].isOut=!1,this._pointerData[b.id].timeOver=this.game.time.time,this._pointerData[b.id].x=b.x-this.sprite.x,this._pointerData[b.id].y=b.y-this.sprite.y,this.useHandCursor&&!1===this._pointerData[b.id].isDragged&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,b))},_pointerOutHandler:function(b){null!==
this.sprite&&(this._pointerData[b.id].isOver=!1,this._pointerData[b.id].isOut=!0,this._pointerData[b.id].timeOut=this.game.time.time,this.useHandCursor&&!1===this._pointerData[b.id].isDragged&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.sprite&&this.sprite.events&&this.sprite.events.onInputOut$dispatch(this.sprite,b))},_touchedHandler:function(b){if(null!==this.sprite){if(!1===this._pointerData[b.id].isDown&&!0===this._pointerData[b.id].isOver){if(this.pixelPerfectClick&&
!this.checkPixel(null,null,b))return;this._pointerData[b.id].isDown=!0;this._pointerData[b.id].isUp=!1;this._pointerData[b.id].timeDown=this.game.time.time;this.sprite&&this.sprite.events&&this.sprite.events.onInputDown$dispatch(this.sprite,b);b.dirty=!0;this.draggable&&!1===this.isDragged&&this.startDrag(b);this.bringToTop&&this.sprite.bringToTop()}return this.consumePointerEvent}},_releasedHandler:function(b){null!==this.sprite&&this._pointerData[b.id].isDown&&b.isUp&&(this._pointerData[b.id].isDown=
!1,this._pointerData[b.id].isUp=!0,this._pointerData[b.id].timeUp=this.game.time.time,this._pointerData[b.id].downDuration=this._pointerData[b.id].timeUp-this._pointerData[b.id].timeDown,this.checkPointerOver(b)?this.sprite&&this.sprite.events&&this.sprite.events.onInputUp$dispatch(this.sprite,b,!0):(this.sprite&&this.sprite.events&&this.sprite.events.onInputUp$dispatch(this.sprite,b,!1),this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1)),b.dirty=!0,this.draggable&&
this.isDragged&&this._draggedPointerID===b.id&&this.stopDrag(b))},updateDrag:function(b){if(b.isUp)return this.stopDrag(b),!1;var c=this.globalToLocalX(b.x)+this._dragPoint.x+this.dragOffset.x;b=this.globalToLocalY(b.y)+this._dragPoint.y+this.dragOffset.y;return this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=c),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=b),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&
(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)):(this.allowHorizontalDrag&&(this.sprite.x=c),this.allowVerticalDrag&&(this.sprite.y=b),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-
this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),!0},justOver:function(b,c){return b=b||0,c=c||500,this._pointerData[b].isOver&&this.overDuration(b)<c},justOut:function(b,c){return b=b||0,c=c||500,this._pointerData[b].isOut&&this.game.time.time-this._pointerData[b].timeOut<c},justPressed:function(b,c){return b=b||0,c=c||500,this._pointerData[b].isDown&&
this.downDuration(b)<c},justReleased:function(b,c){return b=b||0,c=c||500,this._pointerData[b].isUp&&this.game.time.time-this._pointerData[b].timeUp<c},overDuration:function(b){return b=b||0,this._pointerData[b].isOver?this.game.time.time-this._pointerData[b].timeOver:-1},downDuration:function(b){return b=b||0,this._pointerData[b].isDown?this.game.time.time-this._pointerData[b].timeDown:-1},enableDrag:function(b,c,f,d,n,e){"undefined"==typeof b&&(b=!1);"undefined"==typeof c&&(c=!1);"undefined"==typeof f&&
(f=!1);"undefined"==typeof d&&(d=255);"undefined"==typeof n&&(n=null);"undefined"==typeof e&&(e=null);this._dragPoint=new a.Point;this.draggable=!0;this.bringToTop=c;this.dragOffset=new a.Point;this.dragFromCenter=b;this.pixelPerfectClick=f;this.pixelPerfectAlpha=d;n&&(this.boundsRect=n);e&&(this.boundsSprite=e)},disableDrag:function(){if(this._pointerData)for(var b=0;10>b;b++)this._pointerData[b].isDragged=!1;this.isDragged=this.draggable=!1;this._draggedPointerID=-1},startDrag:function(b){var c=
this.sprite.x,a=this.sprite.y;if(this.isDragged=!0,this._draggedPointerID=b.id,this._pointerData[b.id].isDragged=!0,this.sprite.fixedToCamera)this.dragFromCenter?(this.sprite.centerOn(b.x,b.y),this._dragPoint.setTo(this.sprite.cameraOffset.x-b.x,this.sprite.cameraOffset.y-b.y)):this._dragPoint.setTo(this.sprite.cameraOffset.x-b.x,this.sprite.cameraOffset.y-b.y);else{if(this.dragFromCenter){var d=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(b.x)+(this.sprite.x-d.centerX);this.sprite.y=
this.globalToLocalY(b.y)+(this.sprite.y-d.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(b.x),this.sprite.y-this.globalToLocalY(b.y))}this.updateDrag(b);this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop());this.dragStartPoint.set(c,a);this.sprite.events.onDragStart$dispatch(this.sprite,b,c,a)},globalToLocalX:function(b){return this.scaleLayer&&(b-=this.game.scale.grid.boundsFluid.x,b*=this.game.scale.grid.scaleFluidInversed.x),b},globalToLocalY:function(b){return this.scaleLayer&&
(b-=this.game.scale.grid.boundsFluid.y,b*=this.game.scale.grid.scaleFluidInversed.y),b},stopDrag:function(b){this.isDragged=!1;this._draggedPointerID=-1;this._dragPhase=this._pointerData[b.id].isDragged=!1;this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*
this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY));this.sprite.events.onDragStop$dispatch(this.sprite,b);!1===this.checkPointerOver(b)&&this._pointerOutHandler(b)},setDragLock:function(b,c){"undefined"==typeof b&&(b=!0);"undefined"==typeof c&&(c=!0);this.allowHorizontalDrag=
b;this.allowVerticalDrag=c},enableSnap:function(b,c,a,d,n,e){"undefined"==typeof a&&(a=!0);"undefined"==typeof d&&(d=!1);"undefined"==typeof n&&(n=0);"undefined"==typeof e&&(e=0);this.snapX=b;this.snapY=c;this.snapOffsetX=n;this.snapOffsetY=e;this.snapOnDrag=a;this.snapOnRelease=d},disableSnap:function(){this.snapOnRelease=this.snapOnDrag=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+
this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-
(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>
this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<
this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}};a.InputHandler.prototype.constructor=a.InputHandler;a.Gamepad=function(b){this.game=
b;this._gamepadIndexMap={};this._rawPads=[];this._active=!1;this.enabled=!0;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!=navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this._gamepaddisconnected=this._ongamepadconnected=this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=this.onConnectCallback=null;this._gamepads=
[new a.SinglePad(b,this),new a.SinglePad(b,this),new a.SinglePad(b,this),new a.SinglePad(b,this)]};a.Gamepad.prototype={addCallbacks:function(b,c){"undefined"!=typeof c&&(this.onConnectCallback="function"==typeof c.onConnect?c.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof c.onDisconnect?c.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof c.onDown?c.onDown:this.onDownCallback,this.onUpCallback="function"==typeof c.onUp?c.onUp:this.onUpCallback,
this.onAxisCallback="function"==typeof c.onAxis?c.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof c.onFloat?c.onFloat:this.onFloatCallback,this.callbackContext=b)},start:function(){if(!this._active){this._active=!0;var b=this;this._onGamepadConnected=function(c){return b.onGamepadConnected(c)};this._onGamepadDisconnected=function(c){return b.onGamepadDisconnected(c)};window.addEventListener("gamepadconnected",this._onGamepadConnected,!1);window.addEventListener("gamepaddisconnected",
this._onGamepadDisconnected,!1)}},onGamepadConnected:function(b){b=b.gamepad;this._rawPads.push(b);this._gamepads[b.index].connect(b)},onGamepadDisconnected:function(b){b=b.gamepad;for(var c in this._rawPads)this._rawPads[c].index===b.index&&this._rawPads.splice(c,1);this._gamepads[b.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(navigator.getGamepads)var b=navigator.getGamepads();
else navigator.webkitGetGamepads?b=navigator.webkitGetGamepads():navigator.webkitGamepads&&(b=navigator.webkitGamepads());if(b){this._rawPads=[];for(var c=!1,a=0;a<b.length&&(typeof b[a]!==this._prevRawGamepadTypes[a]&&(c=!0,this._prevRawGamepadTypes[a]=typeof b[a]),b[a]&&this._rawPads.push(b[a]),3!==a);a++);if(c){for(var d,b={},c={},a=0;a<this._gamepads.length;a++)if(d=this._gamepads[a],d.connected)for(var n=0;n<this._rawPads.length;n++)this._rawPads[n].index===d.index&&(b[d.index]=!0,c[a]=!0);for(a=
0;a<this._gamepads.length;a++)if(d=this._gamepads[a],!c[a])for(1>this._rawPads.length&&d.disconnect(),n=0;n<this._rawPads.length&&!c[a];n++){var e=this._rawPads[n];e?b[e.index]?d.disconnect():(d.connect(e),b[e.index]=!0,c[a]=!0):d.disconnect()}}}},setDeadZones:function(b){for(var c=0;c<this._gamepads.length;c++)this._gamepads[c].deadZone=b},stop:function(){this._active=!1;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},
reset:function(){this.update();for(var b=0;b<this._gamepads.length;b++)this._gamepads[b].reset()},justPressed:function(b,c){for(var a=0;a<this._gamepads.length;a++)if(!0===this._gamepads[a].justPressed(b,c))return!0;return!1},justReleased:function(b,c){for(var a=0;a<this._gamepads.length;a++)if(!0===this._gamepads[a].justReleased(b,c))return!0;return!1},isDown:function(b){for(var c=0;c<this._gamepads.length;c++)if(!0===this._gamepads[c].isDown(b))return!0;return!1},destroy:function(){this.stop();
for(var b=0;b<this._gamepads.length;b++)this._gamepads[b].destroy()}};a.Gamepad.prototype.constructor=a.Gamepad;Object.defineProperty(a.Gamepad.prototype,"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});Object.defineProperty(a.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(a.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(a.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});
Object.defineProperty(a.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(a.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(a.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(a.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});a.Gamepad.BUTTON_0=0;a.Gamepad.BUTTON_1=1;a.Gamepad.BUTTON_2=2;a.Gamepad.BUTTON_3=3;a.Gamepad.BUTTON_4=4;a.Gamepad.BUTTON_5=5;a.Gamepad.BUTTON_6=
6;a.Gamepad.BUTTON_7=7;a.Gamepad.BUTTON_8=8;a.Gamepad.BUTTON_9=9;a.Gamepad.BUTTON_10=10;a.Gamepad.BUTTON_11=11;a.Gamepad.BUTTON_12=12;a.Gamepad.BUTTON_13=13;a.Gamepad.BUTTON_14=14;a.Gamepad.BUTTON_15=15;a.Gamepad.AXIS_0=0;a.Gamepad.AXIS_1=1;a.Gamepad.AXIS_2=2;a.Gamepad.AXIS_3=3;a.Gamepad.AXIS_4=4;a.Gamepad.AXIS_5=5;a.Gamepad.AXIS_6=6;a.Gamepad.AXIS_7=7;a.Gamepad.AXIS_8=8;a.Gamepad.AXIS_9=9;a.Gamepad.XBOX360_A=0;a.Gamepad.XBOX360_B=1;a.Gamepad.XBOX360_X=2;a.Gamepad.XBOX360_Y=3;a.Gamepad.XBOX360_LEFT_BUMPER=
4;a.Gamepad.XBOX360_RIGHT_BUMPER=5;a.Gamepad.XBOX360_LEFT_TRIGGER=6;a.Gamepad.XBOX360_RIGHT_TRIGGER=7;a.Gamepad.XBOX360_BACK=8;a.Gamepad.XBOX360_START=9;a.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;a.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;a.Gamepad.XBOX360_DPAD_LEFT=14;a.Gamepad.XBOX360_DPAD_RIGHT=15;a.Gamepad.XBOX360_DPAD_UP=12;a.Gamepad.XBOX360_DPAD_DOWN=13;a.Gamepad.XBOX360_STICK_LEFT_X=0;a.Gamepad.XBOX360_STICK_LEFT_Y=1;a.Gamepad.XBOX360_STICK_RIGHT_X=2;a.Gamepad.XBOX360_STICK_RIGHT_Y=3;a.Gamepad.PS3XC_X=
0;a.Gamepad.PS3XC_CIRCLE=1;a.Gamepad.PS3XC_SQUARE=2;a.Gamepad.PS3XC_TRIANGLE=3;a.Gamepad.PS3XC_L1=4;a.Gamepad.PS3XC_R1=5;a.Gamepad.PS3XC_L2=6;a.Gamepad.PS3XC_R2=7;a.Gamepad.PS3XC_SELECT=8;a.Gamepad.PS3XC_START=9;a.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;a.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;a.Gamepad.PS3XC_DPAD_UP=12;a.Gamepad.PS3XC_DPAD_DOWN=13;a.Gamepad.PS3XC_DPAD_LEFT=14;a.Gamepad.PS3XC_DPAD_RIGHT=15;a.Gamepad.PS3XC_STICK_LEFT_X=0;a.Gamepad.PS3XC_STICK_LEFT_Y=1;a.Gamepad.PS3XC_STICK_RIGHT_X=2;a.Gamepad.PS3XC_STICK_RIGHT_Y=
3;a.SinglePad=function(b,c){this.game=b;this.index=null;this.connected=!1;this.callbackContext=this;this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=this.onConnectCallback=null;this.deadZone=.26;this._padParent=c;this._prevTimestamp=this._rawPad=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};a.SinglePad.prototype={addCallbacks:function(b,c){"undefined"!=typeof c&&(this.onConnectCallback="function"==typeof c.onConnect?
c.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof c.onDisconnect?c.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof c.onDown?c.onDown:this.onDownCallback,this.onUpCallback="function"==typeof c.onUp?c.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof c.onAxis?c.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof c.onFloat?c.onFloat:this.onFloatCallback)},getButton:function(b){return this._buttons[b]?this._buttons[b]:
null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var b=0;b<this._buttonsLen;b++){var c=isNaN(this._rawPad.buttons[b])?this._rawPad.buttons[b].value:this._rawPad.buttons[b];c!==this._buttons[b].value&&(1===c?this.processButtonDown(b,c):0===c?this.processButtonUp(b,c):this.processButtonFloat(b,c))}for(b=0;b<this._axesLen;b++)c=this._rawPad.axes[b],0<c&&c>this.deadZone||
0>c&&c<-this.deadZone?this.processAxisChange(b,c):this.processAxisChange(b,0);this._prevTimestamp=this._rawPad.timestamp}},connect:function(b){var c=!this.connected;this.connected=!0;this.index=b.index;this._rawPad=b;this._buttons=[];this._buttonsLen=b.buttons.length;this._axes=[];this._axesLen=b.axes.length;for(var f=0;f<this._axesLen;f++)this._axes[f]=b.axes[f];for(var d in b.buttons)d=parseInt(d,10),this._buttons[d]=new a.GamepadButton(this,d);c&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,
this.index);c&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var b=this.connected,c=this.index;this.connected=!1;this.index=null;this._rawPad=void 0;for(var a=0;a<this._buttonsLen;a++)this._buttons[a].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;b&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,c);b&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},
destroy:function(){this._rawPad=void 0;for(var b=0;b<this._buttonsLen;b++)this._buttons[b].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=this.onConnectCallback=null},processAxisChange:function(b,c){this._axes[b]!==c&&(this._axes[b]=c,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,b,c),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,
this,b,c))},processButtonDown:function(b,c){this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,b,c,this.index);this.onDownCallback&&this.onDownCallback.call(this.callbackContext,b,c);this._buttons[b]&&this._buttons[b].processButtonDown(c)},processButtonUp:function(b,c){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,b,c,this.index);this.onUpCallback&&this.onUpCallback.call(this.callbackContext,b,c);this._buttons[b]&&
this._buttons[b].processButtonUp(c)},processButtonFloat:function(b,c){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,b,c,this.index);this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,b,c);this._buttons[b]&&this._buttons[b].processButtonFloat(c)},axis:function(b){return this._axes[b]?this._axes[b]:!1},isDown:function(b){return this._buttons[b]?this._buttons[b].isDown:!1},isUp:function(b){return this._buttons[b]?this._buttons[b].isUp:
!1},justReleased:function(b,c){return this._buttons[b]?this._buttons[b].justReleased(c):void 0},justPressed:function(b,c){return this._buttons[b]?this._buttons[b].justPressed(c):void 0},buttonValue:function(b){return this._buttons[b]?this._buttons[b].value:null},reset:function(){for(var b=0;b<this._axes.length;b++)this._axes[b]=0}};a.SinglePad.prototype.constructor=a.SinglePad;a.GamepadButton=function(b,c){this.pad=b;this.game=b.game;this.isDown=!1;this.isUp=!0;this.value=this.repeats=this.timeUp=
this.duration=this.timeDown=0;this.buttonCode=c;this.onDown=new a.Signal;this.onUp=new a.Signal;this.onFloat=new a.Signal};a.GamepadButton.prototype={processButtonDown:function(b){this.isDown=!0;this.isUp=!1;this.timeDown=this.game.time.time;this.repeats=this.duration=0;this.value=b;this.onDown.dispatch(this,b)},processButtonUp:function(b){this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.time;this.value=b;this.onUp.dispatch(this,b)},processButtonFloat:function(b){this.value=b;this.onFloat.dispatch(this,
b)},justPressed:function(b){return b=b||250,!0===this.isDown&&this.timeDown+b>this.game.time.time},justReleased:function(b){return b=b||250,!0===this.isUp&&this.timeUp+b>this.game.time.time},reset:function(){this.isDown=!1;this.isUp=!0;this.timeDown=this.game.time.time;this.repeats=this.duration=0},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.game=this.pad=null}};a.GamepadButton.prototype.constructor=a.GamepadButton;a.Key=function(b,c){this.game=b;this._enabled=
!0;this.event=null;this.isDown=!1;this.isUp=!0;this.shiftKey=this.ctrlKey=this.altKey=!1;this.duration=this.timeDown=0;this.timeUp=-2500;this.repeats=0;this.keyCode=c;this.onDown=new a.Signal;this.onHoldContext=this.onHoldCallback=null;this.onUp=new a.Signal;this._justUp=this._justDown=!1};a.Key.prototype={update:function(){this._enabled&&this.isDown&&(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(b){this._enabled&&
(this.event=b,this.isDown||(this.altKey=b.altKey,this.ctrlKey=b.ctrlKey,this.shiftKey=b.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(b){this._enabled&&(this.event=b,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(b){"undefined"==typeof b&&(b=!0);
this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.time;this.duration=0;this._enabled=!0;this._justUp=this._justDown=!1;b&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(b){return"undefined"==typeof b&&(b=50),this.isDown&&this.duration<b},upDuration:function(b){return"undefined"==typeof b&&(b=50),!this.isDown&&this.game.time.time-this.timeUp<b}};Object.defineProperty(a.Key.prototype,"justDown",{get:function(){var b=this._justDown;
return this._justDown=!1,b}});Object.defineProperty(a.Key.prototype,"justUp",{get:function(){var b=this._justUp;return this._justUp=!1,b}});Object.defineProperty(a.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(b){b=!!b;b!==this._enabled&&(b||this.reset(!1),this._enabled=b)}});a.Key.prototype.constructor=a.Key;a.Keyboard=function(b){this.game=b;this.enabled=!0;this.pressEvent=this.event=null;this.callbackContext=this;this.onUpCallback=this.onPressCallback=this.onDownCallback=
null;this._keys=[];this._capture=[];this._onKeyUp=this._onKeyPress=this._onKeyDown=null;this._k=this._i=0};a.Keyboard.prototype={addCallbacks:function(b,c,a,d){this.callbackContext=b;"undefined"!=typeof c&&(this.onDownCallback=c);"undefined"!=typeof a&&(this.onUpCallback=a);"undefined"!=typeof d&&(this.onPressCallback=d)},addKey:function(b){return this._keys[b]||(this._keys[b]=new a.Key(this.game,b),this.addKeyCapture(b)),this._keys[b]},removeKey:function(b){this._keys[b]&&(this._keys[b]=null,this.removeKeyCapture(b))},
createCursorKeys:function(){return{up:this.addKey(a.Keyboard.UP),down:this.addKey(a.Keyboard.DOWN),left:this.addKey(a.Keyboard.LEFT),right:this.addKey(a.Keyboard.RIGHT)}},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var b=this;this._onKeyDown=function(c){return b.processKeyDown(c)};this._onKeyUp=function(c){return b.processKeyUp(c)};this._onKeyPress=function(c){return b.processKeyPress(c)};window.addEventListener("keydown",this._onKeyDown,!1);window.addEventListener("keyup",
this._onKeyUp,!1);window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyPress=this._onKeyUp=this._onKeyDown=null},destroy:function(){this.stop();this.clearCaptures();this._i=this._keys.length=0},addKeyCapture:function(b){if("object"==typeof b)for(var c in b)this._capture[b[c]]=!0;else this._capture[b]=!0},removeKeyCapture:function(b){delete this._capture[b]},
clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(b){this.event=b;this.game.input.enabled&&this.enabled&&(this._capture[b.keyCode]&&b.preventDefault(),this._keys[b.keyCode]||(this._keys[b.keyCode]=new a.Key(this.game,b.keyCode)),this._keys[b.keyCode].processKeyDown(b),this._k=b.keyCode,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,b))},processKeyPress:function(b){this.pressEvent=
b;this.game.input.enabled&&this.enabled&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(b.charCode),b)},processKeyUp:function(b){this.event=b;this.game.input.enabled&&this.enabled&&(this._capture[b.keyCode]&&b.preventDefault(),this._keys[b.keyCode]||(this._keys[b.keyCode]=new a.Key(this.game,b.keyCode)),this._keys[b.keyCode].processKeyUp(b),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,b))},reset:function(b){"undefined"==typeof b&&(b=!0);
this.event=null;for(var c=this._keys.length;c--;)this._keys[c]&&this._keys[c].reset(b)},downDuration:function(b,c){return this._keys[b]?this._keys[b].downDuration(c):null},upDuration:function(b,c){return this._keys[b]?this._keys[b].upDuration(c):null},isDown:function(b){return this._keys[b]?this._keys[b].isDown:null}};Object.defineProperty(a.Keyboard.prototype,"disabled",{get:function(){return!this.enabled},set:function(b){this.enabled=!b}});Object.defineProperty(a.Keyboard.prototype,"lastChar",{get:function(){return 32===
this.event.charCode?"":String.fromCharCode(this.pressEvent.charCode)}});Object.defineProperty(a.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});a.Keyboard.prototype.constructor=a.Keyboard;a.Keyboard.A=65;a.Keyboard.B=66;a.Keyboard.C=67;a.Keyboard.D=68;a.Keyboard.E=69;a.Keyboard.F=70;a.Keyboard.G=71;a.Keyboard.H=72;a.Keyboard.I=73;a.Keyboard.J=74;a.Keyboard.K=75;a.Keyboard.L=76;a.Keyboard.M=77;a.Keyboard.N=78;a.Keyboard.O=79;a.Keyboard.P=80;a.Keyboard.Q=81;a.Keyboard.R=82;
a.Keyboard.S=83;a.Keyboard.T=84;a.Keyboard.U=85;a.Keyboard.V=86;a.Keyboard.W=87;a.Keyboard.X=88;a.Keyboard.Y=89;a.Keyboard.Z=90;a.Keyboard.ZERO=48;a.Keyboard.ONE=49;a.Keyboard.TWO=50;a.Keyboard.THREE=51;a.Keyboard.FOUR=52;a.Keyboard.FIVE=53;a.Keyboard.SIX=54;a.Keyboard.SEVEN=55;a.Keyboard.EIGHT=56;a.Keyboard.NINE=57;a.Keyboard.NUMPAD_0=96;a.Keyboard.NUMPAD_1=97;a.Keyboard.NUMPAD_2=98;a.Keyboard.NUMPAD_3=99;a.Keyboard.NUMPAD_4=100;a.Keyboard.NUMPAD_5=101;a.Keyboard.NUMPAD_6=102;a.Keyboard.NUMPAD_7=
103;a.Keyboard.NUMPAD_8=104;a.Keyboard.NUMPAD_9=105;a.Keyboard.NUMPAD_MULTIPLY=106;a.Keyboard.NUMPAD_ADD=107;a.Keyboard.NUMPAD_ENTER=108;a.Keyboard.NUMPAD_SUBTRACT=109;a.Keyboard.NUMPAD_DECIMAL=110;a.Keyboard.NUMPAD_DIVIDE=111;a.Keyboard.F1=112;a.Keyboard.F2=113;a.Keyboard.F3=114;a.Keyboard.F4=115;a.Keyboard.F5=116;a.Keyboard.F6=117;a.Keyboard.F7=118;a.Keyboard.F8=119;a.Keyboard.F9=120;a.Keyboard.F10=121;a.Keyboard.F11=122;a.Keyboard.F12=123;a.Keyboard.F13=124;a.Keyboard.F14=125;a.Keyboard.F15=126;
a.Keyboard.COLON=186;a.Keyboard.EQUALS=187;a.Keyboard.UNDERSCORE=189;a.Keyboard.QUESTION_MARK=191;a.Keyboard.TILDE=192;a.Keyboard.OPEN_BRACKET=219;a.Keyboard.BACKWARD_SLASH=220;a.Keyboard.CLOSED_BRACKET=221;a.Keyboard.QUOTES=222;a.Keyboard.BACKSPACE=8;a.Keyboard.TAB=9;a.Keyboard.CLEAR=12;a.Keyboard.ENTER=13;a.Keyboard.SHIFT=16;a.Keyboard.CONTROL=17;a.Keyboard.ALT=18;a.Keyboard.CAPS_LOCK=20;a.Keyboard.ESC=27;a.Keyboard.SPACEBAR=32;a.Keyboard.PAGE_UP=33;a.Keyboard.PAGE_DOWN=34;a.Keyboard.END=35;a.Keyboard.HOME=
36;a.Keyboard.LEFT=37;a.Keyboard.UP=38;a.Keyboard.RIGHT=39;a.Keyboard.DOWN=40;a.Keyboard.INSERT=45;a.Keyboard.DELETE=46;a.Keyboard.HELP=47;a.Keyboard.NUM_LOCK=144;a.Keyboard.PLUS=43;a.Keyboard.MINUS=45;a.Component=function(){};a.Component.Angle=function(){};a.Component.Angle.prototype={angle:{get:function(){return a.Math.wrapAngle(a.Math.radToDeg(this.rotation))},set:function(b){this.rotation=a.Math.degToRad(a.Math.wrapAngle(b))}}};a.Component.Animation=function(){};a.Component.Animation.prototype=
{play:function(b,c,a,d){return this.animations?this.animations.play(b,c,a,d):void 0}};a.Component.AutoCull=function(){};a.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}};a.Component.Bounds=function(){};a.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*
this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},left:{get:function(){return this.x-this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX}},top:{get:function(){return this.y-this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY}}};a.Component.BringToTop=function(){};a.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this};a.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&
this.parent.sendToBack(this),this};a.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this};a.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this};a.Component.Core=function(){};a.Component.Core.install=function(b){a.Utils.mixinPrototype(this,a.Component.Core.prototype);this.components={};for(var c=0;c<b.length;c++){var f=b[c],d=!1;"Destroy"===f&&(d=!0);a.Utils.mixinPrototype(this,a.Component[f].prototype,
d);this.components[f]=!0}};a.Component.Core.init=function(b,c,f,d,n){this.game=b;this.key=d;this.position.set(c,f);this.world=new a.Point(c,f);this.previousPosition=new a.Point(c,f);this.events=new a.Events(this);this._bounds=new a.Rectangle;this.components.PhysicsBody&&(this.body=this.body);this.components.Animation&&(this.animations=new a.AnimationManager(this));this.components.LoadTexture&&null!==d&&this.loadTexture(d,n);this.components.FixedToCamera&&(this.cameraOffset=new a.Point(c,f))};a.Component.Core.preUpdate=
function(){if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++);this.animations&&this.animations.update();this.body&&this.body.preUpdate();for(var b=0;b<this.children.length;b++)this.children[b].preUpdate();return!0};a.Component.Core.prototype=
{game:null,name:"",components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(b){b?(this._exists=!0,this.body&&this.body.type===a.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===a.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},update:function(){},postUpdate:function(){this.key instanceof
a.BitmapData&&this.key.render();this.components.PhysicsBody&&a.Component.PhysicsBody.postUpdate.call(this);this.components.FixedToCamera&&a.Component.FixedToCamera.postUpdate.call(this);for(var b=0;b<this.children.length;b++)this.children[b].postUpdate()}};a.Component.Crop=function(){};a.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(b,c){"undefined"==typeof c&&(c=!1);b?(c&&null!==this.cropRect?this.cropRect.setTo(b.x,b.y,b.width,b.height):this.cropRect=c&&null===this.cropRect?new a.Rectangle(b.x,
b.y,b.width,b.height):b,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){this._crop=a.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var b=Math.max(this._frame.x,this._crop.x),c=Math.max(this._frame.y,this._crop.y),f=Math.min(this._frame.right,this._crop.right)-b,d=Math.min(this._frame.bottom,this._crop.bottom)-c;this.texture.crop.x=b;this.texture.crop.y=c;this.texture.crop.width=f;
this.texture.crop.height=d;this.texture.frame.width=Math.min(f,this.cropRect.width);this.texture.frame.height=Math.min(d,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs()}}};a.Component.Delta=function(){};a.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-
this.previousRotation}}};a.Component.Destroy=function(){};a.Component.Destroy.prototype={destroyPhase:!1,destroy:function(b){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof b&&(b=!0);this.destroyPhase=!0;this.events&&this.events.onDestroy$dispatch(this);this.parent&&(this.parent instanceof a.Group?this.parent.remove(this):this.parent.removeChild(this));this.input&&this.input.destroy();this.animations&&this.animations.destroy();this.body&&this.body.destroy();this.events&&this.events.destroy();
var c=this.children.length;if(b)for(;c--;)this.children[c].destroy(b);else for(;c--;)this.removeChild(this.children[c]);this._crop&&(this._crop=null);this._frame&&(this._frame=null);this.visible=this.exists=this.alive=!1;this.game=this.mask=this.filters=null;this.renderable=!1;this._mask=this._currentBounds=this._bounds=this.filterArea=this.worldTransform=this.stage=this.parent=this.hitArea=this.transformCallbackContext=this.transformCallback=null;this._destroyCachedSprite();this.destroyPhase=!1}}};
a.Events=function(b){this.parent=b};a.Events.prototype={destroy:function(){this._parent=null;this._onDestroy&&this._onDestroy.dispose();this._onAddedToGroup&&this._onAddedToGroup.dispose();this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose();this._onRemovedFromWorld&&this._onRemovedFromWorld.dispose();this._onKilled&&this._onKilled.dispose();this._onRevived&&this._onRevived.dispose();this._onEnterBounds&&this._onEnterBounds.dispose();this._onOutOfBounds&&this._onOutOfBounds.dispose();this._onInputOver&&
this._onInputOver.dispose();this._onInputOut&&this._onInputOut.dispose();this._onInputDown&&this._onInputDown.dispose();this._onInputUp&&this._onInputUp.dispose();this._onDragStart&&this._onDragStart.dispose();this._onDragStop&&this._onDragStop.dispose();this._onAnimationStart&&this._onAnimationStart.dispose();this._onAnimationComplete&&this._onAnimationComplete.dispose();this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,
onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};a.Events.prototype.constructor=a.Events;for(var h in a.Events.prototype)a.Events.prototype.hasOwnProperty(h)&&0===h.indexOf("on")&&null===a.Events.prototype[h]&&!function(b,c){Object.defineProperty(a.Events.prototype,b,{get:function(){return this[c]||(this[c]=new a.Signal)}});
a.Events.prototype[b+"$dispatch"]=function(){return this[c]?this[c].dispatch.apply(this[c],arguments):null}}(h,"_"+h);a.Component.FixedToCamera=function(){};a.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)};a.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},
set:function(b){b?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new a.Point};a.Component.Health=function(){};a.Component.Health.prototype={health:1,damage:function(b){return this.alive&&(this.health-=b,0>=this.health&&this.kill()),this}};a.Component.InCamera=function(){};a.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};a.Component.InputEnabled=function(){};a.Component.InputEnabled.prototype=
{input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(b){b?null===this.input?(this.input=new a.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}};a.Component.InWorld=function(){};a.Component.InWorld.preUpdate=function(){if((this.autoCull||this.checkWorldBounds)&&(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,
this.autoCull&&(this.game.world.camera.view.intersects(this._bounds)?(this.renderable=!0,this.game.world.camera.totalInView++):this.renderable=!1),this.checkWorldBounds))if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),
!1;return!0};a.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};a.Component.LifeSpan=function(){};a.Component.LifeSpan.preUpdate=function(){return 0<this.lifespan&&(this.lifespan-=this.game.time.physicsElapsedMS,0>=this.lifespan)?(this.kill(),!1):!0};a.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(b){return"undefined"==typeof b&&(b=1),this.alive=!0,this.exists=
!0,this.visible=!0,"number"==typeof this.health&&(this.health=b),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}};a.Component.LoadTexture=function(){};a.Component.LoadTexture.prototype={_frame:null,loadTexture:function(b,c,f){c=c||0;(f||"undefined"==typeof f)&&this.animations&&this.animations.stop();this.key=b;f=!0;var d=!this.texture.baseTexture.scaleMode,n=!1;a.RenderTexture&&
b instanceof a.RenderTexture?(this.key=b.key,this.setTexture(b),n=!0):a.BitmapData&&b instanceof a.BitmapData?(this.setTexture(b.texture),this.game.cache.getFrameData(b.key,a.Cache.BITMAPDATA)&&(f=!this.animations.loadFrameData(this.game.cache.getFrameData(b.key,a.Cache.BITMAPDATA),c))):b instanceof PIXI.Texture?this.setTexture(b):null===b||"undefined"==typeof b?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof b||this.game.cache.checkImageKey(b)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[b])),
f=!this.animations.loadFrameData(this.game.cache.getFrameData(b),c)):(console.warn("Texture with key '"+b+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]));n||this.texture.baseTexture.dirty();f&&(this._frame=a.Rectangle.clone(this.texture.frame));d||(this.texture.baseTexture.scaleMode=1)},setFrame:function(b){this._frame=b;this.texture.frame.x=b.x;this.texture.frame.y=b.y;this.texture.frame.width=b.width;this.texture.frame.height=b.height;this.texture.crop.x=b.x;this.texture.crop.y=
b.y;this.texture.crop.width=b.width;this.texture.crop.height=b.height;b.trimmed?(this.texture.trim?(this.texture.trim.x=b.spriteSourceSizeX,this.texture.trim.y=b.spriteSourceSizeY,this.texture.trim.width=b.sourceSizeW,this.texture.trim.height=b.sourceSizeH):this.texture.trim={x:b.spriteSourceSizeX,y:b.spriteSourceSizeY,width:b.sourceSizeW,height:b.sourceSizeH},this.texture.width=b.sourceSizeW,this.texture.height=b.sourceSizeH,this.texture.frame.width=b.sourceSizeW,this.texture.frame.height=b.sourceSizeH):
!b.trimmed&&this.texture.trim&&(this.texture.trim=null);this.cropRect&&this.updateCrop();16777215!==this.tint&&(this.cachedTint=-1);this.texture._updateUvs()},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(b){this.animations.frame=b}},frameName:{get:function(){return this.animations.frameName},set:function(b){this.animations.frameName=b}}};a.Component.Overlap=function(){};a.Component.Overlap.prototype={overlap:function(b){return a.Rectangle.intersects(this.getBounds(),
b.getBounds())}};a.Component.PhysicsBody=function(){};a.Component.PhysicsBody.preUpdate=function(){return this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=
this.rotation,this._exists&&this.parent.exists?!0:(this.renderOrderID=-1,!1))};a.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()};a.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(b){this.position.x=b;this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(b){this.position.y=b;this.body&&!this.body.dirty&&(this.body._reset=!0)}}};a.Component.Reset=function(){};
a.Component.Reset.prototype.reset=function(b,c,a){return"undefined"==typeof a&&(a=1),this.world.set(b,c),this.position.set(b,c),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=a),this.components.PhysicsBody&&this.body&&this.body.reset(b,c,!1,!1),this};a.Component.ScaleMinMax=function(){};a.Component.ScaleMinMax.prototype={transformCallback:this.checkTransform,transformCallbackContext:this,
scaleMin:null,scaleMax:null,checkTransform:function(b){this.scaleMin&&(b.a<this.scaleMin.x&&(b.a=this.scaleMin.x),b.d<this.scaleMin.y&&(b.d=this.scaleMin.y));this.scaleMax&&(b.a>this.scaleMax.x&&(b.a=this.scaleMax.x),b.d>this.scaleMax.y&&(b.d=this.scaleMax.y))},setScaleMinMax:function(b,c,f,d){"undefined"==typeof c?c=f=d=b:"undefined"==typeof f&&(f=d=c,c=b);null===b?this.scaleMin=null:this.scaleMin?this.scaleMin.set(b,c):this.scaleMin=new a.Point(b,c);null===f?this.scaleMax=null:this.scaleMax?this.scaleMax.set(f,
d):this.scaleMax=new a.Point(f,d)}};a.Component.Smoothed=function(){};a.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(b){b?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}};a.GameObjectFactory=function(b){this.game=b;this.world=this.game.world};a.GameObjectFactory.prototype={existing:function(b){return this.world.add(b)},image:function(b,c,f,d,n){return"undefined"==typeof n&&
(n=this.world),n.add(new a.Image(this.game,b,c,f,d))},sprite:function(b,c,a,d,n){return"undefined"==typeof n&&(n=this.world),n.create(b,c,a,d)},tween:function(b){return this.game.tweens.create(b)},group:function(b,c,f,d,n){return new a.Group(this.game,b,c,f,d,n)},physicsGroup:function(b,c,f,d){return new a.Group(this.game,c,f,d,!0,b)},spriteBatch:function(b,c,f){return"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c="group"),"undefined"==typeof f&&(f=!1),new a.SpriteBatch(this.game,b,c,f)},
audio:function(b,c,a,d){return this.game.sound.add(b,c,a,d)},sound:function(b,c,a,d){return this.game.sound.add(b,c,a,d)},audioSprite:function(b){return this.game.sound.addSprite(b)},tileSprite:function(b,c,f,d,n,e,l){return"undefined"==typeof l&&(l=this.world),l.add(new a.TileSprite(this.game,b,c,f,d,n,e))},rope:function(b,c,f,d,n,e){return"undefined"==typeof e&&(e=this.world),e.add(new a.Rope(this.game,b,c,f,d,n))},text:function(b,c,f,d,n){return"undefined"==typeof n&&(n=this.world),n.add(new a.Text(this.game,
b,c,f,d))},button:function(b,c,f,d,n,e,l,g,h,k){return"undefined"==typeof k&&(k=this.world),k.add(new a.Button(this.game,b,c,f,d,n,e,l,g,h))},graphics:function(b,c,f){return"undefined"==typeof f&&(f=this.world),f.add(new a.Graphics(this.game,b,c))},emitter:function(b,c,f){return this.game.particles.add(new a.Particles.Arcade.Emitter(this.game,b,c,f))},retroFont:function(b,c,f,d,n,e,l,g,h){return new a.RetroFont(this.game,b,c,f,d,n,e,l,g,h)},bitmapText:function(b,c,f,d,n,e){return"undefined"==typeof e&&
(e=this.world),e.add(new a.BitmapText(this.game,b,c,f,d,n))},tilemap:function(b,c,f,d,n){return new a.Tilemap(this.game,b,c,f,d,n)},renderTexture:function(b,c,f,d){"undefined"!=typeof f&&""!==f||(f=this.game.rnd.uuid());"undefined"==typeof d&&(d=!1);b=new a.RenderTexture(this.game,b,c,f);return d&&this.game.cache.addRenderTexture(f,b),b},bitmapData:function(b,c,f,d){"undefined"==typeof d&&(d=!1);"undefined"!=typeof f&&""!==f||(f=this.game.rnd.uuid());b=new a.BitmapData(this.game,f,b,c);return d&&
this.game.cache.addBitmapData(f,b),b},filter:function(b){var c=Array.prototype.splice.call(arguments,1);b=new a.Filter[b](this.game);return b.init.apply(b,c),b},plugin:function(b){return this.game.plugins.add(b)}};a.GameObjectFactory.prototype.constructor=a.GameObjectFactory;a.GameObjectCreator=function(b){this.game=b;this.world=this.game.world};a.GameObjectCreator.prototype={image:function(b,c,f,d){return new a.Image(this.game,b,c,f,d)},sprite:function(b,c,f,d){return new a.Sprite(this.game,b,c,
f,d)},tween:function(b){return new a.Tween(b,this.game,this.game.tweens)},group:function(b,c,f,d,n){return new a.Group(this.game,null,c,f,d,n)},spriteBatch:function(b,c,f){return"undefined"==typeof c&&(c="group"),"undefined"==typeof f&&(f=!1),new a.SpriteBatch(this.game,b,c,f)},audio:function(b,c,a,d){return this.game.sound.add(b,c,a,d)},audioSprite:function(b){return this.game.sound.addSprite(b)},sound:function(b,c,a,d){return this.game.sound.add(b,c,a,d)},tileSprite:function(b,c,f,d,n,e){return new a.TileSprite(this.game,
b,c,f,d,n,e)},rope:function(b,c,f,d,n){return new a.Rope(this.game,b,c,f,d,n)},text:function(b,c,f,d){return new a.Text(this.game,b,c,f,d)},button:function(b,c,f,d,n,e,l,g,h){return new a.Button(this.game,b,c,f,d,n,e,l,g,h)},graphics:function(b,c){return new a.Graphics(this.game,b,c)},emitter:function(b,c,f){return new a.Particles.Arcade.Emitter(this.game,b,c,f)},retroFont:function(b,c,f,d,n,e,l,g,h){return new a.RetroFont(this.game,b,c,f,d,n,e,l,g,h)},bitmapText:function(b,c,f,d,n){return new a.BitmapText(this.game,
b,c,f,d,n)},tilemap:function(b,c,f,d,n){return new a.Tilemap(this.game,b,c,f,d,n)},renderTexture:function(b,c,f,d){"undefined"!=typeof f&&""!==f||(f=this.game.rnd.uuid());"undefined"==typeof d&&(d=!1);b=new a.RenderTexture(this.game,b,c,f);return d&&this.game.cache.addRenderTexture(f,b),b},bitmapData:function(b,c,f,d){"undefined"==typeof d&&(d=!1);"undefined"!=typeof f&&""!==f||(f=this.game.rnd.uuid());b=new a.BitmapData(this.game,f,b,c);return d&&this.game.cache.addBitmapData(f,b),b},filter:function(b){var c=
Array.prototype.splice.call(arguments,1);b=new a.Filter[b](this.game);return b.init.apply(b,c),b}};a.GameObjectCreator.prototype.constructor=a.GameObjectCreator;a.Sprite=function(b,c,f,d,n){c=c||0;f=f||0;d=d||null;n=n||null;this.physicsType=this.type=a.SPRITE;PIXI.Sprite.call(this,PIXI.TextureCache.__default);a.Component.Core.init.call(this,b,c,f,d,n)};a.Sprite.prototype=Object.create(PIXI.Sprite.prototype);a.Sprite.prototype.constructor=a.Sprite;a.Component.Core.install.call(a.Sprite.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Delta Destroy FixedToCamera InputEnabled InWorld LifeSpan LoadTexture Overlap PhysicsBody Reset ScaleMinMax Smoothed".split(" "));
a.Sprite.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.Sprite.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;a.Sprite.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.Sprite.prototype.preUpdateCore=a.Component.Core.preUpdate;a.Sprite.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};a.Image=function(b,c,f,d,n){c=c||0;f=f||0;d=d||null;n=n||null;this.type=a.IMAGE;PIXI.Sprite.call(this,
PIXI.TextureCache.__default);a.Component.Core.init.call(this,b,c,f,d,n)};a.Image.prototype=Object.create(PIXI.Sprite.prototype);a.Image.prototype.constructor=a.Image;a.Component.Core.install.call(a.Image.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Destroy FixedToCamera InputEnabled LifeSpan LoadTexture Overlap Reset Smoothed".split(" "));a.Image.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.Image.prototype.preUpdateCore=a.Component.Core.preUpdate;a.Image.prototype.preUpdate=
function(){return this.preUpdateInWorld()?this.preUpdateCore():!1};a.TileSprite=function(b,c,f,d,n,e,l){c=c||0;f=f||0;d=d||256;n=n||256;e=e||null;l=l||null;this.type=a.TILESPRITE;this._scroll=new a.Point;PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,d,n);a.Component.Core.init.call(this,b,c,f,e,l)};a.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);a.TileSprite.prototype.constructor=a.TileSprite;a.Component.Core.install.call(a.TileSprite.prototype,"Angle Animation AutoCull Bounds Destroy FixedToCamera InputEnabled InWorld LoadTexture Overlap PhysicsBody Reset Smoothed".split(" "));
a.TileSprite.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.TileSprite.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;a.TileSprite.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.TileSprite.prototype.preUpdateCore=a.Component.Core.preUpdate;a.TileSprite.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),
this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};a.TileSprite.prototype.autoScroll=function(b,c){this._scroll.set(b,c)};a.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};a.TileSprite.prototype.destroy=function(b){a.Component.Destroy.prototype.destroy.call(this,b);PIXI.TilingSprite.prototype.destroy.call(this)};a.TileSprite.prototype.reset=function(b,c){return a.Component.Reset.prototype.reset.call(this,b,c),this.tilePosition.x=0,
this.tilePosition.y=0,this};a.Rope=function(b,c,f,d,n,e){this.points=[];this.points=e;this._hasUpdateAnimation=!1;this._updateAnimationCallback=null;c=c||0;f=f||0;d=d||null;n=n||null;this.type=a.ROPE;this._scroll=new a.Point;PIXI.Rope.call(this,d,this.points);a.Component.Core.init.call(this,b,c,f,d,n)};a.Rope.prototype=Object.create(PIXI.Rope.prototype);a.Rope.prototype.constructor=a.Rope;a.Component.Core.install.call(a.Rope.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Delta Destroy FixedToCamera InputEnabled InWorld LifeSpan LoadTexture Overlap PhysicsBody Reset ScaleMinMax Smoothed".split(" "));
a.Rope.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.Rope.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;a.Rope.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.Rope.prototype.preUpdateCore=a.Component.Core.preUpdate;a.Rope.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),this.preUpdatePhysics()&&
this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};a.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)};a.Rope.prototype.reset=function(b,c){return a.Component.Reset.prototype.reset.call(this,b,c),this.tilePosition.x=0,this.tilePosition.y=0,this};Object.defineProperty(a.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(b){b&&"function"==typeof b?(this._hasUpdateAnimation=!0,this._updateAnimation=
b):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}});Object.defineProperty(a.Rope.prototype,"segments",{get:function(){for(var b,c,f,d,n=[],e=0;e<this.points.length;e++)b=4*e,c=this.verticies[b],f=this.verticies[b+1],d=this.verticies[b+4],b=this.verticies[b+3],d=a.Math.difference(c,d),b=a.Math.difference(f,b),c+=this.world.x,f+=this.world.y,c=new a.Rectangle(c,f,d,b),n.push(c);return n}});a.Button=function(b,c,f,d,n,e,l,g,h,k){n=n||null;e=e||this;a.Image.call(this,b,c||0,f||0,d||null,g);
this.type=a.BUTTON;this.physicsType=a.SPRITE;this.onUpSound=this.onDownSound=this.onOutSound=this.onOverSound=this._onUpFrame=this._onDownFrame=this._onOutFrame=this._onOverFrame=null;this.onUpSoundMarker=this.onDownSoundMarker=this.onOutSoundMarker=this.onOverSoundMarker="";this.onInputOver=new a.Signal;this.onInputOut=new a.Signal;this.onInputDown=new a.Signal;this.onInputUp=new a.Signal;this.forceOut=this.freezeFrames=this.onOverMouseOnly=!1;this.inputEnabled=!0;this.input.start(0,!0);this.setFrames(l,
g,h,k);null!==n&&this.onInputUp.add(n,e);this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};a.Button.prototype=Object.create(a.Image.prototype);a.Button.prototype.constructor=a.Button;a.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};
a.Button.prototype.removedFromWorld=function(){this.inputEnabled=!1};a.Button.prototype.setStateFrame=function(b,c,a){var d="_on"+b+"Frame";null!=c?(this[d]=c,a&&this.changeStateFrame(b)):this[d]=null};a.Button.prototype.changeStateFrame=function(b){if(this.freezeFrames)return!1;b=this["_on"+b+"Frame"];return"string"==typeof b?(this.frameName=b,!0):"number"==typeof b?(this.frame=b,!0):!1};a.Button.prototype.setFrames=function(b,c,a,d){this.setStateFrame("Over",b,this.input.pointerOver());this.setStateFrame("Out",
c,!this.input.pointerOver());this.setStateFrame("Down",a,this.input.pointerDown());this.setStateFrame("Up",d,this.input.pointerUp())};a.Button.prototype.setStateSound=function(b,c,f){var d="on"+b+"Sound";b="on"+b+"SoundMarker";c instanceof a.Sound||c instanceof a.AudioSprite?(this[d]=c,this[b]="string"==typeof f?f:""):(this[d]=null,this[b]="")};a.Button.prototype.playStateSound=function(b){var c=this["on"+b+"Sound"];return c?(c.play(this["on"+b+"SoundMarker"]),!0):!1};a.Button.prototype.setSounds=
function(b,c,a,d,n,e,l,g){this.setStateSound("Over",b,c);this.setStateSound("Out",n,e);this.setStateSound("Down",a,d);this.setStateSound("Up",l,g)};a.Button.prototype.setOverSound=function(b,c){this.setStateSound("Over",b,c)};a.Button.prototype.setOutSound=function(b,c){this.setStateSound("Out",b,c)};a.Button.prototype.setDownSound=function(b,c){this.setStateSound("Down",b,c)};a.Button.prototype.setUpSound=function(b,c){this.setStateSound("Up",b,c)};a.Button.prototype.onInputOverHandler=function(b,
c){c.justReleased()||(this.changeStateFrame("Over"),(!this.onOverMouseOnly||c.isMouse)&&(this.playStateSound("Over"),this.onInputOver&&this.onInputOver.dispatch(this,c)))};a.Button.prototype.onInputOutHandler=function(b,c){this.changeStateFrame("Out");this.playStateSound("Out");this.onInputOut&&this.onInputOut.dispatch(this,c)};a.Button.prototype.onInputDownHandler=function(b,c){this.changeStateFrame("Down");this.playStateSound("Down");this.onInputDown&&this.onInputDown.dispatch(this,c)};a.Button.prototype.onInputUpHandler=
function(b,c,a){(this.playStateSound("Up"),this.onInputUp&&this.onInputUp.dispatch(this,c,a),this.freezeFrames)||(this.forceOut?this.changeStateFrame("Out"):this.changeStateFrame("Up")||this.changeStateFrame(a?"Over":"Out"))};a.SpriteBatch=function(b,c,f,d){"undefined"!=typeof c&&null!==c||(c=b.world);PIXI.SpriteBatch.call(this);a.Group.call(this,b,c,f,d);this.type=a.SPRITEBATCH};a.SpriteBatch.prototype=a.Utils.extend(!0,a.SpriteBatch.prototype,a.Group.prototype,PIXI.SpriteBatch.prototype);a.SpriteBatch.prototype.constructor=
a.SpriteBatch;a.Particle=function(b,c,f,d,n){a.Sprite.call(this,b,c,f,d,n);this.autoScale=!1;this.scaleData=null;this._s=0;this.autoAlpha=!1;this.alphaData=null;this._a=0};a.Particle.prototype=Object.create(a.Sprite.prototype);a.Particle.prototype.constructor=a.Particle;a.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1);this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:
this.autoAlpha=!1)};a.Particle.prototype.onEmit=function(){};a.Particle.prototype.setAlphaData=function(b){this.alphaData=b;this._a=b.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=!0};a.Particle.prototype.setScaleData=function(b){this.scaleData=b;this._s=b.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=!0};a.Particle.prototype.reset=function(b,c,f){return a.Component.Reset.prototype.reset.call(this,b,c,f),this.alpha=1,this.scale.set(1),this.autoScale=
!1,this.autoAlpha=!1,this};a.BitmapData=function(b,c,f,d){"undefined"==typeof f&&(f=256);"undefined"==typeof d&&(d=256);this.game=b;this.key=c;this.width=f;this.height=d;this.canvas=a.Canvas.create(f,d,"",!0);this.ctx=this.context=this.canvas.getContext("2d",{alpha:!0});this.imageData=this.context.getImageData(0,0,f,d);this.data=this.imageData.data;this.pixels=null;this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=
new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data;this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new a.Frame(0,0,0,f,d,"bitmapData",b.rnd.uuid());this.texture.frame=this.textureFrame;this.type=a.BITMAPDATA;this.dirty=this.disableTextureUpload=!1;this.cls=this.clear;this._image=null;this._pos=new a.Point;this._size=new a.Point;this._scale=new a.Point;this._rotate=
0;this._alpha={prev:1,current:1};this._anchor=new a.Point;this._tempB=this._tempG=this._tempR=0;this._circle=new a.Circle};a.BitmapData.prototype={add:function(b){if(Array.isArray(b))for(var c=0;c<b.length;c++)b[c].loadTexture&&b[c].loadTexture(this);else b.loadTexture(this);return this},load:function(b){return"string"==typeof b&&(b=this.game.cache.getImage(b)),b?(this.resize(b.width,b.height),this.cls(),this.draw(b),this.update(),this):void 0},clear:function(){return this.context.clearRect(0,0,this.width,
this.height),this.dirty=!0,this},fill:function(b,c,a,d){return"undefined"==typeof d&&(d=1),this.context.fillStyle="rgba("+b+","+c+","+a+","+d+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},resize:function(b,c){return(b!==this.width||c!==this.height)&&(this.width=b,this.height=c,this.canvas.width=b,this.canvas.height=c,this.baseTexture.width=b,this.baseTexture.height=c,this.textureFrame.width=b,this.textureFrame.height=c,this.texture.width=b,this.texture.height=c,this.texture.crop.width=
b,this.texture.crop.height=c,this.update(),this.dirty=!0),this},update:function(b,c,a,d){return"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof a&&(a=this.width),"undefined"==typeof d&&(d=this.height),this.imageData=this.context.getImageData(b,c,a,d),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=
new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(b,c,f,d,n,e){"undefined"==typeof f&&(f=0);"undefined"==typeof d&&(d=0);"undefined"==typeof n&&(n=this.width);"undefined"==typeof e&&(e=this.height);n=f+n;e=d+e;for(var l=a.Color.createColor(),g={r:0,g:0,b:0,a:0},h=!1;e>d;d++)for(var k=f;n>k;k++)a.Color.unpackPixel(this.getPixel32(k,d),l),g=b.call(c,l,k,d),!1!==g&&null!==g&&void 0!==g&&(this.setPixel32(k,d,g.r,g.g,g.b,g.a,!1),h=!0);return h&&(this.context.putImageData(this.imageData,
0,0),this.dirty=!0),this},processPixel:function(b,c,a,d,n,e){"undefined"==typeof a&&(a=0);"undefined"==typeof d&&(d=0);"undefined"==typeof n&&(n=this.width);"undefined"==typeof e&&(e=this.height);n=a+n;e=d+e;for(var l=0,g=0,h=!1;e>d;d++)for(var k=a;n>k;k++)l=this.getPixel32(k,d),g=b.call(c,l,k,d),g!==l&&(this.pixels[d*this.width+k]=g,h=!0);return h&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(b,c,f,d,n,e,l,g,h){var k=0,m=0,u=this.width,z=this.height;b=a.Color.packPixel(b,
c,f,d);void 0!==h&&h instanceof a.Rectangle&&(k=h.x,m=h.y,u=h.width,z=h.height);for(h=0;z>h;h++)for(c=0;u>c;c++)this.getPixel32(k+c,m+h)===b&&this.setPixel32(k+c,m+h,n,e,l,g,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(b,c,f,d){if(("undefined"==typeof b||null===b)&&(b=!1),("undefined"==typeof c||null===c)&&(c=!1),("undefined"==typeof f||null===f)&&(f=!1),b||c||f){"undefined"==typeof d&&(d=new a.Rectangle(0,0,this.width,this.height));for(var n=a.Color.createColor(),
e=d.y;e<d.bottom;e++)for(var l=d.x;l<d.right;l++)a.Color.unpackPixel(this.getPixel32(l,e),n,!0),b&&(n.h=b),c&&(n.s=c),f&&(n.l=f),a.Color.HSLtoRGB(n.h,n.s,n.l,n),this.setPixel32(l,e,n.r,n.g,n.b,n.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(b,c,f,d){if(("undefined"==typeof b||null===b)&&(b=!1),("undefined"==typeof c||null===c)&&(c=!1),("undefined"==typeof f||null===f)&&(f=!1),b||c||f){"undefined"==typeof d&&(d=new a.Rectangle(0,0,this.width,this.height));
for(var n=a.Color.createColor(),e=d.y;e<d.bottom;e++)for(var l=d.x;l<d.right;l++)a.Color.unpackPixel(this.getPixel32(l,e),n,!0),b&&(n.h=this.game.math.wrap(n.h+b,0,1)),c&&(n.s=this.game.math.limitValue(n.s+c,0,1)),f&&(n.l=this.game.math.limitValue(n.l+f,0,1)),a.Color.HSLtoRGB(n.h,n.s,n.l,n),this.setPixel32(l,e,n.r,n.g,n.b,n.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(b,c,f,d,n,e,l){return"undefined"==typeof l&&(l=!0),0<=b&&b<=this.width&&0<=
c&&c<=this.height&&(this.pixels[c*this.width+b]=a.Device.LITTLE_ENDIAN?e<<24|n<<16|d<<8|f:f<<24|d<<16|n<<8|e,l&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(b,c,a,d,n,e){return this.setPixel32(b,c,a,d,n,255,e)},getPixel:function(b,c,f){f||(f=a.Color.createColor());b=~~(b+c*this.width);return b*=4,f.r=this.data[b],f.g=this.data[++b],f.b=this.data[++b],f.a=this.data[++b],f},getPixel32:function(b,c){return 0<=b&&b<=this.width&&0<=c&&c<=this.height?this.pixels[c*
this.width+b]:void 0},getPixelRGB:function(b,c,f,d,n){return a.Color.unpackPixel(this.getPixel32(b,c),f,d,n)},getPixels:function(b){return this.context.getImageData(b.x,b.y,b.width,b.height)},getFirstPixel:function(b){"undefined"==typeof b&&(b=0);var c=a.Color.createColor(),f=0,d=0,n=1,e=!1;1===b?(n=-1,d=this.height):3===b&&(n=-1,f=this.width);do a.Color.unpackPixel(this.getPixel32(f,d),c),0===b||1===b?(f++,f===this.width&&(f=0,d+=n,(d>=this.height||0>=d)&&(e=!0))):(2===b||3===b)&&(d++,d===this.height&&
(d=0,f+=n,(f>=this.width||0>=f)&&(e=!0)));while(0===c.a&&!e);return c.x=f,c.y=d,c},getBounds:function(b){return"undefined"==typeof b&&(b=new a.Rectangle),b.x=this.getFirstPixel(2).x,b.x===this.width?b.setTo(0,0,0,0):(b.y=this.getFirstPixel(0).y,b.width=this.getFirstPixel(3).x-b.x+1,b.height=this.getFirstPixel(1).y-b.y+1,b)},addToWorld:function(b,c,a,d,n,e){n=n||1;e=e||1;b=this.game.add.image(b,c,this);return b.anchor.set(a,d),b.scale.set(n,e),b},copy:function(b,c,f,d,n,e,l,g,h,k,m,u,z,x,r,w,G){if(("undefined"==
typeof b||null===b)&&(b=this),this._image=b,b instanceof a.Sprite||b instanceof a.Image||b instanceof a.Text)this._pos.set(b.texture.crop.x,b.texture.crop.y),this._size.set(b.texture.crop.width,b.texture.crop.height),this._scale.set(b.scale.x,b.scale.y),this._anchor.set(b.anchor.x,b.anchor.y),this._rotate=b.rotation,this._alpha.current=b.alpha,this._image=b.texture.baseTexture.source,"undefined"!=typeof e&&null!==e||(e=b.x),"undefined"!=typeof l&&null!==l||(l=b.y),b.texture.trim&&(e+=b.texture.trim.x-
b.anchor.x*b.texture.trim.width,l+=b.texture.trim.y-b.anchor.y*b.texture.trim.height),16777215!==b.tint&&(b.cachedTint!==b.tint&&(b.cachedTint=b.tint,b.tintedTexture=PIXI.CanvasTinter.getTintedTexture(b,b.tint)),this._image=b.tintedTexture);else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,b instanceof a.BitmapData)this._image=b.canvas;else if("string"==typeof b){if(b=this.game.cache.getImage(b),null===b)return;this._image=b}this._size.set(this._image.width,
this._image.height)}return("undefined"==typeof c||null===c)&&(c=0),("undefined"==typeof f||null===f)&&(f=0),d&&(this._size.x=d),n&&(this._size.y=n),("undefined"==typeof e||null===e)&&(e=c),("undefined"==typeof l||null===l)&&(l=f),("undefined"==typeof g||null===g)&&(g=this._size.x),("undefined"==typeof h||null===h)&&(h=this._size.y),"number"==typeof k&&(this._rotate=k),"number"==typeof m&&(this._anchor.x=m),"number"==typeof u&&(this._anchor.y=u),"number"==typeof z&&(this._scale.x=z),"number"==typeof x&&
(this._scale.y=x),"number"==typeof r&&(this._alpha.current=r),"undefined"==typeof w&&(w=null),"undefined"==typeof G&&(G=!1),0>=this._alpha.current||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y?void 0:(this._alpha.prev=this.context.globalAlpha,this.context.save(),this.context.globalAlpha=this._alpha.current,w&&(this.context.globalCompositeOperation=w),G&&(e|=0,l|=0),this.context.translate(e,l),this.context.scale(this._scale.x,this._scale.y),this.context.rotate(this._rotate),
this.context.drawImage(this._image,this._pos.x+c,this._pos.y+f,this._size.x,this._size.y,-g*this._anchor.x,-h*this._anchor.y,g,h),this.context.restore(),this.context.globalAlpha=this._alpha.prev,this.dirty=!0,this)},copyRect:function(b,c,a,d,n,e,l){return this.copy(b,c.x,c.y,c.width,c.height,a,d,c.width,c.height,0,0,0,1,1,n,e,l)},draw:function(b,c,a,d,n,e,l){return this.copy(b,null,null,null,null,c,a,d,n,null,null,null,null,null,null,e,l)},drawGroup:function(b,c,a){return 0<b.total&&b.forEachExists(this.copy,
this,null,null,null,null,null,null,null,null,null,null,null,null,null,null,c,a),this},shadow:function(b,c,a,d){"undefined"==typeof b||null===b?this.context.shadowColor="rgba(0,0,0,0)":(this.context.shadowColor=b,this.context.shadowBlur=c||5,this.context.shadowOffsetX=a||10,this.context.shadowOffsetY=d||10)},alphaMask:function(b,c,a,d){return"undefined"==typeof d||null===d?this.draw(c).blendSourceAtop():this.draw(c,d.x,d.y,d.width,d.height).blendSourceAtop(),"undefined"==typeof a||null===a?this.draw(b).blendReset():
this.draw(b,a.x,a.y,a.width,a.height).blendReset(),this},extract:function(b,c,a,d,n,e,l,g,h){return"undefined"==typeof n&&(n=255),"undefined"==typeof e&&(e=!1),"undefined"==typeof l&&(l=c),"undefined"==typeof g&&(g=a),"undefined"==typeof h&&(h=d),e&&b.resize(this.width,this.height),this.processPixelRGB(function(e,p,k){return e.r===c&&e.g===a&&e.b===d&&b.setPixel32(p,k,l,g,h,n,!1),!1},this),b.context.putImageData(b.imageData,0,0),b.dirty=!0,b},rect:function(b,c,a,d,n){return"undefined"!=typeof n&&
(this.context.fillStyle=n),this.context.fillRect(b,c,a,d),this},text:function(b,c,a,d,n,e){"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a=0);"undefined"==typeof d&&(d="14px Courier");"undefined"==typeof n&&(n="rgb(255,255,255)");"undefined"==typeof e&&(e=!0);var l=this.context.font;this.context.font=d;e&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(b,c+1,a+1));this.context.fillStyle=n;this.context.fillText(b,c,a);this.context.font=l},circle:function(b,c,a,d){return"undefined"!=
typeof d&&(this.context.fillStyle=d),this.context.beginPath(),this.context.arc(b,c,a,0,2*Math.PI,!1),this.context.closePath(),this.context.fill(),this},textureLine:function(b,c,f){if("undefined"==typeof f&&(f="repeat-x"),"string"!=typeof c||(c=this.game.cache.getImage(c))){var d=b.length;return"no-repeat"===f&&d>c.width&&(d=c.width),this.context.fillStyle=this.context.createPattern(c,f),this._circle=new a.Circle(b.start.x,b.start.y,c.height),this._circle.circumferencePoint(b.angle-1.5707963267948966,
!1,this._pos),this.context.save(),this.context.translate(this._pos.x,this._pos.y),this.context.rotate(b.angle),this.context.fillRect(0,0,d,c.height),this.context.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},blendReset:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceOver:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceIn:function(){return this.context.globalCompositeOperation=
"source-in",this},blendSourceOut:function(){return this.context.globalCompositeOperation="source-out",this},blendSourceAtop:function(){return this.context.globalCompositeOperation="source-atop",this},blendDestinationOver:function(){return this.context.globalCompositeOperation="destination-over",this},blendDestinationIn:function(){return this.context.globalCompositeOperation="destination-in",this},blendDestinationOut:function(){return this.context.globalCompositeOperation="destination-out",this},blendDestinationAtop:function(){return this.context.globalCompositeOperation=
"destination-atop",this},blendXor:function(){return this.context.globalCompositeOperation="xor",this},blendAdd:function(){return this.context.globalCompositeOperation="lighter",this},blendMultiply:function(){return this.context.globalCompositeOperation="multiply",this},blendScreen:function(){return this.context.globalCompositeOperation="screen",this},blendOverlay:function(){return this.context.globalCompositeOperation="overlay",this},blendDarken:function(){return this.context.globalCompositeOperation=
"darken",this},blendLighten:function(){return this.context.globalCompositeOperation="lighten",this},blendColorDodge:function(){return this.context.globalCompositeOperation="color-dodge",this},blendColorBurn:function(){return this.context.globalCompositeOperation="color-burn",this},blendHardLight:function(){return this.context.globalCompositeOperation="hard-light",this},blendSoftLight:function(){return this.context.globalCompositeOperation="soft-light",this},blendDifference:function(){return this.context.globalCompositeOperation=
"difference",this},blendExclusion:function(){return this.context.globalCompositeOperation="exclusion",this},blendHue:function(){return this.context.globalCompositeOperation="hue",this},blendSaturation:function(){return this.context.globalCompositeOperation="saturation",this},blendColor:function(){return this.context.globalCompositeOperation="color",this},blendLuminosity:function(){return this.context.globalCompositeOperation="luminosity",this}};Object.defineProperty(a.BitmapData.prototype,"smoothed",
{get:function(){a.Canvas.getSmoothingEnabled(this.context)},set:function(b){a.Canvas.setSmoothingEnabled(this.context,b)}});a.BitmapData.getTransform=function(b,c,a,d,n,e){return"number"!=typeof b&&(b=0),"number"!=typeof c&&(c=0),"number"!=typeof a&&(a=1),"number"!=typeof d&&(d=1),"number"!=typeof n&&(n=0),"number"!=typeof e&&(e=0),{sx:a,sy:d,scaleX:a,scaleY:d,skewX:n,skewY:e,translateX:b,translateY:c,tx:b,ty:c}};a.BitmapData.prototype.constructor=a.BitmapData;a.Graphics=function(b,c,f){c=c||0;f=
f||0;this.type=a.GRAPHICS;this.physicsType=a.SPRITE;PIXI.Graphics.call(this);a.Component.Core.init.call(this,b,c,f,"",null)};a.Graphics.prototype=Object.create(PIXI.Graphics.prototype);a.Graphics.prototype.constructor=a.Graphics;a.Component.Core.install.call(a.Graphics.prototype,"Angle AutoCull Bounds Destroy FixedToCamera InputEnabled InWorld LifeSpan PhysicsBody Reset".split(" "));a.Graphics.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.Graphics.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;
a.Graphics.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.Graphics.prototype.preUpdateCore=a.Component.Core.preUpdate;a.Graphics.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};a.Graphics.prototype.destroy=function(b){this.clear();a.Component.Destroy.prototype.destroy.call(this,b)};a.Graphics.prototype.drawTriangle=function(b,c){"undefined"==typeof c&&(c=!1);var f=new a.Polygon(b);if(c){var d=new a.Point(this.game.camera.x-
b[0].x,this.game.camera.y-b[0].y),n=new a.Point(b[1].x-b[0].x,b[1].y-b[0].y),n=(new a.Point(b[1].x-b[2].x,b[1].y-b[2].y)).cross(n);0<d.dot(n)&&this.drawPolygon(f)}else this.drawPolygon(f)};a.Graphics.prototype.drawTriangles=function(b,c,f){"undefined"==typeof f&&(f=!1);var d,n=new a.Point,e=new a.Point,l=new a.Point,g=[];if(c)if(b[0]instanceof a.Point)for(d=0;d<c.length/3;d++)g.push(b[c[3*d]]),g.push(b[c[3*d+1]]),g.push(b[c[3*d+2]]),3===g.length&&(this.drawTriangle(g,f),g=[]);else for(d=0;d<c.length;d++)n.x=
b[2*c[d]],n.y=b[2*c[d]+1],g.push(n.copyTo({})),3===g.length&&(this.drawTriangle(g,f),g=[]);else if(b[0]instanceof a.Point)for(d=0;d<b.length/3;d++)this.drawTriangle([b[3*d],b[3*d+1],b[3*d+2]],f);else for(d=0;d<b.length/6;d++)n.x=b[6*d+0],n.y=b[6*d+1],e.x=b[6*d+2],e.y=b[6*d+3],l.x=b[6*d+4],l.y=b[6*d+5],this.drawTriangle([n,e,l],f)};a.RenderTexture=function(b,c,f,d,n,e){"undefined"==typeof d&&(d="");"undefined"==typeof n&&(n=a.scaleModes.DEFAULT);"undefined"==typeof e&&(e=1);this.game=b;this.key=d;
this.type=a.RENDERTEXTURE;this.matrix=new PIXI.Matrix;PIXI.RenderTexture.call(this,c,f,this.game.renderer,n,e);this.render=a.RenderTexture.prototype.render};a.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);a.RenderTexture.prototype.constructor=a.RenderTexture;a.RenderTexture.prototype.renderXY=function(b,c,a,d){this.matrix.tx=c;this.matrix.ty=a;this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(b,this.matrix,d):this.renderCanvas(b,this.matrix,d)};a.RenderTexture.prototype.render=
function(b,c,a){this.matrix.tx=c.x;this.matrix.ty=c.y;this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(b,this.matrix,a):this.renderCanvas(b,this.matrix,a)};a.Text=function(b,c,f,d,n){c=c||0;f=f||0;d=d||" ";n=n||{};d=0===d.length?" ":d.toString();this.type=a.TEXT;this.physicsType=a.SPRITE;this.padding=new a.Point;this._text=d;this._fontComponents=null;this._charCount=this._lineSpacing=0;this.colors=[];this.setStyle(n);PIXI.Text.call(this,d,this.style);a.Component.Core.init.call(this,b,c,f,
"",null);" "!==d&&this.updateText()};a.Text.prototype=Object.create(PIXI.Text.prototype);a.Text.prototype.constructor=a.Text;a.Component.Core.install.call(a.Text.prototype,"Angle AutoCull Bounds BringToTop Destroy FixedToCamera InputEnabled InWorld LifeSpan Overlap PhysicsBody Reset Smoothed".split(" "));a.Text.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.Text.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;a.Text.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;
a.Text.prototype.preUpdateCore=a.Component.Core.preUpdate;a.Text.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};a.Text.prototype.update=function(){};a.Text.prototype.destroy=function(b){this.texture.destroy(!0);this.canvas&&this.canvas.parentNode?this.canvas.parentNode.removeChild(this.canvas):(this.canvas=null,this.context=null);a.Component.Destroy.prototype.destroy.call(this,b)};a.Text.prototype.setShadow=
function(b,c,a,d){"undefined"==typeof b&&(b=0);"undefined"==typeof c&&(c=0);"undefined"==typeof a&&(a="rgba(0, 0, 0, 1)");"undefined"==typeof d&&(d=0);this.style.shadowOffsetX=b;this.style.shadowOffsetY=c;this.style.shadowColor=a;this.style.shadowBlur=d;this.dirty=!0};a.Text.prototype.setStyle=function(b){b=b||{};b.font=b.font||"bold 20pt Arial";b.backgroundColor=b.backgroundColor||null;b.fill=b.fill||"black";b.align=b.align||"left";b.stroke=b.stroke||"black";b.strokeThickness=b.strokeThickness||
0;b.wordWrap=b.wordWrap||!1;b.wordWrapWidth=b.wordWrapWidth||100;b.shadowOffsetX=b.shadowOffsetX||0;b.shadowOffsetY=b.shadowOffsetY||0;b.shadowColor=b.shadowColor||"rgba(0,0,0,0)";b.shadowBlur=b.shadowBlur||0;var c=this.fontToComponents(b.font);b.fontStyle&&(c.fontStyle=b.fontStyle);b.fontVariant&&(c.fontVariant=b.fontVariant);b.fontWeight&&(c.fontWeight=b.fontWeight);b.fontSize&&("number"==typeof b.fontSize&&(b.fontSize+="px"),c.fontSize=b.fontSize);this._fontComponents=c;b.font=this.componentsToFont(this._fontComponents);
this.style=b;this.dirty=!0};a.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var b=this.text;this.style.wordWrap&&(b=this.runWordWrap(this.text));for(var b=b.split(/(?:\r\n|\r|\n)/),c=[],a=0,d=this.determineFontProperties(this.style.font),n=0;n<b.length;n++){var e=this.context.measureText(b[n]).width+this.padding.x;c[n]=e;a=Math.max(a,e)}this.canvas.width=(a+this.style.strokeThickness)*this.resolution;var e=d.fontSize+this.style.strokeThickness+
this.padding.y,n=e*b.length,l=this._lineSpacing;if(0>l&&Math.abs(l)>e&&(l=-e),0!==l)n+=l*(b.length-1);this.canvas.height=n*this.resolution;this.context.scale(this.resolution,this.resolution);navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height));this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=
this.style.stroke;this.context.textBaseline="alphabetic";this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur;this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";for(var g,h,n=this._charCount=0;n<b.length;n++)g=this.style.strokeThickness/2,h=this.style.strokeThickness/2+n*e+d.ascent,0<n&&(h+=l*n),"right"===
this.style.align?g+=a-c[n]:"center"===this.style.align&&(g+=(a-c[n])/2),0<this.colors.length?this.updateLine(b[n],g,h):(this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(b[n],g,h),this.style.fill&&this.context.fillText(b[n],g,h));this.updateTexture()};a.Text.prototype.updateLine=function(b,c,a){for(var d=0;d<b.length;d++){var n=b[d];this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount],this.context.strokeStyle=this.colors[this._charCount]);this.style.stroke&&
this.style.strokeThickness&&this.context.strokeText(n,c,a);this.style.fill&&this.context.fillText(n,c,a);c+=this.context.measureText(n).width;this._charCount++}};a.Text.prototype.clearColors=function(){this.colors=[];this.dirty=!0};a.Text.prototype.addColor=function(b,c){this.colors[c]=b;this.dirty=!0};a.Text.prototype.runWordWrap=function(b){var c="";b=b.split("\n");for(var a=0;a<b.length;a++){for(var d=this.style.wordWrapWidth,n=b[a].split(" "),e=0;e<n.length;e++){var l=this.context.measureText(n[e]).width,
g=l+this.context.measureText(" ").width;g>d?(0<e&&(c+="\n"),c+=n[e]+" ",d=this.style.wordWrapWidth-l):(d-=g,c+=n[e]+" ")}a<b.length-1&&(c+="\n")}return c};a.Text.prototype.updateFont=function(b){b=this.componentsToFont(b);this.style.font!==b&&(this.style.font=b,this.dirty=!0,this.parent&&this.updateTransform())};a.Text.prototype.fontToComponents=function(b){var c=b.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);
return c?{font:b,fontStyle:c[1]||"normal",fontVariant:c[2]||"normal",fontWeight:c[3]||"normal",fontSize:c[4]||"medium",fontFamily:c[5]}:(console.warn("Phaser.Text - unparsable CSS font: "+b),{font:b})};a.Text.prototype.componentsToFont=function(b){var c,a=[];return c=b.fontStyle,c&&"normal"!==c&&a.push(c),c=b.fontVariant,c&&"normal"!==c&&a.push(c),c=b.fontWeight,c&&"normal"!==c&&a.push(c),c=b.fontSize,c&&"medium"!==c&&a.push(c),c=b.fontFamily,c&&a.push(c),a.length||a.push(b.font),a.join(" ")};Object.defineProperty(a.Text.prototype,
"text",{get:function(){return this._text},set:function(b){b!==this._text&&(this._text=b.toString()||" ",this.dirty=!0,this.parent&&this.updateTransform())}});Object.defineProperty(a.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(b){this._fontComponents=this.fontToComponents(b||"bold 20pt Arial");this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(b){b=
(b||"Arial").trim();/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(b)||/['",]/.exec(b)||(b="'"+b+"'");this._fontComponents.fontFamily=b;this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,"fontSize",{get:function(){var b=this._fontComponents.fontSize;return b&&/(?:^0$|px$)/.exec(b)?parseInt(b,10):b},set:function(b){b=b||"0";"number"==typeof b&&(b+="px");this._fontComponents.fontSize=b;this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,
"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(b){this._fontComponents.fontWeight=b||"normal";this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(b){this._fontComponents.fontStyle=b||"normal";this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||
"normal"},set:function(b){this._fontComponents.fontVariant=b||"normal";this.updateFont(this._fontComponents)}});Object.defineProperty(a.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(b){b!==this.style.fill&&(this.style.fill=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"align",{get:function(){return this.style.align},set:function(b){b!==this.style.align&&(this.style.align=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"stroke",{get:function(){return this.style.stroke},
set:function(b){b!==this.style.stroke&&(this.style.stroke=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(b){b!==this.style.strokeThickness&&(this.style.strokeThickness=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(b){b!==this.style.wordWrap&&(this.style.wordWrap=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"wordWrapWidth",
{get:function(){return this.style.wordWrapWidth},set:function(b){b!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(b){b!==this._lineSpacing&&(this._lineSpacing=parseFloat(b),this.dirty=!0,this.parent&&this.updateTransform())}});Object.defineProperty(a.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(b){b!==this.style.shadowOffsetX&&
(this.style.shadowOffsetX=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(b){b!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(b){b!==this.style.shadowColor&&(this.style.shadowColor=b,this.dirty=!0)}});Object.defineProperty(a.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},
set:function(b){b!==this.style.shadowBlur&&(this.style.shadowBlur=b,this.dirty=!0)}});a.BitmapText=function(b,c,f,d,n,e){c=c||0;f=f||0;n=n||"";this.type=a.BITMAPTEXT;this.physicsType=a.SPRITE;this._text=n;this._font=d||"";this._fontSize=e||32;this._align="left";this._tint=16777215;this._th=this._tw=0;PIXI.BitmapText.call(this,n);a.Component.Core.init.call(this,b,c,f,"",null)};a.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype);a.BitmapText.prototype.constructor=a.BitmapText;a.Component.Core.install.call(a.BitmapText.prototype,
"Angle AutoCull Bounds Destroy FixedToCamera InputEnabled InWorld LifeSpan PhysicsBody Reset".split(" "));a.BitmapText.prototype.preUpdatePhysics=a.Component.PhysicsBody.preUpdate;a.BitmapText.prototype.preUpdateLifeSpan=a.Component.LifeSpan.preUpdate;a.BitmapText.prototype.preUpdateInWorld=a.Component.InWorld.preUpdate;a.BitmapText.prototype.preUpdateCore=a.Component.Core.preUpdate;a.BitmapText.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?
this.preUpdateCore():!1};a.BitmapText.prototype.postUpdate=function(){a.Component.PhysicsBody.postUpdate.call(this);a.Component.FixedToCamera.postUpdate.call(this);!this.body||this.textWidth===this._tw&&this.textHeight===this._th||(this.body.setSize(this.textWidth,this.textHeight),this._tw=this.textWidth,this._th=this.textHeight)};a.BitmapText.prototype.setStyle=function(){this.style={align:this._align};this.fontName=this._font;this.fontSize=this._fontSize;this.dirty=!0};Object.defineProperty(a.BitmapText.prototype,
"align",{get:function(){return this._align},set:function(b){b!==this._align&&(this._align=b,this.setStyle())}});Object.defineProperty(a.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(b){b!==this._tint&&(this._tint=b,this.dirty=!0)}});Object.defineProperty(a.BitmapText.prototype,"font",{get:function(){return this._font},set:function(b){b!==this._font&&(this._font=b.trim(),this.fontName=this._font,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}});Object.defineProperty(a.BitmapText.prototype,
"fontSize",{get:function(){return this._fontSize},set:function(b){b=parseInt(b,10);b!==this._fontSize&&(this._fontSize=b,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}});Object.defineProperty(a.BitmapText.prototype,"text",{get:function(){return this._text},set:function(b){b!==this._text&&(this._text=b.toString()||" ",this.dirty=!0)}});a.RetroFont=function(b,c,f,d,n,e,l,g,h,k){if(!b.cache.checkImageKey(c))return!1;"undefined"!=typeof e&&null!==e||(e=b.cache.getImage(c).width/
f);this.characterWidth=f;this.characterHeight=d;this.characterSpacingX=l||0;this.characterSpacingY=g||0;this.characterPerRow=e;this.offsetX=h||0;this.offsetY=k||0;this.align="left";this.multiLine=!1;this.autoUpperCase=!0;this.fixedWidth=this.customSpacingY=this.customSpacingX=0;this.fontSet=b.cache.getImage(c);this._text="";this.grabData=[];this.frameData=new a.FrameData;f=this.offsetX;d=this.offsetY;for(l=e=0;l<n.length;l++)g=b.rnd.uuid(),h=this.frameData.addFrame(new a.Frame(l,f,d,this.characterWidth,
this.characterHeight,"",g)),this.grabData[n.charCodeAt(l)]=h.index,PIXI.TextureCache[g]=new PIXI.Texture(PIXI.BaseTextureCache[c],{x:f,y:d,width:this.characterWidth,height:this.characterHeight}),e++,e==this.characterPerRow?(e=0,f=this.offsetX,d+=this.characterHeight+this.characterSpacingY):f+=this.characterWidth+this.characterSpacingX;b.cache.updateFrameData(c,this.frameData);this.stamp=new a.Image(b,0,0,c,0);a.RenderTexture.call(this,b,100,100,"",a.scaleModes.NEAREST);this.type=a.RETROFONT};a.RetroFont.prototype=
Object.create(a.RenderTexture.prototype);a.RetroFont.prototype.constructor=a.RetroFont;a.RetroFont.ALIGN_LEFT="left";a.RetroFont.ALIGN_RIGHT="right";a.RetroFont.ALIGN_CENTER="center";a.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";a.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";a.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";a.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";
a.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";a.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";a.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";a.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";a.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";a.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";a.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";a.RetroFont.prototype.setFixedWidth=
function(b,c){"undefined"==typeof c&&(c="left");this.fixedWidth=b;this.align=c};a.RetroFont.prototype.setText=function(b,c,a,d,n,e){this.multiLine=c||!1;this.customSpacingX=a||0;this.customSpacingY=d||0;this.align=n||"left";this.autoUpperCase=e?!1:!0;0<b.length&&(this.text=b)};a.RetroFont.prototype.buildRetroFontText=function(){var b=0,c=0;if(this.clear(),this.multiLine){var f=this._text.split("\n");0<this.fixedWidth?this.resize(this.fixedWidth,f.length*(this.characterHeight+this.customSpacingY)-
this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),f.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var d=0;d<f.length;d++){switch(this.align){case a.RetroFont.ALIGN_LEFT:b=0;break;case a.RetroFont.ALIGN_RIGHT:b=this.width-f[d].length*(this.characterWidth+this.customSpacingX);break;case a.RetroFont.ALIGN_CENTER:b=this.width/2-f[d].length*(this.characterWidth+this.customSpacingX)/2,b+=this.customSpacingX/2}0>b&&(b=0);this.pasteLine(f[d],
b,c,this.customSpacingX);c+=this.characterHeight+this.customSpacingY}}else{switch(0<this.fixedWidth?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),this.align){case a.RetroFont.ALIGN_LEFT:b=0;break;case a.RetroFont.ALIGN_RIGHT:b=this.width-this._text.length*(this.characterWidth+this.customSpacingX);break;case a.RetroFont.ALIGN_CENTER:b=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/
2,b+=this.customSpacingX/2}this.textureBuffer.clear();this.pasteLine(this._text,b,0,this.customSpacingX)}};a.RetroFont.prototype.pasteLine=function(b,c,f,d){for(var n=new a.Point,e=0;e<b.length;e++)if(" "==b.charAt(e))c+=this.characterWidth+d;else if(0<=this.grabData[b.charCodeAt(e)]&&(this.stamp.frame=this.grabData[b.charCodeAt(e)],n.set(c,f),this.render(this.stamp,n,!1),c+=this.characterWidth+d,c>this.width))break};a.RetroFont.prototype.getLongestLine=function(){var b=0;if(0<this._text.length)for(var c=
this._text.split("\n"),a=0;a<c.length;a++)c[a].length>b&&(b=c[a].length);return b};a.RetroFont.prototype.removeUnsupportedCharacters=function(b){for(var c="",a=0;a<this._text.length;a++){var d=this._text[a],n=d.charCodeAt(0);(0<=this.grabData[n]||!b&&"\n"===d)&&(c=c.concat(d))}return c};a.RetroFont.prototype.updateOffset=function(b,c){if(this.offsetX!==b||this.offsetY!==c){for(var a=b-this.offsetX,d=c-this.offsetY,n=this.game.cache.getFrameData(this.stamp.key).getFrames(),e=n.length;e--;)n[e].x+=
a,n[e].y+=d,PIXI.TextureCache[n[e].uuid].frame.x=n[e].x,PIXI.TextureCache[n[e].uuid].frame.y=n[e].y;this.buildRetroFontText()}};Object.defineProperty(a.RetroFont.prototype,"text",{get:function(){return this._text},set:function(b){b=this.autoUpperCase?b.toUpperCase():b;b!==this._text&&(this._text=b,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}});Object.defineProperty(a.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(b){this.stamp.smoothed=
b;this.buildRetroFontText()}});a.Device=function(){this.deviceReadyAt=0;this.canvas=this.windowsPhone=this.windows=this.macOS=this.linux=this.chromeOS=this.android=this.crosswalk=this.ejecta=this.nodeWebkit=this.node=this.cordova=this.cocoonJSApp=this.cocoonJS=this.iOS=this.desktop=this.initialized=!1;this.canvasBitBltShift=null;this.mspointer=this.touch=this.quirksMode=this.getUserMedia=this.vibration=this.typedArray=this.pointerLock=this.css3D=this.worker=this.localStorage=this.fileSystem=this.file=
this.webGL=!1;this.wheelEvent=null;this.ie=this.firefox=this.epiphany=this.chrome=this.arora=!1;this.ieVersion=0;this.trident=!1;this.tridentVersion=0;this.iPad=this.iPhone4=this.iPhone=this.webm=this.m4a=this.wav=this.mp3=this.opus=this.ogg=this.webAudio=this.audioData=this.silk=this.webApp=this.safari=this.opera=this.midori=this.mobileSafari=!1;this.pixelRatio=0;this.fullscreen=this.support32bit=this.LITTLE_ENDIAN=this.littleEndian=!1;this.cancelFullscreen=this.requestFullscreen="";this.fullscreenKeyboard=
!1};a.Device=new a.Device;a.Device.onInitialized=new a.Signal;a.Device.whenReady=function(b,c,a){var d=this._readyCheck;this.deviceReadyAt||!d?b.call(c,this):d._monitor||a?(d._queue=d._queue||[],d._queue.push([b,c])):(d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([b,c]),b="undefined"!=typeof window.cordova,c=navigator.isCocoonJS,"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):b&&!c?document.addEventListener("deviceready",d._monitor,
!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1)))};a.Device._readyCheck=function(){var b=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",b._monitor);document.removeEventListener("DOMContentLoaded",b._monitor);window.removeEventListener("load",b._monitor);this._initialize();this.initialized=!0;this.onInitialized.dispatch(this);for(var c;c=b._queue.shift();)c[0].call(c[1],
this);this.onInitialized=this._initialize=this._readyCheck=null}}else window.setTimeout(b._monitor,20)};a.Device._initialize=function(){function b(){var b=new ArrayBuffer(4),a=new Uint8Array(b),b=new Uint32Array(b);return a[0]=161,a[1]=178,a[2]=195,a[3]=212,3569595041==b[0]?!0:2712847316==b[0]?!1:null}function c(){if("undefined"==typeof Uint8ClampedArray)return!1;var b=document.createElement("canvas").getContext("2d");return b?b.createImageData(1,1).data instanceof Uint8ClampedArray:!1}var a=this;
(function(){var b=navigator.userAgent;/Playstation Vita/.test(b)?a.vita=!0:/Kindle/.test(b)||/\bKF[A-Z][A-Z]+/.test(b)||/Silk.*Mobile Safari/.test(b)?a.kindle=!0:/Android/.test(b)?a.android=!0:/CrOS/.test(b)?a.chromeOS=!0:/iP[ao]d|iPhone/i.test(b)?a.iOS=!0:/Linux/.test(b)?a.linux=!0:/Mac OS/.test(b)?a.macOS=!0:/Windows/.test(b)&&(a.windows=!0,/Windows Phone/i.test(b)&&(a.windowsPhone=!0));var c=/Silk/.test(b);(a.windows||a.macOS||a.linux&&!c||a.chromeOS)&&(a.desktop=!0);(a.windowsPhone||/Windows NT/i.test(b)&&
/Touch/i.test(b))&&(a.desktop=!1)})();(function(){a.audioData=!!window.Audio;a.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var b=document.createElement("audio");try{b.canPlayType&&(b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(a.ogg=!0),(b.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||b.canPlayType("audio/opus;").replace(/^no$/,""))&&(a.opus=!0),b.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(a.mp3=!0),b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,
"")&&(a.wav=!0),(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;").replace(/^no$/,""))&&(a.m4a=!0),b.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(a.webm=!0))}catch(c){}})();(function(){var b=navigator.userAgent;if(/Arora/.test(b)?a.arora=!0:/Chrome/.test(b)?a.chrome=!0:/Epiphany/.test(b)?a.epiphany=!0:/Firefox/.test(b)?a.firefox=!0:/AppleWebKit/.test(b)&&a.iOS?a.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(b)?(a.ie=!0,a.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(b)?a.midori=
!0:/Opera/.test(b)?a.opera=!0:/Safari/.test(b)?a.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(b)&&(a.ie=!0,a.trident=!0,a.tridentVersion=parseInt(RegExp.$1,10),a.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(b)&&(a.silk=!0),navigator.standalone&&(a.webApp=!0),"undefined"!=typeof window.cordova&&(a.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(a.node=!0),a.node)try{a.nodeWebkit="undefined"!=typeof require("nw.gui")}catch(c){a.nodeWebkit=!1}if(navigator.isCocoonJS&&
(a.cocoonJS=!0),a.cocoonJS)try{a.cocoonJSApp="undefined"!=typeof CocoonJS}catch(e){a.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(a.ejecta=!0);/Crosswalk/.test(b)&&(a.crosswalk=!0)})();(function(){var b,c=document.createElement("p"),e={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(c,null);for(var l in e)void 0!==c.style[l]&&(c.style[l]="translate3d(1px,1px,1px)",b=window.getComputedStyle(c).getPropertyValue(e[l]));
document.body.removeChild(c);a.css3D=void 0!==b&&0<b.length&&"none"!==b})();a.pixelRatio=window.devicePixelRatio||1;a.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone");a.iPhone4=2==a.pixelRatio&&a.iPhone;a.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad");a.typedArray="undefined"!=typeof Int8Array?!0:!1;"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(a.littleEndian=b(),a.LITTLE_ENDIAN=a.littleEndian);a.support32bit="undefined"!=
typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==a.littleEndian&&c();navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;navigator.vibrate&&(a.vibration=!0);(function(){a.canvas=!!window.CanvasRenderingContext2D||a.cocoonJS;try{a.localStorage=!!localStorage.getItem}catch(b){a.localStorage=!1}a.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob);a.fileSystem=!!window.requestFileSystem;
var c;try{var e=document.createElement("canvas");c=(e.screencanvas=!1,!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch(l){c=!1}a.webGL=c;a.webGL=!!a.webGL;a.worker=!!window.Worker;a.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;a.quirksMode="CSS1Compat"===document.compatMode?!1:!0;a.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||
navigator.msGetUserMedia);!a.iOS&&(a.ie||a.firefox||a.chrome)&&(a.canvasBitBltShift=!0);(a.safari||a.mobileSafari)&&(a.canvasBitBltShift=!1)})();(function(){for(var b="requestFullscreen requestFullScreen webkitRequestFullscreen webkitRequestFullScreen msRequestFullscreen msRequestFullScreen mozRequestFullScreen mozRequestFullscreen".split(" "),c=document.createElement("div"),e=0;e<b.length;e++)if(c[b[e]]){a.fullscreen=!0;a.requestFullscreen=b[e];break}b="cancelFullScreen exitFullscreen webkitCancelFullScreen webkitExitFullscreen msCancelFullScreen msExitFullscreen mozCancelFullScreen mozExitFullscreen".split(" ");
if(a.fullscreen)for(e=0;e<b.length;e++)if(document[b[e]]){a.cancelFullscreen=b[e];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(a.fullscreenKeyboard=!0)})();("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&1<=window.navigator.maxTouchPoints)&&(a.touch=!0);(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(a.mspointer=!0);a.cocoonJS||("onwheel"in window||a.ie&&"WheelEvent"in window?a.wheelEvent="wheel":"onmousewheel"in window?a.wheelEvent="mousewheel":
a.firefox&&"MouseScrollEvent"in window&&(a.wheelEvent="DOMMouseScroll"))};a.Device.canPlayAudio=function(b){return"mp3"==b&&this.mp3?!0:"ogg"==b&&(this.ogg||this.opus)?!0:"m4a"==b&&this.m4a?!0:"opus"==b&&this.opus?!0:"wav"==b&&this.wav?!0:"webm"==b&&this.webm?!0:!1};a.Device.isConsoleOpen=function(){return window.console&&window.console.firebug?!0:window.console&&(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles)?0<console.profiles.length:!1};a.Device.isAndroidStockBrowser=
function(){var b=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return b&&537>b[1]};a.DOM={getOffset:function(b,c){c=c||new a.Point;var f=b.getBoundingClientRect(),d=a.DOM.scrollY,n=document.documentElement.clientTop;return c.x=f.left+a.DOM.scrollX-document.documentElement.clientLeft,c.y=f.top+d-n,c},getBounds:function(b,a){return"undefined"==typeof a&&(a=0),b=b&&!b.nodeType?b[0]:b,b&&1===b.nodeType?this.calibrate(b.getBoundingClientRect(),a):!1},calibrate:function(b,a){a=+a||
0;var f={width:0,height:0,left:0,right:0,top:0,bottom:0};return f.width=(f.right=b.right+a)-(f.left=b.left-a),f.height=(f.bottom=b.bottom+a)-(f.top=b.top-a),f},getAspectRatio:function(b){b=null==b?this.visualBounds:1===b.nodeType?this.getBounds(b):b;var a=b.width,f=b.height;return"function"==typeof a&&(a=a.call(b)),"function"==typeof f&&(f=f.call(b)),a/f},inLayoutViewport:function(b,a){var f=this.getBounds(b,a);return!!f&&0<=f.bottom&&0<=f.right&&f.top<=this.layoutBounds.width&&f.left<=this.layoutBounds.height},
getScreenOrientation:function(b){var a=window.screen,f=a.orientation||a.mozOrientation||a.msOrientation;if(f&&"string"==typeof f.type)return f.type;if("string"==typeof f)return f;if("screen"===b)return a.height>a.width?"portrait-primary":"landscape-primary";if("viewport"===b)return this.visualBounds.height>this.visualBounds.width?"portrait-primary":"landscape-primary";if("window.orientation"===b&&"number"==typeof window.orientation)return 0===window.orientation||180===window.orientation?"portrait-primary":
"landscape-primary";if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return"portrait-primary";if(window.matchMedia("(orientation: landscape)").matches)return"landscape-primary"}return this.visualBounds.height>this.visualBounds.width?"portrait-primary":"landscape-primary"},visualBounds:new a.Rectangle,layoutBounds:new a.Rectangle,documentBounds:new a.Rectangle};a.Device.whenReady(function(b){var c=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},
f=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(a.DOM,"scrollX",{get:c});Object.defineProperty(a.DOM,"scrollY",{get:f});Object.defineProperty(a.DOM.visualBounds,"x",{get:c});Object.defineProperty(a.DOM.visualBounds,"y",{get:f});Object.defineProperty(a.DOM.layoutBounds,"x",{value:0});Object.defineProperty(a.DOM.layoutBounds,"y",{value:0});b.desktop&&document.documentElement.clientWidth<=window.innerWidth&&
document.documentElement.clientHeight<=window.innerHeight?(b=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},c=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)},Object.defineProperty(a.DOM.visualBounds,"width",{get:b}),Object.defineProperty(a.DOM.visualBounds,"height",{get:c}),Object.defineProperty(a.DOM.layoutBounds,"width",{get:b}),Object.defineProperty(a.DOM.layoutBounds,"height",{get:c})):(Object.defineProperty(a.DOM.visualBounds,
"width",{get:function(){return window.innerWidth}}),Object.defineProperty(a.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(a.DOM.layoutBounds,"width",{get:function(){var b=document.documentElement.clientWidth,a=window.innerWidth;return a>b?a:b}}),Object.defineProperty(a.DOM.layoutBounds,"height",{get:function(){var b=document.documentElement.clientHeight,a=window.innerHeight;return a>b?a:b}}));Object.defineProperty(a.DOM.documentBounds,"x",{value:0});
Object.defineProperty(a.DOM.documentBounds,"y",{value:0});Object.defineProperty(a.DOM.documentBounds,"width",{get:function(){var b=document.documentElement;return Math.max(b.clientWidth,b.offsetWidth,b.scrollWidth)}});Object.defineProperty(a.DOM.documentBounds,"height",{get:function(){var b=document.documentElement;return Math.max(b.clientHeight,b.offsetHeight,b.scrollHeight)}})},null,!0);a.Canvas={create:function(b,a,f){b=b||256;a=a||256;var d=document.createElement("canvas");return"string"==typeof f&&
""!==f&&(d.id=f),d.width=b,d.height=a,d.style.display="block",d},setBackgroundColor:function(b,a){return a=a||"rgb(0,0,0)",b.style.backgroundColor=a,b},setTouchAction:function(b,a){return a=a||"none",b.style.msTouchAction=a,b.style["ms-touch-action"]=a,b.style["touch-action"]=a,b},setUserSelect:function(b,a){return a=a||"none",b.style["-webkit-touch-callout"]=a,b.style["-webkit-user-select"]=a,b.style["-khtml-user-select"]=a,b.style["-moz-user-select"]=a,b.style["-ms-user-select"]=a,b.style["user-select"]=
a,b.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",b},addToDOM:function(b,a,f){var d;return"undefined"==typeof f&&(f=!0),a&&("string"==typeof a?d=document.getElementById(a):"object"==typeof a&&1===a.nodeType&&(d=a)),d||(d=document.body),f&&d.style&&(d.style.overflow="hidden"),d.appendChild(b),b},removeFromDOM:function(b){b.parentNode&&b.parentNode.removeChild(b)},setTransform:function(b,a,f,d,n,e,l){return b.setTransform(d,e,l,n,a,f),b},setSmoothingEnabled:function(b,a){return b.imageSmoothingEnabled=
a,b.mozImageSmoothingEnabled=a,b.oImageSmoothingEnabled=a,b.webkitImageSmoothingEnabled=a,b.msImageSmoothingEnabled=a,b},getSmoothingEnabled:function(b){return b.imageSmoothingEnabled||b.mozImageSmoothingEnabled||b.oImageSmoothingEnabled||b.webkitImageSmoothingEnabled||b.msImageSmoothingEnabled},setImageRenderingCrisp:function(b){return b.style["image-rendering"]="optimizeSpeed",b.style["image-rendering"]="crisp-edges",b.style["image-rendering"]="-moz-crisp-edges",b.style["image-rendering"]="-webkit-optimize-contrast",
b.style["image-rendering"]="optimize-contrast",b.style["image-rendering"]="pixelated",b.style.msInterpolationMode="nearest-neighbor",b},setImageRenderingBicubic:function(b){return b.style["image-rendering"]="auto",b.style.msInterpolationMode="bicubic",b}};a.Canvas.getOffset=a.DOM.getOffset;a.Canvas.getAspectRatio=a.DOM.getAspectRatio;a.RequestAnimationFrame=function(b,a){"undefined"==typeof a&&(a=!1);this.game=b;this.isRunning=!1;this.forceSetTimeOut=a;for(var f=["ms","moz","webkit","o"],d=0;d<f.length&&
!window.requestAnimationFrame;d++)window.requestAnimationFrame=window[f[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[f[d]+"CancelAnimationFrame"];this._isSetTimeOut=!1;this._timeOutID=this._onLoop=null};a.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var b=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return b.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=
!1,this._onLoop=function(a){return b.updateRAF(a)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(b){this.game.update(Math.floor(b));this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID);this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},
isRAF:function(){return!1===this._isSetTimeOut}};a.RequestAnimationFrame.prototype.constructor=a.RequestAnimationFrame;a.Math={PI2:2*Math.PI,fuzzyEqual:function(b,a,f){return"undefined"==typeof f&&(f=1E-4),Math.abs(b-a)<f},fuzzyLessThan:function(b,a,f){return"undefined"==typeof f&&(f=1E-4),a+f>b},fuzzyGreaterThan:function(b,a,f){return"undefined"==typeof f&&(f=1E-4),b>a-f},fuzzyCeil:function(b,a){return"undefined"==typeof a&&(a=1E-4),Math.ceil(b-a)},fuzzyFloor:function(b,a){return"undefined"==typeof a&&
(a=1E-4),Math.floor(b+a)},average:function(){for(var b=0,a=0;a<arguments.length;a++)b+=+arguments[a];return b/arguments.length},truncate:function(b){return Math.trunc(b)},shear:function(b){return b%1},snapTo:function(b,a,f){return"undefined"==typeof f&&(f=0),0===a?b:(b-=f,b=a*Math.round(b/a),f+b)},snapToFloor:function(b,a,f){return"undefined"==typeof f&&(f=0),0===a?b:(b-=f,b=a*Math.floor(b/a),f+b)},snapToCeil:function(b,a,f){return"undefined"==typeof f&&(f=0),0===a?b:(b-=f,b=a*Math.ceil(b/a),f+b)},
snapToInArray:function(b,c,f){return"undefined"==typeof f&&(f=!0),f&&c.sort(),a.ArrayUtils.findClosest(b,c)},roundTo:function(b,a,f){"undefined"==typeof a&&(a=0);"undefined"==typeof f&&(f=10);a=Math.pow(f,-a);return Math.round(b*a)/a},floorTo:function(b,a,f){"undefined"==typeof a&&(a=0);"undefined"==typeof f&&(f=10);a=Math.pow(f,-a);return Math.floor(b*a)/a},ceilTo:function(b,a,f){"undefined"==typeof a&&(a=0);"undefined"==typeof f&&(f=10);a=Math.pow(f,-a);return Math.ceil(b*a)/a},interpolateFloat:function(b,
a,f){return(a-b)*f+b},angleBetween:function(b,a,f,d){return Math.atan2(d-a,f-b)},angleBetweenY:function(b,a,f,d){return Math.atan2(f-b,d-a)},angleBetweenPoints:function(b,a){return Math.atan2(a.y-b.y,a.x-b.x)},angleBetweenPointsY:function(b,a){return Math.atan2(a.x-b.x,a.y-b.y)},reverseAngle:function(b){return this.normalizeAngle(b+Math.PI,!0)},normalizeAngle:function(b){return b%=2*Math.PI,0<=b?b:b+2*Math.PI},normalizeLatitude:function(b){return a.Math.clamp(b,-90,90)},normalizeLongitude:function(b){return a.Math.wrap(b,
-180,180)},chanceRoll:function(b){return a.Utils.chanceRoll(b)},numberArray:function(b,c){return a.ArrayUtils.numberArray(b,c)},numberArrayStep:function(b,c,f){return a.ArrayUtils.numberArrayStep(b,c,f)},maxAdd:function(b,a,f){return Math.min(b+a,f)},minSub:function(b,a,f){return Math.max(b-a,f)},wrap:function(b,a,f){f-=a;if(0>=f)return 0;b=(b-a)%f;return 0>b&&(b+=f),b+a},wrapValue:function(b,a,f){return b=Math.abs(b),a=Math.abs(a),f=Math.abs(f),(b+a)%f},limitValue:function(b,c,f){return a.Math.clamp(b,
c,f)},randomSign:function(){return a.Utils.randomChoice(-1,1)},isOdd:function(b){return 1&b},isEven:function(b){return!(1&b)},min:function(){for(var b=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments,a=1,f=0,d=b.length;d>a;a++)b[a]<b[f]&&(f=a);return b[f]},max:function(){for(var b=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments,a=1,f=0,d=b.length;d>a;a++)b[a]>b[f]&&(f=a);return b[f]},minProperty:function(b){for(var a=2===arguments.length&&"object"==
typeof arguments[1]?arguments[1]:arguments.slice(1),f=1,d=0,n=a.length;n>f;f++)a[f][b]<a[d][b]&&(d=f);return a[d][b]},maxProperty:function(b){for(var a=2===arguments.length&&"object"==typeof arguments[1]?arguments[1]:arguments.slice(1),f=1,d=0,n=a.length;n>f;f++)a[f][b]>a[d][b]&&(d=f);return a[d][b]},wrapAngle:function(b,a){return a?this.wrap(b,-Math.PI,Math.PI):this.wrap(b,-180,180)},angleLimit:function(b,a,f){var d=b;return b>f?d=f:a>b&&(d=a),d},linearInterpolation:function(b,a){var f=b.length-
1,d=f*a,n=Math.floor(d);return 0>a?this.linear(b[0],b[1],d):1<a?this.linear(b[f],b[f-1],f-d):this.linear(b[n],b[n+1>f?f:n+1],d-n)},bezierInterpolation:function(b,a){for(var f=0,d=b.length-1,n=0;d>=n;n++)f+=Math.pow(1-a,d-n)*Math.pow(a,n)*b[n]*this.bernstein(d,n);return f},catmullRomInterpolation:function(b,a){var f=b.length-1,d=f*a,n=Math.floor(d);return b[0]===b[f]?(0>a&&(n=Math.floor(d=f*(1+a))),this.catmullRom(b[(n-1+f)%f],b[n],b[(n+1)%f],b[(n+2)%f],d-n)):0>a?b[0]-(this.catmullRom(b[0],b[0],b[1],
b[1],-d)-b[0]):1<a?b[f]-(this.catmullRom(b[f],b[f],b[f-1],b[f-1],d-f)-b[f]):this.catmullRom(b[n?n-1:0],b[n],b[n+1>f?f:n+1],b[n+2>f?f:n+2],d-n)},linear:function(b,a,f){return(a-b)*f+b},bernstein:function(b,a){return this.factorial(b)/this.factorial(a)/this.factorial(b-a)},factorial:function(b){if(0===b)return 1;for(var a=b;--b;)a*=b;return a},catmullRom:function(b,a,f,d,n){b=.5*(f-b);d=.5*(d-a);var e=n*n;return(2*a-2*f+b+d)*n*e+(-3*a+3*f-2*b-d)*e+b*n+a},difference:function(b,a){return Math.abs(b-a)},
getRandom:function(b,c,f){return a.ArrayUtils.getRandomItem(b,c,f)},removeRandom:function(b,c,f){return a.ArrayUtils.removeRandomItem(b,c,f)},floor:function(b){return Math.trunc(b)},ceil:function(b){return a.Math.roundAwayFromZero(b)},roundAwayFromZero:function(b){return 0<b?Math.ceil(b):Math.floor(b)},sinCosGenerator:function(b,a,f,d){"undefined"==typeof a&&(a=1);"undefined"==typeof f&&(f=1);"undefined"==typeof d&&(d=1);d=d*Math.PI/b;for(var n=[],e=[],l=0;b>l;l++)f-=a*d,a+=f*d,n[l]=f,e[l]=a;return{sin:e,
cos:n,length:b}},shift:function(b){var a=b.shift();return b.push(a),a},shuffleArray:function(b){return a.ArrayUtils.shuffle(b)},distance:function(b,a,f,d){b-=f;a-=d;return Math.sqrt(b*b+a*a)},distancePow:function(b,a,f,d,n){return"undefined"==typeof n&&(n=2),Math.sqrt(Math.pow(f-b,n)+Math.pow(d-a,n))},distanceRounded:function(b,c,f,d){return Math.round(a.Math.distance(b,c,f,d))},clamp:function(b,a,f){return a>b?a:b>f?f:b},clampBottom:function(b,a){return a>b?a:b},within:function(b,a,f){return Math.abs(b-
a)<=f},mapLinear:function(b,a,f,d,n){return d+(b-a)*(n-d)/(f-a)},smoothstep:function(b,a,f){return b=Math.max(0,Math.min(1,(b-a)/(f-a))),b*b*(3-2*b)},smootherstep:function(b,a,f){return b=Math.max(0,Math.min(1,(b-a)/(f-a))),b*b*b*(b*(6*b-15)+10)},sign:function(b){return 0>b?-1:0<b?1:0},percent:function(b,a,f){return"undefined"==typeof f&&(f=0),b>a||f>a?1:f>b||f>b?0:(b-f)/a}};var k=Math.PI/180,m=180/Math.PI;a.Math.degToRad=function(b){return b*k};a.Math.radToDeg=function(b){return b*m};a.RandomDataGenerator=
function(b){"undefined"==typeof b&&(b=[]);this.c=1;this.s2=this.s1=this.s0=0;this.sow(b)};a.RandomDataGenerator.prototype={rnd:function(){var b=2091639*this.s0+2.3283064365386963E-10*this.c;return this.c=0|b,this.s0=this.s1,this.s1=this.s2,this.s2=b-this.c,this.s2},sow:function(b){if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,b)for(var a=0;a<b.length&&null!=b[a];a++){var f=b[a];this.s0-=this.hash(f);this.s0+=~~(0>this.s0);this.s1-=this.hash(f);this.s1+=~~(0>
this.s1);this.s2-=this.hash(f);this.s2+=~~(0>this.s2)}},hash:function(b){var a,f,d;d=4022871197;b=b.toString();for(f=0;f<b.length;f++)d+=b.charCodeAt(f),a=.02519603282416938*d,d=a>>>0,a-=d,a*=d,d=a>>>0,a-=d,d+=4294967296*a;return 2.3283064365386963E-10*(d>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565E-16*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(b,a){return Math.floor(this.realInRange(0,
a-b+1)+b)},between:function(b,a){return this.integerInRange(b,a)},realInRange:function(b,a){return this.frac()*(a-b)+b},normal:function(){return 1-2*this.frac()},uuid:function(){for(var b="",a="",a=b="";36>b++;a+=~b%5|3*b&4?(15^b?8^this.frac()*(20^b?16:4):4).toString(16):"-");return a},pick:function(b){return b[this.integerInRange(0,b.length-1)]},weightedPick:function(b){return b[~~(Math.pow(this.frac(),2)*(b.length-1))]},timestamp:function(b,a){return this.realInRange(b||9466848E5,a||1577862E6)},
angle:function(){return this.integerInRange(-180,180)}};a.RandomDataGenerator.prototype.constructor=a.RandomDataGenerator;a.QuadTree=function(b,a,f,d,n,e,l){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(b,a,f,d,n,e,l)};a.QuadTree.prototype={reset:function(b,a,f,d,n,e,l){this.maxObjects=n||10;this.maxLevels=e||4;this.level=l||0;this.bounds={x:Math.round(b),y:Math.round(a),width:f,height:d,subWidth:Math.floor(f/2),subHeight:Math.floor(d/
2),right:Math.round(b)+Math.floor(f/2),bottom:Math.round(a)+Math.floor(d/2)};this.objects.length=0;this.nodes.length=0},populate:function(b){b.forEach(this.populateHandler,this,!0)},populateHandler:function(b){b.body&&b.exists&&this.insert(b.body)},split:function(){this.nodes[0]=new a.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[1]=new a.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,
this.maxObjects,this.maxLevels,this.level+1);this.nodes[2]=new a.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[3]=new a.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(b){var a,f=0;if(null!=this.nodes[0]&&(a=this.getIndex(b),-1!==a))return void this.nodes[a].insert(b);if(this.objects.push(b),this.objects.length>
this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();f<this.objects.length;)a=this.getIndex(this.objects[f]),-1!==a?this.nodes[a].insert(this.objects.splice(f,1)[0]):f++},getIndex:function(b){var a=-1;return b.x<this.bounds.right&&b.right<this.bounds.right?b.y<this.bounds.bottom&&b.bottom<this.bounds.bottom?a=1:b.y>this.bounds.bottom&&(a=2):b.x>this.bounds.right&&(b.y<this.bounds.bottom&&b.bottom<this.bounds.bottom?a=0:b.y>this.bounds.bottom&&(a=3)),a},retrieve:function(b){if(b instanceof
a.Rectangle)var c=this.objects,f=this.getIndex(b);else{if(!b.body)return this._empty;c=this.objects;f=this.getIndex(b.body)}return this.nodes[0]&&(-1!==f?c=c.concat(this.nodes[f].retrieve(b)):(c=c.concat(this.nodes[0].retrieve(b)),c=c.concat(this.nodes[1].retrieve(b)),c=c.concat(this.nodes[2].retrieve(b)),c=c.concat(this.nodes[3].retrieve(b)))),c},clear:function(){this.objects.length=0;for(var b=this.nodes.length;b--;)this.nodes[b].clear(),this.nodes.splice(b,1);this.nodes.length=0}};a.QuadTree.prototype.constructor=
a.QuadTree;a.Net=function(b){this.game=b};a.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(b){return-1!==window.location.hostname.indexOf(b)},updateQueryString:function(b,a,f,d){"undefined"==typeof f&&(f=!1);"undefined"!=typeof d&&""!==d||(d=window.location.href);var n="",n=new RegExp("([?|&])"+b+"=.*?(&|#|$)(.*)","gi");if(n.test(d))n="undefined"!=typeof a&&null!==a?d.replace(n,"$1"+b+"="+a+"$2$3"):d.replace(n,
"$1$3").replace(/(&|\?)$/,"");else{if("undefined"!=typeof a&&null!==a){var n=-1!==d.indexOf("?")?"&":"?",e=d.split("#");d=e[0]+n+b+"="+a;e[1]&&(d+="#"+e[1])}n=d}return f?void(window.location.href=n):n},getQueryString:function(b){"undefined"==typeof b&&(b="");var a={},f=location.search.substring(1).split("&"),d;for(d in f){var n=f[d].split("=");if(1<n.length){if(b&&b==this.decodeURI(n[0]))return this.decodeURI(n[1]);a[this.decodeURI(n[0])]=this.decodeURI(n[1])}}return a},decodeURI:function(b){return decodeURIComponent(b.replace(/\+/g,
" "))}};a.Net.prototype.constructor=a.Net;a.TweenManager=function(b){this.game=b;this._tweens=[];this._add=[];this.easeMap={Power0:a.Easing.Power0,Power1:a.Easing.Power1,Power2:a.Easing.Power2,Power3:a.Easing.Power3,Power4:a.Easing.Power4,Linear:a.Easing.Linear.None,Quad:a.Easing.Quadratic.Out,Cubic:a.Easing.Cubic.Out,Quart:a.Easing.Quartic.Out,Quint:a.Easing.Quintic.Out,Sine:a.Easing.Sinusoidal.Out,Expo:a.Easing.Exponential.Out,Circ:a.Easing.Circular.Out,Elastic:a.Easing.Elastic.Out,Back:a.Easing.Back.Out,
Bounce:a.Easing.Bounce.Out,"Quad.easeIn":a.Easing.Quadratic.In,"Cubic.easeIn":a.Easing.Cubic.In,"Quart.easeIn":a.Easing.Quartic.In,"Quint.easeIn":a.Easing.Quintic.In,"Sine.easeIn":a.Easing.Sinusoidal.In,"Expo.easeIn":a.Easing.Exponential.In,"Circ.easeIn":a.Easing.Circular.In,"Elastic.easeIn":a.Easing.Elastic.In,"Back.easeIn":a.Easing.Back.In,"Bounce.easeIn":a.Easing.Bounce.In,"Quad.easeOut":a.Easing.Quadratic.Out,"Cubic.easeOut":a.Easing.Cubic.Out,"Quart.easeOut":a.Easing.Quartic.Out,"Quint.easeOut":a.Easing.Quintic.Out,
"Sine.easeOut":a.Easing.Sinusoidal.Out,"Expo.easeOut":a.Easing.Exponential.Out,"Circ.easeOut":a.Easing.Circular.Out,"Elastic.easeOut":a.Easing.Elastic.Out,"Back.easeOut":a.Easing.Back.Out,"Bounce.easeOut":a.Easing.Bounce.Out,"Quad.easeInOut":a.Easing.Quadratic.InOut,"Cubic.easeInOut":a.Easing.Cubic.InOut,"Quart.easeInOut":a.Easing.Quartic.InOut,"Quint.easeInOut":a.Easing.Quintic.InOut,"Sine.easeInOut":a.Easing.Sinusoidal.InOut,"Expo.easeInOut":a.Easing.Exponential.InOut,"Circ.easeInOut":a.Easing.Circular.InOut,
"Elastic.easeInOut":a.Easing.Elastic.InOut,"Back.easeInOut":a.Easing.Back.InOut,"Bounce.easeInOut":a.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};a.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var b=0;b<this._tweens.length;b++)this._tweens[b].pendingDelete=!0;this._add=[]},removeFrom:function(b,c){"undefined"==typeof c&&(c=!0);var f,d;if(Array.isArray(b))for(f=0,d=b.length;d>f;f++)this.removeFrom(b[f]);
else if(b.type===a.GROUP&&c)for(f=0,d=b.children.length;d>f;f++)this.removeFrom(b.children[f]);else{f=0;for(d=this._tweens.length;d>f;f++)b===this._tweens[f].target&&this.remove(this._tweens[f]);f=0;for(d=this._add.length;d>f;f++)b===this._add[f].target&&this.remove(this._add[f])}},add:function(b){b._manager=this;this._add.push(b)},create:function(b){return new a.Tween(b,this.game,this)},remove:function(b){var a=this._tweens.indexOf(b);-1!==a?this._tweens[a].pendingDelete=!0:(a=this._add.indexOf(b),
-1!==a&&(this._add[a].pendingDelete=!0))},update:function(){var b=this._add.length,a=this._tweens.length;if(0===a&&0===b)return!1;for(var f=0;a>f;)this._tweens[f].update(this.game.time.time)?f++:(this._tweens.splice(f,1),a--);return 0<b&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(b){return this._tweens.some(function(a){return a.target===b})},_pauseAll:function(){for(var b=this._tweens.length-1;0<=b;b--)this._tweens[b]._pause()},_resumeAll:function(){for(var b=
this._tweens.length-1;0<=b;b--)this._tweens[b]._resume()},pauseAll:function(){for(var b=this._tweens.length-1;0<=b;b--)this._tweens[b].pause()},resumeAll:function(){for(var b=this._tweens.length-1;0<=b;b--)this._tweens[b].resume(!0)}};a.TweenManager.prototype.constructor=a.TweenManager;a.Tween=function(b,c,f){this.game=c;this.target=b;this.manager=f;this.timeline=[];this.reverse=!1;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=!1;this.onStart=new a.Signal;this.onLoop=new a.Signal;this.onRepeat=
new a.Signal;this.onChildComplete=new a.Signal;this.onComplete=new a.Signal;this.isRunning=!1;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=!1;this._onUpdateCallbackContext=this._onUpdateCallback=null;this._pausedTime=0;this._codePaused=!1};a.Tween.prototype={to:function(b,c,f,d,n,e,l){return"undefined"==typeof c&&(c=1E3),"undefined"==typeof f&&(f=a.Easing.Default),"undefined"==typeof d&&(d=!1),"undefined"==typeof n&&(n=0),"undefined"==typeof e&&(e=0),"undefined"==typeof l&&
(l=!1),"string"==typeof f&&this.manager.easeMap[f]&&(f=this.manager.easeMap[f]),this.isRunning?(console.warn("Phaser.Tween.to cannot be called after Tween.start"),this):(this.timeline.push((new a.TweenData(this)).to(b,c,f,n,e,l)),d&&this.start(),this)},from:function(b,c,f,d,e,p,l){return"undefined"==typeof c&&(c=1E3),"undefined"==typeof f&&(f=a.Easing.Default),"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=0),"undefined"==typeof p&&(p=0),"undefined"==typeof l&&(l=!1),"string"==typeof f&&
this.manager.easeMap[f]&&(f=this.manager.easeMap[f]),this.isRunning?(console.warn("Phaser.Tween.from cannot be called after Tween.start"),this):(this.timeline.push((new a.TweenData(this)).from(b,c,f,e,p,l)),d&&this.start(),this)},start:function(b){if("undefined"==typeof b&&(b=0),null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;for(var a=0;a<this.timeline.length;a++)for(var f in this.timeline[a].vEnd)this.properties[f]=this.target[f]||0,Array.isArray(this.properties[f])||
(this.properties[f]*=1);for(a=0;a<this.timeline.length;a++)this.timeline[a].loadValues();return this.manager.add(this),this.isRunning=!0,(0>b||b>this.timeline.length-1)&&(b=0),this.current=b,this.timeline[this.current].start(),this.onStart.dispatch(this.target,this),this},stop:function(b){return"undefined"==typeof b&&(b=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,b&&(this.onComplete.dispatch(this.target,this),this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),
this},updateTweenData:function(b,a,f){if(0===this.timeline.length)return this;if("undefined"==typeof f&&(f=0),-1===f)for(f=0;f<this.timeline.length;f++)this.timeline[f][b]=a;else this.timeline[f][b]=a;return this},delay:function(b,a){return this.updateTweenData("delay",b,a)},repeat:function(b,a,f){return"undefined"==typeof a&&(a=0),this.updateTweenData("repeatCounter",b,f),this.updateTweenData("repeatDelay",a,f)},repeatDelay:function(b,a){return this.updateTweenData("repeatDelay",b,a)},yoyo:function(b,
a,f){return"undefined"==typeof a&&(a=0),this.updateTweenData("yoyo",b,f),this.updateTweenData("yoyoDelay",a,f)},yoyoDelay:function(b,a){return this.updateTweenData("yoyoDelay",b,a)},easing:function(b,a){return"string"==typeof b&&this.manager.easeMap[b]&&(b=this.manager.easeMap[b]),this.updateTweenData("easingFunction",b,a)},interpolation:function(b,c,f){return"undefined"==typeof c&&(c=a.Math),this.updateTweenData("interpolationFunction",b,f),this.updateTweenData("interpolationContext",c,f)},repeatAll:function(b){return"undefined"==
typeof b&&(b=0),this.repeatCounter=b,this},chain:function(){for(var b=arguments.length;b--;)0<b?arguments[b-1].chainedTween=arguments[b]:this.chainedTween=arguments[b];return this},loop:function(b){return"undefined"==typeof b&&(b=!0),b?this.repeatAll(-1):this.repeatCounter=0,this},onUpdateCallback:function(b,a){return this._onUpdateCallback=b,this._onUpdateCallbackContext=a,this},pause:function(){this._codePaused=this.isPaused=!0;this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||
(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this._codePaused=this.isPaused=!1;for(var b=0;b<this.timeline.length;b++)this.timeline[b].isRunning||(this.timeline[b].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(b){if(this.pendingDelete)return!1;if(this.isPaused)return!0;b=this.timeline[this.current].update(b);if(b===a.TweenData.PENDING)return!0;if(b===a.TweenData.RUNNING)return null!==
this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(b===a.TweenData.LOOPED)return this.onLoop.dispatch(this.target,this),!0;if(b===a.TweenData.COMPLETE)return b=!1,this.reverse?(this.current--,0>this.current&&(this.current=this.timeline.length-1,b=!0)):(this.current++,this.current===this.timeline.length&&(this.current=0,b=!0)),b?-1===this.repeatCounter?(this.timeline[this.current].start(),
this.onRepeat.dispatch(this.target,this),!0):0<this.repeatCounter?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)},generateData:function(b,a){if(null===this.game||null===this.target)return null;"undefined"==typeof a&&(a=[]);for(var f=0;f<this.timeline.length;f++)for(var d in this.timeline[f].vEnd)this.properties[d]=
this.target[d]||0,Array.isArray(this.properties[d])||(this.properties[d]*=1);for(f=0;f<this.timeline.length;f++)this.timeline[f].loadValues();for(f=0;f<this.timeline.length;f++)a=a.concat(this.timeline[f].generateData(b));return a}};Object.defineProperty(a.Tween.prototype,"totalDuration",{get:function(){for(var b=0,a=0;a<this.timeline.length;a++)b+=this.timeline[a].duration;return b}});a.Tween.prototype.constructor=a.Tween;a.TweenData=function(b){this.parent=b;this.game=b.game;this.vStart={};this.vStartCache=
{};this.vEnd={};this.vEndCache={};this.duration=1E3;this.repeatDelay=this.repeatCounter=this.value=this.percent=0;this.yoyo=this.interpolate=!1;this.yoyoDelay=0;this.inReverse=!1;this.dt=this.delay=0;this.startTime=null;this.easingFunction=a.Easing.Default;this.interpolationFunction=a.Math.linearInterpolation;this.interpolationContext=a.Math;this.isFrom=this.isRunning=!1};a.TweenData.PENDING=0;a.TweenData.RUNNING=1;a.TweenData.LOOPED=2;a.TweenData.COMPLETE=3;a.TweenData.prototype={to:function(b,a,
f,d,e,p){return this.vEnd=b,this.duration=a,this.easingFunction=f,this.delay=d,this.repeatCounter=e,this.yoyo=p,this.isFrom=!1,this},from:function(b,a,f,d,e,p){return this.vEnd=b,this.duration=a,this.easingFunction=f,this.delay=d,this.repeatCounter=e,this.yoyo=p,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.dt=this.parent.reverse?this.duration:0,this.isRunning=0<this.delay?!1:!0,this.isFrom)for(var b in this.vStartCache)this.vStart[b]=this.vEndCache[b],
this.vEnd[b]=this.vStartCache[b],this.parent.target[b]=this.vStart[b];return this.value=0,this.yoyoCounter=0,this},loadValues:function(){for(var b in this.parent.properties){if(this.vStart[b]=this.parent.properties[b],Array.isArray(this.vEnd[b])){if(0===this.vEnd[b].length)continue;this.vEnd[b]=[this.vStart[b]].concat(this.vEnd[b])}"undefined"!=typeof this.vEnd[b]?("string"==typeof this.vEnd[b]&&(this.vEnd[b]=this.vStart[b]+parseFloat(this.vEnd[b],10)),this.parent.properties[b]=this.vEnd[b]):this.vEnd[b]=
this.vStart[b];this.vStartCache[b]=this.vStart[b];this.vEndCache[b]=this.vEnd[b]}return this},update:function(){if(this.isRunning){if(this.game.time.time<this.startTime)return a.TweenData.RUNNING}else{if(!(this.game.time.time>=this.startTime))return a.TweenData.PENDING;this.isRunning=!0}this.parent.reverse?(this.dt-=this.game.time.physicsElapsedMS*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=this.game.time.physicsElapsedMS*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration));
this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var b in this.vEnd){var c=this.vStart[b],f=this.vEnd[b];this.parent.target[b]=Array.isArray(f)?this.interpolationFunction.call(this.interpolationContext,f,this.value):c+(f-c)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():a.TweenData.RUNNING},generateData:function(b){this.dt=this.parent.reverse?this.duration:0;var a=[],f=!1;b=1/b*1E3;do{this.parent.reverse?
(this.dt-=b,this.dt=Math.max(this.dt,0)):(this.dt+=b,this.dt=Math.min(this.dt,this.duration));this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var d={},e;for(e in this.vEnd){var p=this.vStart[e],l=this.vEnd[e];d[e]=Array.isArray(l)?this.interpolationFunction(l,this.value):p+(l-p)*this.value}a.push(d);(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)&&(f=!0)}while(!f);this.yoyo&&(f=a.slice(),f.reverse(),a=a.concat(f));return a},repeat:function(){if(this.yoyo){if(this.inReverse&&
0===this.repeatCounter)return a.TweenData.COMPLETE;this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return a.TweenData.COMPLETE;if(this.inReverse)for(var b in this.vStartCache)this.vStart[b]=this.vEndCache[b],this.vEnd[b]=this.vStartCache[b];else{for(b in this.vStartCache)this.vStart[b]=this.vStartCache[b],this.vEnd[b]=this.vEndCache[b];0<this.repeatCounter&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||
(this.startTime+=this.repeatDelay),this.dt=this.parent.reverse?this.duration:0,a.TweenData.LOOPED}};a.TweenData.prototype.constructor=a.TweenData;a.Easing={Linear:{None:function(b){return b}},Quadratic:{In:function(b){return b*b},Out:function(b){return b*(2-b)},InOut:function(b){return 1>(b*=2)?.5*b*b:-.5*(--b*(b-2)-1)}},Cubic:{In:function(b){return b*b*b},Out:function(b){return--b*b*b+1},InOut:function(b){return 1>(b*=2)?.5*b*b*b:.5*((b-=2)*b*b+2)}},Quartic:{In:function(b){return b*b*b*b},Out:function(b){return 1-
--b*b*b*b},InOut:function(b){return 1>(b*=2)?.5*b*b*b*b:-.5*((b-=2)*b*b*b-2)}},Quintic:{In:function(b){return b*b*b*b*b},Out:function(b){return--b*b*b*b*b+1},InOut:function(b){return 1>(b*=2)?.5*b*b*b*b*b:.5*((b-=2)*b*b*b*b+2)}},Sinusoidal:{In:function(b){return 0===b?0:1===b?1:1-Math.cos(b*Math.PI/2)},Out:function(b){return 0===b?0:1===b?1:Math.sin(b*Math.PI/2)},InOut:function(b){return 0===b?0:1===b?1:.5*(1-Math.cos(Math.PI*b))}},Exponential:{In:function(b){return 0===b?0:Math.pow(1024,b-1)},Out:function(b){return 1===
b?1:1-Math.pow(2,-10*b)},InOut:function(b){return 0===b?0:1===b?1:1>(b*=2)?.5*Math.pow(1024,b-1):.5*(-Math.pow(2,-10*(b-1))+2)}},Circular:{In:function(b){return 1-Math.sqrt(1-b*b)},Out:function(b){return Math.sqrt(1- --b*b)},InOut:function(b){return 1>(b*=2)?-.5*(Math.sqrt(1-b*b)-1):.5*(Math.sqrt(1-(b-=2)*b)+1)}},Elastic:{In:function(b){var a,f=.1;return 0===b?0:1===b?1:(!f||1>f?(f=1,a=.1):a=.4*Math.asin(1/f)/(2*Math.PI),-(f*Math.pow(2,10*--b)*Math.sin(2*(b-a)*Math.PI/.4)))},Out:function(b){var a,
f=.1;return 0===b?0:1===b?1:(!f||1>f?(f=1,a=.1):a=.4*Math.asin(1/f)/(2*Math.PI),f*Math.pow(2,-10*b)*Math.sin(2*(b-a)*Math.PI/.4)+1)},InOut:function(b){var a,f=.1;return 0===b?0:1===b?1:(!f||1>f?(f=1,a=.1):a=.4*Math.asin(1/f)/(2*Math.PI),1>(b*=2)?-.5*f*Math.pow(2,10*--b)*Math.sin(2*(b-a)*Math.PI/.4):f*Math.pow(2,-10*--b)*Math.sin(2*(b-a)*Math.PI/.4)*.5+1)}},Back:{In:function(b){return b*b*(2.70158*b-1.70158)},Out:function(b){return--b*b*(2.70158*b+1.70158)+1},InOut:function(b){return 1>(b*=2)?.5*b*
b*(3.5949095*b-2.5949095):.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)}},Bounce:{In:function(b){return 1-a.Easing.Bounce.Out(1-b)},Out:function(b){return 1/2.75>b?7.5625*b*b:2/2.75>b?7.5625*(b-=1.5/2.75)*b+.75:2.5/2.75>b?7.5625*(b-=2.25/2.75)*b+.9375:7.5625*(b-=2.625/2.75)*b+.984375},InOut:function(b){return.5>b?.5*a.Easing.Bounce.In(2*b):.5*a.Easing.Bounce.Out(2*b-1)+.5}}};a.Easing.Default=a.Easing.Linear.None;a.Easing.Power0=a.Easing.Linear.None;a.Easing.Power1=a.Easing.Quadratic.Out;a.Easing.Power2=
a.Easing.Cubic.Out;a.Easing.Power3=a.Easing.Quartic.Out;a.Easing.Power4=a.Easing.Quintic.Out;a.Time=function(b){this.game=b;this.physicsElapsedMS=this.physicsElapsed=this.elapsedMS=this.elapsed=this.now=this.prevTime=this.time=0;this.desiredFps=60;this.suggestedFps=null;this.slowMotion=1;this.advancedTiming=!1;this.fps=this.frames=0;this.fpsMin=1E3;this.fpsMax=0;this.msMin=1E3;this.timeExpected=this.timeToCall=this.pauseDuration=this.msMax=0;this.events=new a.Timer(this.game,!1);this._pauseStarted=
this._timeLastSecond=this._started=this._elapsedAccumulator=this._frameCount=0;this._justResumed=!1;this._timers=[]};a.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start()},add:function(b){return this._timers.push(b),b},create:function(b){"undefined"==typeof b&&(b=!0);b=new a.Timer(this.game,b);return this._timers.push(b),b},removeAll:function(){for(var b=0;b<this._timers.length;b++)this._timers[b].destroy();this._timers=[];this.events.removeAll()},update:function(b){var a=
this.time;if(this.time=Date.now(),this.elapsedMS=this.time-a,this.prevTime=this.now,this.now=b,this.elapsed=this.now-this.prevTime,this.timeToCall=Math.floor(Math.max(0,1E3/this.desiredFps-(this.timeCallExpected-b))),this.timeCallExpected=b+this.timeToCall,this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=2*this.desiredFps&&(this.suggestedFps=5*Math.floor(200/(this._elapsedAccumulator/this._frameCount)),this._frameCount=0,this._elapsedAccumulator=0),this.physicsElapsed=1/
this.desiredFps,this.physicsElapsedMS=1E3*this.physicsElapsed,this.advancedTiming&&(this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1E3&&(this.fps=Math.round(1E3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)),!this.game.paused)for(this.events.update(this.time),b=0,a=this._timers.length;a>
b;)this._timers[b].update(this.time)?b++:(this._timers.splice(b,1),a--)},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();for(var b=this._timers.length;b--;)this._timers[b]._pause()},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();for(var b=this._timers.length;b--;)this._timers[b]._resume()},totalElapsedSeconds:function(){return.001*(this.time-this._started)},elapsedSince:function(b){return this.time-b},elapsedSecondsSince:function(b){return.001*
(this.time-b)},reset:function(){this._started=this.time;this.removeAll()}};a.Time.prototype.constructor=a.Time;a.Timer=function(b,c){"undefined"==typeof c&&(c=!0);this.game=b;this.running=!1;this.autoDestroy=c;this.expired=!1;this.elapsed=0;this.events=[];this.onComplete=new a.Signal;this.nextTick=0;this.timeCap=1E3;this._codePaused=this.paused=!1;this._pauseTotal=this._pauseStarted=this._started=0;this._now=Date.now();this._newTick=this._diff=this._i=this._marked=this._len=0};a.Timer.MINUTE=6E4;
a.Timer.SECOND=1E3;a.Timer.HALF=500;a.Timer.QUARTER=250;a.Timer.prototype={create:function(b,c,f,d,e,p){b=Math.round(b);var l;l=b+(0===this._now?this.game.time.time:this._now);b=new a.TimerEvent(this,b,l,f,c,d,e,p);return this.events.push(b),this.order(),this.expired=!1,b},add:function(b,a,f){return this.create(b,!1,0,a,f,Array.prototype.splice.call(arguments,3))},repeat:function(b,a,f,d){return this.create(b,!1,a,f,d,Array.prototype.splice.call(arguments,4))},loop:function(b,a,f){return this.create(b,
!0,0,a,f,Array.prototype.splice.call(arguments,3))},start:function(b){if(!this.running)for(this._started=this.game.time.time+(b||0),this.running=!0,b=0;b<this.events.length;b++)this.events[b].tick=this.events[b].delay+this._started},stop:function(b){this.running=!1;"undefined"==typeof b&&(b=!0);b&&(this.events.length=0)},remove:function(b){for(var a=0;a<this.events.length;a++)if(this.events[a]===b)return this.events[a].pendingDelete=!0,!0;return!1},order:function(){0<this.events.length&&(this.events.sort(this.sortHandler),
this.nextTick=this.events[0].tick)},sortHandler:function(b,a){return b.tick<a.tick?-1:b.tick>a.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length;this._i=0},update:function(b){if(this.paused)return!0;if(this.elapsed=b-this._now,this._now=b,this.elapsed>this.timeCap&&this.adjustEvents(b-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&
0<this._len){for(;this._i<this._len&&this.running&&this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete;)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),0>this._newTick&&(this._newTick=this._now+this.events[this._i].delay),!0===this.events[this._i].loop?(this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):0<this.events[this._i].repeatCount?(this.events[this._i].repeatCount--,
this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this._marked++,this.events[this._i].pendingDelete=!0,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)),this._i++;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&(this._codePaused=!0,this.paused||
(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(b){for(var a=0;a<this.events.length;a++)if(!this.events[a].pendingDelete){var f=this.events[a].tick-b;0>f&&(f=0);this.events[a].tick=this._now+f}b=this.nextTick-b;this.nextTick=0>b?this._now:this._now+b},resume:function(){if(this.paused){var b=this.game.time.time;this._pauseTotal+=b-this._now;this._now=b;this.adjustEvents(this._pauseStarted);
this._codePaused=this.paused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll();this._i=this._len=this.events.length=0},destroy:function(){this.onComplete.removeAll();this.running=!1;this.events=[];this._i=this._len=0}};Object.defineProperty(a.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(a.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}});
Object.defineProperty(a.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(a.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}});Object.defineProperty(a.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}});a.Timer.prototype.constructor=a.Timer;a.TimerEvent=function(b,a,f,d,e,p,l,g){this.timer=b;this.delay=a;this.tick=f;this.repeatCount=d-1;this.loop=e;this.callback=p;this.callbackContext=
l;this.args=g;this.pendingDelete=!1};a.TimerEvent.prototype.constructor=a.TimerEvent;a.AnimationManager=function(b){this.sprite=b;this.game=b.game;this.currentAnim=this.currentFrame=null;this.updateIfVisible=!0;this.isLoaded=!1;this._frameData=null;this._anims={};this._outputFrames=[]};a.AnimationManager.prototype={loadFrameData:function(b,a){if("undefined"==typeof b)return!1;if(this.isLoaded)for(var f in this._anims)this._anims[f].updateFrameData(b);return this._frameData=b,"undefined"==typeof a||
null===a?this.frame=0:"string"==typeof a?this.frameName=a:this.frame=a,this.isLoaded=!0,!0},copyFrameData:function(b,a){if(this._frameData=b.clone(),this.isLoaded)for(var f in this._anims)this._anims[f].updateFrameData(this._frameData);return"undefined"==typeof a||null===a?this.frame=0:"string"==typeof a?this.frameName=a:this.frame=a,this.isLoaded=!0,!0},add:function(b,c,f,d,e){return c=c||[],f=f||60,"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=c&&"number"==typeof c[0]?!0:!1),this._outputFrames.length=
0,this._frameData.getFrameIndexes(c,e,this._outputFrames),this._anims[b]=new a.Animation(this.game,this.sprite,b,this._frameData,this._outputFrames,f,d),this.currentAnim=this._anims[b],this.currentFrame=this.currentAnim.currentFrame,this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[b]},validateFrames:function(b,a){"undefined"==typeof a&&(a=!0);for(var f=0;f<b.length;f++)if(!0===a){if(b[f]>this._frameData.total)return!1}else if(!1===this._frameData.checkFrameName(b[f]))return!1;
return!0},play:function(b,a,f,d){return this._anims[b]?this.currentAnim===this._anims[b]?!1===this.currentAnim.isPlaying?(this.currentAnim.paused=!1,this.currentAnim.play(a,f,d)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[b],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(a,f,d)):void 0},stop:function(b,a){"undefined"==typeof a&&(a=!1);"string"==typeof b?this._anims[b]&&(this.currentAnim=
this._anims[b],this.currentAnim.stop(a)):this.currentAnim&&this.currentAnim.stop(a)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(b){this.currentAnim&&(this.currentAnim.next(b),this.currentFrame=this.currentAnim.currentFrame)},previous:function(b){this.currentAnim&&(this.currentAnim.previous(b),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(b){return"string"==
typeof b&&this._anims[b]?this._anims[b]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var b=null;for(b in this._anims)this._anims.hasOwnProperty(b)&&this._anims[b].destroy();this._anims={};this._outputFrames=[];this.game=this.sprite=this.currentFrame=this.currentAnim=this._frameData=null}};a.AnimationManager.prototype.constructor=a.AnimationManager;Object.defineProperty(a.AnimationManager.prototype,
"frameData",{get:function(){return this._frameData}});Object.defineProperty(a.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(a.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(b){this.currentAnim.paused=b}});Object.defineProperty(a.AnimationManager.prototype,"name",{get:function(){return this.currentAnim?this.currentAnim.name:void 0}});Object.defineProperty(a.AnimationManager.prototype,
"frame",{get:function(){return this.currentFrame?this.currentFrame.index:void 0},set:function(b){"number"==typeof b&&this._frameData&&null!==this._frameData.getFrame(b)&&(this.currentFrame=this._frameData.getFrame(b),this.currentFrame&&(this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}});Object.defineProperty(a.AnimationManager.prototype,"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:void 0},set:function(b){"string"==
typeof b&&null!==this._frameData.getFrameByName(b)?(this.currentFrame=this._frameData.getFrameByName(b),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+b)}});a.Animation=function(b,c,f,d,e,p,l){"undefined"==typeof l&&(l=!1);this.game=b;this._parent=c;this._frameData=d;this.name=f;this._frames=[];this._frames=this._frames.concat(e);this.delay=
1E3/p;this.loop=l;this.loopCount=0;this.isPaused=this.isPlaying=this.isFinished=this.killOnComplete=!1;this._frameDiff=this._frameIndex=this._pauseStartTime=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new a.Signal;this.onUpdate=null;this.onComplete=new a.Signal;this.onLoop=new a.Signal;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};a.Animation.prototype={play:function(b,a,f){return"number"==typeof b&&
(this.delay=1E3/b),"boolean"==typeof a&&(this.loop=a),"undefined"!=typeof f&&(this.killOnComplete=f),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.updateCurrentFrame(!1),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,
this},restart:function(){this.isPlaying=!0;this.paused=this.isFinished=!1;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},setFrame:function(b,a){var f;if("undefined"==typeof a&&
(a=!1),"string"==typeof b)for(var d=0;d<this._frames.length;d++)this._frameData.getFrame(this._frames[d]).name===b&&(f=d);else if("number"==typeof b)if(a)f=b;else for(d=0;d<this._frames.length;d++)this._frames[d]===f&&(f=d);f&&(this._frameIndex=f-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(b,a){"undefined"==typeof b&&(b=!1);"undefined"==typeof a&&(a=!1);this.isPlaying=!1;this.isFinished=!0;this.paused=!1;b&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame));
a&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.time>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=
this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length?this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,
this),this.updateCurrentFrame(!0)):(this.complete(),!1):this.updateCurrentFrame(!0)):!1},updateCurrentFrame:function(b){return this._frameData?(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&b?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0):!1},next:function(b){"undefined"==typeof b&&
(b=1);b=this._frameIndex+b;b>=this._frames.length&&(this.loop?b%=this._frames.length:b=this._frames.length-1);b!==this._frameIndex&&(this._frameIndex=b,this.updateCurrentFrame(!0))},previous:function(b){"undefined"==typeof b&&(b=1);b=this._frameIndex-b;0>b&&(this.loop?b=this._frames.length+b:b++);b!==this._frameIndex&&(this._frameIndex=b,this.updateCurrentFrame(!0))},updateFrameData:function(b){this.currentFrame=(this._frameData=b)?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):
null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=
!1;this.isFinished=!0;this.paused=!1;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);this.killOnComplete&&this._parent.kill()}};a.Animation.prototype.constructor=a.Animation;Object.defineProperty(a.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(b){(this.isPaused=b)?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}});Object.defineProperty(a.Animation.prototype,
"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(a.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(b){this.currentFrame=this._frameData.getFrame(this._frames[b]);null!==this.currentFrame&&(this._frameIndex=b,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}});Object.defineProperty(a.Animation.prototype,"speed",{get:function(){return Math.round(1E3/
this.delay)},set:function(b){1<=b&&(this.delay=1E3/b)}});Object.defineProperty(a.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(b){b&&null===this.onUpdate?this.onUpdate=new a.Signal:b||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}});a.Animation.generateFrameNames=function(b,c,f,d,e){"undefined"==typeof d&&(d="");var p=[],l="";if(f>c)for(;f>=c;c++)l="number"==typeof e?a.Utils.pad(c.toString(),e,"0",1):c.toString(),l=b+l+d,p.push(l);
else for(;c>=f;c--)l="number"==typeof e?a.Utils.pad(c.toString(),e,"0",1):c.toString(),l=b+l+d,p.push(l);return p};a.Frame=function(b,c,f,d,e,p,l){this.index=b;this.x=c;this.y=f;this.width=d;this.height=e;this.name=p;this.uuid=l;this.centerX=Math.floor(d/2);this.centerY=Math.floor(e/2);this.distance=a.Math.distance(0,0,d,e);this.rotated=!1;this.rotationDirection="cw";this.trimmed=!1;this.sourceSizeW=d;this.sourceSizeH=e;this.spriteSourceSizeH=this.spriteSourceSizeW=this.spriteSourceSizeY=this.spriteSourceSizeX=
0;this.right=this.x+this.width;this.bottom=this.y+this.height};a.Frame.prototype={setTrim:function(b,a,f,d,e,p,l){(this.trimmed=b)&&(this.sourceSizeW=a,this.sourceSizeH=f,this.centerX=Math.floor(a/2),this.centerY=Math.floor(f/2),this.spriteSourceSizeX=d,this.spriteSourceSizeY=e,this.spriteSourceSizeW=p,this.spriteSourceSizeH=l)},clone:function(){var b=new a.Frame(this.index,this.x,this.y,this.width,this.height,this.name,this.uuid),c;for(c in this)this.hasOwnProperty(c)&&(b[c]=this[c]);return b},getRect:function(b){return"undefined"==
typeof b?b=new a.Rectangle(this.x,this.y,this.width,this.height):b.setTo(this.x,this.y,this.width,this.height),b}};a.Frame.prototype.constructor=a.Frame;a.FrameData=function(){this._frames=[];this._frameNames=[]};a.FrameData.prototype={addFrame:function(b){return b.index=this._frames.length,this._frames.push(b),""!==b.name&&(this._frameNames[b.name]=b.index),b},getFrame:function(b){return b>=this._frames.length&&(b=0),this._frames[b]},getFrameByName:function(b){return"number"==typeof this._frameNames[b]?
this._frames[this._frameNames[b]]:null},checkFrameName:function(b){return null==this._frameNames[b]?!1:!0},clone:function(){for(var b=new a.FrameData,c=0;c<this._frames.length;c++)b._frames.push(this._frames[c].clone());for(var f in this._frameNames)this._frameNames.hasOwnProperty(f)&&b._frameNames.push(this._frameNames[f]);return b},getFrameRange:function(b,a,f){for("undefined"==typeof f&&(f=[]);a>=b;b++)f.push(this._frames[b]);return f},getFrames:function(b,a,f){if("undefined"==typeof a&&(a=!0),
"undefined"==typeof f&&(f=[]),"undefined"==typeof b||0===b.length)for(var d=0;d<this._frames.length;d++)f.push(this._frames[d]);else for(var d=0,e=b.length;e>d;d++)f.push(a?this.getFrame(b[d]):this.getFrameByName(b[d]));return f},getFrameIndexes:function(b,a,f){if("undefined"==typeof a&&(a=!0),"undefined"==typeof f&&(f=[]),"undefined"==typeof b||0===b.length)for(var d=0,e=this._frames.length;e>d;d++)f.push(this._frames[d].index);else for(d=0,e=b.length;e>d;d++)a?f.push(b[d]):this.getFrameByName(b[d])&&
f.push(this.getFrameByName(b[d]).index);return f}};a.FrameData.prototype.constructor=a.FrameData;Object.defineProperty(a.FrameData.prototype,"total",{get:function(){return this._frames.length}});a.AnimationParser={spriteSheet:function(b,c,f,d,e,p,l){var g=b.cache.getImage(c);if(null==g)return null;var h=g.width,k=g.height;0>=f&&(f=Math.floor(-h/Math.min(-1,f)));0>=d&&(d=Math.floor(-k/Math.min(-1,d)));g=Math.floor((h-p)/(f+l))*Math.floor((k-p)/(d+l));if(-1!==e&&(g=e),0===h||0===k||f>h||d>k||0===g)return console.warn("Phaser.AnimationParser.spriteSheet: '"+
c+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;e=new a.FrameData;for(var m=k=p,u=0;g>u;u++){var z=b.rnd.uuid();e.addFrame(new a.Frame(u,k,m,f,d,"",z));PIXI.TextureCache[z]=new PIXI.Texture(PIXI.BaseTextureCache[c],{x:k,y:m,width:f,height:d});k+=f+l;k+f>h&&(k=p,m+=d+l)}return e},JSONData:function(b,c,f){if(!c.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(c);for(var d=new a.FrameData,
e=c.frames,p=0;p<e.length;p++){var l=b.rnd.uuid();c=d.addFrame(new a.Frame(p,e[p].frame.x,e[p].frame.y,e[p].frame.w,e[p].frame.h,e[p].filename,l));PIXI.TextureCache[l]=new PIXI.Texture(PIXI.BaseTextureCache[f],{x:e[p].frame.x,y:e[p].frame.y,width:e[p].frame.w,height:e[p].frame.h});e[p].trimmed&&c.setTrim(e[p].trimmed,e[p].sourceSize.w,e[p].sourceSize.h,e[p].spriteSourceSize.x,e[p].spriteSourceSize.y,e[p].spriteSourceSize.w,e[p].spriteSourceSize.h)}return d},JSONDataHash:function(b,c,f){if(!c.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),
void console.log(c);var d=new a.FrameData,e=c.frames,p=0,l;for(l in e){var g=b.rnd.uuid();c=d.addFrame(new a.Frame(p,e[l].frame.x,e[l].frame.y,e[l].frame.w,e[l].frame.h,l,g));PIXI.TextureCache[g]=new PIXI.Texture(PIXI.BaseTextureCache[f],{x:e[l].frame.x,y:e[l].frame.y,width:e[l].frame.w,height:e[l].frame.h});e[l].trimmed&&c.setTrim(e[l].trimmed,e[l].sourceSize.w,e[l].sourceSize.h,e[l].spriteSourceSize.x,e[l].spriteSourceSize.y,e[l].spriteSourceSize.w,e[l].spriteSourceSize.h);p++}return d},XMLData:function(b,
c,f){if(!c.getElementsByTagName("TextureAtlas"))return void console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");for(var d,e,p,l,g,h,k,m,u,z,x=new a.FrameData,r=c.getElementsByTagName("SubTexture"),w=0;w<r.length;w++)c=b.rnd.uuid(),e=r[w].attributes,d=e.name.value,p=parseInt(e.x.value,10),l=parseInt(e.y.value,10),g=parseInt(e.width.value,10),h=parseInt(e.height.value,10),m=k=null,e.frameX&&(k=Math.abs(parseInt(e.frameX.value,10)),m=Math.abs(parseInt(e.frameY.value,
10)),u=parseInt(e.frameWidth.value,10),z=parseInt(e.frameHeight.value,10)),d=x.addFrame(new a.Frame(w,p,l,g,h,d,c)),PIXI.TextureCache[c]=new PIXI.Texture(PIXI.BaseTextureCache[f],{x:p,y:l,width:g,height:h}),null===k&&null===m||d.setTrim(!0,g,h,k,m,u,z);return x}};a.Cache=function(b){this.game=b;this.autoResolveURL=!1;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._json={};this._xml={};this._physics={};this._tilemaps={};this._binary={};this._bitmapDatas={};this._bitmapFont=
{};this._urlMap={};this._urlResolver=new Image;this._urlTemp=null;this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new a.Signal;this._cacheMap=[];this._cacheMap[a.Cache.CANVAS]=this._canvases;this._cacheMap[a.Cache.IMAGE]=this._images;this._cacheMap[a.Cache.TEXTURE]=this._textures;this._cacheMap[a.Cache.SOUND]=this._sounds;this._cacheMap[a.Cache.TEXT]=this._text;this._cacheMap[a.Cache.PHYSICS]=this._physics;this._cacheMap[a.Cache.TILEMAP]=this._tilemaps;this._cacheMap[a.Cache.BINARY]=
this._binary;this._cacheMap[a.Cache.BITMAPDATA]=this._bitmapDatas;this._cacheMap[a.Cache.BITMAPFONT]=this._bitmapFont;this._cacheMap[a.Cache.JSON]=this._json;this._cacheMap[a.Cache.XML]=this._xml};a.Cache.CANVAS=1;a.Cache.IMAGE=2;a.Cache.TEXTURE=3;a.Cache.SOUND=4;a.Cache.TEXT=5;a.Cache.PHYSICS=6;a.Cache.TILEMAP=7;a.Cache.BINARY=8;a.Cache.BITMAPDATA=9;a.Cache.BITMAPFONT=10;a.Cache.JSON=11;a.Cache.XML=12;a.Cache.prototype={addCanvas:function(b,a,f){this._canvases[b]={canvas:a,context:f}},addBinary:function(b,
a){this._binary[b]=a},addBitmapData:function(b,c,f){return c.key=b,"undefined"==typeof f&&(f=new a.FrameData,f.addFrame(c.textureFrame)),this._bitmapDatas[b]={data:c,frameData:f},c},addRenderTexture:function(b,c){var f=new a.Frame(0,0,0,c.width,c.height,"","");this._textures[b]={texture:c,frame:f}},addSpriteSheet:function(b,c,f,d,e,p,l,g){this._images[b]={url:c,data:f,frameWidth:d,frameHeight:e,margin:l,spacing:g};PIXI.BaseTextureCache[b]=new PIXI.BaseTexture(f);PIXI.TextureCache[b]=new PIXI.Texture(PIXI.BaseTextureCache[b]);
this._images[b].frameData=a.AnimationParser.spriteSheet(this.game,b,d,e,p,l,g);this._resolveURL(c,this._images[b])},addTilemap:function(b,a,f,d){this._tilemaps[b]={url:a,data:f,format:d};this._resolveURL(a,this._tilemaps[b])},addTextureAtlas:function(b,c,f,d,e){this._images[b]={url:c,data:f};PIXI.BaseTextureCache[b]=new PIXI.BaseTexture(f);PIXI.TextureCache[b]=new PIXI.Texture(PIXI.BaseTextureCache[b]);e==a.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[b].frameData=a.AnimationParser.JSONData(this.game,
d,b):e==a.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[b].frameData=a.AnimationParser.JSONDataHash(this.game,d,b):e==a.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[b].frameData=a.AnimationParser.XMLData(this.game,d,b));this._resolveURL(c,this._images[b])},addBitmapFont:function(b,c,f,d,e,p){this._images[b]={url:c,data:f};PIXI.BaseTextureCache[b]=new PIXI.BaseTexture(f);PIXI.TextureCache[b]=new PIXI.Texture(PIXI.BaseTextureCache[b]);a.LoaderParser.bitmapFont(this.game,d,b,e,p);this._bitmapFont[b]=
PIXI.BitmapText.fonts[b];this._resolveURL(c,this._bitmapFont[b])},addPhysicsData:function(b,a,f,d){this._physics[b]={url:a,data:f,format:d};this._resolveURL(a,this._physics[b])},addDefaultImage:function(){var b=new Image;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images.__default={url:null,data:b};this._images.__default.frame=new a.Frame(0,0,0,32,32,"","");this._images.__default.frameData=
new a.FrameData;this._images.__default.frameData.addFrame(new a.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(b);PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var b=new Image;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";
this._images.__missing={url:null,data:b};this._images.__missing.frame=new a.Frame(0,0,0,32,32,"","");this._images.__missing.frameData=new a.FrameData;this._images.__missing.frameData.addFrame(new a.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(b);PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(b,a,f){this._text[b]={url:a,data:f};this._resolveURL(a,this._text[b])},addJSON:function(b,a,f){this._json[b]=
{url:a,data:f};this._resolveURL(a,this._json[b])},addXML:function(b,a,f){this._xml[b]={url:a,data:f};this._resolveURL(a,this._xml[b])},addImage:function(b,c,f){this.checkImageKey(b)&&this.removeImage(b);this._images[b]={url:c,data:f};this._images[b].frame=new a.Frame(0,0,0,f.width,f.height,b,this.game.rnd.uuid());this._images[b].frameData=new a.FrameData;this._images[b].frameData.addFrame(new a.Frame(0,0,0,f.width,f.height,c,this.game.rnd.uuid()));PIXI.BaseTextureCache[b]=new PIXI.BaseTexture(f);
PIXI.TextureCache[b]=new PIXI.Texture(PIXI.BaseTextureCache[b]);this._resolveURL(c,this._images[b])},addSound:function(b,a,f,d,e){e=e||!1;var p=!1;e&&(p=!0);this._sounds[b]={url:a,data:f,isDecoding:!1,decoded:p,webAudio:d||!0,audioTag:e,locked:this.game.sound.touchLocked};this._resolveURL(a,this._sounds[b])},reloadSound:function(b){var a=this;this._sounds[b]&&(this._sounds[b].data.src=this._sounds[b].url,this._sounds[b].data.addEventListener("canplaythrough",function(){return a.reloadSoundComplete(b)},
!1),this._sounds[b].data.load())},reloadSoundComplete:function(b){this._sounds[b]&&(this._sounds[b].locked=!1,this.onSoundUnlock.dispatch(b))},updateSound:function(b,a,f){this._sounds[b]&&(this._sounds[b][a]=f)},decodedSound:function(b,a){this._sounds[b].data=a;this._sounds[b].decoded=!0;this._sounds[b].isDecoding=!1},getCanvas:function(b){return this._canvases[b]?this._canvases[b].canvas:(console.warn('Phaser.Cache.getCanvas: Invalid key: "'+b+'"'),null)},getBitmapData:function(b){return this._bitmapDatas[b]?
this._bitmapDatas[b].data:(console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+b+'"'),null)},getBitmapFont:function(b){return this._bitmapFont[b]?this._bitmapFont[b]:(console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+b+'"'),null)},getPhysicsData:function(b,a,f){if("undefined"==typeof a||null===a){if(this._physics[b])return this._physics[b].data;console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+b+'"')}else if(this._physics[b]&&this._physics[b].data[a]){a=this._physics[b].data[a];
if(!a||!f)return a;for(var d in a)if(d=a[d],d.fixtureKey===f)return d;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+f+" in "+b+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+b+" / "+a+'"');return null},checkKey:function(b,a){return this._cacheMap[b][a]?!0:!1},checkCanvasKey:function(b){return this.checkKey(a.Cache.CANVAS,b)},checkImageKey:function(b){return this.checkKey(a.Cache.IMAGE,b)},checkTextureKey:function(b){return this.checkKey(a.Cache.TEXTURE,
b)},checkSoundKey:function(b){return this.checkKey(a.Cache.SOUND,b)},checkTextKey:function(b){return this.checkKey(a.Cache.TEXT,b)},checkPhysicsKey:function(b){return this.checkKey(a.Cache.PHYSICS,b)},checkTilemapKey:function(b){return this.checkKey(a.Cache.TILEMAP,b)},checkBinaryKey:function(b){return this.checkKey(a.Cache.BINARY,b)},checkBitmapDataKey:function(b){return this.checkKey(a.Cache.BITMAPDATA,b)},checkBitmapFontKey:function(b){return this.checkKey(a.Cache.BITMAPFONT,b)},checkJSONKey:function(b){return this.checkKey(a.Cache.JSON,
b)},checkXMLKey:function(b){return this.checkKey(a.Cache.XML,b)},checkURL:function(b){return this._urlMap[this._resolveURL(b)]?!0:!1},getImage:function(b){return this._images[b]?this._images[b].data:(console.warn('Phaser.Cache.getImage: Invalid key: "'+b+'"'),null)},getTilemapData:function(b){return this._tilemaps[b]?this._tilemaps[b]:(console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+b+'"'),null)},getFrameData:function(b,c){return"undefined"==typeof c&&(c=a.Cache.IMAGE),this._cacheMap[c][b]?
this._cacheMap[c][b].frameData:null},updateFrameData:function(b,a){this._images[b]&&(this._images[b].frameData=a)},getFrameByIndex:function(b,a){return this._images[b]?this._images[b].frameData.getFrame(a):null},getFrameByName:function(b,a){return this._images[b]?this._images[b].frameData.getFrameByName(a):null},getFrame:function(b){return this._images[b]?this._images[b].frame:null},getTextureFrame:function(b){return this._textures[b]?this._textures[b].frame:null},getRenderTexture:function(b){return this._textures[b]?
this._textures[b]:(console.warn('Phaser.Cache.getTexture: Invalid key: "'+b+'"'),null)},getTexture:function(b){return this._textures[b]?this._textures[b]:void console.warn('Phaser.Cache.getTexture: Invalid key: "'+b+'"')},getSound:function(b){return this._sounds[b]?this._sounds[b]:(console.warn('Phaser.Cache.getSound: Invalid key: "'+b+'"'),null)},getSoundData:function(b){return this._sounds[b]?this._sounds[b].data:(console.warn('Phaser.Cache.getSoundData: Invalid key: "'+b+'"'),null)},isSoundDecoded:function(b){return this._sounds[b]?
this._sounds[b].decoded:void 0},isSoundReady:function(b){return this._sounds[b]&&this._sounds[b].decoded&&!1===this.game.sound.touchLocked},getFrameCount:function(b){return this._images[b]?this._images[b].frameData.total:0},getText:function(b){return this._text[b]?this._text[b].data:(console.warn('Phaser.Cache.getText: Invalid key: "'+b+'"'),null)},getJSON:function(b){return this._json[b]?this._json[b].data:(console.warn('Phaser.Cache.getJSON: Invalid key: "'+b+'"'),null)},getXML:function(b){return this._xml[b]?
this._xml[b].data:(console.warn('Phaser.Cache.getXML: Invalid key: "'+b+'"'),null)},getBinary:function(b){return this._binary[b]?this._binary[b]:(console.warn('Phaser.Cache.getBinary: Invalid key: "'+b+'"'),null)},getURL:function(b){return(b=this._resolveURL(b))?this._urlMap[b]:(console.warn('Phaser.Cache.getUrl: Invalid url: "'+b+'" or Cache.autoResolveURL was false'),null)},getUrl:function(b){return this.getURL(b)},getKeys:function(b){var c=null;switch(b){case a.Cache.CANVAS:c=this._canvases;break;
case a.Cache.IMAGE:c=this._images;break;case a.Cache.TEXTURE:c=this._textures;break;case a.Cache.SOUND:c=this._sounds;break;case a.Cache.TEXT:c=this._text;break;case a.Cache.PHYSICS:c=this._physics;break;case a.Cache.TILEMAP:c=this._tilemaps;break;case a.Cache.BINARY:c=this._binary;break;case a.Cache.BITMAPDATA:c=this._bitmapDatas;break;case a.Cache.BITMAPFONT:c=this._bitmapFont;break;case a.Cache.JSON:c=this._json;break;case a.Cache.XML:c=this._xml}if(c){b=[];for(var f in c)"__default"!==f&&"__missing"!==
f&&b.push(f);return b}},removeCanvas:function(b){delete this._canvases[b]},removeImage:function(b,a){"undefined"==typeof a&&(a=!0);delete this._images[b];a&&PIXI.BaseTextureCache[b].destroy()},removeSound:function(b){delete this._sounds[b]},removeText:function(b){delete this._text[b]},removeJSON:function(b){delete this._json[b]},removeXML:function(b){delete this._xml[b]},removePhysics:function(b){delete this._physics[b]},removeTilemap:function(b){delete this._tilemaps[b]},removeBinary:function(b){delete this._binary[b]},
removeBitmapData:function(b){delete this._bitmapDatas[b]},removeBitmapFont:function(b){delete this._bitmapFont[b]},_resolveURL:function(b,a){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+b,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",a&&(this._urlMap[this._urlTemp]=a),this._urlTemp):null},destroy:function(){for(var b in this._images)"__default"!==b&&"__missing"!==b&&delete this._images[b];for(var a=[this._canvases,this._sounds,this._text,this._json,this._xml,
this._textures,this._physics,this._tilemaps,this._binary,this._bitmapDatas,this._bitmapFont],f=0;f<a.length;f++)for(b in a[f])delete a[f][b];this._urlTemp=this._urlResolver=this._urlMap=null}};a.Cache.prototype.constructor=a.Cache;a.Loader=function(b){this.game=b;this.hasLoaded=this.isLoading=this.resetLocked=!1;this.preloadSprite=null;this.crossOrigin=!1;this.baseURL="";this.onLoadStart=new a.Signal;this.onLoadComplete=new a.Signal;this.onPackComplete=new a.Signal;this.onFileStart=new a.Signal;this.onFileComplete=
new a.Signal;this.onFileError=new a.Signal;this._warnedAboutXDomainRequest=this.useXDomainRequest=!1;this.enableParallel=!0;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=!1;this._loadedFileCount=this._loadedPackCount=this._totalFileCount=this._totalPackCount=0};a.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;a.Loader.TEXTURE_ATLAS_JSON_HASH=1;a.Loader.TEXTURE_ATLAS_XML_STARLING=2;a.Loader.PHYSICS_LIME_CORONA_JSON=3;a.Loader.PHYSICS_PHASER_JSON=
4;a.Loader.prototype={setPreloadSprite:function(b,c){c=c||0;this.preloadSprite={sprite:b,direction:c,width:b.width,height:b.height,rect:null};this.preloadSprite.rect=0===c?new a.Rectangle(0,0,1,b.height):new a.Rectangle(0,0,b.width,1);b.crop(this.preloadSprite.rect);b.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(b,a){return-1<this.getAssetIndex(b,
a)},getAssetIndex:function(b,a){for(var f=-1,d=0;d<this._fileList.length;d++){var e=this._fileList[d];if(e.type===b&&e.key===a&&(f=d,!e.loaded&&!e.loading))break}return f},getAsset:function(b,a){var f=this.getAssetIndex(b,a);return-1<f?{index:f,file:this._fileList[f]}:!1},reset:function(b,a){"undefined"==typeof a&&(a=!1);this.resetLocked||(b&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=
0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,a&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(b,a,f,d,e){f={type:b,key:a,url:f,syncPoint:0<this._withSyncPointDepth,data:null,loading:!1,loaded:!1,error:!1};if(d)for(var p in d)f[p]=d[p];b=this.getAssetIndex(b,a);e&&-1<b?(e=this._fileList[b],e.loading||e.loaded?
(this._fileList.push(f),this._totalFileCount++):this._fileList[b]=f):-1===b&&(this._fileList.push(f),this._totalFileCount++)},replaceInFileList:function(b,a,f,d){return this.addToFileList(b,a,f,d,!0)},pack:function(b,a,f,d){if("undefined"==typeof a&&(a=null),"undefined"==typeof f&&(f=null),"undefined"==typeof d&&(d=null),!a&&!f)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;b={type:"packfile",key:b,url:a,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,
callbackContext:d};f&&("string"==typeof f&&(f=JSON.parse(f)),b.data=f||{},b.loaded=!0);for(f=0;f<this._fileList.length+1;f++)if(a=this._fileList[f],!a||!a.loaded&&!a.loading&&"packfile"!==a.type){this._fileList.splice(f,1,b);this._totalPackCount++;break}return this},image:function(b,a,f){return"undefined"==typeof f&&(f=!1),this.addToFileList("image",b,a,void 0,f),this},text:function(b,a,f){return"undefined"==typeof f&&(f=!1),this.addToFileList("text",b,a,void 0,f),this},json:function(b,a,f){return"undefined"==
typeof f&&(f=!1),this.addToFileList("json",b,a,void 0,f),this},xml:function(b,a,f){return"undefined"==typeof f&&(f=!1),this.addToFileList("xml",b,a,void 0,f),this},script:function(b,a,f,d){return"undefined"==typeof f&&(f=!1),!1!==f&&"undefined"==typeof d&&(d=f),this.addToFileList("script",b,a,{syncPoint:!0,callback:f,callbackContext:d}),this},binary:function(b,a,f,d){return"undefined"==typeof f&&(f=!1),!1!==f&&"undefined"==typeof d&&(d=f),this.addToFileList("binary",b,a,{callback:f,callbackContext:d}),
this},spritesheet:function(b,a,f,d,e,p,l){return"undefined"==typeof e&&(e=-1),"undefined"==typeof p&&(p=0),"undefined"==typeof l&&(l=0),this.addToFileList("spritesheet",b,a,{frameWidth:f,frameHeight:d,frameMax:e,margin:p,spacing:l}),this},audio:function(b,a,f){return"undefined"==typeof f&&(f=!0),"string"==typeof a&&(a=[a]),this.addToFileList("audio",b,a,{buffer:null,autoDecode:f}),this},audiosprite:function(b,a,f,d,e){return"undefined"==typeof f&&(f=null),"undefined"==typeof d&&(d=null),"undefined"==
typeof e&&(e=!0),this.audio(b,a,e),f?this.json(b+"-audioatlas",f):d?("string"==typeof d&&(d=JSON.parse(d)),this.game.cache.addJSON(b+"-audioatlas","",d)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object"),this},tilemap:function(b,c,f,d){if("undefined"==typeof c&&(c=null),"undefined"==typeof f&&(f=null),"undefined"==typeof d&&(d=a.Tilemap.CSV),!c&&!f)return console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set."),this;
if(f){switch(d){case a.Tilemap.TILED_JSON:"string"==typeof f&&(f=JSON.parse(f))}this.game.cache.addTilemap(b,null,f,d)}else this.addToFileList("tilemap",b,c,{format:d});return this},physics:function(b,c,f,d){return"undefined"==typeof c&&(c=null),"undefined"==typeof f&&(f=null),"undefined"==typeof d&&(d=a.Physics.LIME_CORONA_JSON),c||f?(f?("string"==typeof f&&(f=JSON.parse(f)),this.game.cache.addPhysicsData(b,null,f,d)):this.addToFileList("physics",b,c,{format:d}),this):(console.warn("Phaser.Loader.physics - Both url and data are null. One must be set."),
this)},bitmapFont:function(b,a,f,d,e,p){if("undefined"==typeof f&&(f=null),"undefined"==typeof d&&(d=null),"undefined"==typeof e&&(e=0),"undefined"==typeof p&&(p=0),f)this.addToFileList("bitmapfont",b,a,{xmlURL:f,xSpacing:e,ySpacing:p});else if("string"==typeof d){f=this.parseXml(d);if(!f)throw Error("Phaser.Loader. Invalid Bitmap Font XML given");this.addToFileList("bitmapfont",b,a,{xmlURL:null,xmlData:f,xSpacing:e,ySpacing:p})}return this},atlasJSONArray:function(b,c,f,d){return this.atlas(b,c,
f,d,a.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(b,c,f,d){return this.atlas(b,c,f,d,a.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(b,c,f,d){return this.atlas(b,c,f,d,a.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(b,c,f,d,e){if("undefined"==typeof f&&(f=null),"undefined"==typeof d&&(d=null),"undefined"==typeof e&&(e=a.Loader.TEXTURE_ATLAS_JSON_ARRAY),f)this.addToFileList("textureatlas",b,c,{atlasURL:f,format:e});else{switch(e){case a.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==
typeof d&&(d=JSON.parse(d));break;case a.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof d){f=this.parseXml(d);if(!f)throw Error("Phaser.Loader. Invalid Texture Atlas XML given");d=f}}this.addToFileList("textureatlas",b,c,{atlasURL:null,atlasData:d,format:e})}return this},withSyncPoint:function(b,a){this._withSyncPointDepth++;try{b.call(a||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(b,a){var f=this.getAsset(b,a);return f&&(f.file.syncPoint=!0),this},removeFile:function(b,
a){var f=this.getAsset(b,a);f&&(f.loaded||f.loading||this._fileList.splice(f.index,1))},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){if(!this.isLoading)return console.warn("Phaser.Loader - active loading canceled / reset"),void this.finishedLoading(!0);for(var b=0;b<this._flightQueue.length;b++){var c=this._flightQueue[b];(c.loaded||
c.error)&&(this._flightQueue.splice(b,1),b--,c.loading=!1,c.requestUrl=null,c.requestObject=null,c.error&&this.onFileError.dispatch(c.key,c),"packfile"!==c.type?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,c.key,!c.error,this._loadedFileCount,this._totalFileCount)):"packfile"===c.type&&c.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(c.key,!c.error,this._loadedPackCount,this._totalPackCount)))}for(var f=!1,d=this.enableParallel?a.Math.clamp(this.maxParallelDownloads,
1,12):1,b=this._processingHead;b<this._fileList.length&&!(c=this._fileList[b],"packfile"===c.type&&!c.error&&c.loaded&&b===this._processingHead&&(this.processPack(c),this._loadedPackCount++,this.onPackComplete.dispatch(c.key,!c.error,this._loadedPackCount,this._totalPackCount)),c.loaded||c.error?b===this._processingHead&&(this._processingHead=b+1):!c.loading&&this._flightQueue.length<d&&("packfile"!==c.type||c.data?f||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),
this._flightQueue.push(c),c.loading=!0,this.onFileStart.dispatch(this.progress,c.key,c.url),this.loadFile(c)):(this._flightQueue.push(c),c.loading=!0,this.loadFile(c))),!c.loaded&&c.syncPoint&&(f=!0),this._flightQueue.length>=d||f&&this._loadedPackCount===this._totalPackCount);b++);if(this.updateProgress(),this._processingHead>=this._fileList.length)this.finishedLoading();else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");
var e=this;setTimeout(function(){e.finishedLoading(!0)},2E3)}},finishedLoading:function(b){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,b||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.onLoadComplete.dispatch(),this.reset(),this.game.state.loadComplete())},asyncComplete:function(b,a){"undefined"==typeof a&&(a="");b.loaded=!0;b.error=!!a;a&&(b.errorMessage=a,console.warn("Phaser.Loader - "+b.type+"["+b.key+"]: "+a));this.processLoadQueue()},processPack:function(b){var c=
b.data[b.key];if(!c)return void console.warn("Phaser.Loader - "+b.key+": pack has data, but not for pack key");for(var f=0;f<c.length;f++){var d=c[f];switch(d.type){case "image":this.image(d.key,d.url,d.overwrite);break;case "text":this.text(d.key,d.url,d.overwrite);break;case "json":this.json(d.key,d.url,d.overwrite);break;case "xml":this.xml(d.key,d.url,d.overwrite);break;case "script":this.script(d.key,d.url,d.callback,b.callbackContext||this);break;case "binary":this.binary(d.key,d.url,d.callback,
b.callbackContext||this);break;case "spritesheet":this.spritesheet(d.key,d.url,d.frameWidth,d.frameHeight,d.frameMax,d.margin,d.spacing);break;case "audio":this.audio(d.key,d.urls,d.autoDecode);break;case "audiosprite":this.audio(d.key,d.urls,d.jsonURL);break;case "tilemap":this.tilemap(d.key,d.url,d.data,a.Tilemap[d.format]);break;case "physics":this.physics(d.key,d.url,d.data,a.Loader[d.format]);break;case "bitmapFont":this.bitmapFont(d.key,d.textureURL,d.xmlURL,d.xmlData,d.xSpacing,d.ySpacing);
break;case "atlasJSONArray":this.atlasJSONArray(d.key,d.textureURL,d.atlasURL,d.atlasData);break;case "atlasJSONHash":this.atlasJSONHash(d.key,d.textureURL,d.atlasURL,d.atlasData);break;case "atlasXML":this.atlasXML(d.key,d.textureURL,d.atlasURL,d.atlasData);break;case "atlas":this.atlas(d.key,d.textureURL,d.atlasURL,d.atlasData,a.Loader[d.format])}}},transformUrl:function(b){return this.baseURL+b},loadFile:function(b){switch(b.type){case "packfile":this.xhrLoad(b,this.transformUrl(b.url,b),"text",
this.fileComplete);break;case "image":case "spritesheet":case "textureatlas":case "bitmapfont":this.loadImageTag(b);break;case "audio":b.url=this.getAudioURL(b.url);b.url?this.game.sound.usingWebAudio?this.xhrLoad(b,this.transformUrl(b.url,b),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(b):this.fileError(b,null,"no supported audio URL specified");break;case "json":this.xhrLoad(b,this.transformUrl(b.url,b),"text",this.jsonLoadComplete);break;case "xml":this.xhrLoad(b,
this.transformUrl(b.url,b),"text",this.xmlLoadComplete);break;case "tilemap":b.format===a.Tilemap.TILED_JSON?this.xhrLoad(b,this.transformUrl(b.url,b),"text",this.jsonLoadComplete):b.format===a.Tilemap.CSV?this.xhrLoad(b,this.transformUrl(b.url,b),"text",this.csvLoadComplete):this.asyncComplete(b,"invalid Tilemap format: "+b.format);break;case "text":case "script":case "physics":this.xhrLoad(b,this.transformUrl(b.url,b),"text",this.fileComplete);break;case "binary":this.xhrLoad(b,this.transformUrl(b.url,
b),"arraybuffer",this.fileComplete)}},loadImageTag:function(b){var a=this;b.data=new Image;b.data.name=b.key;this.crossOrigin&&(b.data.crossOrigin=this.crossOrigin);b.data.onload=function(){b.data.onload&&(b.data.onload=null,b.data.onerror=null,a.fileComplete(b))};b.data.onerror=function(){b.data.onload&&(b.data.onload=null,b.data.onerror=null,a.fileError(b))};b.data.src=this.transformUrl(b.url,b);b.data.complete&&b.data.width&&b.data.height&&(b.data.onload=null,b.data.onerror=null,this.fileComplete(b))},
loadAudioTag:function(b){var c=this;if(this.game.sound.touchLocked)b.data=new Audio,b.data.name=b.key,b.data.preload="auto",b.data.src=this.transformUrl(b.url,b),this.fileComplete(b);else{b.data=new Audio;b.data.name=b.key;var f=function(){b.data.removeEventListener("canplaythrough",f,!1);b.data.onerror=null;a.GAMES[c.game.id].load.fileComplete(b)};b.data.onerror=function(){b.data.removeEventListener("canplaythrough",f,!1);b.data.onerror=null;c.fileError(b)};b.data.preload="auto";b.data.src=this.transformUrl(b.url,
b);b.data.addEventListener("canplaythrough",f,!1);b.data.load()}},xhrLoad:function(b,a,f,d,e){if(this.useXDomainRequest&&window.XDomainRequest)return void this.xhrLoadWithXDR(b,a,f,d,e);var p=new XMLHttpRequest;p.open("GET",a,!0);p.responseType=f;e=e||this.fileError;var l=this;p.onload=function(){try{return d.call(l,b,p)}catch(a){l.hasLoaded?window.console&&console.error(a):l.asyncComplete(b,a.message||"Exception")}};p.onerror=function(){try{return e.call(l,b,p)}catch(a){l.hasLoaded?window.console&&
console.error(a):l.asyncComplete(b,a.message||"Exception")}};b.requestObject=p;b.requestUrl=a;p.send()},xhrLoadWithXDR:function(b,a,f,d,e){this._warnedAboutXDomainRequest||this.game.device.ie&&!(10<=this.game.device.ieVersion)||(this._warnedAboutXDomainRequest=!0,console.warn("Phaser.Loader - using XDomainRequest outside of IE 9"));var p=new window.XDomainRequest;p.open("GET",a,!0);p.responseType=f;p.timeout=3E3;e=e||this.fileError;var l=this;p.onerror=function(){try{return e.call(l,b,p)}catch(a){l.asyncComplete(b,
a.message||"Exception")}};p.ontimeout=function(){try{return e.call(l,b,p)}catch(a){l.asyncComplete(b,a.message||"Exception")}};p.onprogress=function(){};p.onload=function(){try{return d.call(l,b,p)}catch(a){l.asyncComplete(b,a.message||"Exception")}};b.requestObject=p;b.requestUrl=a;setTimeout(function(){p.send()},0)},getAudioURL:function(b){for(var a=0;a<b.length;a++){var f;f=b[a];if(f.uri)f=f.uri,f=f.type;else{if(0===f.indexOf("blob:")||0===f.indexOf("data:"))return f;0<=f.indexOf("?")&&(f=f.substr(0,
f.indexOf("?")));f=f.substr((Math.max(0,f.lastIndexOf("."))||1/0)+1).toLowerCase()}if(this.game.device.canPlayAudio(f))return b[a]}return null},fileError:function(b,a,f){var d="error loading asset from URL "+(b.requestUrl||this.transformUrl(b.url,b));!f&&a&&(f=a.status);f&&(d=d+" ("+f+")");this.asyncComplete(b,d)},fileComplete:function(b,c){var f=!0;switch(b.type){case "packfile":var d=JSON.parse(c.responseText);b.data=d||{};break;case "image":this.game.cache.addImage(b.key,b.url,b.data);break;case "spritesheet":this.game.cache.addSpriteSheet(b.key,
b.url,b.data,b.frameWidth,b.frameHeight,b.frameMax,b.margin,b.spacing);break;case "textureatlas":if(null==b.atlasURL)this.game.cache.addTextureAtlas(b.key,b.url,b.data,b.atlasData,b.format);else if(f=!1,b.format==a.Loader.TEXTURE_ATLAS_JSON_ARRAY||b.format==a.Loader.TEXTURE_ATLAS_JSON_HASH)this.xhrLoad(b,this.transformUrl(b.atlasURL,b),"text",this.jsonLoadComplete);else{if(b.format!=a.Loader.TEXTURE_ATLAS_XML_STARLING)throw Error("Phaser.Loader. Invalid Texture Atlas format: "+b.format);this.xhrLoad(b,
this.transformUrl(b.atlasURL,b),"text",this.xmlLoadComplete)}break;case "bitmapfont":b.xmlURL?(f=!1,this.xhrLoad(b,this.transformUrl(b.xmlURL,b),"text",this.xmlLoadComplete)):this.game.cache.addBitmapFont(b.key,b.url,b.data,b.xmlData,b.xSpacing,b.ySpacing);break;case "audio":this.game.sound.usingWebAudio?(b.data=c.response,this.game.cache.addSound(b.key,b.url,b.data,!0,!1),b.autoDecode&&this.game.sound.decode(b.key)):this.game.cache.addSound(b.key,b.url,b.data,!1,!0);break;case "text":b.data=c.responseText;
this.game.cache.addText(b.key,b.url,b.data);break;case "physics":d=JSON.parse(c.responseText);this.game.cache.addPhysicsData(b.key,b.url,d,b.format);break;case "script":b.data=document.createElement("script");b.data.language="javascript";b.data.type="text/javascript";b.data.defer=!1;b.data.text=c.responseText;document.head.appendChild(b.data);b.callback&&(b.data=b.callback.call(b.callbackContext,b.key,c.responseText));break;case "binary":b.data=b.callback?b.callback.call(b.callbackContext,b.key,c.response):
c.response,this.game.cache.addBinary(b.key,b.data)}f&&this.asyncComplete(b)},jsonLoadComplete:function(b,a){var f=JSON.parse(a.responseText);"tilemap"===b.type?this.game.cache.addTilemap(b.key,b.url,f,b.format):"json"===b.type?this.game.cache.addJSON(b.key,b.url,f):this.game.cache.addTextureAtlas(b.key,b.url,b.data,f,b.format);this.asyncComplete(b)},csvLoadComplete:function(b,a){this.game.cache.addTilemap(b.key,b.url,a.responseText,b.format);this.asyncComplete(b)},xmlLoadComplete:function(b,a){var f=
this.parseXml(a.responseText);if(!f)return console.warn("Phaser.Loader - "+b.key+": invalid XML ("+(a.responseType||a.contentType)+")"),void this.asyncComplete(b,"invalid XML");"bitmapfont"===b.type?this.game.cache.addBitmapFont(b.key,b.url,b.data,f,b.xSpacing,b.ySpacing):"textureatlas"===b.type?this.game.cache.addTextureAtlas(b.key,b.url,b.data,f,b.format):"xml"===b.type&&this.game.cache.addXML(b.key,b.url,f);this.asyncComplete(b)},parseXml:function(b){var a;try{window.DOMParser?a=(new DOMParser).parseFromString(b,
"text/xml"):(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(b))}catch(f){a=null}return a&&a.documentElement&&!a.getElementsByTagName("parsererror").length?a:null},updateProgress:function(){this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=
null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(a.Loader.prototype,"progressFloat",{get:function(){return a.Math.clamp(this._loadedFileCount/this._totalFileCount*100||0,0,100)}});Object.defineProperty(a.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});
a.Loader.prototype.constructor=a.Loader;a.LoaderParser={bitmapFont:function(b,a,f,d,e){b={};var p=a.getElementsByTagName("info")[0],l=a.getElementsByTagName("common")[0];b.font=p.getAttribute("face");b.size=parseInt(p.getAttribute("size"),10);b.lineHeight=parseInt(l.getAttribute("lineHeight"),10)+e;b.chars={};p=a.getElementsByTagName("char");for(e=0;e<p.length;e++){var l=parseInt(p[e].getAttribute("id"),10),g=new PIXI.Rectangle(parseInt(p[e].getAttribute("x"),10),parseInt(p[e].getAttribute("y"),10),
parseInt(p[e].getAttribute("width"),10),parseInt(p[e].getAttribute("height"),10));b.chars[l]={xOffset:parseInt(p[e].getAttribute("xoffset"),10),yOffset:parseInt(p[e].getAttribute("yoffset"),10),xAdvance:parseInt(p[e].getAttribute("xadvance"),10)+d,kerning:{},texture:PIXI.TextureCache[f]=new PIXI.Texture(PIXI.BaseTextureCache[f],g)}}a=a.getElementsByTagName("kerning");for(e=0;e<a.length;e++)d=parseInt(a[e].getAttribute("first"),10),p=parseInt(a[e].getAttribute("second"),10),l=parseInt(a[e].getAttribute("amount"),
10),b.chars[p].kerning[d]=l;PIXI.BitmapText.fonts[f]=b}};a.AudioSprite=function(b,a){this.game=b;this.key=a;this.config=this.game.cache.getJSON(a+"-audioatlas");this.autoplayKey=null;this.autoplay=!1;this.sounds={};for(var f in this.config.spritemap){var d=this.config.spritemap[f],e=this.game.add.sound(this.key);e.addMarker(f,d.start,d.end-d.start,null,d.loop);this.sounds[f]=e}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])};
a.AudioSprite.prototype={play:function(b,a){return"undefined"==typeof a&&(a=1),this.sounds[b].play(b,null,a)},stop:function(b){if(b)this.sounds[b].stop();else for(var a in this.sounds)this.sounds[a].stop()},get:function(b){return this.sounds[b]}};a.AudioSprite.prototype.constructor=a.AudioSprite;a.Sound=function(b,c,f,d,e){"undefined"==typeof f&&(f=1);"undefined"==typeof d&&(d=!1);"undefined"==typeof e&&(e=b.sound.connectToMaster);this.game=b;this.key=this.name=c;this.loop=d;this.volume=f;this.markers=
{};this.context=null;this.autoplay=!1;this.stopTime=this.position=this.durationMS=this.duration=this.currentTime=this.startTime=this.totalDuration=0;this.paused=!1;this.pausedTime=this.pausedPosition=0;this.isPlaying=!1;this.currentMarker="";this.fadeTween=null;this.allowMultiple=this.override=this.pendingPlayback=!1;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this._sound=this.gainNode=this.masterGainNode=this.externalNode=null;this.usingWebAudio?
(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=f*this.game.sound.volume,e&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(c)&&this.game.cache.isSoundReady(c)?(this._sound=this.game.cache.getSoundData(c),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):
this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this));this.onDecoded=new a.Signal;this.onPlay=new a.Signal;this.onPause=new a.Signal;this.onResume=new a.Signal;this.onLoop=new a.Signal;this.onStop=new a.Signal;this.onMute=new a.Signal;this.onMarkerComplete=new a.Signal;this.onFadeComplete=new a.Signal;this._volume=f;this._buffer=null;this._muted=!1;this._tempLoop=this._muteVolume=this._tempVolume=this._tempPosition=this._tempMarker=0;this._onDecodedEventDispatched=this._paused=!1};a.Sound.prototype=
{soundHasUnlocked:function(b){b===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(b,a,f,d,e){"undefined"==typeof d&&(d=1);"undefined"==typeof e&&(e=!1);this.markers[b]={name:b,start:a,stop:a+f,volume:d,duration:f,durationMS:1E3*f,loop:e}},removeMarker:function(b){delete this.markers[b]},onEndedHandler:function(){this.isPlaying=!1;this.stop()},update:function(){this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),
this._onDecodedEventDispatched=!0);this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop));this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.time):(this.onMarkerComplete.dispatch(this.currentMarker,this),
this.play(this.currentMarker,0,this.volume,!0,!0))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},loopFull:function(b){this.play(null,0,b,!0)},play:function(b,a,f,d,e){if(("undefined"==typeof b||!1===b||null===b)&&(b=""),"undefined"==typeof e&&(e=!0),this.isPlaying&&!this.allowMultiple&&!e&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||e))if(this.usingWebAudio)if("undefined"==
typeof this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(p){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(""===b&&0<Object.keys(this.markers).length)return this;if(""!==b){if(this.currentMarker=b,!this.markers[b])return this;this.position=this.markers[b].start;this.volume=this.markers[b].volume;this.loop=this.markers[b].loop;this.duration=this.markers[b].duration;this.durationMS=this.markers[b].durationMS;"undefined"!=typeof f&&(this.volume=
f);"undefined"!=typeof d&&(this.loop=d);this._tempMarker=b;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else a=a||0,"undefined"==typeof f&&(f=this._volume),"undefined"==typeof d&&(d=this.loop),this.position=a,this.volume=f,this.loop=d,this.durationMS=this.duration=0,this._tempMarker=b,this._tempPosition=a,this._tempVolume=f,this._tempLoop=d;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(null===this._buffer&&(this._buffer=this.game.cache.getSoundData(this.key)),
this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&""===b&&(this._sound.loop=!0),this.loop||""!==b||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1E3*this.totalDuration)),"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):
this.loop&&""===b?this._sound.start(0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),
this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1E3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):
this.pendingPlayback=!0,this},restart:function(b,a,f,d){"undefined"==typeof d&&(d=!1);this.play(b||"",a||0,f||1,d,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var b=this.position+this.pausedPosition/1E3;this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;this._sound.connect(this.externalNode?
this.externalNode:this.gainNode);this.loop&&(this._sound.loop=!0);this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var a=this.duration-this.pausedPosition/1E3;"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,b,a):this._sound.start(0,b,a)}else this._sound.play();this.isPlaying=!0;this.paused=!1;this.startTime+=this.game.time.time-this.pausedTime;this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio)if("undefined"==
typeof this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(b){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=this.pendingPlayback=!1;var a=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this);this.currentMarker="";null!==this.fadeTween&&this.fadeTween.stop();this.paused||this.onStop.dispatch(this,a)},fadeIn:function(b,a,f){"undefined"==typeof a&&(a=!1);"undefined"==typeof f&&(f=this.currentMarker);
this.paused||(this.play(f,0,0,a),this.fadeTo(b,1))},fadeOut:function(b){this.fadeTo(b,0)},fadeTo:function(b,c){if(this.isPlaying&&!this.paused&&c!==this.volume){if("undefined"==typeof b&&(b=1E3),"undefined"==typeof c)return void console.warn("Phaser.Sound.fadeTo: No Volume Specified.");this.fadeTween=this.game.add.tween(this).to({volume:c},b,a.Easing.Linear.None,!0);this.fadeTween.onComplete.add(this.fadeComplete,this)}},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);0===this.volume&&
this.stop()},destroy:function(b){"undefined"==typeof b&&(b=!0);this.stop();b?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}};a.Sound.prototype.constructor=a.Sound;Object.defineProperty(a.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});
Object.defineProperty(a.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(a.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(b){b?(this._muted=!0,this.usingWebAudio?(this._muteVolume=this.gainNode.gain.value,this.gainNode.gain.value=0):this.usingAudioTag&&this._sound&&(this._muteVolume=this._sound.volume,this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=
this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume));this.onMute.dispatch(this)}});Object.defineProperty(a.Sound.prototype,"volume",{get:function(){return this._volume},set:function(b){this.usingWebAudio?(this._volume=b,this.gainNode.gain.value=b):this.usingAudioTag&&this._sound&&0<=b&&1>=b&&(this._volume=b,this._sound.volume=b)}});a.SoundManager=function(b){this.game=b;this.onSoundDecode=new a.Signal;this._muted=this._codeMuted=!1;this._unlockSource=null;this._volume=
1;this._sounds=[];this._watchList=new a.ArraySet;this._watching=!1;this.context=this._watchContext=this._watchCallback=null;this.usingWebAudio=!0;this.noAudio=this.usingAudioTag=!1;this.connectToMaster=!0;this.touchLocked=!1;this.channels=32};a.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&!1===this.game.device.webAudio&&(this.channels=1),!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(this.game.input.touch.callbackContext=
this,this.game.input.touch.touchStartCallback=this.unlock,this.game.input.mouse.callbackContext=this,this.game.input.mouse.mouseDownCallback=this.unlock,this.touchLocked=!0):this.touchLocked=!1,window.PhaserGlobal){if(!0===window.PhaserGlobal.disableAudio)return this.usingWebAudio=!1,void(this.noAudio=!0);if(!0===window.PhaserGlobal.disableWebAudio)return this.usingWebAudio=!1,this.usingAudioTag=!0,void(this.noAudio=!1)}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;
else if(window.AudioContext)try{this.context=new window.AudioContext}catch(b){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(a){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}window.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1);null!==this.context&&(this.masterGain="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),
this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},unlock:function(){if(!1!==this.touchLocked)if(!1===this.game.device.webAudio||window.PhaserGlobal&&!0===window.PhaserGlobal.disableWebAudio)this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null,this.game.input.mouse.callbackContext=null,this.game.input.mouse.mouseDownCallback=null;else{var b=this.context.createBuffer(1,1,22050);this._unlockSource=
this.context.createBufferSource();this._unlockSource.buffer=b;this._unlockSource.connect(this.context.destination);"undefined"==typeof this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0)}},stopAll:function(){for(var b=0;b<this._sounds.length;b++)this._sounds[b]&&this._sounds[b].stop()},pauseAll:function(){for(var b=0;b<this._sounds.length;b++)this._sounds[b]&&this._sounds[b].pause()},resumeAll:function(){for(var b=0;b<this._sounds.length;b++)this._sounds[b]&&this._sounds[b].resume()},
decode:function(b,a){a=a||null;var f=this.game.cache.getSoundData(b);if(f&&!1===this.game.cache.isSoundDecoded(b)){this.game.cache.updateSound(b,"isDecoding",!0);var d=this;this.context.decodeAudioData(f,function(f){f&&(d.game.cache.decodedSound(b,f),d.onSoundDecode.dispatch(b,a))})}},setDecodedCallback:function(b,c,f){"string"==typeof b&&(b=[b]);this._watchList.reset();for(var d=0;d<b.length;d++)b[d]instanceof a.Sound?this.game.cache.isSoundDecoded(b[d].key)||this._watchList.add(b[d].key):this.game.cache.isSoundDecoded(b[d])||
this._watchList.add(b[d]);0===this._watchList.total?(this._watching=!1,c.call(f)):(this._watching=!0,this._watchCallback=c,this._watchContext=f)},update:function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=
null);for(var b=0;b<this._sounds.length;b++)this._sounds[b].update();if(this._watching){for(b=this._watchList.first;b;)this.game.cache.isSoundDecoded(b)&&this._watchList.remove(b),b=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}},add:function(b,c,f,d){"undefined"==typeof c&&(c=1);"undefined"==typeof f&&(f=!1);"undefined"==typeof d&&(d=this.connectToMaster);b=new a.Sound(this.game,b,c,f,d);return this._sounds.push(b),b},addSprite:function(b){return new a.AudioSprite(this.game,
b)},remove:function(b){for(var a=this._sounds.length;a--;)if(this._sounds[a]===b)return this._sounds[a].destroy(!1),this._sounds.splice(a,1),!0;return!1},removeByKey:function(b){for(var a=this._sounds.length,f=0;a--;)this._sounds[a].key===b&&(this._sounds[a].destroy(!1),this._sounds.splice(a,1),f++);return f},play:function(b,a,f){b=this.add(b,a,f);return b.play(),b},setMute:function(){if(!this._muted){this._muted=!0;this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=
0);for(var b=0;b<this._sounds.length;b++)this._sounds[b].usingAudioTag&&(this._sounds[b].mute=!0)}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1;this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var b=0;b<this._sounds.length;b++)this._sounds[b].usingAudioTag&&(this._sounds[b].mute=!1)}},destroy:function(){this.stopAll();for(var b=0;b<this._sounds.length;b++)this._sounds[b]&&this._sounds[b].destroy();this._sounds=[];this.onSoundDecode.dispose();this.context&&
window.PhaserGlobal&&(window.PhaserGlobal.audioContext=this.context)}};a.SoundManager.prototype.constructor=a.SoundManager;Object.defineProperty(a.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(b){b?this._muted||(this._codeMuted=!0,this.setMute()):this._muted&&(this._codeMuted=!1,this.unsetMute())}});Object.defineProperty(a.SoundManager.prototype,"volume",{get:function(){return this.usingWebAudio?this.masterGain.gain.value:this._volume},set:function(b){if(this._volume=
b,this.usingWebAudio)this.masterGain.gain.value=b;else for(var a=0;a<this._sounds.length;a++)this._sounds[a].usingAudioTag&&(this._sounds[a].volume*=b)}});a.Utils.Debug=function(b){this.game=b;this.context=this.canvas=this.bmd=this.sprite=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=!0;this.currentY=this.currentX=0;this.currentAlpha=1;this.dirty=!1};a.Utils.Debug.prototype={boot:function(){this.game.renderType===a.CANVAS?this.context=this.game.context:(this.bmd=
this.game.make.bitmapData(this.game.width,this.game.height),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.canvas=a.Canvas.create(this.game.width,this.game.height,"",!0),this.context=this.canvas.getContext("2d"))},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,
this.game.height);this.sprite&&this.bmd.clear()},start:function(b,a,f,d){"number"!=typeof b&&(b=0);"number"!=typeof a&&(a=0);f=f||"rgb(255,255,255)";"undefined"==typeof d&&(d=0);this.currentX=b;this.currentY=a;this.currentColor=f;this.currentAlpha=this.context.globalAlpha;this.columnWidth=d;this.dirty=!0;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=f;this.context.fillStyle=f;this.context.font=this.font;this.context.globalAlpha=1},stop:function(){this.context.restore();
this.context.globalAlpha=this.currentAlpha},line:function(){for(var b=this.currentX,a=0;a<arguments.length;a++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[a],b+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[a],b,this.currentY),b+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(b,a,f,d){this.start(a,f,d);this.line("Sound: "+b.key+" Locked: "+b.game.sound.touchLocked);this.line("Is Ready?: "+
this.game.cache.isSoundReady(b.key)+" Pending Playback: "+b.pendingPlayback);this.line("Decoded: "+b.isDecoded+" Decoding: "+b.isDecoding);this.line("Total Duration: "+b.totalDuration+" Playing: "+b.isPlaying);this.line("Time: "+b.currentTime);this.line("Volume: "+b.volume+" Muted: "+b.mute);this.line("WebAudio: "+b.usingWebAudio+" Audio: "+b.usingAudioTag);""!==b.currentMarker&&(this.line("Marker: "+b.currentMarker+" Duration: "+b.duration+" (ms: "+b.durationMS+")"),this.line("Start: "+b.markers[b.currentMarker].start+
" Stop: "+b.markers[b.currentMarker].stop),this.line("Position: "+b.position));this.stop()},cameraInfo:function(b,a,f,d){this.start(a,f,d);this.line("Camera ("+b.width+" x "+b.height+")");this.line("X: "+b.x+" Y: "+b.y);b.bounds&&this.line("Bounds x: "+b.bounds.x+" Y: "+b.bounds.y+" w: "+b.bounds.width+" h: "+b.bounds.height);this.line("View x: "+b.view.x+" Y: "+b.view.y+" w: "+b.view.width+" h: "+b.view.height);this.line("Total in view: "+b.totalInView);this.stop()},timer:function(b,a,f,d){this.start(a,
f,d);this.line("Timer (running: "+b.running+" expired: "+b.expired+")");this.line("Next Tick: "+b.next+" Duration: "+b.duration);this.line("Paused: "+b.paused+" Length: "+b.length);this.stop()},pointer:function(b,a,f,d,e){null==b||("undefined"==typeof a&&(a=!1),f=f||"rgba(0,255,0,0.5)",d=d||"rgba(255,0,0,0.5)",!0===a&&!0===b.isUp||(this.start(b.x,b.y-100,e),this.context.beginPath(),this.context.arc(b.x,b.y,b.circle.radius,0,2*Math.PI),this.context.fillStyle=b.active?f:d,this.context.fill(),this.context.closePath(),
this.context.beginPath(),this.context.moveTo(b.positionDown.x,b.positionDown.y),this.context.lineTo(b.position.x,b.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+b.id+" Active: "+b.active),this.line("World X: "+b.worldX+" World Y: "+b.worldY),this.line("Screen X: "+b.x+" Screen Y: "+b.y),this.line("Duration: "+b.duration+" ms"),this.line("is Down: "+b.isDown+" is Up: "+b.isUp),this.stop()))},spriteInputInfo:function(b,a,f,d){this.start(a,f,d);
this.line("Sprite Input: ("+b.width+" x "+b.height+")");this.line("x: "+b.input.pointerX().toFixed(1)+" y: "+b.input.pointerY().toFixed(1));this.line("over: "+b.input.pointerOver()+" duration: "+b.input.overDuration().toFixed(0));this.line("down: "+b.input.pointerDown()+" duration: "+b.input.downDuration().toFixed(0));this.line("just over: "+b.input.justOver()+" just out: "+b.input.justOut());this.stop()},key:function(b,a,f,d){this.start(a,f,d,150);this.line("Key:",b.keyCode,"isDown:",b.isDown);this.line("justDown:",
b.justDown,"justUp:",b.justUp);this.line("Time Down:",b.timeDown.toFixed(0),"duration:",b.duration.toFixed(0));this.stop()},inputInfo:function(b,a,f){this.start(b,a,f);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+
this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(b,a,f){b=b.getBounds();b.x+=this.game.camera.x;b.y+=this.game.camera.y;this.rectangle(b,a,f)},ropeSegments:function(b,a,f){b.segments.forEach(function(b){this.rectangle(b,a,f)},this)},spriteInfo:function(b,a,f,d){this.start(a,f,d);this.line("Sprite:  ("+b.width+" x "+b.height+") anchor: "+b.anchor.x+" x "+b.anchor.y);this.line("x: "+b.x.toFixed(1)+" y: "+b.y.toFixed(1));this.line("angle: "+b.angle.toFixed(1)+" rotation: "+b.rotation.toFixed(1));
this.line("visible: "+b.visible+" in camera: "+b.inCamera);this.line("bounds x: "+b._bounds.x.toFixed(1)+" y: "+b._bounds.y.toFixed(1)+" w: "+b._bounds.width.toFixed(1)+" h: "+b._bounds.height.toFixed(1));this.stop()},spriteCoords:function(b,a,f,d){this.start(a,f,d,100);b.name&&this.line(b.name);this.line("x:",b.x.toFixed(2),"y:",b.y.toFixed(2));this.line("pos x:",b.position.x.toFixed(2),"pos y:",b.position.y.toFixed(2));this.line("world x:",b.world.x.toFixed(2),"world y:",b.world.y.toFixed(2));this.stop()},
lineInfo:function(b,a,f,d){this.start(a,f,d,80);this.line("start.x:",b.start.x.toFixed(2),"start.y:",b.start.y.toFixed(2));this.line("end.x:",b.end.x.toFixed(2),"end.y:",b.end.y.toFixed(2));this.line("length:",b.length.toFixed(2),"angle:",b.angle);this.stop()},pixel:function(b,a,f,d){d=d||2;this.start();this.context.fillStyle=f;this.context.fillRect(b,a,d,d);this.stop()},geom:function(b,c,f,d){"undefined"==typeof f&&(f=!0);"undefined"==typeof d&&(d=0);c=c||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=
c;this.context.strokeStyle=c;b instanceof a.Rectangle||1===d?f?this.context.fillRect(b.x-this.game.camera.x,b.y-this.game.camera.y,b.width,b.height):this.context.strokeRect(b.x-this.game.camera.x,b.y-this.game.camera.y,b.width,b.height):b instanceof a.Circle||2===d?(this.context.beginPath(),this.context.arc(b.x-this.game.camera.x,b.y-this.game.camera.y,b.radius,0,2*Math.PI,!1),this.context.closePath(),f?this.context.fill():this.context.stroke()):b instanceof a.Point||3===d?this.context.fillRect(b.x-
this.game.camera.x,b.y-this.game.camera.y,4,4):(b instanceof a.Line||4===d)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(b.start.x+.5-this.game.camera.x,b.start.y+.5-this.game.camera.y),this.context.lineTo(b.end.x+.5-this.game.camera.x,b.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke());this.stop()},rectangle:function(b,a,f){"undefined"==typeof f&&(f=!0);a=a||"rgba(0, 255, 0, 0.4)";this.start();f?(this.context.fillStyle=a,this.context.fillRect(b.x-
this.game.camera.x,b.y-this.game.camera.y,b.width,b.height)):(this.context.strokeStyle=a,this.context.strokeRect(b.x-this.game.camera.x,b.y-this.game.camera.y,b.width,b.height));this.stop()},text:function(b,a,f,d,e){d=d||"rgb(255,255,255)";e=e||"16px Courier";this.start();this.context.font=e;this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(b,a+1,f+1));this.context.fillStyle=d;this.context.fillText(b,a,f);this.stop()},quadTree:function(b,a){a=a||"rgba(255,0,0,0.3)";this.start();
var f=b.bounds;if(0===b.nodes.length)for(this.context.strokeStyle=a,this.context.strokeRect(f.x,f.y,f.width,f.height),this.text("size: "+b.objects.length,f.x+4,f.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)",f=0;f<b.objects.length;f++)this.context.strokeRect(b.objects[f].x,b.objects[f].y,b.objects[f].width,b.objects[f].height);else for(f=0;f<b.nodes.length;f++)this.quadTree(b.nodes[f]);this.stop()},body:function(b,c,f){b.body&&(this.start(),b.body.type===a.Physics.ARCADE?
a.Physics.Arcade.Body.render(this.context,b.body,c,f):b.body.type===a.Physics.NINJA?a.Physics.Ninja.Body.render(this.context,b.body,c,f):b.body.type===a.Physics.BOX2D&&a.Physics.Box2D.renderBody(this.context,b.body,c),this.stop())},bodyInfo:function(b,c,f,d){b.body&&(this.start(c,f,d,210),b.body.type===a.Physics.ARCADE?a.Physics.Arcade.Body.renderBodyInfo(this,b.body):b.body.type===a.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,b.body),this.stop())},box2dWorld:function(){this.start();
this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(b,c){this.start();a.Physics.Box2D.renderBody(this.context,b,c);this.stop()}};a.Utils.Debug.prototype.constructor=a.Utils.Debug;a.ArraySet=function(b){this.position=0;this.list=b||[]};a.ArraySet.prototype={add:function(b){return this.exists(b)||this.list.push(b),b},getIndex:function(b){return this.list.indexOf(b)},getByKey:function(b,a){for(var f=
this.list.length;f--;)if(this.list[f][b]===a)return this.list[f];return null},exists:function(b){return-1<this.list.indexOf(b)},reset:function(){this.list.length=0},remove:function(b){var a=this.list.indexOf(b);return-1<a?(this.list.splice(a,1),b):void 0},setAll:function(b,a){for(var f=this.list.length;f--;)this.list[f]&&(this.list[f][b]=a)},callAll:function(b){for(var a=Array.prototype.splice.call(arguments,1),f=this.list.length;f--;)this.list[f]&&this.list[f][b]&&this.list[f][b].apply(this.list[f],
a)},removeAll:function(b){"undefined"==typeof b&&(b=!1);for(var a=this.list.length;a--;)if(this.list[a]){var f=this.remove(this.list[a]);b&&f.destroy()}this.position=0;this.list=[]}};Object.defineProperty(a.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(a.ArraySet.prototype,"first",{get:function(){return this.position=0,0<this.list.length?this.list[0]:null}});Object.defineProperty(a.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?
(this.position++,this.list[this.position]):null}});a.ArraySet.prototype.constructor=a.ArraySet;a.ArrayList=a.ArraySet;a.ArrayUtils={getRandomItem:function(b,a,f){if(null==b)return null;"undefined"==typeof a&&(a=0);"undefined"==typeof f&&(f=b.length);a+=Math.floor(Math.random()*f);return void 0===b[a]?null:b[a]},removeRandomItem:function(b,a,f){if(null==b)return null;"undefined"==typeof a&&(a=0);"undefined"==typeof f&&(f=b.length);a+=Math.floor(Math.random()*f);return a<b.length?(b=b.splice(a,1),void 0===
b[0]?null:b[0]):null},shuffle:function(b){for(var a=b.length-1;0<a;a--){var f=Math.floor(Math.random()*(a+1)),d=b[a];b[a]=b[f];b[f]=d}return b},transposeMatrix:function(b){for(var a=b.length,f=b[0].length,d=Array(f),e=0;f>e;e++){d[e]=Array(a);for(var p=a-1;-1<p;p--)d[e][p]=b[p][e]}return d},rotateMatrix:function(b,c){if("string"!=typeof c&&(c=(c%360+360)%360),90===c||-270===c||"rotateLeft"===c)b=a.ArrayUtils.transposeMatrix(b),b=b.reverse();else if(-90===c||270===c||"rotateRight"===c)b=b.reverse(),
b=a.ArrayUtils.transposeMatrix(b);else if(180===Math.abs(c)||"rotate180"===c){for(var f=0;f<b.length;f++)b[f].reverse();b=b.reverse()}return b},findClosest:function(b,a){if(!a.length)return 0/0;if(1===a.length||b<a[0])return a[0];for(var f=1;a[f]<b;)f++;var d=a[f-1],f=f<a.length?a[f]:Number.POSITIVE_INFINITY;return b-d>=f-b?f:d},rotate:function(b){var a=b.shift();return b.push(a),a},numberArray:function(b,a){for(var f=[],d=b;a>=d;d++)f.push(d);return f},numberArrayStep:function(b,c,f){b=+b||0;var d=
typeof c;"number"!==d&&"string"!==d||!f||f[c]!==b||(c=f=null);f=null==f?1:+f||0;null===c?(c=b,b=0):c=+c||0;d=-1;c=Math.max(a.Math.roundAwayFromZero((c-b)/(f||1)),0);for(var e=Array(c);++d<c;)e[d]=b,b+=f;return e}};a.Color={packPixel:function(b,c,f,d){return a.Device.LITTLE_ENDIAN?(d<<24|f<<16|c<<8|b)>>>0:(b<<24|c<<16|f<<8|d)>>>0},unpackPixel:function(b,c,f,d){return("undefined"==typeof c||null===c)&&(c=a.Color.createColor()),("undefined"==typeof f||null===f)&&(f=!1),("undefined"==typeof d||null===
d)&&(d=!1),a.Device.LITTLE_ENDIAN?(c.a=(4278190080&b)>>>24,c.b=(16711680&b)>>>16,c.g=(65280&b)>>>8,c.r=255&b):(c.r=(4278190080&b)>>>24,c.g=(16711680&b)>>>16,c.b=(65280&b)>>>8,c.a=255&b),c.color=b,c.rgba="rgba("+c.r+","+c.g+","+c.b+","+c.a/255+")",f&&a.Color.RGBtoHSL(c.r,c.g,c.b,c),d&&a.Color.RGBtoHSV(c.r,c.g,c.b,c),c},fromRGBA:function(b,c){return c||(c=a.Color.createColor()),c.r=(4278190080&b)>>>24,c.g=(16711680&b)>>>16,c.b=(65280&b)>>>8,c.a=255&b,c.rgba="rgba("+c.r+","+c.g+","+c.b+","+c.a+")",c},
toRGBA:function(b,a,f,d){return b<<24|a<<16|f<<8|d},RGBtoHSL:function(b,c,f,d){d||(d=a.Color.createColor(b,c,f,1));b/=255;c/=255;f/=255;var e=Math.min(b,c,f),p=Math.max(b,c,f);if(d.h=0,d.s=0,d.l=(p+e)/2,p!==e){var l=p-e;d.s=.5<d.l?l/(2-p-e):l/(p+e);p===b?d.h=(c-f)/l+(f>c?6:0):p===c?d.h=(f-b)/l+2:p===f&&(d.h=(b-c)/l+4);d.h/=6}return d},HSLtoRGB:function(b,c,f,d){if(d?(d.r=f,d.g=f,d.b=f):d=a.Color.createColor(f,f,f),0!==c)c=.5>f?f*(1+c):f+c-f*c,f=2*f-c,d.r=a.Color.hueToColor(f,c,b+1/3),d.g=a.Color.hueToColor(f,
c,b),d.b=a.Color.hueToColor(f,c,b-1/3);return d.r=Math.floor(255*d.r|0),d.g=Math.floor(255*d.g|0),d.b=Math.floor(255*d.b|0),a.Color.updateColor(d),d},RGBtoHSV:function(b,c,f,d){d||(d=a.Color.createColor(b,c,f,255));b/=255;c/=255;f/=255;var e=Math.min(b,c,f),p=Math.max(b,c,f),l=p-e;return d.h=0,d.s=0===p?0:l/p,d.v=p,p!==e&&(p===b?d.h=(c-f)/l+(f>c?6:0):p===c?d.h=(f-b)/l+2:p===f&&(d.h=(b-c)/l+4),d.h/=6),d},HSVtoRGB:function(b,c,f,d){"undefined"==typeof d&&(d=a.Color.createColor(0,0,0,1,b,c,0,f));var e,
p,l,g=Math.floor(6*b),h=6*b-g;b=f*(1-c);var k=f*(1-h*c);c=f*(1-(1-h)*c);switch(g%6){case 0:e=f;p=c;l=b;break;case 1:e=k;p=f;l=b;break;case 2:e=b;p=f;l=c;break;case 3:e=b;p=k;l=f;break;case 4:e=c;p=b;l=f;break;case 5:e=f,p=b,l=k}return d.r=Math.floor(255*e),d.g=Math.floor(255*p),d.b=Math.floor(255*l),a.Color.updateColor(d),d},hueToColor:function(b,a,f){return 0>f&&(f+=1),1<f&&--f,1/6>f?b+6*(a-b)*f:.5>f?a:2/3>f?b+(a-b)*(2/3-f)*6:b},createColor:function(b,c,f,d,e,p,l,g){b={r:b||0,g:c||0,b:f||0,a:d||
1,h:e||0,s:p||0,l:l||0,v:g||0,color:0,color32:0,rgba:""};return b.color=a.Color.getColor(b.r,b.g,b.b),b.color32=a.Color.getColor32(b.a,b.r,b.g,b.b),a.Color.updateColor(b)},updateColor:function(b){return b.rgba="rgba("+b.r.toString()+","+b.g.toString()+","+b.b.toString()+","+b.a.toString()+")",b},getColor32:function(b,a,f,d){return b<<24|a<<16|f<<8|d},getColor:function(b,a,f){return b<<16|a<<8|f},RGBtoString:function(b,c,f,d,e){return"undefined"==typeof d&&(d=255),"undefined"==typeof e&&(e="#"),"#"===
e?"#"+(16777216+(b<<16)+(c<<8)+f).toString(16).slice(1):"0x"+a.Color.componentToHex(d)+a.Color.componentToHex(b)+a.Color.componentToHex(c)+a.Color.componentToHex(f)},hexToRGB:function(b){return(b=a.Color.hexToColor(b))?a.Color.getColor32(b.a,b.r,b.g,b.b):void 0},hexToColor:function(b,c){b=b.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(b,a,c,d){return a+a+c+c+d+d});var f=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);if(f){var d=parseInt(f[1],16),e=parseInt(f[2],16),f=parseInt(f[3],
16);c?(c.r=d,c.g=e,c.b=f):c=a.Color.createColor(d,e,f)}return c},webToColor:function(b,c){c||(c=a.Color.createColor());var f=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(b);return f&&(c.r=parseInt(f[1],10),c.g=parseInt(f[2],10),c.b=parseInt(f[3],10),c.a=void 0!==f[4]?parseFloat(f[4]):1),c},valueToColor:function(b,c){if(c||(c=a.Color.createColor()),"string"==typeof b)return 0===b.indexOf("rgb")?a.Color.webToColor(b,c):(c.a=1,a.Color.hexToColor(b,c));if("number"==
typeof b){var f=a.Color.getRGB(b);return c.r=f.r,c.g=f.g,c.b=f.b,c.a=f.a/255,c}return c},componentToHex:function(b){b=b.toString(16);return 1==b.length?"0"+b:b},HSVColorWheel:function(b,c){"undefined"==typeof b&&(b=1);"undefined"==typeof c&&(c=1);for(var f=[],d=0;359>=d;d++)f.push(a.Color.HSVtoRGB(d/359,b,c));return f},HSLColorWheel:function(b,c){"undefined"==typeof b&&(b=.5);"undefined"==typeof c&&(c=.5);for(var f=[],d=0;359>=d;d++)f.push(a.Color.HSLtoRGB(d/359,b,c));return f},interpolateColor:function(b,
c,f,d,e){"undefined"==typeof e&&(e=255);b=a.Color.getRGB(b);c=a.Color.getRGB(c);return a.Color.getColor32(e,(c.red-b.red)*d/f+b.red,(c.green-b.green)*d/f+b.green,(c.blue-b.blue)*d/f+b.blue)},interpolateColorWithRGB:function(b,c,f,d,e,p){b=a.Color.getRGB(b);return a.Color.getColor((c-b.red)*p/e+b.red,(f-b.green)*p/e+b.green,(d-b.blue)*p/e+b.blue)},interpolateRGB:function(b,c,f,d,e,p,l,g){return a.Color.getColor((d-b)*g/l+b,(e-c)*g/l+c,(p-f)*g/l+f)},getRandomColor:function(b,c,f){if("undefined"==typeof b&&
(b=0),"undefined"==typeof c&&(c=255),"undefined"==typeof f&&(f=255),255<c||b>c)return a.Color.getColor(255,255,255);var d=b+Math.round(Math.random()*(c-b)),e=b+Math.round(Math.random()*(c-b));b+=Math.round(Math.random()*(c-b));return a.Color.getColor32(f,d,e,b)},getRGB:function(b){return 16777215<b?{alpha:b>>>24,red:b>>16&255,green:b>>8&255,blue:255&b,a:b>>>24,r:b>>16&255,g:b>>8&255,b:255&b}:{alpha:255,red:b>>16&255,green:b>>8&255,blue:255&b,a:255,r:b>>16&255,g:b>>8&255,b:255&b}},getWebRGB:function(b){if("object"==
typeof b)return"rgba("+b.r.toString()+","+b.g.toString()+","+b.b.toString()+","+(b.a/255).toString()+")";b=a.Color.getRGB(b);return"rgba("+b.r.toString()+","+b.g.toString()+","+b.b.toString()+","+(b.a/255).toString()+")"},getAlpha:function(b){return b>>>24},getAlphaFloat:function(b){return(b>>>24)/255},getRed:function(b){return b>>16&255},getGreen:function(b){return b>>8&255},getBlue:function(b){return 255&b}};a.LinkedList=function(){this.last=this.first=this.prev=this.next=null;this.total=0};a.LinkedList.prototype=
{add:function(b){return 0===this.total&&null===this.first&&null===this.last?(this.first=b,this.last=b,this.next=b,b.prev=this,this.total++,b):(this.last.next=b,b.prev=this.last,this.last=b,this.total++,b)},reset:function(){this.prev=this.next=this.last=this.first=null;this.total=0},remove:function(b){return 1===this.total?(this.reset(),void(b.next=b.prev=null)):(b===this.first?this.first=this.first.next:b===this.last&&(this.last=this.last.prev),b.prev&&(b.prev.next=b.next),b.next&&(b.next.prev=b.prev),
b.next=b.prev=null,null===this.first&&(this.last=null),void this.total--)},callAll:function(b){if(this.first&&this.last){var a=this.first;do a&&a[b]&&a[b].call(a),a=a.next;while(a!=this.last.next)}}};a.LinkedList.prototype.constructor=a.LinkedList;a.Physics=function(b,a){a=a||{};this.game=b;this.config=a;this.chipmunk=this.box2d=this.ninja=this.p2=this.arcade=null;this.parseConfig()};a.Physics.ARCADE=0;a.Physics.P2JS=1;a.Physics.NINJA=2;a.Physics.BOX2D=3;a.Physics.CHIPMUNK=4;a.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&
!0!==this.config.arcade||!a.Physics.hasOwnProperty("Arcade")||(this.arcade=new a.Physics.Arcade(this.game),this.game.time.deltaCap=.2);this.config.hasOwnProperty("ninja")&&!0===this.config.ninja&&a.Physics.hasOwnProperty("Ninja")&&(this.ninja=new a.Physics.Ninja(this.game));this.config.hasOwnProperty("p2")&&!0===this.config.p2&&a.Physics.hasOwnProperty("P2")&&(this.p2=new a.Physics.P2(this.game,this.config));this.config.hasOwnProperty("box2d")&&!0===this.config.box2d&&a.Physics.hasOwnProperty("BOX2D")&&
(this.box2d=new a.Physics.BOX2D(this.game,this.config))},startSystem:function(b){b===a.Physics.ARCADE?this.arcade=new a.Physics.Arcade(this.game):b===a.Physics.P2JS?null===this.p2?this.p2=new a.Physics.P2(this.game,this.config):this.p2.reset():b===a.Physics.NINJA?this.ninja=new a.Physics.Ninja(this.game):b===a.Physics.BOX2D&&(null===this.box2d?this.box2d=new a.Physics.Box2D(this.game,this.config):this.box2d.reset())},enable:function(b,c,f){"undefined"==typeof c&&(c=a.Physics.ARCADE);"undefined"==
typeof f&&(f=!1);c===a.Physics.ARCADE?this.arcade.enable(b):c===a.Physics.P2JS&&this.p2?this.p2.enable(b,f):c===a.Physics.NINJA&&this.ninja?this.ninja.enableAABB(b):c===a.Physics.BOX2D&&this.box2d&&this.box2d.enable(b)},preUpdate:function(){this.p2&&this.p2.preUpdate();this.box2d&&this.box2d.preUpdate()},update:function(){this.p2&&this.p2.update();this.box2d&&this.box2d.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld();this.ninja&&this.ninja.setBoundsToWorld();this.p2&&
this.p2.setBoundsToWorld();this.box2d&&this.box2d.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear();this.box2d&&this.box2d.clear()},reset:function(){this.p2&&this.p2.reset();this.box2d&&this.box2d.reset()},destroy:function(){this.p2&&this.p2.destroy();this.box2d&&this.box2d.destroy();this.box2d=this.p2=this.ninja=this.arcade=null}};a.Physics.prototype.constructor=a.Physics;a.Physics.Arcade=function(b){this.game=b;this.gravity=new a.Point;this.bounds=new a.Rectangle(0,0,b.world.width,b.world.height);
this.checkCollision={up:!0,down:!0,left:!0,right:!0};this.maxObjects=10;this.OVERLAP_BIAS=this.maxLevels=4;this.forceX=!1;this.sortDirection=a.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=!0;this.isPaused=!1;this.quadTree=new a.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};a.Physics.Arcade.prototype.constructor=a.Physics.Arcade;a.Physics.Arcade.SORT_NONE=0;
a.Physics.Arcade.LEFT_RIGHT=1;a.Physics.Arcade.RIGHT_LEFT=2;a.Physics.Arcade.TOP_BOTTOM=3;a.Physics.Arcade.BOTTOM_TOP=4;a.Physics.Arcade.prototype={setBounds:function(b,a,f,d){this.bounds.setTo(b,a,f,d)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(b,c){"undefined"==typeof c&&(c=!0);var f=1;if(Array.isArray(b))for(f=b.length;f--;)b[f]instanceof a.Group?this.enable(b[f].children,
c):(this.enableBody(b[f]),c&&b[f].hasOwnProperty("children")&&0<b[f].children.length&&this.enable(b[f],!0));else b instanceof a.Group?this.enable(b.children,c):(this.enableBody(b),c&&b.hasOwnProperty("children")&&0<b.children.length&&this.enable(b.children,!0))},enableBody:function(b){b.hasOwnProperty("body")&&null===b.body&&(b.body=new a.Physics.Arcade.Body(b))},updateMotion:function(b){var a=this.computeVelocity(0,b,b.angularVelocity,b.angularAcceleration,b.angularDrag,b.maxAngular)-b.angularVelocity;
b.angularVelocity+=a;b.rotation+=b.angularVelocity*this.game.time.physicsElapsed;b.velocity.x=this.computeVelocity(1,b,b.velocity.x,b.acceleration.x,b.drag.x,b.maxVelocity.x);b.velocity.y=this.computeVelocity(2,b,b.velocity.y,b.acceleration.y,b.drag.y,b.maxVelocity.y)},computeVelocity:function(b,a,f,d,e,p){return"undefined"==typeof p&&(p=1E4),1===b&&a.allowGravity?f+=(this.gravity.x+a.gravity.x)*this.game.time.physicsElapsed:2===b&&a.allowGravity&&(f+=(this.gravity.y+a.gravity.y)*this.game.time.physicsElapsed),
d?f+=d*this.game.time.physicsElapsed:e&&(e*=this.game.time.physicsElapsed,0<f-e?f-=e:0>f+e?f+=e:f=0),f>p?f=p:-p>f&&(f=-p),f},overlap:function(b,a,f,d,e){if(f=f||null,d=d||null,e=e||f,this._total=0,!Array.isArray(b)&&Array.isArray(a))for(var p=0;p<a.length;p++)this.collideHandler(b,a[p],f,d,e,!0);else if(Array.isArray(b)&&!Array.isArray(a))for(p=0;p<b.length;p++)this.collideHandler(b[p],a,f,d,e,!0);else if(Array.isArray(b)&&Array.isArray(a))for(p=0;p<b.length;p++)for(var l=0;l<a.length;l++)this.collideHandler(b[p],
a[l],f,d,e,!0);else this.collideHandler(b,a,f,d,e,!0);return 0<this._total},collide:function(b,a,f,d,e){if(f=f||null,d=d||null,e=e||f,this._total=0,!Array.isArray(b)&&Array.isArray(a))for(var p=0;p<a.length;p++)this.collideHandler(b,a[p],f,d,e,!1);else if(Array.isArray(b)&&!Array.isArray(a))for(p=0;p<b.length;p++)this.collideHandler(b[p],a,f,d,e,!1);else if(Array.isArray(b)&&Array.isArray(a))for(p=0;p<b.length;p++)for(var l=0;l<a.length;l++)this.collideHandler(b[p],a[l],f,d,e,!1);else this.collideHandler(b,
a,f,d,e,!1);return 0<this._total},sort:function(b){this.sortDirection===a.Physics.Arcade.LEFT_RIGHT?b._hash.sort(function(b,a){return b.body&&a.body?b.body.x-a.body.x:-1}):this.sortDirection===a.Physics.Arcade.RIGHT_LEFT?b._hash.sort(function(b,a){return b.body&&a.body?a.body.x-b.body.x:-1}):this.sortDirection===a.Physics.Arcade.TOP_BOTTOM?b._hash.sort(function(b,a){return b.body&&a.body?b.body.y-a.body.y:-1}):this.sortDirection===a.Physics.Arcade.BOTTOM_TOP&&b._hash.sort(function(b,a){return b.body&&
a.body?a.body.y-b.body.y:-1})},collideHandler:function(b,c,f,d,e,p){return"undefined"==typeof c&&b.physicsType===a.GROUP?(this.sort(b),void this.collideGroupVsSelf(b,f,d,e,p)):void(b&&c&&b.exists&&c.exists&&(this.sortDirection!==a.Physics.Arcade.SORT_NONE&&(b.physicsType===a.GROUP&&this.sort(b),c.physicsType===a.GROUP&&this.sort(c)),b.physicsType===a.SPRITE?c.physicsType===a.SPRITE?this.collideSpriteVsSprite(b,c,f,d,e,p):c.physicsType===a.GROUP?this.collideSpriteVsGroup(b,c,f,d,e,p):c.physicsType===
a.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(b,c,f,d,e):b.physicsType===a.GROUP?c.physicsType===a.SPRITE?this.collideSpriteVsGroup(c,b,f,d,e,p):c.physicsType===a.GROUP?this.collideGroupVsGroup(b,c,f,d,e,p):c.physicsType===a.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(b,c,f,d,e,p):b.physicsType===a.TILEMAPLAYER&&(c.physicsType===a.SPRITE?this.collideSpriteVsTilemapLayer(c,b,f,d,e,p):c.physicsType===a.GROUP&&this.collideGroupVsTilemapLayer(c,b,f,d,e,p))))},collideSpriteVsSprite:function(b,a,f,
d,e,p){return b.body&&a.body?(this.separate(b.body,a.body,d,e,p)&&(f&&f.call(e,b,a),this._total++),!0):!1},collideSpriteVsGroup:function(b,c,f,d,e,p){if(0!==c.length&&b.body)if(this.skipQuadTree||b.body.skipQuadTree)for(var l=0;l<c._hash.length;l++){if(c._hash[l]&&c._hash[l].exists&&c._hash[l].body){if(this.sortDirection===a.Physics.Arcade.LEFT_RIGHT){if(b.body.right<c._hash[l].body.x)break;if(c._hash[l].body.right<b.body.x)continue}else if(this.sortDirection===a.Physics.Arcade.RIGHT_LEFT){if(b.body.x>
c._hash[l].body.right)break;if(c._hash[l].body.x>b.body.right)continue}else if(this.sortDirection===a.Physics.Arcade.TOP_BOTTOM){if(b.body.bottom<c._hash[l].body.y)break;if(c._hash[l].body.bottom<b.body.y)continue}else if(this.sortDirection===a.Physics.Arcade.BOTTOM_TOP){if(b.body.y>c._hash[l].body.bottom)break;if(c._hash[l].body.y>b.body.bottom)continue}this.collideSpriteVsSprite(b,c._hash[l],f,d,e,p)}}else for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,
this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(c),c=this.quadTree.retrieve(b),l=0;l<c.length;l++)this.separate(b.body,c[l],d,e,p)&&(f&&f.call(e,b,c[l].sprite),this._total++)},collideGroupVsSelf:function(b,c,f,d,e){if(0!==b.length)for(var p=0;p<b._hash.length;p++)if(b._hash[p]&&b._hash[p].exists&&b._hash[p].body)for(var l=b._hash[p],g=p+1;g<b._hash.length;g++)if(b._hash[g]&&b._hash[g].exists&&b._hash[g].body){var h=b._hash[g];if(this.sortDirection===
a.Physics.Arcade.LEFT_RIGHT){if(l.body.right<h.body.x)break;if(h.body.right<l.body.x)continue}else if(this.sortDirection===a.Physics.Arcade.RIGHT_LEFT){if(l.body.x>h.body.right)continue;if(h.body.x>l.body.right)break}else if(this.sortDirection===a.Physics.Arcade.TOP_BOTTOM){if(l.body.bottom<h.body.y)continue;if(h.body.bottom<l.body.y)break}else if(this.sortDirection===a.Physics.Arcade.BOTTOM_TOP){if(l.body.y>h.body.bottom)continue;if(h.body.y>l.body.bottom)break}this.collideSpriteVsSprite(l,h,c,f,
d,e)}},collideGroupVsGroup:function(b,c,f,d,e,p){if(0!==b.length&&0!==c.length)for(var l=0;l<b.children.length;l++)b.children[l].exists&&(b.children[l].physicsType===a.GROUP?this.collideGroupVsGroup(b.children[l],c,f,d,e,p):this.collideSpriteVsGroup(b.children[l],c,f,d,e,p))},separate:function(b,a,f,d,e){if(!b.enable||!a.enable||!this.intersects(b,a)||f&&!1===f.call(d,b.sprite,a.sprite))return!1;f=!1;return f=this.forceX||Math.abs(this.gravity.y+b.gravity.y)<Math.abs(this.gravity.x+b.gravity.x)?this.separateX(b,
a,e)||this.separateY(b,a,e):this.separateY(b,a,e)||this.separateX(b,a,e),e?!0:f},intersects:function(b,a){return b.right<=a.position.x?!1:b.bottom<=a.position.y?!1:b.position.x>=a.right?!1:b.position.y>=a.bottom?!1:!0},separateX:function(b,a,f){if(b.immovable&&a.immovable)return!1;var d=0;if(this.intersects(b,a)){var e=b.deltaAbsX()+a.deltaAbsX()+this.OVERLAP_BIAS;if(0===b.deltaX()&&0===a.deltaX()?(b.embedded=!0,a.embedded=!0):b.deltaX()>a.deltaX()?(d=b.right-a.x,d>e||!1===b.checkCollision.right||
!1===a.checkCollision.left?d=0:(b.touching.none=!1,b.touching.right=!0,a.touching.none=!1,a.touching.left=!0)):b.deltaX()<a.deltaX()&&(d=b.x-a.width-a.x,-d>e||!1===b.checkCollision.left||!1===a.checkCollision.right?d=0:(b.touching.none=!1,b.touching.left=!0,a.touching.none=!1,a.touching.right=!0)),b.overlapX=d,a.overlapX=d,0!==d){if(f||b.customSeparateX||a.customSeparateX)return!0;f=b.velocity.x;e=a.velocity.x;b.immovable||a.immovable?b.immovable?a.immovable||(a.x+=d,a.velocity.x=f-e*a.bounce.x,b.moves&&
(a.y+=(b.y-b.prev.y)*b.friction.y)):(b.x-=d,b.velocity.x=e-f*b.bounce.x,a.moves&&(b.y+=(a.y-a.prev.y)*a.friction.y)):(d*=.5,b.x-=d,a.x+=d,d=Math.sqrt(e*e*a.mass/b.mass)*(0<e?1:-1),f=Math.sqrt(f*f*b.mass/a.mass)*(0<f?1:-1),e=.5*(d+f),b.velocity.x=e+(d-e)*b.bounce.x,a.velocity.x=e+(f-e)*a.bounce.x);return!0}}return!1},separateY:function(b,a,f){if(b.immovable&&a.immovable)return!1;var d=0;if(this.intersects(b,a)){var e=b.deltaAbsY()+a.deltaAbsY()+this.OVERLAP_BIAS;if(0===b.deltaY()&&0===a.deltaY()?(b.embedded=
!0,a.embedded=!0):b.deltaY()>a.deltaY()?(d=b.bottom-a.y,d>e||!1===b.checkCollision.down||!1===a.checkCollision.up?d=0:(b.touching.none=!1,b.touching.down=!0,a.touching.none=!1,a.touching.up=!0)):b.deltaY()<a.deltaY()&&(d=b.y-a.bottom,-d>e||!1===b.checkCollision.up||!1===a.checkCollision.down?d=0:(b.touching.none=!1,b.touching.up=!0,a.touching.none=!1,a.touching.down=!0)),b.overlapY=d,a.overlapY=d,0!==d){if(f||b.customSeparateY||a.customSeparateY)return!0;f=b.velocity.y;e=a.velocity.y;b.immovable||
a.immovable?b.immovable?a.immovable||(a.y+=d,a.velocity.y=f-e*a.bounce.y,b.moves&&(a.x+=(b.x-b.prev.x)*b.friction.x)):(b.y-=d,b.velocity.y=e-f*b.bounce.y,a.moves&&(b.x+=(a.x-a.prev.x)*a.friction.x)):(d*=.5,b.y-=d,a.y+=d,d=Math.sqrt(e*e*a.mass/b.mass)*(0<e?1:-1),f=Math.sqrt(f*f*b.mass/a.mass)*(0<f?1:-1),e=.5*(d+f),b.velocity.y=e+(d-e)*b.bounce.y,a.velocity.y=e+(f-e)*a.bounce.y);return!0}}return!1},getObjectsUnderPointer:function(b,a,f,d){return 0!==a.length&&b.exists?this.getObjectsAtLocation(b.x,
b.y,a,f,d,b):void 0},getObjectsAtLocation:function(b,c,f,d,e,p){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(f);var l=new a.Rectangle(b,c,1,1);f=[];for(var l=this.quadTree.retrieve(l),g=0;g<l.length;g++)l[g].hitTest(b,c)&&(d&&d.call(e,p,l[g].sprite),f.push(l[g].sprite));return f},moveToObject:function(b,a,f,d){"undefined"==typeof f&&(f=60);
"undefined"==typeof d&&(d=0);var e=Math.atan2(a.y-b.y,a.x-b.x);return 0<d&&(f=this.distanceBetween(b,a)/(d/1E3)),b.body.velocity.x=Math.cos(e)*f,b.body.velocity.y=Math.sin(e)*f,e},moveToPointer:function(b,a,f,d){"undefined"==typeof a&&(a=60);f=f||this.game.input.activePointer;"undefined"==typeof d&&(d=0);var e=this.angleToPointer(b,f);return 0<d&&(a=this.distanceToPointer(b,f)/(d/1E3)),b.body.velocity.x=Math.cos(e)*a,b.body.velocity.y=Math.sin(e)*a,e},moveToXY:function(b,a,f,d,e){"undefined"==typeof d&&
(d=60);"undefined"==typeof e&&(e=0);var p=Math.atan2(f-b.y,a-b.x);return 0<e&&(d=this.distanceToXY(b,a,f)/(e/1E3)),b.body.velocity.x=Math.cos(p)*d,b.body.velocity.y=Math.sin(p)*d,p},velocityFromAngle:function(b,c,f){return"undefined"==typeof c&&(c=60),f=f||new a.Point,f.setTo(Math.cos(this.game.math.degToRad(b))*c,Math.sin(this.game.math.degToRad(b))*c)},velocityFromRotation:function(b,c,f){return"undefined"==typeof c&&(c=60),f=f||new a.Point,f.setTo(Math.cos(b)*c,Math.sin(b)*c)},accelerationFromRotation:function(b,
c,f){return"undefined"==typeof c&&(c=60),f=f||new a.Point,f.setTo(Math.cos(b)*c,Math.sin(b)*c)},accelerateToObject:function(b,a,f,d,e){"undefined"==typeof f&&(f=60);"undefined"==typeof d&&(d=1E3);"undefined"==typeof e&&(e=1E3);a=this.angleBetween(b,a);return b.body.acceleration.setTo(Math.cos(a)*f,Math.sin(a)*f),b.body.maxVelocity.setTo(d,e),a},accelerateToPointer:function(b,a,f,d,e){"undefined"==typeof f&&(f=60);"undefined"==typeof a&&(a=this.game.input.activePointer);"undefined"==typeof d&&(d=1E3);
"undefined"==typeof e&&(e=1E3);a=this.angleToPointer(b,a);return b.body.acceleration.setTo(Math.cos(a)*f,Math.sin(a)*f),b.body.maxVelocity.setTo(d,e),a},accelerateToXY:function(b,a,f,d,e,p){"undefined"==typeof d&&(d=60);"undefined"==typeof e&&(e=1E3);"undefined"==typeof p&&(p=1E3);a=this.angleToXY(b,a,f);return b.body.acceleration.setTo(Math.cos(a)*d,Math.sin(a)*d),b.body.maxVelocity.setTo(e,p),a},distanceBetween:function(b,a){var f=b.x-a.x,d=b.y-a.y;return Math.sqrt(f*f+d*d)},distanceToXY:function(b,
a,f){a=b.x-a;b=b.y-f;return Math.sqrt(a*a+b*b)},distanceToPointer:function(b,a){a=a||this.game.input.activePointer;var f=b.x-a.worldX,d=b.y-a.worldY;return Math.sqrt(f*f+d*d)},angleBetween:function(b,a){return Math.atan2(a.y-b.y,a.x-b.x)},angleToXY:function(b,a,f){return Math.atan2(f-b.y,a-b.x)},angleToPointer:function(b,a){a=a||this.game.input.activePointer;return Math.atan2(a.worldY-b.y,a.worldX-b.x)}};a.Physics.Arcade.Body=function(b){this.sprite=b;this.game=b.game;this.type=a.Physics.ARCADE;this.enable=
!0;this.offset=new a.Point;this.position=new a.Point(b.x,b.y);this.prev=new a.Point(this.position.x,this.position.y);this.allowRotation=!0;this.preRotation=this.rotation=b.rotation;this.width=b.width;this.height=b.height;this.sourceWidth=b.width;this.sourceHeight=b.height;b.texture&&(this.sourceWidth=b.texture.frame.width,this.sourceHeight=b.texture.frame.height);this.halfWidth=Math.abs(b.width/2);this.halfHeight=Math.abs(b.height/2);this.center=new a.Point(b.x+this.halfWidth,b.y+this.halfHeight);
this.velocity=new a.Point;this.newVelocity=new a.Point(0,0);this.deltaMax=new a.Point(0,0);this.acceleration=new a.Point;this.drag=new a.Point;this.allowGravity=!0;this.gravity=new a.Point(0,0);this.bounce=new a.Point;this.maxVelocity=new a.Point(1E4,1E4);this.friction=new a.Point(1,0);this.angularDrag=this.angularAcceleration=this.angularVelocity=0;this.maxAngular=1E3;this.mass=1;this.speed=this.angle=0;this.facing=a.NONE;this.immovable=!1;this.moves=!0;this.customSeparateY=this.customSeparateX=
!1;this.overlapY=this.overlapX=0;this.collideWorldBounds=this.embedded=!1;this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0};this.touching={none:!0,up:!1,down:!1,left:!1,right:!1};this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1};this.blocked={up:!1,down:!1,left:!1,right:!1};this.tilePadding=new a.Point;this.skipQuadTree=this.dirty=!1;this._reset=!0;this._sx=b.scale.x;this._sy=b.scale.y;this._dy=this._dx=0};a.Physics.Arcade.Body.prototype={updateBounds:function(){var b=Math.abs(this.sprite.scale.x),
a=Math.abs(this.sprite.scale.y);(b!==this._sx||a!==this._sy)&&(this.width=this.sourceWidth*b,this.height=this.sourceHeight*a,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this._sx=b,this._sy=a,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this._reset=!0)},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=
this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y,this.rotation=
this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,(this.position.x!==this.prev.x||this.position.y!==this.prev.y)&&(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+
this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds()),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},postUpdate:function(){this.enable&&this.dirty&&(this.dirty=!1,0>this.deltaX()?this.facing=a.LEFT:0<this.deltaX()&&(this.facing=a.RIGHT),0>this.deltaY()?this.facing=a.UP:0<this.deltaY()&&(this.facing=a.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&
(0>this._dx&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:0<this._dx&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(0>this._dy&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:0<this._dy&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=
this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},destroy:function(){this.sprite=this.sprite.body=null},checkWorldBounds:function(){this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left?(this.position.x=this.game.physics.arcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0):this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right&&(this.position.x=this.game.physics.arcade.bounds.right-
this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0);this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up?(this.position.y=this.game.physics.arcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0):this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down&&(this.position.y=this.game.physics.arcade.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0)},setSize:function(b,
a,f,d){"undefined"==typeof f&&(f=this.offset.x);"undefined"==typeof d&&(d=this.offset.y);this.sourceWidth=b;this.sourceHeight=a;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(f,d);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(b,a){this.velocity.set(0);this.acceleration.set(0);this.angularAcceleration=this.angularVelocity=
this.speed=0;this.position.x=b-this.sprite.anchor.x*this.width+this.offset.x;this.position.y=a-this.sprite.anchor.y*this.height+this.offset.y;this.prev.x=this.position.x;this.prev.y=this.position.y;this.preRotation=this.rotation=this.sprite.angle;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(b,c){return a.Rectangle.contains(this,b,c)},onFloor:function(){return this.blocked.down},onWall:function(){return this.blocked.left||
this.blocked.right},deltaAbsX:function(){return 0<this.deltaX()?this.deltaX():-this.deltaX()},deltaAbsY:function(){return 0<this.deltaY()?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}};Object.defineProperty(a.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(a.Physics.Arcade.Body.prototype,
"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(a.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(b){this.position.x=b}});Object.defineProperty(a.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(b){this.position.y=b}});a.Physics.Arcade.Body.render=function(b,a,f,d){"undefined"==typeof d&&(d=!0);f=f||"rgba(0,255,0,0.4)";d?(b.fillStyle=f,b.fillRect(a.position.x-a.game.camera.x,a.position.y-
a.game.camera.y,a.width,a.height)):(b.strokeStyle=f,b.strokeRect(a.position.x-a.game.camera.x,a.position.y-a.game.camera.y,a.width,a.height))};a.Physics.Arcade.Body.renderBodyInfo=function(b,a){b.line("x: "+a.x.toFixed(2),"y: "+a.y.toFixed(2),"width: "+a.width,"height: "+a.height);b.line("velocity x: "+a.velocity.x.toFixed(2),"y: "+a.velocity.y.toFixed(2),"deltaX: "+a._dx.toFixed(2),"deltaY: "+a._dy.toFixed(2));b.line("acceleration x: "+a.acceleration.x.toFixed(2),"y: "+a.acceleration.y.toFixed(2),
"speed: "+a.speed.toFixed(2),"angle: "+a.angle.toFixed(2));b.line("gravity x: "+a.gravity.x,"y: "+a.gravity.y,"bounce x: "+a.bounce.x.toFixed(2),"y: "+a.bounce.y.toFixed(2));b.line("touching left: "+a.touching.left,"right: "+a.touching.right,"up: "+a.touching.up,"down: "+a.touching.down);b.line("blocked left: "+a.blocked.left,"right: "+a.blocked.right,"up: "+a.blocked.up,"down: "+a.blocked.down)};a.Physics.Arcade.Body.prototype.constructor=a.Physics.Arcade.Body;a.Physics.Arcade.TilemapCollision=function(){};
a.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(b,a,f,d,e){if(b.body&&(a=a.getTiles(b.body.position.x-b.body.tilePadding.x,b.body.position.y-b.body.tilePadding.y,b.body.width+b.body.tilePadding.x,b.body.height+b.body.tilePadding.y,!1,!1),0!==a.length))for(var p=0;p<a.length;p++)d?d.call(e,b,a[p])&&this.separateTile(p,b.body,a[p])&&(this._total++,f&&f.call(e,b,a[p])):this.separateTile(p,b.body,a[p])&&(this._total++,f&&f.call(e,b,a[p]))},collideGroupVsTilemapLayer:function(b,
a,f,d,e){if(0!==b.length)for(var p=0;p<b.children.length;p++)b.children[p].exists&&this.collideSpriteVsTilemapLayer(b.children[p],a,f,d,e)},separateTile:function(b,a,f){if(!a.enable||!f.intersects(a.position.x,a.position.y,a.right,a.bottom)||f.collisionCallback&&!f.collisionCallback.call(f.collisionCallbackContext,a.sprite,f)||f.layer.callbacks[f.index]&&!f.layer.callbacks[f.index].callback.call(f.layer.callbacks[f.index].callbackContext,a.sprite,f)||!(f.faceLeft||f.faceRight||f.faceTop||f.faceBottom))return!1;
var d=b=0,e=0,p=1;if(a.deltaAbsX()>a.deltaAbsY()?e=-1:a.deltaAbsX()<a.deltaAbsY()&&(p=-1),0!==a.deltaX()&&0!==a.deltaY()&&(f.faceLeft||f.faceRight)&&(f.faceTop||f.faceBottom)&&(e=Math.min(Math.abs(a.position.x-f.right),Math.abs(a.right-f.left)),p=Math.min(Math.abs(a.position.y-f.bottom),Math.abs(a.bottom-f.top))),p>e){if((f.faceLeft||f.faceRight)&&(b=this.tileCheckX(a,f),0!==b&&!f.intersects(a.position.x,a.position.y,a.right,a.bottom)))return!0;(f.faceTop||f.faceBottom)&&(d=this.tileCheckY(a,f))}else{if((f.faceTop||
f.faceBottom)&&(d=this.tileCheckY(a,f),0!==d&&!f.intersects(a.position.x,a.position.y,a.right,a.bottom)))return!0;(f.faceLeft||f.faceRight)&&(b=this.tileCheckX(a,f))}return 0!==b||0!==d},tileCheckX:function(b,a){var f=0;return 0>b.deltaX()&&!b.blocked.left&&a.collideRight&&b.checkCollision.left?a.faceRight&&b.x<a.right&&(f=b.x-a.right,f<-this.TILE_BIAS&&(f=0)):0<b.deltaX()&&!b.blocked.right&&a.collideLeft&&b.checkCollision.right&&a.faceLeft&&b.right>a.left&&(f=b.right-a.left,f>this.TILE_BIAS&&(f=
0)),0!==f&&(b.customSeparateX?b.overlapX=f:this.processTileSeparationX(b,f)),f},tileCheckY:function(b,a){var f=0;return 0>b.deltaY()&&!b.blocked.up&&a.collideDown&&b.checkCollision.up?a.faceBottom&&b.y<a.bottom&&(f=b.y-a.bottom,f<-this.TILE_BIAS&&(f=0)):0<b.deltaY()&&!b.blocked.down&&a.collideUp&&b.checkCollision.down&&a.faceTop&&b.bottom>a.top&&(f=b.bottom-a.top,f>this.TILE_BIAS&&(f=0)),0!==f&&(b.customSeparateY?b.overlapY=f:this.processTileSeparationY(b,f)),f},processTileSeparationX:function(b,
a){0>a?b.blocked.left=!0:0<a&&(b.blocked.right=!0);b.position.x-=a;b.velocity.x=0===b.bounce.x?0:-b.velocity.x*b.bounce.x},processTileSeparationY:function(b,a){0>a?b.blocked.up=!0:0<a&&(b.blocked.down=!0);b.position.y-=a;b.velocity.y=0===b.bounce.y?0:-b.velocity.y*b.bounce.y}};a.Utils.mixinPrototype(a.Physics.Arcade.prototype,a.Physics.Arcade.TilemapCollision.prototype);!function(b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):"undefined"!=typeof window?
window.p2=b():"undefined"!=typeof global?global.p2=b():"undefined"!=typeof self&&(self.p2=b())}(function(){return function c(a,d,e){function p(g,h){if(!d[g]){if(!a[g]){var v="function"==typeof require&&require;if(!h&&v)return v(g,!0);if(l)return l(g,!0);throw Error("Cannot find module '"+g+"'");}v=d[g]={exports:{}};a[g][0].call(v.exports,function(c){var d=a[g][1][c];return p(d?d:c)},v,v.exports,c,a,d,e)}return d[g].exports}for(var l="function"==typeof require&&require,g=0;g<e.length;g++)p(e[g]);return p}({1:[function(a,
f){function d(){}var e=a("./Scalar");f.exports=d;d.lineInt=function(a,c,d){var f,g,h,k,m,x,r,w=[0,0];return f=a[1][1]-a[0][1],g=a[0][0]-a[1][0],h=f*a[0][0]+g*a[0][1],k=c[1][1]-c[0][1],m=c[0][0]-c[1][0],x=k*c[0][0]+m*c[0][1],r=f*m-k*g,e.eq(r,0,d||0)||(w[0]=(m*h-g*x)/r,w[1]=(f*x-k*h)/r),w};d.segmentsIntersect=function(a,c,d,f){var e=c[0]-a[0];c=c[1]-a[1];var n=f[0]-d[0],g=f[1]-d[1];if(0==n*c-g*e)return!1;f=(e*(d[1]-a[1])+c*(a[0]-d[0]))/(n*c-g*e);a=(n*(a[1]-d[1])+g*(d[0]-a[0]))/(g*e-n*c);return 0<=f&&
1>=f&&0<=a&&1>=a}},{"./Scalar":4}],2:[function(a,f){function d(){}f.exports=d;d.area=function(a,c,d){return(c[0]-a[0])*(d[1]-a[1])-(d[0]-a[0])*(c[1]-a[1])};d.left=function(a,c,f){return 0<d.area(a,c,f)};d.leftOn=function(a,c,f){return 0<=d.area(a,c,f)};d.right=function(a,c,f){return 0>d.area(a,c,f)};d.rightOn=function(a,c,f){return 0>=d.area(a,c,f)};var e=[],p=[];d.collinear=function(a,c,f,g){return g?(e[0]=c[0]-a[0],e[1]=c[1]-a[1],p[0]=f[0]-c[0],p[1]=f[1]-c[1],a=e[0]*p[0]+e[1]*p[1],c=Math.sqrt(e[0]*
e[0]+e[1]*e[1]),f=Math.sqrt(p[0]*p[0]+p[1]*p[1]),a=Math.acos(a/(c*f)),g>a):0==d.area(a,c,f)};d.sqdist=function(a,c){var d=c[0]-a[0],f=c[1]-a[1];return d*d+f*f}},{}],3:[function(a,f){function d(){this.vertices=[]}function e(a,c,d,f,n){var l=c[1]-a[1];c=a[0]-c[0];a=l*a[0]+c*a[1];var p=f[1]-d[1];f=d[0]-f[0];d=p*d[0]+f*d[1];var h=l*f-p*c;return g.eq(h,0,n||0)?[0,0]:[(f*a-c*d)/h,(l*d-p*a)/h]}var p=a("./Line"),l=a("./Point"),g=a("./Scalar");f.exports=d;d.prototype.at=function(a){var c=this.vertices,d=c.length;
return c[0>a?a%d+d:a%d]};d.prototype.first=function(){return this.vertices[0]};d.prototype.last=function(){return this.vertices[this.vertices.length-1]};d.prototype.clear=function(){this.vertices.length=0};d.prototype.append=function(a,c,d){if("undefined"==typeof c)throw Error("From is not given!");if("undefined"==typeof d)throw Error("To is not given!");if(c>d-1)throw Error("lol1");if(d>a.vertices.length)throw Error("lol2");if(0>c)throw Error("lol3");for(;d>c;c++)this.vertices.push(a.vertices[c])};
d.prototype.makeCCW=function(){for(var a=0,c=this.vertices,d=1;d<this.vertices.length;++d)(c[d][1]<c[a][1]||c[d][1]==c[a][1]&&c[d][0]>c[a][0])&&(a=d);l.left(this.at(a-1),this.at(a),this.at(a+1))||this.reverse()};d.prototype.reverse=function(){for(var a=[],c=0,d=this.vertices.length;c!==d;c++)a.push(this.vertices.pop());this.vertices=a};d.prototype.isReflex=function(a){return l.right(this.at(a-1),this.at(a),this.at(a+1))};var h=[],k=[];d.prototype.canSee=function(a,c){var d,f;if(l.leftOn(this.at(a+
1),this.at(a),this.at(c))&&l.rightOn(this.at(a-1),this.at(a),this.at(c)))return!1;f=l.sqdist(this.at(a),this.at(c));for(var e=0;e!==this.vertices.length;++e)if((e+1)%this.vertices.length!==a&&e!==a&&l.leftOn(this.at(a),this.at(c),this.at(e+1))&&l.rightOn(this.at(a),this.at(c),this.at(e))&&(h[0]=this.at(a),h[1]=this.at(c),k[0]=this.at(e),k[1]=this.at(e+1),d=p.lineInt(h,k),l.sqdist(this.at(a),d)<f))return!1;return!0};d.prototype.copy=function(a,c,f){f=f||new d;if(f.clear(),c>a)for(var e=a;c>=e;e++)f.vertices.push(this.vertices[e]);
else{for(e=0;c>=e;e++)f.vertices.push(this.vertices[e]);for(e=a;e<this.vertices.length;e++)f.vertices.push(this.vertices[e])}return f};d.prototype.getCutEdges=function(){for(var a=[],c=[],f=[],e=new d,n=Number.MAX_VALUE,l=0;l<this.vertices.length;++l)if(this.isReflex(l))for(var p=0;p<this.vertices.length;++p)if(this.canSee(l,p)){for(var c=this.copy(l,p,e).getCutEdges(),f=this.copy(p,l,e).getCutEdges(),g=0;g<f.length;g++)c.push(f[g]);c.length<n&&(a=c,n=c.length,a.push([this.at(l),this.at(p)]))}return a};
d.prototype.decomp=function(){var a=this.getCutEdges();return 0<a.length?this.slice(a):[this]};d.prototype.slice=function(a){if(0==a.length)return[this];if(a instanceof Array&&a.length&&a[0]instanceof Array&&2==a[0].length&&a[0][0]instanceof Array){for(var c=[this],d=0;d<a.length;d++)for(var f=a[d],e=0;e<c.length;e++){var n=c[e].slice(f);if(n){c.splice(e,1);c.push(n[0],n[1]);break}}return c}f=a;d=this.vertices.indexOf(f[0]);e=this.vertices.indexOf(f[1]);return-1!=d&&-1!=e?[this.copy(d,e),this.copy(e,
d)]:!1};d.prototype.isSimple=function(){for(var a=this.vertices,c=0;c<a.length-1;c++)for(var d=0;c-1>d;d++)if(p.segmentsIntersect(a[c],a[c+1],a[d],a[d+1]))return!1;for(c=1;c<a.length-2;c++)if(p.segmentsIntersect(a[0],a[a.length-1],a[c],a[c+1]))return!1;return!0};d.prototype.quickDecomp=function(a,c,f,p,g,h){g=g||100;h=h||0;p=p||25;a="undefined"!=typeof a?a:[];c=c||[];f=f||[];var k=[0,0],v=[0,0],m=[0,0],y=0,t=0,D=0,H=y=0,C=0,E=0,L=new d,K=new d,M=this.vertices;if(3>M.length)return a;if(h++,h>g)return console.warn("quickDecomp: max level ("+
g+") reached."),a;for(var J=0;J<this.vertices.length;++J)if(this.isReflex(J)){c.push(this.vertices[J]);for(var y=t=Number.MAX_VALUE,N=0;N<this.vertices.length;++N)l.left(this.at(J-1),this.at(J),this.at(N))&&l.rightOn(this.at(J-1),this.at(J),this.at(N-1))&&(m=e(this.at(J-1),this.at(J),this.at(N),this.at(N-1)),l.right(this.at(J+1),this.at(J),m)&&(D=l.sqdist(this.vertices[J],m),t>D&&(t=D,v=m,C=N))),l.left(this.at(J+1),this.at(J),this.at(N+1))&&l.rightOn(this.at(J+1),this.at(J),this.at(N))&&(m=e(this.at(J+
1),this.at(J),this.at(N),this.at(N+1)),l.left(this.at(J-1),this.at(J),m)&&(D=l.sqdist(this.vertices[J],m),y>D&&(y=D,k=m,H=N)));if(C==(H+1)%this.vertices.length)m[0]=(v[0]+k[0])/2,m[1]=(v[1]+k[1])/2,f.push(m),H>J?(L.append(this,J,H+1),L.vertices.push(m),K.vertices.push(m),0!=C&&K.append(this,C,this.vertices.length),K.append(this,0,J+1)):(0!=J&&L.append(this,J,this.vertices.length),L.append(this,0,H+1),L.vertices.push(m),K.vertices.push(m),K.append(this,C,J+1));else{if(C>H&&(H+=this.vertices.length),
y=Number.MAX_VALUE,C>H)return a;for(N=C;H>=N;++N)l.leftOn(this.at(J-1),this.at(J),this.at(N))&&l.rightOn(this.at(J+1),this.at(J),this.at(N))&&(D=l.sqdist(this.at(J),this.at(N)),y>D&&(y=D,E=N%this.vertices.length));E>J?(L.append(this,J,E+1),0!=E&&K.append(this,E,M.length),K.append(this,0,J+1)):(0!=J&&L.append(this,J,M.length),L.append(this,0,E+1),K.append(this,E,J+1))}return L.vertices.length<K.vertices.length?(L.quickDecomp(a,c,f,p,g,h),K.quickDecomp(a,c,f,p,g,h)):(K.quickDecomp(a,c,f,p,g,h),L.quickDecomp(a,
c,f,p,g,h)),a}return a.push(this),a};d.prototype.removeCollinearPoints=function(a){for(var c=0,d=this.vertices.length-1;3<this.vertices.length&&0<=d;--d)l.collinear(this.at(d-1),this.at(d),this.at(d+1),a)&&(this.vertices.splice(d%this.vertices.length,1),d--,c++);return c}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(a,f){function d(){}f.exports=d;d.eq=function(a,c,d){return d=d||0,Math.abs(a-c)<d}},{}],5:[function(a,f){f.exports={Polygon:a("./Polygon"),Point:a("./Point")}},{"./Point":2,"./Polygon":3}],
6:[function(a,f){f.exports={name:"p2",version:"0.6.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0",
"grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(a,f){function d(a){this.lowerBound=e.create();a&&a.lowerBound&&e.copy(this.lowerBound,a.lowerBound);this.upperBound=e.create();a&&a.upperBound&&e.copy(this.upperBound,a.upperBound)}var e=a("../math/vec2");a("../utils/Utils");f.exports=d;var p=e.create();d.prototype.setFromPoints=function(a,c,d,f){var g=this.lowerBound,h=this.upperBound;"number"!=typeof d&&
(d=0);0!==d?e.rotate(g,a[0],d):e.copy(g,a[0]);e.copy(h,g);for(var k=Math.cos(d),m=Math.sin(d),r=1;r<a.length;r++){var w=a[r];if(0!==d){var G=w[0],w=w[1];p[0]=k*G-m*w;p[1]=m*G+k*w;w=p}for(G=0;2>G;G++)w[G]>h[G]&&(h[G]=w[G]),w[G]<g[G]&&(g[G]=w[G])}c&&(e.add(this.lowerBound,this.lowerBound,c),e.add(this.upperBound,this.upperBound,c));f&&(this.lowerBound[0]-=f,this.lowerBound[1]-=f,this.upperBound[0]+=f,this.upperBound[1]+=f)};d.prototype.copy=function(a){e.copy(this.lowerBound,a.lowerBound);e.copy(this.upperBound,
a.upperBound)};d.prototype.extend=function(a){for(var c=2;c--;){var d=a.lowerBound[c];this.lowerBound[c]>d&&(this.lowerBound[c]=d);d=a.upperBound[c];this.upperBound[c]<d&&(this.upperBound[c]=d)}};d.prototype.overlaps=function(a){var c=this.lowerBound,d=this.upperBound,f=a.lowerBound;a=a.upperBound;return(f[0]<=d[0]&&d[0]<=a[0]||c[0]<=a[0]&&a[0]<=d[0])&&(f[1]<=d[1]&&d[1]<=a[1]||c[1]<=a[1]&&a[1]<=d[1])}},{"../math/vec2":31,"../utils/Utils":50}],8:[function(a,f){function d(a){this.type=a;this.result=
[];this.world=null;this.boundingVolumeType=d.AABB}var e=a("../math/vec2"),p=a("../objects/Body");f.exports=d;d.AABB=1;d.BOUNDING_CIRCLE=2;d.prototype.setWorld=function(a){this.world=a};d.prototype.getCollisionPairs=function(){throw Error("getCollisionPairs must be implemented in a subclass!");};var l=e.create();d.boundingRadiusCheck=function(a,c){e.sub(l,a.position,c.position);var d=e.squaredLength(l),f=a.boundingRadius+c.boundingRadius;return f*f>=d};d.aabbCheck=function(a,c){return a.getAABB().overlaps(c.getAABB())};
d.prototype.boundingVolumeCheck=function(a,c){var f;switch(this.boundingVolumeType){case d.BOUNDING_CIRCLE:f=d.boundingRadiusCheck(a,c);break;case d.AABB:f=d.aabbCheck(a,c);break;default:throw Error("Bounding volume type not recognized: "+this.boundingVolumeType);}return f};d.canCollide=function(a,c){return a.type===p.STATIC&&c.type===p.STATIC?!1:a.type===p.KINEMATIC&&c.type===p.STATIC||a.type===p.STATIC&&c.type===p.KINEMATIC?!1:a.type===p.KINEMATIC&&c.type===p.KINEMATIC?!1:a.sleepState===p.SLEEPING&&
c.sleepState===p.SLEEPING?!1:a.sleepState===p.SLEEPING&&c.type===p.STATIC||c.sleepState===p.SLEEPING&&a.type===p.STATIC?!1:!0};d.NAIVE=1;d.SAP=2},{"../math/vec2":31,"../objects/Body":32}],9:[function(a,f){function d(a){e.apply(this);a=p.defaults(a,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10});this.xmin=a.xmin;this.ymin=a.ymin;this.xmax=a.xmax;this.ymax=a.ymax;this.nx=a.nx;this.ny=a.ny;this.binsizeX=(this.xmax-this.xmin)/this.nx;this.binsizeY=(this.ymax-this.ymin)/this.ny}var e=(a("../shapes/Circle"),
a("../shapes/Plane"),a("../shapes/Particle"),a("../collision/Broadphase")),p=(a("../math/vec2"),a("../utils/Utils"));f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.getCollisionPairs=function(a){var c=[],d=a.bodies,f=d.length,p=(this.binsizeX,this.binsizeY,this.nx),g=this.ny,h=this.xmin,k=this.ymin,m=this.xmax,w=this.ymax;a=[];for(var G=p*g,B=0;G>B;B++)a.push([]);for(var F=p/(m-h),I=g/(w-k),B=0;B!==f;B++)for(var p=d[B],A=p.aabb,D=Math.max(A.lowerBound[0],h),H=Math.max(A.lowerBound[1],
k),C=Math.min(A.upperBound[0],m),E=Math.min(A.upperBound[1],w),H=Math.floor(I*(H-k)),A=Math.floor(F*(C-h)),E=Math.floor(I*(E-k)),D=Math.floor(F*(D-h));A>=D;D++)for(C=H;E>=C;C++){var L=D*(g-1)+C;0<=L&&G>L&&a[L].push(p)}for(B=0;B!==G;B++)for(d=a[B],D=0,f=d.length;D!==f;D++)for(p=d[D],C=0;C!==D;C++)g=d[C],e.canCollide(p,g)&&this.boundingVolumeCheck(p,g)&&c.push(p,g);return c}},{"../collision/Broadphase":8,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../utils/Utils":50}],
10:[function(a,f){function d(){e.call(this,e.NAIVE)}var e=(a("../shapes/Circle"),a("../shapes/Plane"),a("../shapes/Shape"),a("../shapes/Particle"),a("../collision/Broadphase"));a("../math/vec2");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.getCollisionPairs=function(a){a=a.bodies;for(var c=this.result,d=c.length=0,f=a.length;d!==f;d++)for(var g=a[d],h=0;d>h;h++){var k=a[h];e.canCollide(g,k)&&this.boundingVolumeCheck(g,k)&&c.push(g,k)}return c};d.prototype.aabbQuery=function(a,
c,d){d=d||[];a=a.bodies;for(var f=0;f<a.length;f++){var e=a[f];e.aabbNeedsUpdate&&e.updateAABB();e.aabb.overlaps(c)&&d.push(e)}return d}},{"../collision/Broadphase":8,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Shape":45}],11:[function(a,f){function d(){this.contactEquations=[];this.frictionEquations=[];this.enabledEquations=this.enableFriction=!0;this.slipForce=10;this.frictionCoefficient=.3;this.surfaceVelocity=0;this.reuseObjects=!0;this.reusableContactEquations=
[];this.reusableFrictionEquations=[];this.restitution=0;this.stiffness=z.DEFAULT_STIFFNESS;this.relaxation=z.DEFAULT_RELAXATION;this.frictionStiffness=z.DEFAULT_STIFFNESS;this.frictionRelaxation=z.DEFAULT_RELAXATION;this.enableFrictionReduction=!0;this.collidingBodiesLastStep=new u;this.contactSkinSize=.01}function e(a,c){l.set(a.vertices[0],.5*-c.length,-c.radius);l.set(a.vertices[1],.5*c.length,-c.radius);l.set(a.vertices[2],.5*c.length,c.radius);l.set(a.vertices[3],.5*-c.length,c.radius)}function p(a,
c,d,f){var e=aa,n=Da,p=Ea,k=Fa;c=c.vertices;for(var m=null,t=0;t!==c.length+1;t++){var q=c[(t+1)%c.length];l.rotate(e,c[t%c.length],f);l.rotate(n,q,f);h(e,e,d);h(n,n,d);g(p,e,a);g(k,n,a);q=l.crossLength(p,k);if(null===m&&(m=q),0>=q*m)return!1;m=q}return!0}var l=a("../math/vec2"),g=l.sub,h=l.add,k=l.dot,m=a("../utils/Utils"),u=a("../utils/TupleDictionary"),z=a("../equations/Equation"),x=a("../equations/ContactEquation"),r=a("../equations/FrictionEquation"),w=a("../shapes/Circle"),G=a("../shapes/Convex"),
B=a("../shapes/Shape"),F=(a("../objects/Body"),a("../shapes/Rectangle"));f.exports=d;var I=l.fromValues(0,1),A=l.fromValues(0,0),D=l.fromValues(0,0),H=l.fromValues(0,0),C=l.fromValues(0,0),E=l.fromValues(0,0),L=l.fromValues(0,0),K=l.fromValues(0,0),M=l.fromValues(0,0),J=l.fromValues(0,0),N=l.fromValues(0,0),P=l.fromValues(0,0),Y=l.fromValues(0,0),Q=l.fromValues(0,0),S=l.fromValues(0,0),ea=l.fromValues(0,0),R=l.fromValues(0,0),O=l.fromValues(0,0),ua=l.fromValues(0,0),ba=[],va=l.create(),V=l.create();
d.prototype.bodiesOverlap=function(a,c){for(var d=0,f=a.shapes.length;d!==f;d++){var e=a.shapes[d],n=a.shapeOffsets[d];a.shapeAngles[d];a.toWorldFrame(va,n);for(var n=0,l=c.shapes.length;n!==l;n++){var g=c.shapes[n],p=c.shapeOffsets[n];c.shapeAngles[n];if(c.toWorldFrame(V,p),this[e.type|g.type](a,e,va,e.angle+a.angle,c,g,V,g.angle+c.angle,!0))return!0}}return!1};d.prototype.collidedLastStep=function(a,c){return!!this.collidingBodiesLastStep.get(0|a.id,0|c.id)};d.prototype.reset=function(){this.collidingBodiesLastStep.reset();
for(var a=this.contactEquations,c=a.length;c--;){var d=a[c];this.collidingBodiesLastStep.set(d.bodyA.id,d.bodyB.id,!0)}this.reuseObjects&&(a=this.frictionEquations,c=this.reusableFrictionEquations,m.appendArray(this.reusableContactEquations,this.contactEquations),m.appendArray(c,a));this.contactEquations.length=this.frictionEquations.length=0};d.prototype.createContactEquation=function(a,c,d,f){var e=this.reusableContactEquations.length?this.reusableContactEquations.pop():new x(a,c);return e.bodyA=
a,e.bodyB=c,e.shapeA=d,e.shapeB=f,e.restitution=this.restitution,e.firstImpact=!this.collidedLastStep(a,c),e.stiffness=this.stiffness,e.relaxation=this.relaxation,e.needsUpdate=!0,e.enabled=this.enabledEquations,e.offset=this.contactSkinSize,e};d.prototype.createFrictionEquation=function(a,c,d,f){var e=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new r(a,c);return e.bodyA=a,e.bodyB=c,e.shapeA=d,e.shapeB=f,e.setSlipForce(this.slipForce),e.frictionCoefficient=this.frictionCoefficient,
e.relativeVelocity=this.surfaceVelocity,e.enabled=this.enabledEquations,e.needsUpdate=!0,e.stiffness=this.frictionStiffness,e.relaxation=this.frictionRelaxation,e.contactEquations.length=0,e};d.prototype.createFrictionFromContact=function(a){var c=this.createFrictionEquation(a.bodyA,a.bodyB,a.shapeA,a.shapeB);return l.copy(c.contactPointA,a.contactPointA),l.copy(c.contactPointB,a.contactPointB),l.rotate90cw(c.t,a.normalA),c.contactEquations.push(a),c};d.prototype.createFrictionFromAverage=function(a){var c=
this.contactEquations[this.contactEquations.length-1],d=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB),f=c.bodyA;c.bodyB;l.set(d.contactPointA,0,0);l.set(d.contactPointB,0,0);l.set(d.t,0,0);for(var e=0;e!==a;e++)c=this.contactEquations[this.contactEquations.length-1-e],c.bodyA===f?(l.add(d.t,d.t,c.normalA),l.add(d.contactPointA,d.contactPointA,c.contactPointA),l.add(d.contactPointB,d.contactPointB,c.contactPointB)):(l.sub(d.t,d.t,c.normalA),l.add(d.contactPointA,d.contactPointA,c.contactPointB),
l.add(d.contactPointB,d.contactPointB,c.contactPointA)),d.contactEquations.push(c);a=1/a;return l.scale(d.contactPointA,d.contactPointA,a),l.scale(d.contactPointB,d.contactPointB,a),l.normalize(d.t,d.t),l.rotate90cw(d.t,d.t),d};d.prototype[B.LINE|B.CONVEX]=d.prototype.convexLine=function(a,c,d,f,e,n,l,g,p){return p?!1:0};d.prototype[B.LINE|B.RECTANGLE]=d.prototype.lineRectangle=function(a,c,d,f,e,n,l,g,p){return p?!1:0};var ha=new F(1,1),U=l.create();d.prototype[B.CAPSULE|B.CONVEX]=d.prototype[B.CAPSULE|
B.RECTANGLE]=d.prototype.convexCapsule=function(a,c,d,f,g,p,h,k,m){l.set(U,p.length/2,0);l.rotate(U,U,k);l.add(U,U,h);var v=this.circleConvex(g,p,U,k,a,c,d,f,m,p.radius);l.set(U,-p.length/2,0);l.rotate(U,U,k);l.add(U,U,h);var y=this.circleConvex(g,p,U,k,a,c,d,f,m,p.radius);if(m&&(v||y))return!0;e(ha,p);return this.convexConvex(a,c,d,f,g,ha,h,k,m)+v+y};d.prototype[B.CAPSULE|B.LINE]=d.prototype.lineCapsule=function(a,c,d,f,e,n,l,g,p){return p?!1:0};var ia=l.create(),ja=l.create(),pa=new F(1,1);d.prototype[B.CAPSULE|
B.CAPSULE]=d.prototype.capsuleCapsule=function(a,c,d,f,g,p,h,k,m){for(var v,y=0,t=0;2>t;t++){l.set(ia,(0===t?-1:1)*c.length/2,0);l.rotate(ia,ia,f);l.add(ia,ia,d);for(var q=0;2>q;q++){l.set(ja,(0===q?-1:1)*p.length/2,0);l.rotate(ja,ja,k);l.add(ja,ja,h);this.enableFrictionReduction&&(v=this.enableFriction,this.enableFriction=!1);var u=this.circleCircle(a,c,ia,f,g,p,ja,k,m,c.radius,p.radius);if(this.enableFrictionReduction&&(this.enableFriction=v),m&&u)return!0;y+=u}}this.enableFrictionReduction&&(v=
this.enableFriction,this.enableFriction=!1);e(pa,c);t=this.convexCapsule(a,pa,d,f,g,p,h,k,m);if(this.enableFrictionReduction&&(this.enableFriction=v),m&&t)return!0;if(y+=t,this.enableFrictionReduction)v=this.enableFriction,this.enableFriction=!1;e(pa,p);a=this.convexCapsule(g,pa,h,k,a,c,d,f,m);return this.enableFrictionReduction&&(this.enableFriction=v),m&&a?!0:(y+=a,this.enableFrictionReduction&&y&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y)};d.prototype[B.LINE|
B.LINE]=d.prototype.lineLine=function(a,c,d,f,e,n,l,g,p){return p?!1:0};d.prototype[B.PLANE|B.LINE]=d.prototype.planeLine=function(a,c,d,f,e,n,p,m,q){var u=0;l.set(A,-n.length/2,0);l.set(D,n.length/2,0);l.rotate(H,A,m);l.rotate(C,D,m);h(H,H,p);h(C,C,p);l.copy(A,H);l.copy(D,C);g(E,D,A);l.normalize(L,E);l.rotate90cw(J,L);l.rotate(M,I,f);ba[0]=A;ba[1]=D;for(f=0;f<ba.length;f++){m=ba[f];g(K,m,d);var w=k(K,M);if(0>w){if(q)return!0;var r=this.createContactEquation(a,e,c,n);u++;l.copy(r.normalA,M);l.normalize(r.normalA,
r.normalA);l.scale(K,M,w);g(r.contactPointA,m,K);g(r.contactPointA,r.contactPointA,a.position);g(r.contactPointB,m,p);h(r.contactPointB,r.contactPointB,p);g(r.contactPointB,r.contactPointB,e.position);this.contactEquations.push(r);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(r))}}return q?!1:(this.enableFrictionReduction||u&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(u)),u)};d.prototype[B.PARTICLE|
B.CAPSULE]=d.prototype.particleCapsule=function(a,c,d,f,e,n,l,g,p){return this.circleLine(a,c,d,f,e,n,l,g,p,n.radius,0)};d.prototype[B.CIRCLE|B.LINE]=d.prototype.circleLine=function(a,c,d,f,e,n,p,m,q,u,w){u=u||0;w="undefined"!=typeof w?w:c.radius;l.set(M,-n.length/2,0);l.set(J,n.length/2,0);l.rotate(N,M,m);l.rotate(P,J,m);h(N,N,p);h(P,P,p);l.copy(M,N);l.copy(J,P);g(L,J,M);l.normalize(K,L);l.rotate90cw(E,K);g(Y,d,M);m=k(Y,E);g(C,M,p);g(Q,d,p);f=w+u;if(Math.abs(m)<f){l.scale(A,E,m);g(H,d,A);l.scale(D,
E,k(E,Q));l.normalize(D,D);l.scale(D,D,u);h(H,H,D);m=k(K,H);var r=k(K,M),x=k(K,J);if(m>r&&x>m){if(q)return!0;c=this.createContactEquation(a,e,c,n);return l.scale(c.normalA,A,-1),l.normalize(c.normalA,c.normalA),l.scale(c.contactPointA,c.normalA,w),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),g(c.contactPointB,H,p),h(c.contactPointB,c.contactPointB,p),g(c.contactPointB,c.contactPointB,e.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),
1}}ba[0]=M;ba[1]=J;for(r=0;r<ba.length;r++)if(m=ba[r],g(Y,m,d),l.squaredLength(Y)<Math.pow(f,2)){if(q)return!0;c=this.createContactEquation(a,e,c,n);return l.copy(c.normalA,Y),l.normalize(c.normalA,c.normalA),l.scale(c.contactPointA,c.normalA,w),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),g(c.contactPointB,m,p),l.scale(S,c.normalA,-u),h(c.contactPointB,c.contactPointB,S),h(c.contactPointB,c.contactPointB,p),g(c.contactPointB,c.contactPointB,e.position),this.contactEquations.push(c),
this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}return 0};d.prototype[B.CIRCLE|B.CAPSULE]=d.prototype.circleCapsule=function(a,c,d,f,e,n,l,g,p){return this.circleLine(a,c,d,f,e,n,l,g,p,n.radius)};d.prototype[B.CIRCLE|B.CONVEX]=d.prototype[B.CIRCLE|B.RECTANGLE]=d.prototype.circleConvex=function(a,c,d,f,e,n,k,m,t,q){q="number"==typeof q?q:c.radius;f=!1;for(var u=Number.MAX_VALUE,w=n.vertices,r=0;r!==w.length+1;r++){var x=w[(r+1)%w.length];if(l.rotate(A,w[r%w.length],
m),l.rotate(D,x,m),h(A,A,k),h(D,D,k),g(H,D,A),l.normalize(C,H),l.rotate90cw(E,C),l.scale(S,E,-c.radius),h(S,S,d),p(S,n,k,m))l.sub(ea,A,S),x=Math.abs(l.dot(ea,E)),u>x&&(l.copy(R,S),u=x,l.scale(Q,E,x),l.add(Q,Q,S),f=!0)}if(f){if(t)return!0;c=this.createContactEquation(a,e,c,n);return l.sub(c.normalA,R,d),l.normalize(c.normalA,c.normalA),l.scale(c.contactPointA,c.normalA,q),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),g(c.contactPointB,Q,k),h(c.contactPointB,c.contactPointB,
k),g(c.contactPointB,c.contactPointB,e.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}if(0<q)for(r=0;r<w.length;r++)if(l.rotate(P,w[r],m),h(P,P,k),g(N,P,d),l.squaredLength(N)<Math.pow(q,2)){if(t)return!0;c=this.createContactEquation(a,e,c,n);return l.copy(c.normalA,N),l.normalize(c.normalA,c.normalA),l.scale(c.contactPointA,c.normalA,q),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),
g(c.contactPointB,P,k),h(c.contactPointB,c.contactPointB,k),g(c.contactPointB,c.contactPointB,e.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}return 0};var aa=l.create(),Da=l.create(),Ea=l.create(),Fa=l.create();d.prototype[B.PARTICLE|B.CONVEX]=d.prototype[B.PARTICLE|B.RECTANGLE]=d.prototype.particleConvex=function(a,c,d,f,e,n,m,q,u){f=Number.MAX_VALUE;var w=!1,r=n.vertices;if(!p(d,n,m,q))return 0;if(u)return!0;for(u=
0;u!==r.length+1;u++){var x=r[(u+1)%r.length];l.rotate(A,r[u%r.length],q);l.rotate(D,x,q);h(A,A,m);h(D,D,m);g(H,D,A);l.normalize(C,H);l.rotate90cw(E,C);g(N,d,A);k(N,E);g(L,A,m);g(K,d,m);l.sub(O,A,d);x=Math.abs(l.dot(O,E));f>x&&(f=x,l.scale(Q,E,x),l.add(Q,Q,d),l.copy(ua,E),w=!0)}return w?(c=this.createContactEquation(a,e,c,n),l.scale(c.normalA,ua,-1),l.normalize(c.normalA,c.normalA),l.set(c.contactPointA,0,0),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),g(c.contactPointB,
Q,m),h(c.contactPointB,c.contactPointB,m),g(c.contactPointB,c.contactPointB,e.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1):0};d.prototype[B.CIRCLE]=d.prototype.circleCircle=function(a,c,d,f,e,n,p,k,m,t,q){t=t||c.radius;q=q||n.radius;g(A,d,p);f=t+q;if(l.squaredLength(A)>Math.pow(f,2))return 0;if(m)return!0;c=this.createContactEquation(a,e,c,n);return g(c.normalA,p,d),l.normalize(c.normalA,c.normalA),l.scale(c.contactPointA,
c.normalA,t),l.scale(c.contactPointB,c.normalA,-q),h(c.contactPointA,c.contactPointA,d),g(c.contactPointA,c.contactPointA,a.position),h(c.contactPointB,c.contactPointB,p),g(c.contactPointB,c.contactPointB,e.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1};d.prototype[B.PLANE|B.CONVEX]=d.prototype[B.PLANE|B.RECTANGLE]=d.prototype.planeConvex=function(a,c,d,f,e,n,p,m,q){var u=0;l.rotate(D,I,f);for(f=0;f!==n.vertices.length;f++)if(l.rotate(A,
n.vertices[f],m),h(A,A,p),g(H,A,d),0>=k(H,D)){if(q)return!0;u++;var w=this.createContactEquation(a,e,c,n);g(H,A,d);l.copy(w.normalA,D);var r=k(H,w.normalA);l.scale(H,w.normalA,r);g(w.contactPointB,A,e.position);g(w.contactPointA,A,H);g(w.contactPointA,w.contactPointA,a.position);this.contactEquations.push(w);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w))}return this.enableFrictionReduction&&this.enableFriction&&u&&this.frictionEquations.push(this.createFrictionFromAverage(u)),
u};d.prototype[B.PARTICLE|B.PLANE]=d.prototype.particlePlane=function(a,c,d,f,e,n,p,h,m){h=h||0;g(A,d,p);l.rotate(D,I,h);f=k(A,D);if(0<f)return 0;if(m)return!0;c=this.createContactEquation(e,a,n,c);return l.copy(c.normalA,D),l.scale(A,c.normalA,f),g(c.contactPointA,d,A),g(c.contactPointA,c.contactPointA,e.position),g(c.contactPointB,d,a.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1};d.prototype[B.CIRCLE|B.PARTICLE]=d.prototype.circleParticle=
function(a,c,d,f,e,n,p,k,m){if(g(A,p,d),l.squaredLength(A)>Math.pow(c.radius,2))return 0;if(m)return!0;f=this.createContactEquation(a,e,c,n);return l.copy(f.normalA,A),l.normalize(f.normalA,f.normalA),l.scale(f.contactPointA,f.normalA,c.radius),h(f.contactPointA,f.contactPointA,d),g(f.contactPointA,f.contactPointA,a.position),g(f.contactPointB,p,e.position),this.contactEquations.push(f),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(f)),1};var ta=new w(1),ka=l.create(),
la=l.create();l.create();d.prototype[B.PLANE|B.CAPSULE]=d.prototype.planeCapsule=function(a,c,d,f,e,n,g,p,k){l.set(ka,-n.length/2,0);l.rotate(ka,ka,p);h(ka,ka,g);l.set(la,n.length/2,0);l.rotate(la,la,p);h(la,la,g);ta.radius=n.radius;var m;this.enableFrictionReduction&&(m=this.enableFriction,this.enableFriction=!1);n=this.circlePlane(e,ta,ka,0,a,c,d,f,k);a=this.circlePlane(e,ta,la,0,a,c,d,f,k);if(this.enableFrictionReduction&&(this.enableFriction=m),k)return n||a;k=n+a;return this.enableFrictionReduction&&
k&&this.frictionEquations.push(this.createFrictionFromAverage(k)),k};d.prototype[B.CIRCLE|B.PLANE]=d.prototype.circlePlane=function(a,c,d,f,e,n,p,m,q){f=m||0;g(A,d,p);l.rotate(D,I,f);f=k(D,A);if(f>c.radius)return 0;if(q)return!0;n=this.createContactEquation(e,a,n,c);return l.copy(n.normalA,D),l.scale(n.contactPointB,n.normalA,-c.radius),h(n.contactPointB,n.contactPointB,d),g(n.contactPointB,n.contactPointB,a.position),l.scale(H,n.normalA,f),g(n.contactPointA,A,H),h(n.contactPointA,n.contactPointA,
p),g(n.contactPointA,n.contactPointA,e.position),this.contactEquations.push(n),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(n)),1};d.prototype[B.CONVEX]=d.prototype[B.CONVEX|B.RECTANGLE]=d.prototype[B.RECTANGLE]=d.prototype.convexConvex=function(a,c,f,e,n,p,m,q,u,w){var r=0;w="number"==typeof w?w:0;if(!d.findSeparatingAxis(c,f,e,p,m,q,A))return 0;g(M,m,f);0<k(A,M)&&l.scale(A,A,-1);var x=d.getClosestEdge(c,e,A,!0),B=d.getClosestEdge(p,q,A);if(-1===x||-1===B)return 0;
for(var z=0;2>z;z++){var G=x,Y=B,F=c,Q=p,I=f,S=m,aa=e,N=q,ea=a,L=n;if(0===z){var R;R=G;G=Y;Y=R;R=F;F=Q;Q=R;R=I;I=S;S=R;R=aa;aa=N;N=R;R=ea;ea=L;L=R}for(R=Y;Y+2>R;R++){l.rotate(D,Q.vertices[(R+Q.vertices.length)%Q.vertices.length],N);h(D,D,S);for(var O=0,P=G-1;G+2>P;P++){var V=F.vertices[(P+F.vertices.length)%F.vertices.length],ha=F.vertices[(P+1+F.vertices.length)%F.vertices.length];l.rotate(H,V,aa);l.rotate(C,ha,aa);h(H,H,I);h(C,C,I);g(E,C,H);l.rotate90cw(J,E);l.normalize(J,J);g(M,D,H);V=k(J,M);(P===
G&&w>=V||P!==G&&0>=V)&&O++}if(3<=O){if(u)return!0;O=this.createContactEquation(ea,L,F,Q);r++;V=F.vertices[G%F.vertices.length];ha=F.vertices[(G+1)%F.vertices.length];l.rotate(H,V,aa);l.rotate(C,ha,aa);h(H,H,I);h(C,C,I);g(E,C,H);l.rotate90cw(O.normalA,E);l.normalize(O.normalA,O.normalA);g(M,D,H);V=k(O.normalA,M);l.scale(K,O.normalA,V);g(O.contactPointA,D,I);g(O.contactPointA,O.contactPointA,K);h(O.contactPointA,O.contactPointA,I);g(O.contactPointA,O.contactPointA,ea.position);g(O.contactPointB,D,S);
h(O.contactPointB,O.contactPointB,S);g(O.contactPointB,O.contactPointB,L.position);this.contactEquations.push(O);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(O))}}}return this.enableFrictionReduction&&this.enableFriction&&r&&this.frictionEquations.push(this.createFrictionFromAverage(r)),r};var wa=l.fromValues(0,0);d.projectConvexOntoAxis=function(a,c,d,f,e){var n,g=null,p=null;l.rotate(wa,f,-d);for(d=0;d<a.vertices.length;d++)n=a.vertices[d],
n=k(n,wa),(null===g||n>g)&&(g=n),(null===p||p>n)&&(p=n);p>g&&(a=p,p=g,g=a);c=k(c,f);l.set(e,p+c,g+c)};var xa=l.fromValues(0,0),ya=l.fromValues(0,0),za=l.fromValues(0,0),T=l.fromValues(0,0),ca=l.fromValues(0,0),da=l.fromValues(0,0);d.findSeparatingAxis=function(a,c,f,e,n,p,h){var k=null,m=!1,y=!1;if(a instanceof F&&e instanceof F)for(var t=0;2!==t;t++){var q=a,u=f;1===t&&(u=p);for(var w=0;2!==w;w++){0===w?l.set(T,0,1):1===w&&l.set(T,1,0);0!==u&&l.rotate(T,T,u);d.projectConvexOntoAxis(a,c,f,T,ca);d.projectConvexOntoAxis(e,
n,p,T,da);var m=ca,r=da;ca[0]>da[0]&&(r=ca,m=da);r=r[0]-m[1];m=0>=r;(null===k||r>k)&&(l.copy(h,T),k=r,y=m)}}else for(t=0;2!==t;t++)for(q=a,u=f,1===t&&(q=e,u=p),w=0;w!==q.vertices.length;w++)l.rotate(ya,q.vertices[w],u),l.rotate(za,q.vertices[(w+1)%q.vertices.length],u),g(xa,za,ya),l.rotate90cw(T,xa),l.normalize(T,T),d.projectConvexOntoAxis(a,c,f,T,ca),d.projectConvexOntoAxis(e,n,p,T,da),m=ca,r=da,ca[0]>da[0]&&(r=ca,m=da),r=r[0]-m[1],m=0>=r,(null===k||r>k)&&(l.copy(h,T),k=r,y=m);return y};var qa=l.fromValues(0,
0),Aa=l.fromValues(0,0),ra=l.fromValues(0,0);d.getClosestEdge=function(a,c,d,f){l.rotate(qa,d,-c);f&&l.scale(qa,qa,-1);c=-1;d=a.vertices.length;f=-1;for(var e=0;e!==d;e++){g(Aa,a.vertices[(e+1)%d],a.vertices[e%d]);l.rotate90cw(ra,Aa);l.normalize(ra,ra);var n=k(ra,qa);(-1===c||n>f)&&(c=e%d,f=n)}return c};var fa=l.create(),ga=l.create(),W=l.create(),oa=l.create(),Ba=l.create(),Z=l.create(),Ca=l.create();d.prototype[B.CIRCLE|B.HEIGHTFIELD]=d.prototype.circleHeightfield=function(a,c,d,f,e,n,p,k,m,t){f=
n.data;t=t||c.radius;k=n.elementWidth;var q=Math.floor((d[0]-t-p[0])/k),u=Math.ceil((d[0]+t-p[0])/k);0>q&&(q=0);u>=f.length&&(u=f.length-1);for(var w=f[q],r=f[u],x=q;u>x;x++)f[x]<r&&(r=f[x]),f[x]>w&&(w=f[x]);if(d[1]-t>w)return m?!1:0;w=!1;for(x=q;u>x;x++)if(l.set(W,x*k,f[x]),l.set(oa,(x+1)*k,f[x+1]),l.add(W,W,p),l.add(oa,oa,p),l.sub(Z,oa,W),l.rotate(Z,Z,Math.PI/2),l.normalize(Z,Z),l.scale(fa,Z,-t),l.add(fa,fa,d),l.sub(ga,fa,W),w=l.dot(ga,Z),fa[0]>=W[0]&&fa[0]<oa[0]&&0>=w){if(m)return!0;l.scale(ga,
Z,-w);l.add(Ba,fa,ga);l.copy(Ca,Z);r=this.createContactEquation(e,a,n,c);l.copy(r.normalA,Ca);l.scale(r.contactPointB,r.normalA,-t);h(r.contactPointB,r.contactPointB,d);g(r.contactPointB,r.contactPointB,a.position);l.copy(r.contactPointA,Ba);l.sub(r.contactPointA,r.contactPointA,e.position);this.contactEquations.push(r);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(r))}if(w=!1,0<t)for(x=q;u>=x;x++)if(l.set(W,x*k,f[x]),l.add(W,W,p),l.sub(ga,d,W),l.squaredLength(ga)<
Math.pow(t,2)){if(m)return!0;w=!0;r=this.createContactEquation(e,a,n,c);l.copy(r.normalA,ga);l.normalize(r.normalA,r.normalA);l.scale(r.contactPointB,r.normalA,-t);h(r.contactPointB,r.contactPointB,d);g(r.contactPointB,r.contactPointB,a.position);g(r.contactPointA,W,p);h(r.contactPointA,r.contactPointA,p);g(r.contactPointA,r.contactPointA,e.position);this.contactEquations.push(r);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(r))}return w?1:0};var ma=l.create(),na=
l.create(),sa=l.create(),X=new G([l.create(),l.create(),l.create(),l.create()]);d.prototype[B.RECTANGLE|B.HEIGHTFIELD]=d.prototype[B.CONVEX|B.HEIGHTFIELD]=d.prototype.convexHeightfield=function(a,c,d,f,e,n,p,g,h){g=n.data;n=n.elementWidth;var k=Math.floor((a.aabb.lowerBound[0]-p[0])/n),m=Math.ceil((a.aabb.upperBound[0]-p[0])/n);0>k&&(k=0);m>=g.length&&(m=g.length-1);for(var v=g[k],y=g[m],t=k;m>t;t++)g[t]<y&&(y=g[t]),g[t]>v&&(v=g[t]);if(a.aabb.lowerBound[1]>v)return h?!1:0;v=0;for(t=k;m>t;t++)l.set(ma,
t*n,g[t]),l.set(na,(t+1)*n,g[t+1]),l.add(ma,ma,p),l.add(na,na,p),l.set(sa,.5*(na[0]+ma[0]),.5*(na[1]+ma[1]-100)),l.sub(X.vertices[0],na,sa),l.sub(X.vertices[1],ma,sa),l.copy(X.vertices[2],X.vertices[1]),l.copy(X.vertices[3],X.vertices[0]),X.vertices[2][1]-=100,X.vertices[3][1]-=100,v+=this.convexConvex(a,c,d,f,e,X,sa,0,h);return v}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/FrictionEquation":24,"../math/vec2":31,"../objects/Body":32,"../shapes/Circle":38,"../shapes/Convex":39,
"../shapes/Rectangle":44,"../shapes/Shape":45,"../utils/TupleDictionary":49,"../utils/Utils":50}],12:[function(a,f){function d(a){a=a||{};this.from=a.from?e.fromValues(a.from[0],a.from[1]):e.create();this.to=a.to?e.fromValues(a.to[0],a.to[1]):e.create();this._direction=e.create();this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionGroup=this.collisionMask=-1;this.mode=d.ANY;this.result=new p;this.hasHit=!1;this.callback=function(){}}f.exports=d;var e=a("../math/vec2"),
p=a("../collision/RaycastResult"),l=a("../shapes/Shape"),g=a("../collision/AABB");d.prototype.constructor=d;d.CLOSEST=1;d.ANY=2;d.ALL=4;var h=new g,k=[];d.prototype.intersectWorld=function(a,c){return this.mode=c.mode||d.ANY,this.result=c.result||new p,this.skipBackfaces=!!c.skipBackfaces,this.collisionMask="undefined"!=typeof c.collisionMask?c.collisionMask:-1,this.collisionGroup="undefined"!=typeof c.collisionGroup?c.collisionGroup:-1,c.from&&e.copy(this.from,c.from),c.to&&e.copy(this.to,c.to),
this.callback=c.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(h),k.length=0,a.broadphase.aabbQuery(a,h,k),this.intersectBodies(k),this.hasHit};var m=(e.create(),e.create(),e.create());d.prototype.intersectBody=function(a,c){c&&(this.result=c,this._updateDirection());var d=this.checkCollisionResponse;if(!d||a.collisionResponse)for(var f=0,l=a.shapes.length;l>f;f++){var p=a.shapes[f];if(!d||p.collisionResponse)if(e.copy(m,a.shapeOffsets[f]),e.rotate(m,
m,a.angle),e.add(m,m,a.position),this.intersectShape(p,a.shapeAngles[f]+a.angle,m,a),this.result._shouldStop)break}};d.prototype.intersectBodies=function(a,c){c&&(this.result=c,this._updateDirection());for(var d=0,f=a.length;!this.result._shouldStop&&f>d;d++)this.intersectBody(a[d])};d.prototype._updateDirection=function(){var a=this._direction;e.sub(a,this.to,this.from);e.normalize(a,a)};d.prototype.intersectShape=function(a,c,d,f){var l=this.from,p=this._direction;e.sub(L,d,l);var g=e.dot(L,p);
e.scale(K,p,g);e.add(K,K,l);e.distance(d,K)>a.boundingSphereRadius||(l=this[a.type])&&l.call(this,a,c,d,f)};var u=(e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),new p,e.create()),z=e.create(),x=e.create(),r=e.create(),w=e.create(),G=e.create(),B=e.create();d.prototype.intersectRectangle=function(a,c,d,f){d=-Number.MAX_VALUE;var l=Number.MAX_VALUE;if(e.set(G,.5*-a.width,.5*-a.height),e.set(B,.5*a.width,.5*a.height),e.rotate(u,this._direction,-c),f.toLocalFrame(z,this.from),
0!==u[0]){var p=(G[0]-z[0])/u[0],g=(B[0]-z[0])/u[0],h=d;d=Math.max(d,Math.min(p,g));d!==h&&e.set(x,p>g?1:-1,0);h=l;l=Math.min(l,Math.max(p,g));l!==h&&e.set(r,g>p?1:-1,0)}0!==u[1]&&(p=(G[1]-z[1])/u[1],g=(B[1]-z[1])/u[1],h=d,d=Math.max(d,Math.min(p,g)),d!==h&&e.set(x,0,p>g?1:-1),h=l,l=Math.min(l,Math.max(p,g)),l!==h&&e.set(r,0,g>p?1:-1));l>=d&&(e.set(w,z[0]+u[0]*d,z[1]+u[1]*d),e.rotate(x,x,c),f.toWorldFrame(w,w),this.reportIntersection(x,w,a,f,-1),!this._shouldStop)&&(e.rotate(r,r,c),e.set(w,z[0]+u[0]*
l,z[1]+u[1]*l),f.toWorldFrame(w,w),this.reportIntersection(r,w,a,f,-1))};d.prototype[l.RECTANGLE]=d.prototype.intersectRectangle;var F=e.create(),I=e.create(),A=e.create(),D=e.create(),H=e.create();d.prototype.intersectPlane=function(a,c,d,f){var l=this.from,p=this.to,g=this._direction;e.set(D,0,1);e.rotate(D,D,c);e.sub(H,l,d);c=e.dot(H,D);e.sub(H,p,d);var h=e.dot(H,D);0<c*h||e.distance(l,p)<c||(p=e.dot(D,g),e.sub(F,l,d),d=-e.dot(D,F)/p,e.scale(I,g,d),e.add(A,l,I),this.reportIntersection(D,A,a,f,
-1))};d.prototype[l.PLANE]=d.prototype.intersectPlane;var C=e.create(),E=e.create();d.prototype.intersectCircle=function(a,c,d,f){c=this.from;var l=this.to,p=a.radius,g=Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2),h=2*((l[0]-c[0])*(c[0]-d[0])+(l[1]-c[1])*(c[1]-d[1])),p=Math.pow(c[0]-d[0],2)+Math.pow(c[1]-d[1],2)-Math.pow(p,2),k=Math.pow(h,2)-4*g*p;0>k||(0===k?(e.lerp(C,c,l,k),e.sub(E,C,d),e.normalize(E,E),this.reportIntersection(E,C,a,f,-1)):(p=(-h-Math.sqrt(k))/(2*g),g=(-h+Math.sqrt(k))/(2*g),(e.lerp(C,
c,l,p),e.sub(E,C,d),e.normalize(E,E),this.reportIntersection(E,C,a,f,-1),this.result._shouldStop)||(e.lerp(C,c,l,g),e.sub(E,C,d),e.normalize(E,E),this.reportIntersection(E,C,a,f,-1))))};d.prototype[l.CIRCLE]=d.prototype.intersectCircle;d.prototype.getAABB=function(a){var c=this.to,d=this.from;a.lowerBound[0]=Math.min(c[0],d[0]);a.lowerBound[1]=Math.min(c[1],d[1]);a.upperBound[0]=Math.max(c[0],d[0]);a.upperBound[1]=Math.max(c[1],d[1])};d.prototype.reportIntersection=function(a,c,f,l,p){var g=this.from,
h=this.to,k=e.distance(g,c),m=this.result;if(!(this.skipBackfaces&&0<e.dot(a,this._direction)))switch(m.hitFaceIndex="undefined"!=typeof p?p:-1,this.mode){case d.ALL:this.hasHit=!0;m.set(g,h,a,c,f,l,k);m.hasHit=!0;this.callback(m);break;case d.CLOSEST:(k<m.distance||!m.hasHit)&&(this.hasHit=!0,m.hasHit=!0,m.set(g,h,a,c,f,l,k));break;case d.ANY:this.hasHit=!0,m.hasHit=!0,m.set(g,h,a,c,f,l,k),m._shouldStop=!0}};var L=e.create(),K=e.create()},{"../collision/AABB":7,"../collision/RaycastResult":13,"../math/vec2":31,
"../shapes/Shape":45}],13:[function(a,f){function d(){this.rayFromWorld=e.create();this.rayToWorld=e.create();this.hitNormalWorld=e.create();this.hitPointWorld=e.create();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var e=a("../math/vec2");f.exports=d;d.prototype.reset=function(){e.set(this.rayFromWorld,0,0);e.set(this.rayToWorld,0,0);e.set(this.hitNormalWorld,0,0);e.set(this.hitPointWorld,0,0);this.hasHit=!1;this.body=this.shape=null;this.distance=
this.hitFaceIndex=-1;this._shouldStop=!1};d.prototype.abort=function(){this._shouldStop=!0};d.prototype.set=function(a,c,d,f,g,h,k){e.copy(this.rayFromWorld,a);e.copy(this.rayToWorld,c);e.copy(this.hitNormalWorld,d);e.copy(this.hitPointWorld,f);this.shape=g;this.body=h;this.distance=k}},{"../math/vec2":31}],14:[function(a,f){function d(){p.call(this,p.SAP);this.axisList=[];this.axisIndex=0;var a=this;this._addBodyHandler=function(c){a.axisList.push(c.body)};this._removeBodyHandler=function(c){c=a.axisList.indexOf(c.body);
-1!==c&&a.axisList.splice(c,1)}}var e=a("../utils/Utils"),p=a("../collision/Broadphase");f.exports=d;d.prototype=new p;d.prototype.constructor=d;d.prototype.setWorld=function(a){this.axisList.length=0;e.appendArray(this.axisList,a.bodies);a.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);a.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=a};d.sortAxisList=function(a,c){c|=0;for(var d=1,f=a.length;f>d;d++){for(var e=a[d],n=d-1;0<=
n&&!(a[n].aabb.lowerBound[c]<=e.aabb.lowerBound[c]);n--)a[n+1]=a[n];a[n+1]=e}return a};d.prototype.sortList=function(){d.sortAxisList(this.axisList,this.axisIndex)};d.prototype.getCollisionPairs=function(){var a=this.axisList,c=this.result,d=this.axisIndex;c.length=0;for(var f=a.length;f--;){var e=a[f];e.aabbNeedsUpdate&&e.updateAABB()}this.sortList();f=0;for(e=0|a.length;f!==e;f++)for(var n=a[f],g=f+1;e>g;g++){var h=a[g];if(!(h.aabb.lowerBound[d]<=n.aabb.upperBound[d]))break;p.canCollide(n,h)&&this.boundingVolumeCheck(n,
h)&&c.push(n,h)}return c};d.prototype.aabbQuery=function(a,c,d){d=d||[];this.sortList();a=this.axisIndex;var f="x";1===a&&(f="y");2===a&&(f="z");a=this.axisList;for(f=(c.lowerBound[f],c.upperBound[f],0);f<a.length;f++){var e=a[f];e.aabbNeedsUpdate&&e.updateAABB();e.aabb.overlaps(c)&&d.push(e)}return d}},{"../collision/Broadphase":8,"../utils/Utils":50}],15:[function(a,f){function d(a,c,d,f){this.type=d;f=e.defaults(f,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=a;this.bodyB=
c;this.collideConnected=f.collideConnected;f.wakeUpBodies&&(a&&a.wakeUp(),c&&c.wakeUp())}f.exports=d;var e=a("../utils/Utils");d.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};d.DISTANCE=1;d.GEAR=2;d.LOCK=3;d.PRISMATIC=4;d.REVOLUTE=5;d.prototype.setStiffness=function(a){for(var c=this.equations,d=0;d!==c.length;d++){var f=c[d];f.stiffness=a;f.needsUpdate=!0}};d.prototype.setRelaxation=function(a){for(var c=this.equations,d=0;d!==c.length;d++){var f=
c[d];f.relaxation=a;f.needsUpdate=!0}}},{"../utils/Utils":50}],16:[function(a,f){function d(a,c,d){d=h.defaults(d,{localAnchorA:[0,0],localAnchorB:[0,0]});e.call(this,a,c,e.DISTANCE,d);this.localAnchorA=l.fromValues(d.localAnchorA[0],d.localAnchorA[1]);this.localAnchorB=l.fromValues(d.localAnchorB[0],d.localAnchorB[1]);var f=this.localAnchorA,k=this.localAnchorB;if(this.distance=0,"number"==typeof d.distance)this.distance=d.distance;else{var m=l.create(),y=l.create(),t=l.create();l.rotate(m,f,a.angle);
l.rotate(y,k,c.angle);l.add(t,c.position,y);l.sub(t,t,m);l.sub(t,t,a.position);this.distance=l.length(t)}d="undefined"==typeof d.maxForce?Number.MAX_VALUE:d.maxForce;a=new g(a,c,-d,d);this.equations=[a];this.maxForce=d;var t=l.create(),q=l.create(),A=l.create(),D=this;a.computeGq=function(){var a=this.bodyA,c=this.bodyB,d=a.position,e=c.position;return l.rotate(q,f,a.angle),l.rotate(A,k,c.angle),l.add(t,e,A),l.sub(t,t,q),l.sub(t,t,d),l.length(t)-D.distance};this.setMaxForce(d);this.upperLimitEnabled=
!1;this.upperLimit=1;this.lowerLimitEnabled=!1;this.position=this.lowerLimit=0}var e=a("./Constraint"),g=a("../equations/Equation"),l=a("../math/vec2"),h=a("../utils/Utils");f.exports=d;d.prototype=new e;d.prototype.constructor=d;var k=l.create(),m=l.create(),q=l.create();d.prototype.update=function(){var a=this.equations[0],c=this.bodyA,d=this.bodyB,f=(this.distance,c.position),e=d.position,n=this.equations[0],a=a.G;l.rotate(m,this.localAnchorA,c.angle);l.rotate(q,this.localAnchorB,d.angle);l.add(k,
e,q);l.sub(k,k,m);l.sub(k,k,f);this.position=l.length(k);c=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(n.maxForce=0,n.minForce=-this.maxForce,this.distance=this.upperLimit,c=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(n.maxForce=this.maxForce,n.minForce=0,this.distance=this.lowerLimit,c=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!c)return void(n.enabled=!1);n.enabled=!0;l.normalize(k,k);n=l.crossLength(m,k);c=l.crossLength(q,k);a[0]=-k[0];a[1]=-k[1];a[2]=
-n;a[3]=k[0];a[4]=k[1];a[5]=c};d.prototype.setMaxForce=function(a){var c=this.equations[0];c.minForce=-a;c.maxForce=a};d.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":23,"../math/vec2":31,"../utils/Utils":50,"./Constraint":15}],17:[function(a,f){function d(a,c,d){d=d||{};e.call(this,a,c,e.GEAR,d);this.ratio="number"==typeof d.ratio?d.ratio:1;this.angle="number"==typeof d.angle?d.angle:c.angle-this.ratio*a.angle;d.angle=this.angle;d.ratio=this.ratio;
this.equations=[new g(a,c,d)];"number"==typeof d.maxTorque&&this.setMaxTorque(d.maxTorque)}var e=a("./Constraint"),g=(a("../equations/Equation"),a("../equations/AngleLockEquation"));a("../math/vec2");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.update=function(){var a=this.equations[0];a.ratio!==this.ratio&&a.setRatio(this.ratio);a.angle=this.angle};d.prototype.setMaxTorque=function(a){this.equations[0].setMaxTorque(a)};d.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},
{"../equations/AngleLockEquation":21,"../equations/Equation":23,"../math/vec2":31,"./Constraint":15}],18:[function(a,f){function d(a,c,d){d=d||{};e.call(this,a,c,e.LOCK,d);var f="undefined"==typeof d.maxForce?Number.MAX_VALUE:d.maxForce,h=(d.localAngleB||0,new l(a,c,-f,f)),k=new l(a,c,-f,f),m=new l(a,c,-f,f),v=g.create(),y=g.create(),t=this;h.computeGq=function(){return g.rotate(v,t.localOffsetB,a.angle),g.sub(y,c.position,a.position),g.sub(y,y,v),y[0]};k.computeGq=function(){return g.rotate(v,t.localOffsetB,
a.angle),g.sub(y,c.position,a.position),g.sub(y,y,v),y[1]};var q=g.create(),u=g.create();m.computeGq=function(){return g.rotate(q,t.localOffsetB,c.angle-t.localAngleB),g.scale(q,q,-1),g.sub(y,a.position,c.position),g.add(y,y,q),g.rotate(u,q,-Math.PI/2),g.normalize(u,u),g.dot(y,u)};this.localOffsetB=g.create();d.localOffsetB?g.copy(this.localOffsetB,d.localOffsetB):(g.sub(this.localOffsetB,c.position,a.position),g.rotate(this.localOffsetB,this.localOffsetB,-a.angle));this.localAngleB=0;this.localAngleB=
"number"==typeof d.localAngleB?d.localAngleB:c.angle-a.angle;this.equations.push(h,k,m);this.setMaxForce(f)}var e=a("./Constraint"),g=a("../math/vec2"),l=a("../equations/Equation");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.setMaxForce=function(a){for(var c=this.equations,d=0;d<this.equations.length;d++)c[d].maxForce=a,c[d].minForce=-a};d.prototype.getMaxForce=function(){return this.equations[0].maxForce};var h=g.create(),k=g.create(),m=g.create(),q=g.fromValues(1,0),u=g.fromValues(0,
1);d.prototype.update=function(){var a=this.equations[0],c=this.equations[1],d=this.equations[2],f=this.bodyB;g.rotate(h,this.localOffsetB,this.bodyA.angle);g.rotate(k,this.localOffsetB,f.angle-this.localAngleB);g.scale(k,k,-1);g.rotate(m,k,Math.PI/2);g.normalize(m,m);a.G[0]=-1;a.G[1]=0;a.G[2]=-g.crossLength(h,q);a.G[3]=1;c.G[0]=0;c.G[1]=-1;c.G[2]=-g.crossLength(h,u);c.G[4]=1;d.G[0]=-m[0];d.G[1]=-m[1];d.G[3]=m[0];d.G[4]=m[1];d.G[5]=g.crossLength(k,m)}},{"../equations/Equation":23,"../math/vec2":31,
"./Constraint":15}],19:[function(a,f){function d(a,c,d){d=d||{};e.call(this,a,c,e.PRISMATIC,d);var f=h.fromValues(0,0),m=h.fromValues(1,0),t=h.fromValues(0,0);d.localAnchorA&&h.copy(f,d.localAnchorA);d.localAxisA&&h.copy(m,d.localAxisA);d.localAnchorB&&h.copy(t,d.localAnchorB);this.localAnchorA=f;this.localAnchorB=t;this.localAxisA=m;var q=this.maxForce="undefined"!=typeof d.maxForce?d.maxForce:Number.MAX_VALUE,r=new l(a,c,-q,q),u=new h.create,x=new h.create,z=new h.create,K=new h.create;(r.computeGq=
function(){return h.dot(z,K)},r.updateJacobian=function(){var d=this.G,e=a.position,n=c.position;h.rotate(u,f,a.angle);h.rotate(x,t,c.angle);h.add(z,n,x);h.sub(z,z,e);h.sub(z,z,u);h.rotate(K,m,a.angle+Math.PI/2);d[0]=-K[0];d[1]=-K[1];d[2]=-h.crossLength(u,K)+h.crossLength(K,z);d[3]=K[0];d[4]=K[1];d[5]=h.crossLength(x,K)},this.equations.push(r),d.disableRotationalLock)||(r=new k(a,c,-q,q),this.equations.push(r));this.velocity=this.position=0;this.lowerLimitEnabled="undefined"!=typeof d.lowerLimit?
!0:!1;this.upperLimitEnabled="undefined"!=typeof d.upperLimit?!0:!1;this.lowerLimit="undefined"!=typeof d.lowerLimit?d.lowerLimit:0;this.upperLimit="undefined"!=typeof d.upperLimit?d.upperLimit:1;this.upperLimitEquation=new g(a,c);this.lowerLimitEquation=new g(a,c);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=q;this.motorEquation=new l(a,c);this.motorEnabled=!1;this.motorSpeed=0;var M=this;d=this.motorEquation;
d.computeGW;d.computeGq=function(){return 0};d.computeGW=function(){var a=this.bodyA,c=this.bodyB;return this.gmult(this.G,a.velocity,a.angularVelocity,c.velocity,c.angularVelocity)+M.motorSpeed}}var e=a("./Constraint"),g=a("../equations/ContactEquation"),l=a("../equations/Equation"),h=a("../math/vec2"),k=a("../equations/RotationalLockEquation");f.exports=d;d.prototype=new e;d.prototype.constructor=d;var m=h.create(),q=h.create(),u=h.create(),z=h.create(),x=h.create(),r=h.create();d.prototype.update=
function(){var a=this.equations,c=this.upperLimit,d=this.lowerLimit,f=this.upperLimitEquation,e=this.lowerLimitEquation,n=this.bodyA,l=this.bodyB,g=this.localAxisA,p=this.localAnchorA,k=this.localAnchorB;a[0].updateJacobian();h.rotate(m,g,n.angle);h.rotate(z,p,n.angle);h.add(q,z,n.position);h.rotate(x,k,l.angle);h.add(u,x,l.position);g=this.position=h.dot(u,m)-h.dot(q,m);this.motorEnabled&&(p=this.motorEquation.G,p[0]=m[0],p[1]=m[1],p[2]=h.crossLength(m,x),p[3]=-m[0],p[4]=-m[1],p[5]=-h.crossLength(m,
z));this.upperLimitEnabled&&g>c?(h.scale(f.normalA,m,-1),h.sub(f.contactPointA,q,n.position),h.sub(f.contactPointB,u,l.position),h.scale(r,m,c),h.add(f.contactPointA,f.contactPointA,r),-1===a.indexOf(f)&&a.push(f)):(c=a.indexOf(f),-1!==c&&a.splice(c,1));this.lowerLimitEnabled&&d>g?(h.scale(e.normalA,m,1),h.sub(e.contactPointA,q,n.position),h.sub(e.contactPointB,u,l.position),h.scale(r,m,d),h.sub(e.contactPointB,e.contactPointB,r),-1===a.indexOf(e)&&a.push(e)):(c=a.indexOf(e),-1!==c&&a.splice(c,1))};
d.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};d.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1);this.motorEnabled=!1}};d.prototype.setLimits=function(a,c){"number"==typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1);"number"==typeof c?(this.upperLimit=c,this.upperLimitEnabled=!0):(this.upperLimit=
c,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../math/vec2":31,"./Constraint":15}],20:[function(a,f){function d(a,c,d){d=d||{};e.call(this,a,c,e.REVOLUTE,d);var f=this.maxForce="undefined"!=typeof d.maxForce?d.maxForce:Number.MAX_VALUE;this.pivotA=k.create();this.pivotB=k.create();d.worldPivot?(k.sub(this.pivotA,d.worldPivot,a.position),k.sub(this.pivotB,d.worldPivot,c.position),k.rotate(this.pivotA,this.pivotA,
-a.angle),k.rotate(this.pivotB,this.pivotB,-c.angle)):(k.copy(this.pivotA,d.localPivotA),k.copy(this.pivotB,d.localPivotB));var F=this.equations=[new g(a,c,-f,f),new g(a,c,-f,f)];d=F[0];var F=F[1],I=this;d.computeGq=function(){return k.rotate(m,I.pivotA,a.angle),k.rotate(q,I.pivotB,c.angle),k.add(x,c.position,q),k.sub(x,x,a.position),k.sub(x,x,m),k.dot(x,u)};F.computeGq=function(){return k.rotate(m,I.pivotA,a.angle),k.rotate(q,I.pivotB,c.angle),k.add(x,c.position,q),k.sub(x,x,a.position),k.sub(x,
x,m),k.dot(x,z)};F.minForce=d.minForce=-f;F.maxForce=d.maxForce=f;this.motorEquation=new l(a,c);this.motorEnabled=!1;this.angle=0;this.upperLimitEnabled=this.lowerLimitEnabled=!1;this.upperLimit=this.lowerLimit=0;this.upperLimitEquation=new h(a,c);this.lowerLimitEquation=new h(a,c);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}var e=a("./Constraint"),g=a("../equations/Equation"),l=a("../equations/RotationalVelocityEquation"),h=a("../equations/RotationalLockEquation"),k=a("../math/vec2");
f.exports=d;var m=k.create(),q=k.create(),u=k.fromValues(1,0),z=k.fromValues(0,1),x=k.create();d.prototype=new e;d.prototype.constructor=d;d.prototype.setLimits=function(a,c){"number"==typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1);"number"==typeof c?(this.upperLimit=c,this.upperLimitEnabled=!0):(this.upperLimit=c,this.upperLimitEnabled=!1)};d.prototype.update=function(){var a=this.bodyA,c=this.bodyB,d=this.pivotA,f=this.pivotB,e=this.equations,
n=(e[0],e[1],e[0]),l=e[1],g=this.upperLimit,p=this.lowerLimit,h=this.upperLimitEquation,v=this.lowerLimitEquation,x=this.angle=c.angle-a.angle;this.upperLimitEnabled&&x>g?(h.angle=g,-1===e.indexOf(h)&&e.push(h)):(g=e.indexOf(h),-1!==g&&e.splice(g,1));this.lowerLimitEnabled&&p>x?(v.angle=p,-1===e.indexOf(v)&&e.push(v)):(g=e.indexOf(v),-1!==g&&e.splice(g,1));k.rotate(m,d,a.angle);k.rotate(q,f,c.angle);n.G[0]=-1;n.G[1]=0;n.G[2]=-k.crossLength(m,u);n.G[3]=1;n.G[4]=0;n.G[5]=k.crossLength(q,u);l.G[0]=0;
l.G[1]=-1;l.G[2]=-k.crossLength(m,z);l.G[3]=0;l.G[4]=1;l.G[5]=k.crossLength(q,z)};d.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};d.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1);this.motorEnabled=!1}};d.prototype.motorIsEnabled=function(){return!!this.motorEnabled};d.prototype.setMotorSpeed=function(a){if(this.motorEnabled){var c=this.equations.indexOf(this.motorEquation);
this.equations[c].relativeVelocity=a}};d.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../equations/RotationalVelocityEquation":26,"../math/vec2":31,"./Constraint":15}],21:[function(a,f){function d(a,c,d){d=d||{};e.call(this,a,c,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=d.angle||0;this.ratio="number"==typeof d.ratio?d.ratio:1;this.setRatio(this.ratio)}var e=a("./Equation");
a("../math/vec2");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};d.prototype.setRatio=function(a){var c=this.G;c[2]=a;c[5]=-1;this.ratio=a};d.prototype.setMaxTorque=function(a){this.maxForce=a;this.minForce=-a}},{"../math/vec2":31,"./Equation":23}],22:[function(a,f){function d(a,c){e.call(this,a,c,0,Number.MAX_VALUE);this.contactPointA=g.create();this.penetrationVec=g.create();this.contactPointB=
g.create();this.normalA=g.create();this.restitution=0;this.firstImpact=!1;this.shapeB=this.shapeA=null}var e=a("./Equation"),g=a("../math/vec2");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.computeB=function(a,c,d){var f=this.contactPointA,e=this.contactPointB,n=this.bodyA.position,h=this.bodyB.position,k=this.penetrationVec,m=this.normalA,w=this.G,G=g.crossLength(f,m),B=g.crossLength(e,m);w[0]=-m[0];w[1]=-m[1];w[2]=-G;w[3]=m[0];w[4]=m[1];w[5]=B;g.add(k,h,e);g.sub(k,k,n);g.sub(k,
k,f);var F,I;this.firstImpact&&0!==this.restitution?(I=0,F=1/c*(1+this.restitution)*this.computeGW()):(I=g.dot(m,k)+this.offset,F=this.computeGW());f=this.computeGiMf();return-I*a-F*c-d*f}},{"../math/vec2":31,"./Equation":23}],23:[function(a,f){function d(a,c,f,e){this.minForce="undefined"==typeof f?-Number.MAX_VALUE:f;this.maxForce="undefined"==typeof e?Number.MAX_VALUE:e;this.bodyA=a;this.bodyB=c;this.stiffness=d.DEFAULT_STIFFNESS;this.relaxation=d.DEFAULT_RELAXATION;this.G=new g.ARRAY_TYPE(6);
for(a=0;6>a;a++)this.G[a]=0;this.epsilon=this.b=this.a=this.offset=0;this.timeStep=1/60;this.needsUpdate=!0;this.relativeVelocity=this.multiplier=0;this.enabled=!0}f.exports=d;var e=a("../math/vec2"),g=a("../utils/Utils");a("../objects/Body");d.prototype.constructor=d;d.DEFAULT_STIFFNESS=1E6;d.DEFAULT_RELAXATION=4;d.prototype.update=function(){var a=this.stiffness,c=this.relaxation,d=this.timeStep;this.a=4/(d*(1+4*c));this.b=4*c/(1+4*c);this.epsilon=4/(d*d*a*(1+4*c));this.needsUpdate=!1};d.prototype.gmult=
function(a,c,d,f,e){return a[0]*c[0]+a[1]*c[1]+a[2]*d+a[3]*f[0]+a[4]*f[1]+a[5]*e};d.prototype.computeB=function(a,c,d){var f=this.computeGW(),e=this.computeGq(),n=this.computeGiMf();return-e*a-f*c-n*d};var l=e.create(),h=e.create();d.prototype.computeGq=function(){var a=this.G,c=this.bodyA,d=this.bodyB,c=(c.position,d.position,c.angle);return this.gmult(a,l,c,h,d.angle)+this.offset};d.prototype.computeGW=function(){var a=this.bodyA,c=this.bodyB;return this.gmult(this.G,a.velocity,a.angularVelocity,
c.velocity,c.angularVelocity)+this.relativeVelocity};d.prototype.computeGWlambda=function(){var a=this.bodyA,c=this.bodyB;return this.gmult(this.G,a.vlambda,a.wlambda,c.vlambda,c.wlambda)};var k=e.create(),m=e.create();d.prototype.computeGiMf=function(){var a=this.bodyA,c=this.bodyB,d=a.angularForce,f=c.force,l=c.angularForce,g=c.invMassSolve,p=a.invInertiaSolve,c=c.invInertiaSolve,h=this.G;return e.scale(k,a.force,a.invMassSolve),e.scale(m,f,g),this.gmult(h,k,d*p,m,l*c)};d.prototype.computeGiMGt=
function(){var a=this.bodyA,c=this.bodyB,d=a.invMassSolve,f=c.invMassSolve,e=this.G;return e[0]*e[0]*d+e[1]*e[1]*d+e[2]*e[2]*a.invInertiaSolve+e[3]*e[3]*f+e[4]*e[4]*f+e[5]*e[5]*c.invInertiaSolve};var q=e.create(),u=e.create(),z=e.create();e.create();e.create();e.create();d.prototype.addToWlambda=function(a){var c=this.bodyA,d=this.bodyB,f=c.invMassSolve,l=d.invMassSolve,g=c.invInertiaSolve,p=d.invInertiaSolve,h=this.G;u[0]=h[0];u[1]=h[1];z[0]=h[3];z[1]=h[4];e.scale(q,u,f*a);e.add(c.vlambda,c.vlambda,
q);c.wlambda+=g*h[2]*a;e.scale(q,z,l*a);e.add(d.vlambda,d.vlambda,q);d.wlambda+=p*h[5]*a};d.prototype.computeInvC=function(a){return 1/(this.computeGiMGt()+a)}},{"../math/vec2":31,"../objects/Body":32,"../utils/Utils":50}],24:[function(a,f){function d(a,c,d){g.call(this,a,c,-d,d);this.contactPointA=e.create();this.contactPointB=e.create();this.t=e.create();this.contactEquations=[];this.shapeB=this.shapeA=null;this.frictionCoefficient=.3}var e=a("../math/vec2"),g=a("./Equation");a("../utils/Utils");
f.exports=d;d.prototype=new g;d.prototype.constructor=d;d.prototype.setSlipForce=function(a){this.maxForce=a;this.minForce=-a};d.prototype.getSlipForce=function(){return this.maxForce};d.prototype.computeB=function(a,c,d){a=(this.bodyA,this.bodyB,this.contactPointA);var f=this.contactPointB,g=this.t,p=this.G;p[0]=-g[0];p[1]=-g[1];p[2]=-e.crossLength(a,g);p[3]=g[0];p[4]=g[1];p[5]=e.crossLength(f,g);a=this.computeGW();f=this.computeGiMf();return-a*c-d*f}},{"../math/vec2":31,"../utils/Utils":50,"./Equation":23}],
25:[function(a,f){function d(a,c,d){d=d||{};e.call(this,a,c,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=d.angle||0;a=this.G;a[2]=1;a[5]=-1}var e=a("./Equation"),g=a("../math/vec2");f.exports=d;d.prototype=new e;d.prototype.constructor=d;var l=g.create(),h=g.create(),k=g.fromValues(1,0),m=g.fromValues(0,1);d.prototype.computeGq=function(){return g.rotate(l,k,this.bodyA.angle+this.angle),g.rotate(h,m,this.bodyB.angle),g.dot(l,h)}},{"../math/vec2":31,"./Equation":23}],26:[function(a,f){function d(a,
c){e.call(this,a,c,-Number.MAX_VALUE,Number.MAX_VALUE);this.ratio=this.relativeVelocity=1}var e=a("./Equation");a("../math/vec2");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.computeB=function(a,c,d){a=this.G;a[2]=-1;a[5]=this.ratio;a=this.computeGiMf();return-this.computeGW()*c-d*a}},{"../math/vec2":31,"./Equation":23}],27:[function(a,f){var d=function(){};f.exports=d;d.prototype={constructor:d,on:function(a,c,d){c.context=d||this;void 0===this._listeners&&(this._listeners=
{});d=this._listeners;return void 0===d[a]&&(d[a]=[]),-1===d[a].indexOf(c)&&d[a].push(c),this},has:function(a,c){if(void 0===this._listeners)return!1;var d=this._listeners;if(c){if(void 0!==d[a]&&-1!==d[a].indexOf(c))return!0}else if(void 0!==d[a])return!0;return!1},off:function(a,c){if(void 0===this._listeners)return this;var d=this._listeners,f=d[a].indexOf(c);return-1!==f&&d[a].splice(f,1),this},emit:function(a){if(void 0===this._listeners)return this;var c=this._listeners[a.type];if(void 0!==
c){a.target=this;for(var d=0,f=c.length;f>d;d++){var e=c[d];e.call(e.context,a)}}return this}}},{}],28:[function(a,f){function d(a,c,f){if(f=f||{},!(a instanceof e&&c instanceof e))throw Error("First two arguments must be Material instances.");this.id=d.idCounter++;this.materialA=a;this.materialB=c;this.friction="undefined"!=typeof f.friction?Number(f.friction):.3;this.restitution="undefined"!=typeof f.restitution?Number(f.restitution):0;this.stiffness="undefined"!=typeof f.stiffness?Number(f.stiffness):
g.DEFAULT_STIFFNESS;this.relaxation="undefined"!=typeof f.relaxation?Number(f.relaxation):g.DEFAULT_RELAXATION;this.frictionStiffness="undefined"!=typeof f.frictionStiffness?Number(f.frictionStiffness):g.DEFAULT_STIFFNESS;this.frictionRelaxation="undefined"!=typeof f.frictionRelaxation?Number(f.frictionRelaxation):g.DEFAULT_RELAXATION;this.surfaceVelocity="undefined"!=typeof f.surfaceVelocity?Number(f.surfaceVelocity):0;this.contactSkinSize=.005}var e=a("./Material"),g=a("../equations/Equation");
f.exports=d;d.idCounter=0},{"../equations/Equation":23,"./Material":29}],29:[function(a,f){function d(a){this.id=a||d.idCounter++}f.exports=d;d.idCounter=0},{}],30:[function(a,f){var d={GetArea:function(a){if(6>a.length)return 0;for(var c=a.length-2,d=0,f=0;c>f;f+=2)d+=(a[f+2]-a[f])*(a[f+1]+a[f+3]);return d+=(a[0]-a[c])*(a[c+1]+a[1]),.5*-d},Triangulate:function(a){var c=a.length>>1;if(3>c)return[];for(var f=[],e=[],g=0;c>g;g++)e.push(g);for(g=0;3<c;){var h=e[(g+0)%c],k=e[(g+1)%c],m=e[(g+2)%c],z=a[2*
h],x=a[2*h+1],r=a[2*k],w=a[2*k+1],G=a[2*m],B=a[2*m+1],F=!1;if(d._convex(z,x,r,w,G,B))for(var F=!0,I=0;c>I;I++){var A=e[I];if(A!=h&&A!=k&&A!=m&&d._PointInTriangle(a[2*A],a[2*A+1],z,x,r,w,G,B)){F=!1;break}}if(F)f.push(h,k,m),e.splice((g+1)%c,1),c--,g=0;else if(g++>3*c)break}return f.push(e[0],e[1],e[2]),f},_PointInTriangle:function(a,c,d,f,e,g,h,k){h-=d;k-=f;e-=d;g-=f;a-=d;d=c-f;c=h*h+k*k;f=h*e+k*g;h=h*a+k*d;k=e*e+g*g;e=e*a+g*d;g=1/(c*k-f*f);k=(k*h-f*e)*g;h=(c*e-f*h)*g;return 0<=k&&0<=h&&1>k+h},_convex:function(a,
c,d,f,e,g){return 0<=(c-f)*(e-d)+(d-a)*(g-f)}};f.exports=d},{}],31:[function(a,f){var d=f.exports={},e=a("../utils/Utils");d.crossLength=function(a,c){return a[0]*c[1]-a[1]*c[0]};d.crossVZ=function(a,c,f){return d.rotate(a,c,-Math.PI/2),d.scale(a,a,f),a};d.crossZV=function(a,c,f){return d.rotate(a,f,Math.PI/2),d.scale(a,a,c),a};d.rotate=function(a,c,d){if(0!==d){var f=Math.cos(d);d=Math.sin(d);var e=c[0];c=c[1];a[0]=f*e-d*c;a[1]=d*e+f*c}else a[0]=c[0],a[1]=c[1]};d.rotate90cw=function(a,c){var d=c[0];
a[0]=c[1];a[1]=-d};d.toLocalFrame=function(a,c,f,e){d.copy(a,c);d.sub(a,a,f);d.rotate(a,a,-e)};d.toGlobalFrame=function(a,c,f,e){d.copy(a,c);d.rotate(a,a,e);d.add(a,a,f)};d.centroid=function(a,c,f,e){return d.add(a,c,f),d.add(a,a,e),d.scale(a,a,1/3),a};d.create=function(){var a=new e.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a};d.clone=function(a){var c=new e.ARRAY_TYPE(2);return c[0]=a[0],c[1]=a[1],c};d.fromValues=function(a,c){var d=new e.ARRAY_TYPE(2);return d[0]=a,d[1]=c,d};d.copy=function(a,c){return a[0]=
c[0],a[1]=c[1],a};d.set=function(a,c,d){return a[0]=c,a[1]=d,a};d.add=function(a,c,d){return a[0]=c[0]+d[0],a[1]=c[1]+d[1],a};d.subtract=function(a,c,d){return a[0]=c[0]-d[0],a[1]=c[1]-d[1],a};d.sub=d.subtract;d.multiply=function(a,c,d){return a[0]=c[0]*d[0],a[1]=c[1]*d[1],a};d.mul=d.multiply;d.divide=function(a,c,d){return a[0]=c[0]/d[0],a[1]=c[1]/d[1],a};d.div=d.divide;d.scale=function(a,c,d){return a[0]=c[0]*d,a[1]=c[1]*d,a};d.distance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1];return Math.sqrt(d*
d+f*f)};d.dist=d.distance;d.squaredDistance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1];return d*d+f*f};d.sqrDist=d.squaredDistance;d.length=function(a){var c=a[0];a=a[1];return Math.sqrt(c*c+a*a)};d.len=d.length;d.squaredLength=function(a){var c=a[0];a=a[1];return c*c+a*a};d.sqrLen=d.squaredLength;d.negate=function(a,c){return a[0]=-c[0],a[1]=-c[1],a};d.normalize=function(a,c){var d=c[0],f=c[1],d=d*d+f*f;return 0<d&&(d=1/Math.sqrt(d),a[0]=c[0]*d,a[1]=c[1]*d),a};d.dot=function(a,c){return a[0]*c[0]+
a[1]*c[1]};d.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};d.lerp=function(a,c,d,f){var e=c[0];c=c[1];return a[0]=e+f*(d[0]-e),a[1]=c+f*(d[1]-c),a}},{"../utils/Utils":50}],32:[function(a,f){function d(a){a=a||{};k.call(this);this.id=++d._idCounter;this.world=null;this.shapes=[];this.shapeOffsets=[];this.shapeAngles=[];this.mass=a.mass||0;this.invInertiaSolve=this.invMassSolve=this.invInertia=this.inertia=this.invMass=0;this.fixedRotation=!!a.fixedRotation;this.position=e.fromValues(0,0);a.position&&
e.copy(this.position,a.position);this.interpolatedPosition=e.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=e.fromValues(0,0);this.previousAngle=0;this.velocity=e.fromValues(0,0);a.velocity&&e.copy(this.velocity,a.velocity);this.vlambda=e.fromValues(0,0);this.wlambda=0;this.angle=a.angle||0;this.angularVelocity=a.angularVelocity||0;this.force=e.create();a.force&&e.copy(this.force,a.force);this.angularForce=a.angularForce||0;this.damping="number"==typeof a.damping?a.damping:.1;this.angularDamping=
"number"==typeof a.angularDamping?a.angularDamping:.1;this.type=d.STATIC;this.type="undefined"!=typeof a.type?a.type:a.mass?d.DYNAMIC:d.STATIC;this.boundingRadius=0;this.aabb=new h;this.allowSleep=this.aabbNeedsUpdate=!0;this.wantsToSleep=!1;this.sleepState=d.AWAKE;this.sleepSpeedLimit=.2;this.gravityScale=this.sleepTimeLimit=1;this.collisionResponse=!0;this.timeLastSleepy=this.idleTime=0;this.ccdSpeedThreshold=void 0!==a.ccdSpeedThreshold?a.ccdSpeedThreshold:-1;this.ccdIterations=void 0!==a.ccdIterations?
a.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=!1;this.updateMassProperties()}var e=a("../math/vec2"),g=a("poly-decomp"),l=a("../shapes/Convex"),h=a("../collision/AABB"),k=a("../events/EventEmitter");f.exports=d;d.prototype=new k;d.prototype.constructor=d;d._idCounter=0;d.prototype.updateSolveMassProperties=function(){this.sleepState===d.SLEEPING||this.type===d.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)};
d.prototype.setDensity=function(a){this.mass=this.getArea()*a;this.updateMassProperties()};d.prototype.getArea=function(){for(var a=0,c=0;c<this.shapes.length;c++)a+=this.shapes[c].area;return a};d.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var m=new h,q=e.create();d.prototype.updateAABB=function(){for(var a=this.shapes,c=this.shapeOffsets,d=this.shapeAngles,f=a.length,g=this.angle,l=0;l!==f;l++){var p=a[l],h=d[l]+g;e.rotate(q,c[l],g);e.add(q,q,this.position);
p.computeAABB(m,q,h);0===l?this.aabb.copy(m):this.aabb.extend(m)}this.aabbNeedsUpdate=!1};d.prototype.updateBoundingRadius=function(){for(var a=this.shapes,c=this.shapeOffsets,d=a.length,f=0,g=0;g!==d;g++){var l=a[g],p=e.length(c[g]),l=l.boundingRadius;p+l>f&&(f=p+l)}this.boundingRadius=f};d.prototype.addShape=function(a,c,d){d=d||0;c=c?e.fromValues(c[0],c[1]):e.fromValues(0,0);this.shapes.push(a);this.shapeOffsets.push(c);this.shapeAngles.push(d);this.updateMassProperties();this.updateBoundingRadius();
this.aabbNeedsUpdate=!0};d.prototype.removeShape=function(a){a=this.shapes.indexOf(a);return-1!==a?(this.shapes.splice(a,1),this.shapeOffsets.splice(a,1),this.shapeAngles.splice(a,1),this.aabbNeedsUpdate=!0,!0):!1};d.prototype.updateMassProperties=function(){if(this.type===d.STATIC||this.type===d.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var a=this.shapes,c=a.length,f=this.mass/c,g=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,
this.invInertia=0;else{for(var l=0;c>l;l++)var p=a[l],h=e.squaredLength(this.shapeOffsets[l]),p=p.computeMomentOfInertia(f),g=g+(p+f*h);this.inertia=g;this.invInertia=0<g?1/g:0}this.invMass=1/this.mass}};var u=e.create();d.prototype.applyForce=function(a,c){e.sub(u,c,this.position);e.add(this.force,this.force,a);var d=e.crossLength(u,a);this.angularForce+=d};d.prototype.toLocalFrame=function(a,c){e.toLocalFrame(a,c,this.position,this.angle)};d.prototype.toWorldFrame=function(a,c){e.toGlobalFrame(a,
c,this.position,this.angle)};d.prototype.fromPolygon=function(a,c){c=c||{};for(var d=this.shapes.length;0<=d;--d)this.removeShape(this.shapes[d]);var f=new g.Polygon;if(f.vertices=a,f.makeCCW(),"number"==typeof c.removeCollinearPoints&&f.removeCollinearPoints(c.removeCollinearPoints),"undefined"==typeof c.skipSimpleCheck&&!f.isSimple())return!1;this.concavePath=f.vertices.slice(0);for(d=0;d<this.concavePath.length;d++){var h=[0,0];e.copy(h,this.concavePath[d]);this.concavePath[d]=h}for(var f=c.optimalDecomp?
f.decomp():f.quickDecomp(),k=e.create(),d=0;d!==f.length;d++){for(var m=new l(f[d].vertices),v=0;v!==m.vertices.length;v++)h=m.vertices[v],e.sub(h,h,m.centerOfMass);e.scale(k,m.centerOfMass,1);m.updateTriangles();m.updateCenterOfMass();m.updateBoundingRadius();this.addShape(m,k)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var z=(e.fromValues(0,0),e.fromValues(0,0)),x=e.fromValues(0,0),r=e.fromValues(0,0);d.prototype.adjustCenterOfMass=function(){var a=0;e.set(x,0,0);for(var c=0;c!==
this.shapes.length;c++){var d=this.shapes[c],f=this.shapeOffsets[c];e.scale(z,f,d.area);e.add(x,x,z);a+=d.area}e.scale(r,x,1/a);for(c=0;c!==this.shapes.length;c++)(f=this.shapeOffsets[c])||(f=this.shapeOffsets[c]=e.create()),e.sub(f,f,r);e.add(this.position,this.position,r);for(c=0;this.concavePath&&c<this.concavePath.length;c++)e.sub(this.concavePath[c],this.concavePath[c],r);this.updateMassProperties();this.updateBoundingRadius()};d.prototype.setZeroForce=function(){e.set(this.force,0,0);this.angularForce=
0};d.prototype.resetConstraintVelocity=function(){e.set(this.vlambda,0,0);this.wlambda=0};d.prototype.addConstraintVelocity=function(){var a=this.velocity;e.add(a,a,this.vlambda);this.angularVelocity+=this.wlambda};d.prototype.applyDamping=function(a){if(this.type===d.DYNAMIC){var c=this.velocity;e.scale(c,c,Math.pow(1-this.damping,a));this.angularVelocity*=Math.pow(1-this.angularDamping,a)}};d.prototype.wakeUp=function(){var a=this.sleepState;this.sleepState=d.AWAKE;this.idleTime=0;a!==d.AWAKE&&
this.emit(d.wakeUpEvent)};d.prototype.sleep=function(){this.sleepState=d.SLEEPING;this.angularForce=this.angularVelocity=0;e.set(this.velocity,0,0);e.set(this.force,0,0);this.emit(d.sleepEvent)};d.prototype.sleepTick=function(a,c,f){if(this.allowSleep&&this.type!==d.SLEEPING){this.wantsToSleep=!1;a=(this.sleepState,e.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2));var g=Math.pow(this.sleepSpeedLimit,2);a>=g?(this.idleTime=0,this.sleepState=d.AWAKE):(this.idleTime+=f,this.sleepState=
d.SLEEPY);this.idleTime>this.sleepTimeLimit&&(c?this.wantsToSleep=!0:this.sleep())}};d.prototype.getVelocityFromPosition=function(a,c){return a=a||e.create(),e.sub(a,this.position,this.previousPosition),e.scale(a,a,1/c),a};d.prototype.getAngularVelocityFromPosition=function(a){return(this.angle-this.previousAngle)/a};d.prototype.overlaps=function(a){return this.world.overlapKeeper.bodiesAreOverlapping(this,a)};var w=e.create(),G=e.create();d.prototype.integrate=function(a){var c=this.invMass,d=this.force,
f=this.position,g=this.velocity;e.copy(this.previousPosition,this.position);this.previousAngle=this.angle;this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*a);e.scale(w,d,a*c);e.add(g,w,g);this.integrateToTimeOfImpact(a)||(e.scale(G,g,a),e.add(f,f,G),this.fixedRotation||(this.angle+=this.angularVelocity*a));this.aabbNeedsUpdate=!0};var B=e.create(),F=e.create(),I=e.create(),A=e.create();d.prototype.integrateToTimeOfImpact=function(a){if(0>this.ccdSpeedThreshold||e.squaredLength(this.velocity)<
Math.pow(this.ccdSpeedThreshold,2))return!1;e.normalize(B,this.velocity);e.scale(F,this.velocity,a);e.add(F,F,this.position);e.sub(I,F,this.position);var c;a*=this.angularVelocity;var d=e.length(I),f=1,g=this;if(this.world.raycastAll(this.position,F,{},function(a){a.body!==g&&(c=a.body,e.copy(F,a.hitPointWorld),e.sub(I,a.hitPointWorld,g.position),f=e.length(I)/d,a.abort())}),!c)return!1;var l=this.angle;e.copy(A,this.position);for(var p=0,h=0,k=0,m=f;m>=h&&p<this.ccdIterations;)p++,k=(m-h)/2,e.scale(G,
I,f),e.add(this.position,A,G),this.angle=l+a*f,this.updateAABB(),this.aabb.overlaps(c.aabb)&&this.world.narrowphase.bodiesOverlap(this,c)?h=k:m=k;return f=k,e.copy(this.position,A),this.angle=l,e.scale(G,I,f),e.add(this.position,this.position,G),this.fixedRotation||(this.angle+=a*f),!0};d.sleepyEvent={type:"sleepy"};d.sleepEvent={type:"sleep"};d.wakeUpEvent={type:"wakeup"};d.DYNAMIC=1;d.STATIC=2;d.KINEMATIC=4;d.AWAKE=0;d.SLEEPY=1;d.SLEEPING=2},{"../collision/AABB":7,"../events/EventEmitter":27,"../math/vec2":31,
"../shapes/Convex":39,"poly-decomp":5}],33:[function(a,f){function d(a,c,d){d=d||{};g.call(this,a,c,d);this.localAnchorA=e.fromValues(0,0);this.localAnchorB=e.fromValues(0,0);d.localAnchorA&&e.copy(this.localAnchorA,d.localAnchorA);d.localAnchorB&&e.copy(this.localAnchorB,d.localAnchorB);d.worldAnchorA&&this.setWorldAnchorA(d.worldAnchorA);d.worldAnchorB&&this.setWorldAnchorB(d.worldAnchorB);a=e.create();c=e.create();this.getWorldAnchorA(a);this.getWorldAnchorB(c);a=e.distance(a,c);this.restLength=
"number"==typeof d.restLength?d.restLength:a}var e=a("../math/vec2"),g=a("./Spring");a("../utils/Utils");f.exports=d;d.prototype=new g;d.prototype.constructor=d;d.prototype.setWorldAnchorA=function(a){this.bodyA.toLocalFrame(this.localAnchorA,a)};d.prototype.setWorldAnchorB=function(a){this.bodyB.toLocalFrame(this.localAnchorB,a)};d.prototype.getWorldAnchorA=function(a){this.bodyA.toWorldFrame(a,this.localAnchorA)};d.prototype.getWorldAnchorB=function(a){this.bodyB.toWorldFrame(a,this.localAnchorB)};
var l=e.create(),h=e.create(),k=e.create(),m=e.create(),q=e.create(),u=e.create(),z=e.create(),x=e.create(),r=e.create();d.prototype.applyForce=function(){var a=this.stiffness,c=this.damping,d=this.restLength,f=this.bodyA,g=this.bodyB;this.getWorldAnchorA(q);this.getWorldAnchorB(u);e.sub(z,q,f.position);e.sub(x,u,g.position);e.sub(l,u,q);var p=e.len(l);e.normalize(h,l);e.sub(k,g.velocity,f.velocity);e.crossZV(r,g.angularVelocity,x);e.add(k,k,r);e.crossZV(r,f.angularVelocity,z);e.sub(k,k,r);e.scale(m,
h,-a*(p-d)-c*e.dot(k,h));e.sub(f.force,f.force,m);e.add(g.force,g.force,m);a=e.crossLength(z,m);c=e.crossLength(x,m);f.angularForce-=a;g.angularForce+=c}},{"../math/vec2":31,"../utils/Utils":50,"./Spring":35}],34:[function(a,f){function d(a,c,d){d=d||{};e.call(this,a,c,d);this.restAngle="number"==typeof d.restAngle?d.restAngle:c.angle-a.angle}var e=(a("../math/vec2"),a("./Spring"));f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.applyForce=function(){var a=this.bodyA,c=this.bodyB,
d=-this.stiffness*(c.angle-a.angle-this.restAngle)-this.damping*(c.angularVelocity-a.angularVelocity)*0;a.angularForce-=d;c.angularForce+=d}},{"../math/vec2":31,"./Spring":35}],35:[function(a,f){function d(a,c,d){d=e.defaults(d,{stiffness:100,damping:1});this.stiffness=d.stiffness;this.damping=d.damping;this.bodyA=a;this.bodyB=c}var e=(a("../math/vec2"),a("../utils/Utils"));f.exports=d;d.prototype.applyForce=function(){}},{"../math/vec2":31,"../utils/Utils":50}],36:[function(a,f){f.exports={AABB:a("./collision/AABB"),
AngleLockEquation:a("./equations/AngleLockEquation"),Body:a("./objects/Body"),Broadphase:a("./collision/Broadphase"),Capsule:a("./shapes/Capsule"),Circle:a("./shapes/Circle"),Constraint:a("./constraints/Constraint"),ContactEquation:a("./equations/ContactEquation"),ContactMaterial:a("./material/ContactMaterial"),Convex:a("./shapes/Convex"),DistanceConstraint:a("./constraints/DistanceConstraint"),Equation:a("./equations/Equation"),EventEmitter:a("./events/EventEmitter"),FrictionEquation:a("./equations/FrictionEquation"),
GearConstraint:a("./constraints/GearConstraint"),GridBroadphase:a("./collision/GridBroadphase"),GSSolver:a("./solver/GSSolver"),Heightfield:a("./shapes/Heightfield"),Line:a("./shapes/Line"),LockConstraint:a("./constraints/LockConstraint"),Material:a("./material/Material"),Narrowphase:a("./collision/Narrowphase"),NaiveBroadphase:a("./collision/NaiveBroadphase"),Particle:a("./shapes/Particle"),Plane:a("./shapes/Plane"),RevoluteConstraint:a("./constraints/RevoluteConstraint"),PrismaticConstraint:a("./constraints/PrismaticConstraint"),
Ray:a("./collision/Ray"),RaycastResult:a("./collision/RaycastResult"),Rectangle:a("./shapes/Rectangle"),RotationalVelocityEquation:a("./equations/RotationalVelocityEquation"),SAPBroadphase:a("./collision/SAPBroadphase"),Shape:a("./shapes/Shape"),Solver:a("./solver/Solver"),Spring:a("./objects/Spring"),LinearSpring:a("./objects/LinearSpring"),RotationalSpring:a("./objects/RotationalSpring"),Utils:a("./utils/Utils"),World:a("./world/World"),vec2:a("./math/vec2"),version:a("../package.json").version}},
{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/GridBroadphase":9,"./collision/NaiveBroadphase":10,"./collision/Narrowphase":11,"./collision/Ray":12,"./collision/RaycastResult":13,"./collision/SAPBroadphase":14,"./constraints/Constraint":15,"./constraints/DistanceConstraint":16,"./constraints/GearConstraint":17,"./constraints/LockConstraint":18,"./constraints/PrismaticConstraint":19,"./constraints/RevoluteConstraint":20,"./equations/AngleLockEquation":21,"./equations/ContactEquation":22,
"./equations/Equation":23,"./equations/FrictionEquation":24,"./equations/RotationalVelocityEquation":26,"./events/EventEmitter":27,"./material/ContactMaterial":28,"./material/Material":29,"./math/vec2":31,"./objects/Body":32,"./objects/LinearSpring":33,"./objects/RotationalSpring":34,"./objects/Spring":35,"./shapes/Capsule":37,"./shapes/Circle":38,"./shapes/Convex":39,"./shapes/Heightfield":40,"./shapes/Line":41,"./shapes/Particle":42,"./shapes/Plane":43,"./shapes/Rectangle":44,"./shapes/Shape":45,
"./solver/GSSolver":46,"./solver/Solver":47,"./utils/Utils":50,"./world/World":54}],37:[function(a,f){function d(a,c){this.length=a||1;this.radius=c||1;e.call(this,e.CAPSULE)}var e=a("./Shape"),g=a("../math/vec2");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(a){var c=this.radius,d=this.length+c,c=2*c;return a*(c*c+d*d)/12};d.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};d.prototype.updateArea=function(){this.area=
Math.PI*this.radius*this.radius+2*this.radius*this.length};var l=g.create();d.prototype.computeAABB=function(a,c,d){var f=this.radius;g.set(l,this.length/2,0);0!==d&&g.rotate(l,l,d);g.set(a.upperBound,Math.max(l[0]+f,-l[0]+f),Math.max(l[1]+f,-l[1]+f));g.set(a.lowerBound,Math.min(l[0]-f,-l[0]-f),Math.min(l[1]-f,-l[1]-f));g.add(a.lowerBound,a.lowerBound,c);g.add(a.upperBound,a.upperBound,c)}},{"../math/vec2":31,"./Shape":45}],38:[function(a,f){function d(a){this.radius=a||1;e.call(this,e.CIRCLE)}var e=
a("./Shape"),g=a("../math/vec2");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(a){var c=this.radius;return a*c*c/2};d.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};d.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};d.prototype.computeAABB=function(a,c){var d=this.radius;g.set(a.upperBound,d,d);g.set(a.lowerBound,-d,-d);c&&(g.add(a.lowerBound,a.lowerBound,c),g.add(a.upperBound,a.upperBound,
c))}},{"../math/vec2":31,"./Shape":45}],39:[function(a,f){function d(a,c){this.vertices=[];this.axes=[];for(var d=0;d<a.length;d++){var f=g.create();g.copy(f,a[d]);this.vertices.push(f)}if(c)for(d=0;d<c.length;d++)f=g.create(),g.copy(f,c[d]),this.axes.push(f);else for(d=0;d<a.length;d++){var f=a[d],l=a[(d+1)%a.length],h=g.create();g.sub(h,l,f);g.rotate90cw(h,h);g.normalize(h,h);this.axes.push(h)}if(this.centerOfMass=g.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),
this.updateCenterOfMass()),this.boundingRadius=0,e.call(this,e.CONVEX),this.updateBoundingRadius(),this.updateArea(),0>this.area)throw Error("Convex vertices must be given in conter-clockwise winding.");}var e=a("./Shape"),g=a("../math/vec2"),l=a("../math/polyk");a("poly-decomp");f.exports=d;d.prototype=new e;d.prototype.constructor=d;var h=g.create(),k=g.create();d.prototype.projectOntoLocalAxis=function(a,c){var d,f=null,e=null;a=h;for(var n=0;n<this.vertices.length;n++)d=this.vertices[n],d=g.dot(d,
a),(null===f||d>f)&&(f=d),(null===e||e>d)&&(e=d);e>f&&(n=e,e=f,f=n);g.set(c,e,f)};d.prototype.projectOntoWorldAxis=function(a,c,d,f){var e=k;this.projectOntoLocalAxis(a,f);0!==d?g.rotate(e,a,d):e=a;a=g.dot(c,e);g.set(f,f[0]+a,f[1]+a)};d.prototype.updateTriangles=function(){this.triangles.length=0;for(var a=[],c=0;c<this.vertices.length;c++){var d=this.vertices[c];a.push(d[0],d[1])}a=l.Triangulate(a);for(c=0;c<a.length;c+=3)this.triangles.push([a[c],a[c+1],a[c+2]])};var m=g.create(),q=g.create(),u=
g.create(),z=g.create(),x=g.create();g.create();g.create();g.create();g.create();d.prototype.updateCenterOfMass=function(){var a=this.triangles,c=this.vertices,f=this.centerOfMass,e=u,n=z,l=x;g.set(f,0,0);for(var h=0,k=0;k!==a.length;k++)l=a[k],e=c[l[0]],n=c[l[1]],l=c[l[2]],g.centroid(m,e,n,l),e=d.triangleArea(e,n,l),h+=e,g.scale(q,m,e),g.add(f,f,q);g.scale(f,f,1/h)};d.prototype.computeMomentOfInertia=function(a){for(var c=0,d=0,f=this.vertices.length,e=f-1,n=0;f>n;e=n,n++)var l=this.vertices[e],
h=this.vertices[n],e=Math.abs(g.crossLength(l,h)),l=g.dot(h,h)+g.dot(h,l)+g.dot(l,l),c=c+e*l,d=d+e;return a/6*(c/d)};d.prototype.updateBoundingRadius=function(){for(var a=this.vertices,c=0,d=0;d!==a.length;d++){var f=g.squaredLength(a[d]);f>c&&(c=f)}this.boundingRadius=Math.sqrt(c)};d.triangleArea=function(a,c,d){return.5*((c[0]-a[0])*(d[1]-a[1])-(d[0]-a[0])*(c[1]-a[1]))};d.prototype.updateArea=function(){this.updateTriangles();this.area=0;for(var a=this.triangles,c=this.vertices,f=0;f!==a.length;f++){var e=
a[f],e=d.triangleArea(c[e[0]],c[e[1]],c[e[2]]);this.area+=e}};d.prototype.computeAABB=function(a,c,d){a.setFromPoints(this.vertices,c,d,0)}},{"../math/polyk":30,"../math/vec2":31,"./Shape":45,"poly-decomp":5}],40:[function(a,f){function d(a,c){if(c=g.defaults(c,{maxValue:null,minValue:null,elementWidth:.1}),null===c.minValue||null===c.maxValue){c.maxValue=a[0];c.minValue=a[0];for(var d=0;d!==a.length;d++){var f=a[d];f>c.maxValue&&(c.maxValue=f);f<c.minValue&&(c.minValue=f)}}this.data=a;this.maxValue=
c.maxValue;this.minValue=c.minValue;this.elementWidth=c.elementWidth;e.call(this,e.HEIGHTFIELD)}var e=a("./Shape"),g=(a("../math/vec2"),a("../utils/Utils"));f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE};d.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};d.prototype.updateArea=function(){for(var a=this.data,c=0,d=0;d<a.length-1;d++)c+=(a[d]+a[d+1])/2*this.elementWidth;this.area=c};d.prototype.computeAABB=
function(a,c){a.upperBound[0]=this.elementWidth*this.data.length+c[0];a.upperBound[1]=this.maxValue+c[1];a.lowerBound[0]=c[0];a.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45}],41:[function(a,f){function d(a){this.length=a||1;e.call(this,e.LINE)}var e=a("./Shape"),g=a("../math/vec2");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(a){return a*Math.pow(this.length,2)/12};d.prototype.updateBoundingRadius=function(){this.boundingRadius=
this.length/2};var l=[g.create(),g.create()];d.prototype.computeAABB=function(a,c,d){var f=this.length/2;g.set(l[0],-f,0);g.set(l[1],f,0);a.setFromPoints(l,c,d,0)}},{"../math/vec2":31,"./Shape":45}],42:[function(a,f){function d(){e.call(this,e.PARTICLE)}var e=a("./Shape"),g=a("../math/vec2");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(){return 0};d.prototype.updateBoundingRadius=function(){this.boundingRadius=0};d.prototype.computeAABB=function(a,
c){g.copy(a.lowerBound,c);g.copy(a.upperBound,c)}},{"../math/vec2":31,"./Shape":45}],43:[function(a,f){function d(){e.call(this,e.PLANE)}var e=a("./Shape"),g=a("../math/vec2");a("../utils/Utils");f.exports=d;d.prototype=new e;d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(){return 0};d.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};d.prototype.computeAABB=function(a,c,d){var f=0,e=g.set;"number"==typeof d&&(f=d%(2*Math.PI));0===f?(e(a.lowerBound,
-Number.MAX_VALUE,-Number.MAX_VALUE),e(a.upperBound,Number.MAX_VALUE,0)):f===Math.PI/2?(e(a.lowerBound,0,-Number.MAX_VALUE),e(a.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):f===Math.PI?(e(a.lowerBound,-Number.MAX_VALUE,0),e(a.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):f===3*Math.PI/2?(e(a.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),e(a.upperBound,0,Number.MAX_VALUE)):(e(a.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),e(a.upperBound,Number.MAX_VALUE,Number.MAX_VALUE));g.add(a.lowerBound,
a.lowerBound,c);g.add(a.upperBound,a.upperBound,c)};d.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45}],44:[function(a,f){function d(a,c){this.width=a||1;this.height=c||1;var d=[e.fromValues(-a/2,-c/2),e.fromValues(a/2,-c/2),e.fromValues(a/2,c/2),e.fromValues(-a/2,c/2)],f=[e.fromValues(1,0),e.fromValues(0,1)];l.call(this,d,f);this.type=g.RECTANGLE}var e=a("../math/vec2"),g=a("./Shape"),l=a("./Convex");f.exports=d;d.prototype=new l([]);
d.prototype.constructor=d;d.prototype.computeMomentOfInertia=function(a){var c=this.width,d=this.height;return a*(d*d+c*c)/12};d.prototype.updateBoundingRadius=function(){var a=this.width,c=this.height;this.boundingRadius=Math.sqrt(a*a+c*c)/2};e.create();e.create();e.create();e.create();d.prototype.computeAABB=function(a,c,d){a.setFromPoints(this.vertices,c,d,0)};d.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":31,"./Convex":39,"./Shape":45}],45:[function(a,f){function d(a){this.type=
a;this.id=d.idCounter++;this.boundingRadius=0;this.collisionGroup=1;this.collisionResponse=!0;this.collisionMask=1;a&&this.updateBoundingRadius();this.material=null;this.area=0;this.sensor=!1;this.updateArea()}f.exports=d;d.idCounter=0;d.CIRCLE=1;d.PARTICLE=2;d.PLANE=4;d.CONVEX=8;d.LINE=16;d.RECTANGLE=32;d.CAPSULE=64;d.HEIGHTFIELD=128;d.prototype.computeMomentOfInertia=function(){throw Error("Shape.computeMomentOfInertia is not implemented in this Shape...");};d.prototype.updateBoundingRadius=function(){throw Error("Shape.updateBoundingRadius is not implemented in this Shape...");
};d.prototype.updateArea=function(){};d.prototype.computeAABB=function(){}},{}],46:[function(a,f){function d(a){g.call(this,a,g.GS);a=a||{};this.iterations=a.iterations||10;this.tolerance=a.tolerance||1E-10;this.arrayStep=30;this.lambda=new l.ARRAY_TYPE(this.arrayStep);this.Bs=new l.ARRAY_TYPE(this.arrayStep);this.invCs=new l.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=!1;this.usedIterations=this.frictionIterations=0}var e=a("../math/vec2"),g=a("./Solver"),l=a("../utils/Utils"),h=a("../equations/FrictionEquation");
f.exports=d;d.prototype=new g;d.prototype.constructor=d;d.prototype.solve=function(a,c){this.sortEquations();var f=0,g=this.iterations,p=this.frictionIterations,k=this.equations,m=k.length,w=Math.pow(this.tolerance*m,2),G=c.bodies,B=c.bodies.length,F=(e.add,e.set,this.useZeroRHS),I=this.lambda;if(this.usedIterations=0,m)for(var A=0;A!==B;A++)f=G[A],f.updateSolveMassProperties();I.length<m&&(I=this.lambda=new l.ARRAY_TYPE(m+this.arrayStep),this.Bs=new l.ARRAY_TYPE(m+this.arrayStep),this.invCs=new l.ARRAY_TYPE(m+
this.arrayStep));for(var D=I.length;D--;)I[D]=0;for(var D=this.invCs,H=this.Bs,I=this.lambda,A=0;A!==k.length;A++){var C=k[A];(C.timeStep!==a||C.needsUpdate)&&(C.timeStep=a,C.update());H[A]=C.computeB(C.a,C.b,a);D[A]=C.computeInvC(C.epsilon)}var E;if(0!==m){for(A=0;A!==B;A++)f=G[A],f.resetConstraintVelocity();if(p){for(f=0;f!==p;f++){for(A=E=0;A!==m;A++)C=k[A],C=d.iterateEquation(A,C,C.epsilon,H,D,I,F,a,f),E+=Math.abs(C);if(this.usedIterations++,w>=E*E)break}d.updateMultipliers(k,I,1/a);for(A=0;A!==
m;A++)if(p=k[A],p instanceof h){for(C=f=0;C!==p.contactEquations.length;C++)f+=p.contactEquations[C].multiplier;f*=p.frictionCoefficient/p.contactEquations.length;p.maxForce=f;p.minForce=-f}}for(f=0;f!==g;f++){for(A=E=0;A!==m;A++)C=k[A],C=d.iterateEquation(A,C,C.epsilon,H,D,I,F,a,f),E+=Math.abs(C);if(this.usedIterations++,w>=E*E)break}for(A=0;A!==B;A++)G[A].addConstraintVelocity();d.updateMultipliers(k,I,1/a)}};d.updateMultipliers=function(a,c,d){for(var f=a.length;f--;)a[f].multiplier=c[f]*d};d.iterateEquation=
function(a,c,d,f,e,g,n,l){var h=f[a],p=e[a];e=g[a];var k=c.computeGWlambda();f=c.maxForce;var m=c.minForce;n&&(h=0);d=p*(h-k-d*e);n=e+d;return m*l>n?d=m*l-e:n>f*l&&(d=f*l-e),g[a]+=d,c.addToWlambda(d),d}},{"../equations/FrictionEquation":24,"../math/vec2":31,"../utils/Utils":50,"./Solver":47}],47:[function(a,f){function d(a,c){a=a||{};e.call(this);this.type=c;this.equations=[];this.equationSortFunction=a.equationSortFunction||!1}var e=(a("../utils/Utils"),a("../events/EventEmitter"));f.exports=d;d.prototype=
new e;d.prototype.constructor=d;d.prototype.solve=function(){throw Error("Solver.solve should be implemented by subclasses!");};var g={bodies:[]};d.prototype.solveIsland=function(a,c){this.removeAllEquations();c.equations.length&&(this.addEquations(c.equations),g.bodies.length=0,c.getBodies(g.bodies),g.bodies.length&&this.solve(a,g))};d.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)};d.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)};
d.prototype.addEquations=function(a){for(var c=0,d=a.length;c!==d;c++){var f=a[c];f.enabled&&this.equations.push(f)}};d.prototype.removeEquation=function(a){a=this.equations.indexOf(a);-1!==a&&this.equations.splice(a,1)};d.prototype.removeAllEquations=function(){this.equations.length=0};d.GS=1;d.ISLAND=2},{"../events/EventEmitter":27,"../utils/Utils":50}],48:[function(a,f){function d(){this.overlappingShapesLastState=new g;this.overlappingShapesCurrentState=new g;this.recordPool=[];this.tmpDict=new g;
this.tmpArray1=[]}function e(a,c,d,f){this.shapeA=c;this.shapeB=f;this.bodyA=a;this.bodyB=d}var g=a("./TupleDictionary");a("./Utils");f.exports=d;d.prototype.tick=function(){for(var a=this.overlappingShapesLastState,c=this.overlappingShapesCurrentState,d=a.keys.length;d--;){var f=a.keys[d],e=a.getByKey(f),f=c.getByKey(f);e&&!f&&this.recordPool.push(e)}a.reset();a.copy(c);c.reset()};d.prototype.setOverlapping=function(a,c,d,f){var g=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);
if(!g.get(c.id,f.id)){var h;this.recordPool.length?(h=this.recordPool.pop(),h.set(a,c,d,f)):h=new e(a,c,d,f);g.set(c.id,f.id,h)}};d.prototype.getNewOverlaps=function(a){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,a)};d.prototype.getEndOverlaps=function(a){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,a)};d.prototype.bodiesAreOverlapping=function(a,c){for(var d=this.overlappingShapesCurrentState,f=d.keys.length;f--;){var e=
d.data[d.keys[f]];if(e.bodyA===a&&e.bodyB===c||e.bodyA===c&&e.bodyB===a)return!0}return!1};d.prototype.getDiff=function(a,c,d){d=d||[];d.length=0;for(var f=c.keys.length;f--;){var e=c.keys[f],g=c.data[e];if(!g)throw Error("Key "+e+" had no data!");a.data[e]||d.push(g)}return d};d.prototype.isNewOverlap=function(a,c){var d=0|a.id,f=0|c.id,e=this.overlappingShapesCurrentState;return!this.overlappingShapesLastState.get(d,f)&&!!e.get(d,f)};d.prototype.getNewBodyOverlaps=function(a){this.tmpArray1.length=
0;var c=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(c,a)};d.prototype.getEndBodyOverlaps=function(a){this.tmpArray1.length=0;var c=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(c,a)};d.prototype.getBodyDiff=function(a,c){c=c||[];for(var d=this.tmpDict,f=a.length;f--;){var e=a[f];d.set(0|e.bodyA.id,0|e.bodyB.id,e)}for(f=d.keys.length;f--;)(e=d.getByKey(d.keys[f]))&&c.push(e.bodyA,e.bodyB);return d.reset(),c};e.prototype.set=function(a,c,d,f){e.call(this,a,c,d,f)}},{"./TupleDictionary":49,
"./Utils":50}],49:[function(a,f){function d(){this.data={};this.keys=[]}var e=a("./Utils");f.exports=d;d.prototype.getKey=function(a,c){return a|=0,c|=0,(0|a)===(0|c)?-1:0|((0|a)>(0|c)?a<<16|65535&c:c<<16|65535&a)};d.prototype.getByKey=function(a){return a|=0,this.data[a]};d.prototype.get=function(a,c){return this.data[this.getKey(a,c)]};d.prototype.set=function(a,c,d){if(!d)throw Error("No data!");a=this.getKey(a,c);return this.data[a]||this.keys.push(a),this.data[a]=d,a};d.prototype.reset=function(){for(var a=
this.data,c=this.keys,d=c.length;d--;)delete a[c[d]];c.length=0};d.prototype.copy=function(a){this.reset();e.appendArray(this.keys,a.keys);for(var c=a.keys.length;c--;){var d=a.keys[c];this.data[d]=a.data[d]}}},{"./Utils":50}],50:[function(a,f){function d(){}f.exports=d;d.appendArray=function(a,c){if(15E4>c.length)a.push.apply(a,c);else for(var d=0,f=c.length;d!==f;++d)a.push(c[d])};d.splice=function(a,c,d){d=d||1;for(var f=a.length-d;f>c;c++)a[c]=a[c+d];a.length=f};d.ARRAY_TYPE=window.Float32Array||
Array;d.extend=function(a,c){for(var d in c)a[d]=c[d]};d.defaults=function(a,c){a=a||{};for(var d in c)d in a||(a[d]=c[d]);return a}},{}],51:[function(a,f){function d(){this.equations=[];this.bodies=[]}var e=a("../objects/Body");f.exports=d;d.prototype.reset=function(){this.equations.length=this.bodies.length=0};var g=[];d.prototype.getBodies=function(a){a=a||[];for(var c=this.equations,d=g.length=0;d!==c.length;d++){var f=c[d];-1===g.indexOf(f.bodyA.id)&&(a.push(f.bodyA),g.push(f.bodyA.id));-1===
g.indexOf(f.bodyB.id)&&(a.push(f.bodyB),g.push(f.bodyB.id))}return a};d.prototype.wantsToSleep=function(){for(var a=0;a<this.bodies.length;a++){var c=this.bodies[a];if(c.type===e.DYNAMIC&&!c.wantsToSleep)return!1}return!0};d.prototype.sleep=function(){for(var a=0;a<this.bodies.length;a++)this.bodies[a].sleep();return!0}},{"../objects/Body":32}],52:[function(a,f){function d(){this._nodePool=[];this._islandPool=[];this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}var e=(a("../math/vec2"),
a("./Island")),g=a("./IslandNode"),l=a("../objects/Body");f.exports=d;d.getUnvisitedNode=function(a){for(var c=a.length,d=0;d!==c;d++){var f=a[d];if(!f.visited&&f.body.type===l.DYNAMIC)return f}return!1};d.prototype.visit=function(a,c,d){c.push(a.body);c=a.equations.length;for(var f=0;f!==c;f++){var e=a.equations[f];-1===d.indexOf(e)&&d.push(e)}};d.prototype.bfs=function(a,c,f){var e=this.queue;e.length=0;e.push(a);a.visited=!0;for(this.visit(a,c,f);e.length;)for(var g=e.pop();a=d.getUnvisitedNode(g.neighbors);)a.visited=
!0,this.visit(a,c,f),a.body.type===l.DYNAMIC&&e.push(a)};d.prototype.split=function(a){var c=a.bodies;a=this.nodes;for(var f=this.equations;a.length;)this._nodePool.push(a.pop());for(var l=0;l!==c.length;l++)if(this._nodePool.length){var h=this._nodePool.pop();h.reset();h.body=c[l];a.push(h)}else a.push(new g(c[l]));for(h=0;h!==f.length;h++){var k=f[h],l=c.indexOf(k.bodyA),m=c.indexOf(k.bodyB),l=a[l],m=a[m];l.neighbors.push(m);m.neighbors.push(l);l.equations.push(k);m.equations.push(k)}for(c=this.islands;c.length;)f=
c.pop(),f.reset(),this._islandPool.push(f);for(;h=d.getUnvisitedNode(a);)f=this._islandPool.length?this._islandPool.pop():new e,this.bfs(h,f.bodies,f.equations),c.push(f);return c}},{"../math/vec2":31,"../objects/Body":32,"./Island":51,"./IslandNode":53}],53:[function(a,f){function d(a){this.body=a;this.neighbors=[];this.equations=[];this.visited=!1}f.exports=d;d.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=!1;this.body=null}},{}],54:[function(a,f){function d(a){z.apply(this);
a=a||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=a.solver||new e;this.narrowphase=new B(this);this.islandManager=new A;this.gravity=l.fromValues(0,-9.78);a.gravity&&l.copy(this.gravity,a.gravity);this.frictionGravity=l.length(this.gravity)||10;this.useFrictionGravityOnZeroGravity=this.useWorldGravityAsFrictionGravity=!0;this.doProfiling=a.doProfiling||!1;this.lastStepTime=0;this.broadphase=a.broadphase||new G;this.broadphase.setWorld(this);this.constraints=[];
this.defaultMaterial=new r;this.defaultContactMaterial=new w(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.solveConstraints=this.applyGravity=this.applyDamping=this.applySpringForces=!0;this.contactMaterials=[];this.time=0;this.stepping=!1;this.bodiesToBeRemoved=[];this.fixedStepTime=0;this.islandSplit="undefined"!=typeof a.islandSplit?!!a.islandSplit:!1;this.emitImpactEvent=!0;this._bodyIdCounter=this._constraintIdCounter=0;this.postStepEvent={type:"postStep"};this.addBodyEvent=
{type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=d.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,
bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new I}var e=a("../solver/GSSolver"),g=(a("../solver/Solver"),a("../collision/NaiveBroadphase"),a("../collision/Ray")),l=a("../math/vec2"),h=a("../shapes/Circle"),k=(a("../shapes/Rectangle"),a("../shapes/Convex")),m=(a("../shapes/Line"),a("../shapes/Plane")),q=a("../shapes/Capsule"),u=a("../shapes/Particle"),
z=a("../events/EventEmitter"),x=a("../objects/Body"),r=(a("../shapes/Shape"),a("../objects/LinearSpring"),a("../material/Material")),w=a("../material/ContactMaterial"),G=(a("../constraints/DistanceConstraint"),a("../constraints/Constraint"),a("../constraints/LockConstraint"),a("../constraints/RevoluteConstraint"),a("../constraints/PrismaticConstraint"),a("../constraints/GearConstraint"),a("../../package.json"),a("../collision/Broadphase"),a("../collision/SAPBroadphase")),B=a("../collision/Narrowphase"),
F=a("../utils/Utils"),I=a("../utils/OverlapKeeper"),A=a("./IslandManager");a("../objects/RotationalSpring");if(f.exports=d,"undefined"==typeof performance&&(performance={}),!performance.now){var D=Date.now();performance.timing&&performance.timing.navigationStart&&(D=performance.timing.navigationStart);performance.now=function(){return Date.now()-D}}d.prototype=Object(z.prototype);d.prototype.constructor=d;d.NO_SLEEPING=1;d.BODY_SLEEPING=2;d.ISLAND_SLEEPING=4;d.prototype.addConstraint=function(a){this.constraints.push(a)};
d.prototype.addContactMaterial=function(a){this.contactMaterials.push(a)};d.prototype.removeContactMaterial=function(a){a=this.contactMaterials.indexOf(a);-1!==a&&F.splice(this.contactMaterials,a,1)};d.prototype.getContactMaterial=function(a,c){for(var d=this.contactMaterials,f=0,e=d.length;f!==e;f++){var g=d[f];if(g.materialA.id===a.id&&g.materialB.id===c.id||g.materialA.id===c.id&&g.materialB.id===a.id)return g}return!1};d.prototype.removeConstraint=function(a){a=this.constraints.indexOf(a);-1!==
a&&F.splice(this.constraints,a,1)};var H=(l.create(),l.create(),l.create(),l.create(),l.create(),l.create(),l.create()),C=l.fromValues(0,0),E=l.fromValues(0,0),L=(l.fromValues(0,0),l.fromValues(0,0));d.prototype.step=function(a,c,d){if(d=d||10,c=c||0,0===c)this.internalStep(a),this.time+=a;else{var f=Math.floor((this.time+c)/a)-Math.floor(this.time/a),f=Math.min(f,d);d=performance.now();for(var e=0;e!==f&&(this.internalStep(a),!(performance.now()-d>1E3*a));e++);this.time+=c;a=this.time%a/a;for(c=
0;c!==this.bodies.length;c++)f=this.bodies[c],f.type!==x.STATIC&&f.sleepState!==x.SLEEPING?(l.sub(L,f.position,f.previousPosition),l.scale(L,L,a),l.add(f.interpolatedPosition,f.position,L),f.interpolatedAngle=f.angle+(f.angle-f.previousAngle)*a):(l.copy(f.interpolatedPosition,f.position),f.interpolatedAngle=f.angle)}};var K=[];d.prototype.internalStep=function(a){this.stepping=!0;var c,f,e=this.doProfiling,g=this.springs.length,n=this.springs,h=this.bodies,k=this.gravity,p=this.solver,m=this.bodies.length,
v=this.broadphase,t=this.narrowphase,q=this.constraints,y=(l.scale,l.add),u=(l.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=a,e&&(c=performance.now()),this.useWorldGravityAsFrictionGravity){var r=l.length(this.gravity);0===r&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=r)}if(this.applyGravity)for(r=0;r!==m;r++){var w=h[r],z=w.force;w.type===x.DYNAMIC&&w.sleepState!==x.SLEEPING&&(l.scale(H,k,w.mass*w.gravityScale),y(z,z,H))}if(this.applySpringForces)for(r=
0;r!==g;r++)n[r].applyForce();if(this.applyDamping)for(r=0;r!==m;r++)w=h[r],w.type===x.DYNAMIC&&w.applyDamping(a);g=v.getCollisionPairs(this);k=this.disabledBodyCollisionPairs;for(r=k.length-2;0<=r;r-=2)for(n=g.length-2;0<=n;n-=2)(k[r]===g[n]&&k[r+1]===g[n+1]||k[r+1]===g[n]&&k[r]===g[n+1])&&g.splice(n,2);k=q.length;for(r=0;r!==k;r++)if(v=q[r],!v.collideConnected)for(n=g.length-2;0<=n;n-=2)(v.bodyA===g[n]&&v.bodyB===g[n+1]||v.bodyB===g[n]&&v.bodyA===g[n+1])&&g.splice(n,2);this.postBroadphaseEvent.pairs=
g;this.emit(this.postBroadphaseEvent);t.reset(this);r=0;for(k=g.length;r!==k;r+=2)for(v=g[r],y=g[r+1],w=0,z=v.shapes.length;w!==z;w++)for(var A=v.shapes[w],B=v.shapeOffsets[w],C=v.shapeAngles[w],n=0,D=y.shapes.length;n!==D;n++){var E=y.shapes[n],G=y.shapeOffsets[n],I=y.shapeAngles[n],J=this.defaultContactMaterial;if(A.material&&E.material){var L=this.getContactMaterial(A.material,E.material);L&&(J=L)}this.runNarrowphase(t,v,A,B,C,y,E,G,I,J,this.frictionGravity)}for(r=0;r!==m;r++)g=h[r],g._wakeUpAfterNarrowphase&&
(g.wakeUp(),g._wakeUpAfterNarrowphase=!1);if(this.has("endContact"))for(this.overlapKeeper.getEndOverlaps(K),r=this.endContactEvent,n=K.length;n--;)g=K[n],r.shapeA=g.shapeA,r.shapeB=g.shapeB,r.bodyA=g.bodyA,r.bodyB=g.bodyB,this.emit(r);r=this.preSolveEvent;r.contactEquations=t.contactEquations;r.frictionEquations=t.frictionEquations;this.emit(r);k=q.length;for(r=0;r!==k;r++)q[r].update();if(t.contactEquations.length||t.frictionEquations.length||q.length)if(this.islandSplit){u.equations.length=0;F.appendArray(u.equations,
t.contactEquations);F.appendArray(u.equations,t.frictionEquations);for(r=0;r!==k;r++)F.appendArray(u.equations,q[r].equations);u.split(this);for(r=0;r!==u.islands.length;r++)q=u.islands[r],q.equations.length&&p.solveIsland(a,q)}else{p.addEquations(t.contactEquations);p.addEquations(t.frictionEquations);for(r=0;r!==k;r++)p.addEquations(q[r].equations);this.solveConstraints&&p.solve(a,this);p.removeAllEquations()}for(r=0;r!==m;r++)g=h[r],g.sleepState!==x.SLEEPING&&g.type!==x.STATIC&&g.integrate(a);
for(r=0;r!==m;r++)h[r].setZeroForce();if(e&&(f=performance.now(),this.lastStepTime=f-c),this.emitImpactEvent&&this.has("impact"))for(c=this.impactEvent,r=0;r!==t.contactEquations.length;r++)f=t.contactEquations[r],f.firstImpact&&(c.bodyA=f.bodyA,c.bodyB=f.bodyB,c.shapeA=f.shapeA,c.shapeB=f.shapeB,c.contactEquation=f,this.emit(c));if(this.sleepMode===d.BODY_SLEEPING)for(r=0;r!==m;r++)h[r].sleepTick(this.time,!1,a);else if(this.sleepMode===d.ISLAND_SLEEPING&&this.islandSplit){for(r=0;r!==m;r++)h[r].sleepTick(this.time,
!0,a);for(r=0;r<this.islandManager.islands.length;r++)q=this.islandManager.islands[r],q.wantsToSleep()&&q.sleep()}if(this.stepping=!1,this.bodiesToBeRemoved.length){for(r=0;r!==this.bodiesToBeRemoved.length;r++)this.removeBody(this.bodiesToBeRemoved[r]);this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};d.prototype.runNarrowphase=function(a,c,d,f,e,g,n,h,k,p,m){if(0!==(d.collisionGroup&n.collisionMask)&&0!==(n.collisionGroup&d.collisionMask)&&(l.rotate(C,f,c.angle),l.rotate(E,h,g.angle),
l.add(C,C,c.position),l.add(E,E,g.position),f=e+c.angle,k+=g.angle,a.enableFriction=0<p.friction,a.frictionCoefficient=p.friction,a.slipForce=p.friction*m*(c.type===x.STATIC||c.type===x.KINEMATIC?g.mass:g.type===x.STATIC||g.type===x.KINEMATIC?c.mass:c.mass*g.mass/(c.mass+g.mass)),a.restitution=p.restitution,a.surfaceVelocity=p.surfaceVelocity,a.frictionStiffness=p.frictionStiffness,a.frictionRelaxation=p.frictionRelaxation,a.stiffness=p.stiffness,a.relaxation=p.relaxation,a.contactSkinSize=p.contactSkinSize,
a.enabledEquations=c.collisionResponse&&g.collisionResponse&&d.collisionResponse&&n.collisionResponse,m=a[d.type|n.type],p=0,m&&(p=d.sensor||n.sensor,e=a.frictionEquations.length,p=d.type<n.type?m.call(a,c,d,C,f,g,n,E,k,p):m.call(a,g,n,E,k,c,d,C,f,p),f=a.frictionEquations.length-e,p))){c.allowSleep&&c.type===x.DYNAMIC&&c.sleepState===x.SLEEPING&&g.sleepState===x.AWAKE&&g.type!==x.STATIC&&(m=l.squaredLength(g.velocity)+Math.pow(g.angularVelocity,2),k=Math.pow(g.sleepSpeedLimit,2),m>=2*k&&(c._wakeUpAfterNarrowphase=
!0));g.allowSleep&&g.type===x.DYNAMIC&&g.sleepState===x.SLEEPING&&c.sleepState===x.AWAKE&&c.type!==x.STATIC&&(m=l.squaredLength(c.velocity)+Math.pow(c.angularVelocity,2),k=Math.pow(c.sleepSpeedLimit,2),m>=2*k&&(g._wakeUpAfterNarrowphase=!0));if(this.overlapKeeper.setOverlapping(c,d,g,n),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(d,n)){m=this.beginContactEvent;if(m.shapeA=d,m.shapeB=n,m.bodyA=c,m.bodyB=g,m.contactEquations.length=0,"number"==typeof p)for(c=a.contactEquations.length-
p;c<a.contactEquations.length;c++)m.contactEquations.push(a.contactEquations[c]);this.emit(m)}if("number"==typeof p&&1<f)for(c=a.frictionEquations.length-f;c<a.frictionEquations.length;c++)d=a.frictionEquations[c],d.setSlipForce(d.getSlipForce()/f)}};d.prototype.addSpring=function(a){this.springs.push(a);this.addSpringEvent.spring=a;this.emit(this.addSpringEvent)};d.prototype.removeSpring=function(a){a=this.springs.indexOf(a);-1!==a&&F.splice(this.springs,a,1)};d.prototype.addBody=function(a){-1===
this.bodies.indexOf(a)&&(this.bodies.push(a),a.world=this,this.addBodyEvent.body=a,this.emit(this.addBodyEvent))};d.prototype.removeBody=function(a){if(this.stepping)this.bodiesToBeRemoved.push(a);else{a.world=null;var c=this.bodies.indexOf(a);-1!==c&&(F.splice(this.bodies,c,1),this.removeBodyEvent.body=a,a.resetConstraintVelocity(),this.emit(this.removeBodyEvent))}};d.prototype.getBodyById=function(a){for(var c=this.bodies,d=0;d<c.length;d++){var f=c[d];if(f.id===a)return f}return!1};d.prototype.disableBodyCollision=
function(a,c){this.disabledBodyCollisionPairs.push(a,c)};d.prototype.enableBodyCollision=function(a,c){for(var d=this.disabledBodyCollisionPairs,f=0;f<d.length;f+=2)if(d[f]===a&&d[f+1]===c||d[f+1]===a&&d[f]===c)return void d.splice(f,2)};d.prototype.clear=function(){this.fixedStepTime=this.time=0;this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var a=this.constraints,c=a.length-1;0<=c;c--)this.removeConstraint(a[c]);a=this.bodies;for(c=a.length-1;0<=c;c--)this.removeBody(a[c]);
a=this.springs;for(c=a.length-1;0<=c;c--)this.removeSpring(a[c]);a=this.contactMaterials;for(c=a.length-1;0<=c;c--)this.removeContactMaterial(a[c]);d.apply(this)};d.prototype.clone=function(){var a=new d;return a.fromJSON(this.toJSON()),a};var M=l.create(),J=l.fromValues(0,0),N=l.fromValues(0,0);d.prototype.hitTest=function(a,c,d){d=d||0;var f=new x({position:a}),e=new u;f.addShape(e);for(var g=this.narrowphase,n=[],p=0,r=c.length;p!==r;p++)for(var w=c[p],z=0,A=w.shapes.length;z!==A;z++){var B=w.shapes[z],
C=w.shapeAngles[z]||0;l.rotate(M,w.shapeOffsets[z]||J,w.angle);l.add(M,M,w.position);C+=w.angle;(B instanceof h&&g.circleParticle(w,B,M,C,f,e,a,0,!0)||B instanceof k&&g.particleConvex(f,e,a,0,w,B,M,C,!0)||B instanceof m&&g.particlePlane(f,e,a,0,w,B,M,C,!0)||B instanceof q&&g.particleCapsule(f,e,a,0,w,B,M,C,!0)||B instanceof u&&l.squaredLength(l.sub(N,M,a))<d*d)&&n.push(w)}return n};d.prototype.setGlobalEquationParameters=function(a){a=a||{};for(var c=0;c!==this.constraints.length;c++)for(var d=this.constraints[c],
f=0;f!==d.equations.length;f++){var e=d.equations[f];"undefined"!=typeof a.stiffness&&(e.stiffness=a.stiffness);"undefined"!=typeof a.relaxation&&(e.relaxation=a.relaxation);e.needsUpdate=!0}for(c=0;c!==this.contactMaterials.length;c++)d=this.contactMaterials[c],"undefined"!=typeof a.stiffness&&(d.stiffness=a.stiffness,d.frictionStiffness=a.stiffness),"undefined"!=typeof a.relaxation&&(d.relaxation=a.relaxation,d.frictionRelaxation=a.relaxation);d=this.defaultContactMaterial;"undefined"!=typeof a.stiffness&&
(d.stiffness=a.stiffness,d.frictionStiffness=a.stiffness);"undefined"!=typeof a.relaxation&&(d.relaxation=a.relaxation,d.frictionRelaxation=a.relaxation)};d.prototype.setGlobalStiffness=function(a){this.setGlobalEquationParameters({stiffness:a})};d.prototype.setGlobalRelaxation=function(a){this.setGlobalEquationParameters({relaxation:a})};var P=new g;d.prototype.raycastAll=function(a,c,d,f){return d.mode=g.ALL,d.from=a,d.to=c,d.callback=f,P.intersectWorld(this,d)};d.prototype.raycastAny=function(a,
c,d,f){return d.mode=g.ANY,d.from=a,d.to=c,d.result=f,P.intersectWorld(this,d)};d.prototype.raycastClosest=function(a,c,d,f){return d.mode=g.CLOSEST,d.from=a,d.to=c,d.result=f,P.intersectWorld(this,d)}},{"../../package.json":6,"../collision/Broadphase":8,"../collision/NaiveBroadphase":10,"../collision/Narrowphase":11,"../collision/Ray":12,"../collision/SAPBroadphase":14,"../constraints/Constraint":15,"../constraints/DistanceConstraint":16,"../constraints/GearConstraint":17,"../constraints/LockConstraint":18,
"../constraints/PrismaticConstraint":19,"../constraints/RevoluteConstraint":20,"../events/EventEmitter":27,"../material/ContactMaterial":28,"../material/Material":29,"../math/vec2":31,"../objects/Body":32,"../objects/LinearSpring":33,"../objects/RotationalSpring":34,"../shapes/Capsule":37,"../shapes/Circle":38,"../shapes/Convex":39,"../shapes/Line":41,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Rectangle":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":48,
"../utils/Utils":50,"./IslandManager":52}]},{},[36])(36)});p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;a.Physics.P2=function(b,c){this.game=b;"undefined"==typeof c?c={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(c.hasOwnProperty("gravity")||(c.gravity=[0,0]),c.hasOwnProperty("broadphase")||(c.broadphase=new p2.SAPBroadphase));this.config=c;this.world=new p2.World(this.config);this.frameRate=1/60;this.paused=this.useElapsedTime=!1;this.materials=[];this.gravity=new a.Physics.P2.InversePointProxy(this,
this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new a.Signal;this.onBodyRemoved=new a.Signal;this.onSpringAdded=new a.Signal;this.onSpringRemoved=new a.Signal;this.onConstraintAdded=new a.Signal;this.onConstraintRemoved=new a.Signal;this.onContactMaterialAdded=new a.Signal;this.onContactMaterialRemoved=new a.Signal;this.callbackContext=this.postBroadphaseCallback=null;this.onBeginContact=new a.Signal;this.onEndContact=new a.Signal;c.hasOwnProperty("mpx")&&
c.hasOwnProperty("pxm")&&c.hasOwnProperty("mpxi")&&c.hasOwnProperty("pxmi")&&(this.mpx=c.mpx,this.mpxi=c.mpxi,this.pxm=c.pxm,this.pxmi=c.pxmi);this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new a.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new a.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new a.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=
[];this._toRemove=[];this._collisionGroupID=2;this._boundsBottom=this._boundsTop=this._boundsRight=this._boundsLeft=!0;this._boundsOwnGroup=!1;this.setBoundsToWorld(!0,!0,!0,!0,!1)};a.Physics.P2.prototype={removeBodyNextStep:function(b){this._toRemove.push(b)},preUpdate:function(){for(var b=this._toRemove.length;b--;)this.removeBody(this._toRemove[b]);this._toRemove.length=0},enable:function(b,c,f){"undefined"==typeof c&&(c=!1);"undefined"==typeof f&&(f=!0);var d=1;if(Array.isArray(b))for(d=b.length;d--;)b[d]instanceof
a.Group?this.enable(b[d].children,c,f):(this.enableBody(b[d],c),f&&b[d].hasOwnProperty("children")&&0<b[d].children.length&&this.enable(b[d],c,!0));else b instanceof a.Group?this.enable(b.children,c,f):(this.enableBody(b,c),f&&b.hasOwnProperty("children")&&0<b.children.length&&this.enable(b.children,c,!0))},enableBody:function(b,c){b.hasOwnProperty("body")&&null===b.body&&(b.body=new a.Physics.P2.Body(this.game,b,b.x,b.y,1),b.body.debug=c,b.anchor.set(.5))},setImpactEvents:function(b){b?this.world.on("impact",
this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(b,a){this.postBroadphaseCallback=b;this.callbackContext=a;null!==b?this.world.on("postBroadphase",this.postBroadphaseHandler,this):this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(b){if(this.postBroadphaseCallback&&0!==b.pairs.length)for(var a=b.pairs.length-2;0<=a;a-=2)b.pairs[a].parent&&b.pairs[a+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,
b.pairs[a].parent,b.pairs[a+1].parent)&&b.pairs.splice(a,2)},impactHandler:function(b){if(b.bodyA.parent&&b.bodyB.parent){var a=b.bodyA.parent,f=b.bodyB.parent;a._bodyCallbacks[b.bodyB.id]&&a._bodyCallbacks[b.bodyB.id].call(a._bodyCallbackContext[b.bodyB.id],a,f,b.shapeA,b.shapeB);f._bodyCallbacks[b.bodyA.id]&&f._bodyCallbacks[b.bodyA.id].call(f._bodyCallbackContext[b.bodyA.id],f,a,b.shapeB,b.shapeA);a._groupCallbacks[b.shapeB.collisionGroup]&&a._groupCallbacks[b.shapeB.collisionGroup].call(a._groupCallbackContext[b.shapeB.collisionGroup],
a,f,b.shapeA,b.shapeB);f._groupCallbacks[b.shapeA.collisionGroup]&&f._groupCallbacks[b.shapeA.collisionGroup].call(f._groupCallbackContext[b.shapeA.collisionGroup],f,a,b.shapeB,b.shapeA)}},beginContactHandler:function(b){this.onBeginContact.dispatch(b.bodyA,b.bodyB,b.shapeA,b.shapeB,b.contactEquations);b.bodyA.parent&&b.bodyA.parent.onBeginContact.dispatch(b.bodyB.parent,b.shapeA,b.shapeB,b.contactEquations);b.bodyB.parent&&b.bodyB.parent.onBeginContact.dispatch(b.bodyA.parent,b.shapeB,b.shapeA,b.contactEquations)},
endContactHandler:function(b){this.onEndContact.dispatch(b.bodyA,b.bodyB,b.shapeA,b.shapeB);b.bodyA.parent&&b.bodyA.parent.onEndContact.dispatch(b.bodyB.parent,b.shapeA,b.shapeB);b.bodyB.parent&&b.bodyB.parent.onEndContact.dispatch(b.bodyA.parent,b.shapeB,b.shapeA)},setBoundsToWorld:function(b,a,f,d,e){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,b,a,f,d,e)},setWorldMaterial:function(b,a,f,d,e){"undefined"==typeof a&&(a=
!0);"undefined"==typeof f&&(f=!0);"undefined"==typeof d&&(d=!0);"undefined"==typeof e&&(e=!0);a&&this.walls.left&&(this.walls.left.shapes[0].material=b);f&&this.walls.right&&(this.walls.right.shapes[0].material=b);d&&this.walls.top&&(this.walls.top.shapes[0].material=b);e&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=b)},updateBoundsCollisionGroup:function(b){var a=this.everythingCollisionGroup.mask;"undefined"==typeof b&&(a=this.boundsCollisionGroup.mask);this.walls.left&&(this.walls.left.shapes[0].collisionGroup=
a);this.walls.right&&(this.walls.right.shapes[0].collisionGroup=a);this.walls.top&&(this.walls.top.shapes[0].collisionGroup=a);this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=a)},setBounds:function(b,a,f,d,e,g,l,h,k){"undefined"==typeof e&&(e=this._boundsLeft);"undefined"==typeof g&&(g=this._boundsRight);"undefined"==typeof l&&(l=this._boundsTop);"undefined"==typeof h&&(h=this._boundsBottom);"undefined"==typeof k&&(k=this._boundsOwnGroup);this.walls.left&&this.world.removeBody(this.walls.left);
this.walls.right&&this.world.removeBody(this.walls.right);this.walls.top&&this.world.removeBody(this.walls.top);this.walls.bottom&&this.world.removeBody(this.walls.bottom);e&&(this.walls.left=new p2.Body({mass:0,position:[this.pxmi(b),this.pxmi(a)],angle:1.5707963267948966}),this.walls.left.addShape(new p2.Plane),k&&(this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.left));g&&(this.walls.right=new p2.Body({mass:0,position:[this.pxmi(b+f),this.pxmi(a)],
angle:-1.5707963267948966}),this.walls.right.addShape(new p2.Plane),k&&(this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.right));l&&(this.walls.top=new p2.Body({mass:0,position:[this.pxmi(b),this.pxmi(a)],angle:-3.141592653589793}),this.walls.top.addShape(new p2.Plane),k&&(this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.top));h&&(this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(b),
this.pxmi(a+d)]}),this.walls.bottom.addShape(new p2.Plane),k&&(this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.bottom));this._boundsLeft=e;this._boundsRight=g;this._boundsTop=l;this._boundsBottom=h;this._boundsOwnGroup=k},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||this.world.step(this.useElapsedTime?this.game.time.physicsElapsed:this.frameRate)},reset:function(){this.world.on("beginContact",
this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=new a.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new a.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new a.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0;this.world.fixedStepTime=0;this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();
for(var b=this.world.constraints,a=b.length-1;0<=a;a--)this.world.removeConstraint(b[a]);b=this.world.bodies;for(a=b.length-1;0<=a;a--)this.world.removeBody(b[a]);b=this.world.springs;for(a=b.length-1;0<=a;a--)this.world.removeSpring(b[a]);b=this.world.contactMaterials;for(a=b.length-1;0<=a;a--)this.world.removeContactMaterial(b[a]);this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.impactCallback=this.callbackContext=this.postBroadphaseCallback=
null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[]},destroy:function(){this.clear();this.game=null},addBody:function(b){return b.data.world?!1:(this.world.addBody(b.data),this.onBodyAdded.dispatch(b),!0)},removeBody:function(b){return b.data.world==this.world&&(this.world.removeBody(b.data),this.onBodyRemoved.dispatch(b)),b},addSpring:function(b){return this.world.addSpring(b instanceof a.Physics.P2.Spring||b instanceof a.Physics.P2.RotationalSpring?b.data:b),this.onSpringAdded.dispatch(b),
b},removeSpring:function(b){return this.world.removeSpring(b instanceof a.Physics.P2.Spring||b instanceof a.Physics.P2.RotationalSpring?b.data:b),this.onSpringRemoved.dispatch(b),b},createDistanceConstraint:function(b,c,f,d,e,g){return b=this.getBody(b),c=this.getBody(c),b&&c?this.addConstraint(new a.Physics.P2.DistanceConstraint(this,b,c,f,d,e,g)):void console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(b,c,f,d){return b=this.getBody(b),c=this.getBody(c),
b&&c?this.addConstraint(new a.Physics.P2.GearConstraint(this,b,c,f,d)):void console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(b,c,f,d,e,g){return b=this.getBody(b),f=this.getBody(f),b&&f?this.addConstraint(new a.Physics.P2.RevoluteConstraint(this,b,c,f,d,e,g)):void console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(b,c,f,d,e){return b=this.getBody(b),c=this.getBody(c),b&&c?this.addConstraint(new a.Physics.P2.LockConstraint(this,
b,c,f,d,e)):void console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(b,c,f,d,e,g,l){return b=this.getBody(b),c=this.getBody(c),b&&c?this.addConstraint(new a.Physics.P2.PrismaticConstraint(this,b,c,f,d,e,g,l)):void console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(b){return this.world.addConstraint(b),this.onConstraintAdded.dispatch(b),b},removeConstraint:function(b){return this.world.removeConstraint(b),
this.onConstraintRemoved.dispatch(b),b},addContactMaterial:function(b){return this.world.addContactMaterial(b),this.onContactMaterialAdded.dispatch(b),b},removeContactMaterial:function(b){return this.world.removeContactMaterial(b),this.onContactMaterialRemoved.dispatch(b),b},getContactMaterial:function(b,a){return this.world.getContactMaterial(b,a)},setMaterial:function(b,a){for(var f=a.length;f--;)a[f].setMaterial(b)},createMaterial:function(b,c){var f=new a.Physics.P2.Material(b||"");return this.materials.push(f),
"undefined"!=typeof c&&c.setMaterial(f),f},createContactMaterial:function(b,c,f){"undefined"==typeof b&&(b=this.createMaterial());"undefined"==typeof c&&(c=this.createMaterial());b=new a.Physics.P2.ContactMaterial(b,c,f);return this.addContactMaterial(b)},getBodies:function(){for(var b=[],a=this.world.bodies.length;a--;)b.push(this.world.bodies[a].parent);return b},getBody:function(b){return b instanceof p2.Body?b:b instanceof a.Physics.P2.Body?b.data:b.body&&b.body.type===a.Physics.P2JS?b.body.data:
null},getSprings:function(){for(var b=[],a=this.world.springs.length;a--;)b.push(this.world.springs[a].parent);return b},getConstraints:function(){for(var b=[],a=this.world.constraints.length;a--;)b.push(this.world.constraints[a].parent);return b},hitTest:function(b,c,f,d){"undefined"==typeof c&&(c=this.world.bodies);"undefined"==typeof f&&(f=5);"undefined"==typeof d&&(d=!1);b=[this.pxmi(b.x),this.pxmi(b.y)];for(var e=[],g=c.length;g--;)c[g]instanceof a.Physics.P2.Body&&(!d||c[g].data.type!==p2.Body.STATIC)?
e.push(c[g].data):c[g]instanceof p2.Body&&c[g].parent&&(!d||c[g].type!==p2.Body.STATIC)?e.push(c[g]):c[g]instanceof a.Sprite&&c[g].hasOwnProperty("body")&&(!d||c[g].body.data.type!==p2.Body.STATIC)&&e.push(c[g].body.data);return this.world.hitTest(b,e,f)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(b){var c=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask|=c);this.walls.right&&(this.walls.right.shapes[0].collisionMask|=c);
this.walls.top&&(this.walls.top.shapes[0].collisionMask|=c);this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask|=c);this._collisionGroupID++;c=new a.Physics.P2.CollisionGroup(c);return this.collisionGroups.push(c),b&&this.setCollisionGroup(b,c),c},setCollisionGroup:function(b,c){if(b instanceof a.Group)for(var f=0;f<b.total;f++)b.children[f].body&&b.children[f].body.type===a.Physics.P2JS&&b.children[f].body.setCollisionGroup(c);else b.body.setCollisionGroup(c)},createSpring:function(b,c,
f,d,e,g,l,h,k){return b=this.getBody(b),c=this.getBody(c),b&&c?this.addSpring(new a.Physics.P2.Spring(this,b,c,f,d,e,g,l,h,k)):void console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(b,c,f,d,e){return b=this.getBody(b),c=this.getBody(c),b&&c?this.addSpring(new a.Physics.P2.RotationalSpring(this,b,c,f,d,e)):void console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(b,c,f,d,e,g){"undefined"==typeof d&&(d=!1);b=
new a.Physics.P2.Body(this.game,null,b,c,f);return g&&!b.addPolygon(e,g)?!1:(d&&this.world.addBody(b.data),b)},createParticle:function(b,c,f,d,e,g){"undefined"==typeof d&&(d=!1);b=new a.Physics.P2.Body(this.game,null,b,c,f);return g&&!b.addPolygon(e,g)?!1:(d&&this.world.addBody(b.data),b)},convertCollisionObjects:function(b,a,f){"undefined"==typeof f&&(f=!0);for(var d=[],e=0,g=b.collision[a].length;g>e;e++){var l=b.collision[a][e];(l=this.createBody(l.x,l.y,0,f,{},l.polyline))&&d.push(l)}return d},
clearTilemapLayerBodies:function(b,a){a=b.getLayer(a);for(var f=b.layers[a].bodies.length;f--;)b.layers[a].bodies[f].destroy();b.layers[a].bodies.length=0},convertTilemap:function(b,a,f,d){a=b.getLayer(a);"undefined"==typeof f&&(f=!0);"undefined"==typeof d&&(d=!0);this.clearTilemapLayerBodies(b,a);for(var e=0,g=0,l=0,h=0,k=b.layers[a].height;k>h;h++)for(var m=e=0,q=b.layers[a].width;q>m;m++){var u=b.layers[a].data[h][m];if(u&&-1<u.index&&u.collides)if(d){var z=b.getTileRight(a,m,h);(0===e&&(g=u.x*
u.width,l=u.y*u.height,e=u.width),z&&z.collides)?e+=u.width:(z=this.createBody(g,l,0,!1),z.addRectangle(e,u.height,e/2,u.height/2,0),f&&this.addBody(z),b.layers[a].bodies.push(z),e=0)}else z=this.createBody(u.x*u.width,u.y*u.height,0,!1),z.addRectangle(u.width,u.height,u.width/2,u.height/2,0),f&&this.addBody(z),b.layers[a].bodies.push(z)}return b.layers[a].bodies},mpx:function(b){return 20*b},pxm:function(b){return.05*b},mpxi:function(b){return-20*b},pxmi:function(b){return-.05*b}};Object.defineProperty(a.Physics.P2.prototype,
"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(b){this.world.defaultContactMaterial.friction=b}});Object.defineProperty(a.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(b){this.world.defaultContactMaterial.restitution=b}});Object.defineProperty(a.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(b){this.world.defaultContactMaterial=
b}});Object.defineProperty(a.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(b){this.world.applySpringForces=b}});Object.defineProperty(a.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(b){this.world.applyDamping=b}});Object.defineProperty(a.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(b){this.world.applyGravity=b}});Object.defineProperty(a.Physics.P2.prototype,
"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(b){this.world.solveConstraints=b}});Object.defineProperty(a.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(a.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(b){this.world.emitImpactEvent=b}});Object.defineProperty(a.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(b){this.world.sleepMode=
b}});Object.defineProperty(a.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});a.Physics.P2.FixtureList=function(b){Array.isArray(b)||(b=[b]);this.rawList=b;this.init();this.parse(this.rawList)};a.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(b,a){this.getFixtures(a).forEach(function(a){a.collisionGroup=b})},setMask:function(b,a){this.getFixtures(a).forEach(function(a){a.collisionMask=
b})},setSensor:function(b,a){this.getFixtures(a).forEach(function(a){a.sensor=b})},setMaterial:function(b,a){this.getFixtures(a).forEach(function(a){a.material=b})},getFixtures:function(b){var a=[];if(b){b instanceof Array||(b=[b]);var f=this;return b.forEach(function(b){f.namedFixtures[b]&&a.push(f.namedFixtures[b])}),this.flatten(a)}return this.allFixtures},getFixtureByKey:function(b){return this.namedFixtures[b]},getGroup:function(b){return this.groupedFixtures[b]},parse:function(){var b,a,f,d;
f=this.rawList;d=[];for(b in f)a=f[b],isNaN(b-0)?this.namedFixtures[b]=this.flatten(a):(this.groupedFixtures[b]=this.groupedFixtures[b]||[],this.groupedFixtures[b]=this.groupedFixtures[b].concat(a)),d.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(b){var a,f;return a=[],f=arguments.callee,b.forEach(function(b){return Array.prototype.push.apply(a,Array.isArray(b)?f(b):[b])}),a}};a.Physics.P2.PointProxy=function(b,a){this.world=b;this.destination=a};a.Physics.P2.PointProxy.prototype.constructor=
a.Physics.P2.PointProxy;Object.defineProperty(a.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(b){this.destination[0]=this.world.pxm(b)}});Object.defineProperty(a.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(b){this.destination[1]=this.world.pxm(b)}});Object.defineProperty(a.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(b){this.destination[0]=
b}});Object.defineProperty(a.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(b){this.destination[1]=b}});a.Physics.P2.InversePointProxy=function(b,a){this.world=b;this.destination=a};a.Physics.P2.InversePointProxy.prototype.constructor=a.Physics.P2.InversePointProxy;Object.defineProperty(a.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(b){this.destination[0]=this.world.pxmi(b)}});Object.defineProperty(a.Physics.P2.InversePointProxy.prototype,
"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(b){this.destination[1]=this.world.pxmi(b)}});Object.defineProperty(a.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(b){this.destination[0]=-b}});Object.defineProperty(a.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(b){this.destination[1]=-b}});a.Physics.P2.Body=function(b,c,f,d,e){c=c||null;f=f||0;d=d||0;"undefined"==
typeof e&&(e=1);this.game=b;this.world=b.physics.p2;this.sprite=c;this.type=a.Physics.P2JS;this.offset=new a.Point;this.data=new p2.Body({position:[this.world.pxmi(f),this.world.pxmi(d)],mass:e});this.data.parent=this;this.velocity=new a.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new a.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new a.Point;this.onBeginContact=new a.Signal;this.onEndContact=new a.Signal;this.collidesWith=[];this.removeNextStep=
!1;this.debugBody=null;this.dirty=!1;this._collideWorldBounds=!0;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=!1;c&&(this.setRectangleFromSprite(c),c.exists&&this.game.physics.p2.addBody(this))};a.Physics.P2.Body.prototype={createBodyCallback:function(b,a,f){var d=-1;b.id?d=b.id:b.body&&(d=b.body.id);-1<d&&(null===a?(delete this._bodyCallbacks[d],delete this._bodyCallbackContext[d]):(this._bodyCallbacks[d]=a,this._bodyCallbackContext[d]=
f))},createGroupCallback:function(b,a,f){null===a?(delete this._groupCallbacks[b.mask],delete this._groupCallbacksContext[b.mask]):(this._groupCallbacks[b.mask]=a,this._groupCallbackContext[b.mask]=f)},getCollisionMask:function(){var b=0;this._collideWorldBounds&&(b=this.game.physics.p2.boundsCollisionGroup.mask);for(var a=0;a<this.collidesWith.length;a++)b|=this.collidesWith[a].mask;return b},updateCollisionMask:function(b){var a=this.getCollisionMask();if("undefined"==typeof b)for(b=this.data.shapes.length-
1;0<=b;b--)this.data.shapes[b].collisionMask=a;else b.collisionMask=a},setCollisionGroup:function(b,a){var f=this.getCollisionMask();if("undefined"==typeof a)for(var d=this.data.shapes.length-1;0<=d;d--)this.data.shapes[d].collisionGroup=b.mask,this.data.shapes[d].collisionMask=f;else a.collisionGroup=b.mask,a.collisionMask=f},clearCollision:function(b,a,f){if("undefined"==typeof b&&(b=!0),"undefined"==typeof a&&(a=!0),"undefined"==typeof f)for(f=this.data.shapes.length-1;0<=f;f--)b&&(this.data.shapes[f].collisionGroup=
null),a&&(this.data.shapes[f].collisionMask=null);else b&&(f.collisionGroup=null),a&&(f.collisionMask=null);b&&(this.collidesWith.length=0)},collides:function(b,a,f,d){if(Array.isArray(b))for(var e=0;e<b.length;e++)-1===this.collidesWith.indexOf(b[e])&&(this.collidesWith.push(b[e]),a&&this.createGroupCallback(b[e],a,f));else-1===this.collidesWith.indexOf(b)&&(this.collidesWith.push(b),a&&this.createGroupCallback(b,a,f));b=this.getCollisionMask();if("undefined"==typeof d)for(e=this.data.shapes.length-
1;0<=e;e--)this.data.shapes[e].collisionMask=b;else d.collisionMask=b},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},applyDamping:function(b){this.data.applyDamping(b)},applyForce:function(b,a,f){this.data.applyForce(b,[this.world.pxmi(a),this.world.pxmi(f)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=
0;this.data.angularDamping=0},toLocalFrame:function(b,a){return this.data.toLocalFrame(b,a)},toWorldFrame:function(b,a){return this.data.toWorldFrame(b,a)},rotateLeft:function(b){this.data.angularVelocity=this.world.pxm(-b)},rotateRight:function(b){this.data.angularVelocity=this.world.pxm(b)},moveForward:function(b){b=this.world.pxmi(-b);var a=this.data.angle+Math.PI/2;this.data.velocity[0]=b*Math.cos(a);this.data.velocity[1]=b*Math.sin(a)},moveBackward:function(b){b=this.world.pxmi(-b);var a=this.data.angle+
Math.PI/2;this.data.velocity[0]=-(b*Math.cos(a));this.data.velocity[1]=-(b*Math.sin(a))},thrust:function(b){b=this.world.pxmi(-b);var a=this.data.angle+Math.PI/2;this.data.force[0]+=b*Math.cos(a);this.data.force[1]+=b*Math.sin(a)},reverse:function(b){b=this.world.pxmi(-b);var a=this.data.angle+Math.PI/2;this.data.force[0]-=b*Math.cos(a);this.data.force[1]-=b*Math.sin(a)},moveLeft:function(b){this.data.velocity[0]=this.world.pxmi(-b)},moveRight:function(b){this.data.velocity[0]=this.world.pxmi(b)},
moveUp:function(b){this.data.velocity[1]=this.world.pxmi(-b)},moveDown:function(b){this.data.velocity[1]=this.world.pxmi(b)},preUpdate:function(){this.dirty=!0;this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]);this.sprite.y=this.world.mpxi(this.data.position[1]);this.fixedRotation||(this.sprite.rotation=this.data.angle);this.debugBody&&this.debugBody.updateSpriteTransform();this.dirty=!1},reset:function(b,
a,f,d){"undefined"==typeof f&&(f=!1);"undefined"==typeof d&&(d=!1);this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();f&&this.setZeroDamping();d&&(this.mass=1);this.x=b;this.y=a},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var b=0;b<this.game.physics.p2._toRemove.length;b++)this.game.physics.p2._toRemove[b]===this&&this.game.physics.p2._toRemove.splice(b,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===
this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this.debugBody&&this.debugBody.destroy(!0,!0);this.debugBody=null;this.sprite=this.sprite.body=null},clearShapes:function(){for(var b=this.data.shapes.length;b--;)this.data.removeShape(this.data.shapes[b]);this.shapeChanged()},addShape:function(b,a,f,d){return"undefined"==
typeof a&&(a=0),"undefined"==typeof f&&(f=0),"undefined"==typeof d&&(d=0),this.data.addShape(b,[this.world.pxmi(a),this.world.pxmi(f)],d),this.shapeChanged(),b},addCircle:function(b,a,f,d){b=new p2.Circle(this.world.pxm(b));return this.addShape(b,a,f,d)},addRectangle:function(b,a,f,d,e){b=new p2.Rectangle(this.world.pxm(b),this.world.pxm(a));return this.addShape(b,f,d,e)},addPlane:function(b,a,f){var d=new p2.Plane;return this.addShape(d,b,a,f)},addParticle:function(b,a,f){var d=new p2.Particle;return this.addShape(d,
b,a,f)},addLine:function(b,a,f,d){b=new p2.Line(this.world.pxm(b));return this.addShape(b,a,f,d)},addCapsule:function(b,a,f,d,e){b=new p2.Capsule(this.world.pxm(b),this.world.pxm(a));return this.addShape(b,f,d,e)},addPolygon:function(b,a){b=b||{};Array.isArray(a)||(a=Array.prototype.slice.call(arguments,1));var f=[];if(1===a.length&&Array.isArray(a[0]))f=a[0].slice(0);else if(Array.isArray(a[0]))f=a.slice();else if("number"==typeof a[0])for(var d=0,e=a.length;e>d;d+=2)f.push([a[d],a[d+1]]);d=f.length-
1;f[d][0]===f[0][0]&&f[d][1]===f[0][1]&&f.pop();for(d=0;d<f.length;d++)f[d][0]=this.world.pxmi(f[d][0]),f[d][1]=this.world.pxmi(f[d][1]);f=this.data.fromPolygon(f,b);return this.shapeChanged(),f},removeShape:function(a){a=this.data.removeShape(a);return this.shapeChanged(),a},setCircle:function(a,c,f,d){return this.clearShapes(),this.addCircle(a,c,f,d)},setRectangle:function(a,c,f,d,e){return"undefined"==typeof a&&(a=16),"undefined"==typeof c&&(c=16),this.clearShapes(),this.addRectangle(a,c,f,d,e)},
setRectangleFromSprite:function(a){return"undefined"==typeof a&&(a=this.sprite),this.clearShapes(),this.addRectangle(a.width,a.height,0,0,a.rotation)},setMaterial:function(a,c){if("undefined"==typeof c)for(var f=this.data.shapes.length-1;0<=f;f--)this.data.shapes[f].material=a;else c.material=a},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(a,c){for(var f=this.game.cache.getPhysicsData(a,c),d=[],e=0;e<f.length;e++){var g=f[e],l=this.addFixture(g);d[g.filter.group]=
d[g.filter.group]||[];d[g.filter.group]=d[g.filter.group].concat(l);g.fixtureKey&&(d[g.fixtureKey]=l)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),d},addFixture:function(a){var c=[];if(a.circle){var f=new p2.Circle(this.world.pxm(a.circle.radius));f.collisionGroup=a.filter.categoryBits;f.collisionMask=a.filter.maskBits;f.sensor=a.isSensor;var d=p2.vec2.create();d[0]=this.world.pxmi(a.circle.position[0]-this.sprite.width/2);d[1]=this.world.pxmi(a.circle.position[1]-this.sprite.height/2);
this.data.addShape(f,d);c.push(f)}else for(var d=a.polygons,e=p2.vec2.create(),g=0;g<d.length;g++){for(var f=d[g],l=[],h=0;h<f.length;h+=2)l.push([this.world.pxmi(f[h]),this.world.pxmi(f[h+1])]);f=new p2.Convex(l);for(l=0;l!==f.vertices.length;l++)h=f.vertices[l],p2.vec2.sub(h,h,f.centerOfMass);p2.vec2.scale(e,f.centerOfMass,1);e[0]-=this.world.pxmi(this.sprite.width/2);e[1]-=this.world.pxmi(this.sprite.height/2);f.updateTriangles();f.updateCenterOfMass();f.updateBoundingRadius();f.collisionGroup=
a.filter.categoryBits;f.collisionMask=a.filter.maskBits;f.sensor=a.isSensor;this.data.addShape(f,e);c.push(f)}return c},loadPolygon:function(a,c){for(var f=this.game.cache.getPhysicsData(a,c),d=p2.vec2.create(),e=0;e<f.length;e++){for(var g=[],l=0;l<f[e].shape.length;l+=2)g.push([this.world.pxmi(f[e].shape[l]),this.world.pxmi(f[e].shape[l+1])]);g=new p2.Convex(g);for(l=0;l!==g.vertices.length;l++){var h=g.vertices[l];p2.vec2.sub(h,h,g.centerOfMass)}p2.vec2.scale(d,g.centerOfMass,1);d[0]-=this.world.pxmi(this.sprite.width/
2);d[1]-=this.world.pxmi(this.sprite.height/2);g.updateTriangles();g.updateCenterOfMass();g.updateBoundingRadius();this.data.addShape(g,d)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}};a.Physics.P2.Body.prototype.constructor=a.Physics.P2.Body;a.Physics.P2.Body.DYNAMIC=1;a.Physics.P2.Body.STATIC=2;a.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(a.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===a.Physics.P2.Body.STATIC},set:function(b){b&&this.data.type!==
a.Physics.P2.Body.STATIC?(this.data.type=a.Physics.P2.Body.STATIC,this.mass=0):b||this.data.type!==a.Physics.P2.Body.STATIC||(this.data.type=a.Physics.P2.Body.DYNAMIC,0===this.mass&&(this.mass=1))}});Object.defineProperty(a.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===a.Physics.P2.Body.DYNAMIC},set:function(b){b&&this.data.type!==a.Physics.P2.Body.DYNAMIC?(this.data.type=a.Physics.P2.Body.DYNAMIC,0===this.mass&&(this.mass=1)):b||this.data.type!==a.Physics.P2.Body.DYNAMIC||
(this.data.type=a.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(a.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===a.Physics.P2.Body.KINEMATIC},set:function(b){b&&this.data.type!==a.Physics.P2.Body.KINEMATIC?(this.data.type=a.Physics.P2.Body.KINEMATIC,this.mass=4):b||this.data.type!==a.Physics.P2.Body.KINEMATIC||(this.data.type=a.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(a.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},
set:function(a){a!==this.data.allowSleep&&(this.data.allowSleep=a)}});Object.defineProperty(a.Physics.P2.Body.prototype,"angle",{get:function(){return a.Math.wrapAngle(a.Math.radToDeg(this.data.angle))},set:function(b){this.data.angle=a.Math.degToRad(a.Math.wrapAngle(b))}});Object.defineProperty(a.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(a){this.data.angularDamping=a}});Object.defineProperty(a.Physics.P2.Body.prototype,"angularForce",
{get:function(){return this.data.angularForce},set:function(a){this.data.angularForce=a}});Object.defineProperty(a.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(a){this.data.angularVelocity=a}});Object.defineProperty(a.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(a){this.data.damping=a}});Object.defineProperty(a.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},
set:function(a){a!==this.data.fixedRotation&&(this.data.fixedRotation=a)}});Object.defineProperty(a.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(a){this.data.inertia=a}});Object.defineProperty(a.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(a){a!==this.data.mass&&(this.data.mass=a,this.data.updateMassProperties())}});Object.defineProperty(a.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},
set:function(a){a!==this.data.type&&(this.data.type=a)}});Object.defineProperty(a.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(a){this.data.angle=a}});Object.defineProperty(a.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(a){this.data.sleepSpeedLimit=a}});Object.defineProperty(a.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(a){this.data.position[0]=
this.world.pxmi(a)}});Object.defineProperty(a.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(a){this.data.position[1]=this.world.pxmi(a)}});Object.defineProperty(a.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(a.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(b){b&&!this.debugBody?this.debugBody=new a.Physics.P2.BodyDebug(this.game,this.data):!b&&this.debugBody&&
(this.debugBody.destroy(),this.debugBody=null)}});Object.defineProperty(a.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(a){a&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!a&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}});a.Physics.P2.BodyDebug=function(b,c,f){a.Group.call(this,b);this.settings=a.Utils.extend({pixelsPerLengthUnit:20,debugPolygons:!1,lineWidth:1,
alpha:.5},f);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu*=-1;this.body=c;this.canvas=new a.Graphics(b);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};a.Physics.P2.BodyDebug.prototype=Object.create(a.Group.prototype);a.Physics.P2.BodyDebug.prototype.constructor=a.Physics.P2.BodyDebug;a.Utils.extend(a.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*
this.ppu;this.rotation=this.body.angle},draw:function(){var a,c,f,d,e,g,l,h,k,m,q,u,z;if(l=this.body,k=this.canvas,k.clear(),f=parseInt(this.randomPastelHex(),16),g=this.lineWidth,l instanceof p2.Body&&l.shapes.length){var x=l.shapes.length;for(d=0;d!==x;){if(c=l.shapes[d],h=l.shapeOffsets[d],a=l.shapeAngles[d],h=h||0,a=a||0,c instanceof p2.Circle)this.drawCircle(k,h[0]*this.ppu,h[1]*this.ppu,a,c.radius*this.ppu,f,g);else if(c instanceof p2.Capsule)this.drawCapsule(k,h[0]*this.ppu,h[1]*this.ppu,a,
c.length*this.ppu,c.radius*this.ppu,16711680,f,g);else if(c instanceof p2.Plane)this.drawPlane(k,h[0]*this.ppu,-h[1]*this.ppu,f,16711680,5*g,10*g,10*g,100*this.ppu,a);else if(c instanceof p2.Line)this.drawLine(k,c.length*this.ppu,16711680,g);else if(c instanceof p2.Rectangle)this.drawRectangle(k,h[0]*this.ppu,h[1]*this.ppu,a,c.width*this.ppu,c.height*this.ppu,16711680,f,g);else if(c instanceof p2.Convex){m=[];q=p2.vec2.create();e=u=0;for(z=c.vertices.length;0<=z?z>u:u>z;e=0<=z?++u:--u)e=c.vertices[e],
p2.vec2.rotate(q,e,a),m.push([(q[0]+h[0])*this.ppu,-(q[1]+h[1])*this.ppu]);this.drawConvex(k,m,c.triangles,16711680,f,g,this.settings.debugPolygons,[h[0]*this.ppu,-h[1]*this.ppu])}d++}}},drawRectangle:function(a,c,f,d,e,g,l,h,k){"undefined"==typeof k&&(k=1);"undefined"==typeof l&&(l=0);a.lineStyle(k,l,1);a.beginFill(h);a.drawRect(c-e/2,f-g/2,e,g)},drawCircle:function(a,c,f,d,e,g,l){"undefined"==typeof l&&(l=1);"undefined"==typeof g&&(g=16777215);a.lineStyle(l,0,1);a.beginFill(g,1);a.drawCircle(c,
f,2*-e);a.endFill();a.moveTo(c,f);a.lineTo(c+e*Math.cos(-d),f+e*Math.sin(-d))},drawLine:function(a,c,f,d){"undefined"==typeof d&&(d=1);"undefined"==typeof f&&(f=0);a.lineStyle(5*d,f,1);a.moveTo(-c/2,0);a.lineTo(c/2,0)},drawConvex:function(a,c,f,d,e,g,l,h){var k,m;if("undefined"==typeof g&&(g=1),"undefined"==typeof d&&(d=0),l){d=[16711680,65280,255];for(f=0;f!==c.length+1;)k=c[f%c.length],l=c[(f+1)%c.length],e=k[0],m=k[1],k=l[0],l=l[1],a.lineStyle(g,d[f%d.length],1),a.moveTo(e,-m),a.lineTo(k,-l),a.drawCircle(e,
-m,2*g),f++;return a.lineStyle(g,0,1),a.drawCircle(h[0],h[1],2*g)}a.lineStyle(g,d,1);a.beginFill(e);for(f=0;f!==c.length;)h=c[f],g=h[0],h=h[1],0===f?a.moveTo(g,-h):a.lineTo(g,-h),f++;return a.endFill(),2<c.length?(a.moveTo(c[c.length-1][0],-c[c.length-1][1]),a.lineTo(c[0][0],-c[0][1])):void 0},drawPath:function(a,c,f,d,e){var g,l,h,k,m,q,u,z,x,r;"undefined"==typeof e&&(e=1);"undefined"==typeof f&&(f=0);a.lineStyle(e,f,1);"number"==typeof d&&a.beginFill(d);l=e=null;for(f=0;f<c.length;)x=c[f],r=x[0],
x=x[1],(r!==e||x!==l)&&(0===f?a.moveTo(r,x):(h=e,k=l,m=r,q=x,u=c[(f+1)%c.length][0],z=c[(f+1)%c.length][1],g=(m-h)*(z-k)-(u-h)*(q-k),0!==g&&a.lineTo(r,x)),e=r,l=x),f++;"number"==typeof d&&a.endFill();2<c.length&&"number"==typeof d&&(a.moveTo(c[c.length-1][0],c[c.length-1][1]),a.lineTo(c[0][0],c[0][1]))},drawPlane:function(a,c,f,d,e,g,l,h,k,m){"undefined"==typeof g&&(g=1);"undefined"==typeof d&&(d=16777215);a.lineStyle(g,e,11);a.beginFill(d);a.moveTo(c,-f);d=c+Math.cos(m)*this.game.width;e=f+Math.sin(m)*
this.game.height;a.lineTo(d,-e);a.moveTo(c,-f);d=c+Math.cos(m)*-this.game.width;e=f+Math.sin(m)*-this.game.height;a.lineTo(d,-e)},drawCapsule:function(a,c,f,d,e,g,h,k,m){"undefined"==typeof m&&(m=1);"undefined"==typeof h&&(h=0);a.lineStyle(m,h,1);var t=Math.cos(d);d=Math.sin(d);a.beginFill(k,1);a.drawCircle(-e/2*t+c,-e/2*d+f,2*-g);a.drawCircle(e/2*t+c,e/2*d+f,2*-g);a.endFill();a.lineStyle(m,h,0);a.beginFill(k,1);a.moveTo(-e/2*t+g*d+c,-e/2*d+g*t+f);a.lineTo(e/2*t+g*d+c,e/2*d+g*t+f);a.lineTo(e/2*t-
g*d+c,e/2*d-g*t+f);a.lineTo(-e/2*t-g*d+c,-e/2*d-g*t+f);a.endFill();a.lineStyle(m,h,1);a.moveTo(-e/2*t+g*d+c,-e/2*d+g*t+f);a.lineTo(e/2*t+g*d+c,e/2*d+g*t+f);a.moveTo(-e/2*t-g*d+c,-e/2*d-g*t+f);a.lineTo(e/2*t-g*d+c,e/2*d-g*t+f)},randomPastelHex:function(){var a,c,f,d;return f=[255,255,255],d=Math.floor(256*Math.random()),c=Math.floor(256*Math.random()),a=Math.floor(256*Math.random()),d=Math.floor((d+3*f[0])/4),c=Math.floor((c+3*f[1])/4),a=Math.floor((a+3*f[2])/4),this.rgbToHex(d,c,a)},rgbToHex:function(a,
c,f){return this.componentToHex(a)+this.componentToHex(c)+this.componentToHex(f)},componentToHex:function(a){var c;return c=a.toString(16),2===c.len?c:c+"0"}});a.Physics.P2.Spring=function(a,c,f,d,e,g,h,k,m,t){this.game=a.game;this.world=a;"undefined"==typeof d&&(d=1);"undefined"==typeof e&&(e=100);"undefined"==typeof g&&(g=1);d=a.pxm(d);d={restLength:d,stiffness:e,damping:g};"undefined"!=typeof h&&null!==h&&(d.worldAnchorA=[a.pxm(h[0]),a.pxm(h[1])]);"undefined"!=typeof k&&null!==k&&(d.worldAnchorB=
[a.pxm(k[0]),a.pxm(k[1])]);"undefined"!=typeof m&&null!==m&&(d.localAnchorA=[a.pxm(m[0]),a.pxm(m[1])]);"undefined"!=typeof t&&null!==t&&(d.localAnchorB=[a.pxm(t[0]),a.pxm(t[1])]);this.data=new p2.LinearSpring(c,f,d);this.data.parent=this};a.Physics.P2.Spring.prototype.constructor=a.Physics.P2.Spring;a.Physics.P2.RotationalSpring=function(a,c,f,d,e,g){this.game=a.game;this.world=a;"undefined"==typeof d&&(d=null);"undefined"==typeof e&&(e=100);"undefined"==typeof g&&(g=1);d&&(d=a.pxm(d));this.data=
new p2.RotationalSpring(c,f,{restAngle:d,stiffness:e,damping:g});this.data.parent=this};a.Physics.P2.Spring.prototype.constructor=a.Physics.P2.Spring;a.Physics.P2.Material=function(a){this.name=a;p2.Material.call(this)};a.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);a.Physics.P2.Material.prototype.constructor=a.Physics.P2.Material;a.Physics.P2.ContactMaterial=function(a,c,f){p2.ContactMaterial.call(this,a,c,f)};a.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);
a.Physics.P2.ContactMaterial.prototype.constructor=a.Physics.P2.ContactMaterial;a.Physics.P2.CollisionGroup=function(a){this.mask=a};a.Physics.P2.DistanceConstraint=function(a,c,f,d,e,g,h){"undefined"==typeof d&&(d=100);"undefined"==typeof e&&(e=[0,0]);"undefined"==typeof g&&(g=[0,0]);"undefined"==typeof h&&(h=Number.MAX_VALUE);this.game=a.game;this.world=a;d=a.pxm(d);e=[a.pxmi(e[0]),a.pxmi(e[1])];g=[a.pxmi(g[0]),a.pxmi(g[1])];p2.DistanceConstraint.call(this,c,f,{distance:d,localAnchorA:e,localAnchorB:g,
maxForce:h})};a.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);a.Physics.P2.DistanceConstraint.prototype.constructor=a.Physics.P2.DistanceConstraint;a.Physics.P2.GearConstraint=function(a,c,f,d,e){"undefined"==typeof d&&(d=0);"undefined"==typeof e&&(e=1);this.game=a.game;this.world=a;p2.GearConstraint.call(this,c,f,{angle:d,ratio:e})};a.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);a.Physics.P2.GearConstraint.prototype.constructor=
a.Physics.P2.GearConstraint;a.Physics.P2.LockConstraint=function(a,c,f,d,e,g){"undefined"==typeof d&&(d=[0,0]);"undefined"==typeof e&&(e=0);"undefined"==typeof g&&(g=Number.MAX_VALUE);this.game=a.game;this.world=a;d=[a.pxm(d[0]),a.pxm(d[1])];p2.LockConstraint.call(this,c,f,{localOffsetB:d,localAngleB:e,maxForce:g})};a.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);a.Physics.P2.LockConstraint.prototype.constructor=a.Physics.P2.LockConstraint;a.Physics.P2.PrismaticConstraint=
function(a,c,f,d,e,g,h,k){"undefined"==typeof d&&(d=!0);"undefined"==typeof e&&(e=[0,0]);"undefined"==typeof g&&(g=[0,0]);"undefined"==typeof h&&(h=[0,0]);"undefined"==typeof k&&(k=Number.MAX_VALUE);this.game=a.game;this.world=a;e=[a.pxmi(e[0]),a.pxmi(e[1])];g=[a.pxmi(g[0]),a.pxmi(g[1])];p2.PrismaticConstraint.call(this,c,f,{localAnchorA:e,localAnchorB:g,localAxisA:h,maxForce:k,disableRotationalLock:!d})};a.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);a.Physics.P2.PrismaticConstraint.prototype.constructor=
a.Physics.P2.PrismaticConstraint;a.Physics.P2.RevoluteConstraint=function(a,c,f,d,e,g,h){"undefined"==typeof g&&(g=Number.MAX_VALUE);"undefined"==typeof h&&(h=null);this.game=a.game;this.world=a;f=[a.pxmi(f[0]),a.pxmi(f[1])];e=[a.pxmi(e[0]),a.pxmi(e[1])];h&&(h=[a.pxmi(h[0]),a.pxmi(h[1])]);p2.RevoluteConstraint.call(this,c,d,{worldPivot:h,localPivotA:f,localPivotB:e,maxForce:g})};a.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);a.Physics.P2.RevoluteConstraint.prototype.constructor=
a.Physics.P2.RevoluteConstraint;a.Tile=function(a,c,f,d,e,g){this.layer=a;this.index=c;this.x=f;this.y=d;this.rotation=0;this.flipped=!1;this.worldX=f*e;this.worldY=d*g;this.width=e;this.height=g;this.centerX=Math.abs(e/2);this.centerY=Math.abs(g/2);this.alpha=1;this.properties={};this.collideDown=this.collideUp=this.collideRight=this.collideLeft=this.faceRight=this.faceLeft=this.faceBottom=this.faceTop=this.scanned=!1;this.collisionCallback=null;this.collisionCallbackContext=this};a.Tile.prototype=
{containsPoint:function(a,c){return!(a<this.worldX||c<this.worldY||a>this.right||c>this.bottom)},intersects:function(a,c,f,d){return f<=this.worldX?!1:d<=this.worldY?!1:a>=this.worldX+this.width?!1:c>=this.worldY+this.height?!1:!0},setCollisionCallback:function(a,c){this.collisionCallback=a;this.collisionCallbackContext=c},destroy:function(){this.properties=this.collisionCallbackContext=this.collisionCallback=null},setCollision:function(a,c,f,d){this.collideLeft=a;this.collideRight=c;this.collideUp=
f;this.collideDown=d;this.faceLeft=a;this.faceRight=c;this.faceTop=f;this.faceBottom=d},resetCollision:function(){this.faceRight=this.faceLeft=this.faceBottom=this.faceTop=this.collideDown=this.collideUp=this.collideRight=this.collideLeft=!1},isInteresting:function(a,c){return a&&c?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:a?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:
c?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1},copy:function(a){this.index=a.index;this.alpha=a.alpha;this.properties=a.properties;this.collideUp=a.collideUp;this.collideDown=a.collideDown;this.collideLeft=a.collideLeft;this.collideRight=a.collideRight;this.collisionCallback=a.collisionCallback;this.collisionCallbackContext=a.collisionCallbackContext}};a.Tile.prototype.constructor=a.Tile;Object.defineProperty(a.Tile.prototype,"collides",{get:function(){return this.collideLeft||
this.collideRight||this.collideUp||this.collideDown}});Object.defineProperty(a.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}});Object.defineProperty(a.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(a.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(a.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(a.Tile.prototype,
"bottom",{get:function(){return this.worldY+this.height}});a.Tilemap=function(b,c,f,d,e,g){this.game=b;this.key=c;b=a.TilemapParser.parse(this.game,c,f,d,e,g);null!==b&&(this.width=b.width,this.height=b.height,this.tileWidth=b.tileWidth,this.tileHeight=b.tileHeight,this.orientation=b.orientation,this.format=b.format,this.version=b.version,this.properties=b.properties,this.widthInPixels=b.widthInPixels,this.heightInPixels=b.heightInPixels,this.layers=b.layers,this.tilesets=b.tilesets,this.tiles=b.tiles,
this.objects=b.objects,this.collideIndexes=[],this.collision=b.collision,this.images=b.images,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)};a.Tilemap.CSV=0;a.Tilemap.TILED_JSON=1;a.Tilemap.NORTH=0;a.Tilemap.EAST=1;a.Tilemap.SOUTH=2;a.Tilemap.WEST=3;a.Tilemap.prototype={create:function(a,c,f,d,e,g){return"undefined"==typeof g&&(g=this.game.world),this.width=c,this.height=f,this.setTileSize(d,e),this.layers.length=0,this.createBlankLayer(a,c,f,d,e,g)},setTileSize:function(a,
c){this.tileWidth=a;this.tileHeight=c;this.widthInPixels=this.width*a;this.heightInPixels=this.height*c},addTilesetImage:function(b,c,f,d,e,g,h){if("undefined"==typeof f&&(f=this.tileWidth),"undefined"==typeof d&&(d=this.tileHeight),"undefined"==typeof e&&(e=0),"undefined"==typeof g&&(g=0),"undefined"==typeof h&&(h=0),0===f&&(f=32),0===d&&(d=32),"undefined"==typeof c){if("string"!=typeof b)return null;if(c=b,!this.game.cache.checkImageKey(c))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+
c+'"'),null}if("string"==typeof b&&(b=this.getTilesetIndex(b),null===b&&this.format===a.Tilemap.TILED_JSON))return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+c+'"'),null;if(this.tilesets[b])return this.tilesets[b].setImage(this.game.cache.getImage(c)),this.tilesets[b];b=new a.Tileset(c,h,f,d,e,g,{});b.setImage(this.game.cache.getImage(c));this.tilesets.push(b);c=this.tilesets.length-1;for(var k=e,m=e,t=0,q=0,u=0,z=h;z<h+b.total&&(this.tiles[z]=
[k,m,c],k+=f+g,t++,t!==b.total)&&(q++,q!==b.columns||(k=e,m+=d+g,q=0,u++,u!==b.rows));z++);return b},createFromObjects:function(b,c,f,d,e,g,h,k,m){if("undefined"==typeof e&&(e=!0),"undefined"==typeof g&&(g=!1),"undefined"==typeof h&&(h=this.game.world),"undefined"==typeof k&&(k=a.Sprite),"undefined"==typeof m&&(m=!0),!this.objects[b])return void console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+b);for(var t,q=0,u=this.objects[b].length;u>q;q++)if(this.objects[b][q].gid===
c){t=new k(this.game,this.objects[b][q].x,this.objects[b][q].y,f,d);t.name=this.objects[b][q].name;t.visible=this.objects[b][q].visible;t.autoCull=g;t.exists=e;this.objects[b][q].rotation&&(t.angle=this.objects[b][q].rotation);m&&(t.y-=t.height);h.add(t);for(var z in this.objects[b][q].properties)h.set(t,z,this.objects[b][q].properties[z],!1,!1,0,!0)}},createFromTiles:function(b,c,f,d,e,g){"number"==typeof b&&(b=[b]);"undefined"==typeof c||null===c?c=[]:"number"==typeof c&&(c=[c]);d=this.getLayer(d);
"undefined"==typeof e&&(e=this.game.world);"undefined"==typeof g&&(g={});void 0===g.customClass&&(g.customClass=a.Sprite);void 0===g.adjustY&&(g.adjustY=!0);var h=this.layers[d].width,k=this.layers[d].height;if(this.copy(0,0,h,k,d),2>this._results.length)return 0;for(var m,t=0,q=1,u=this._results.length;u>q;q++)if(-1!==b.indexOf(this._results[q].index)){m=new g.customClass(this.game,this._results[q].worldX,this._results[q].worldY,f);for(var z in g)m[z]=g[z];e.add(m);t++}if(1===c.length)for(q=0;q<
b.length;q++)this.replace(b[q],c[0],0,0,h,k,d);else if(1<c.length)for(q=0;q<b.length;q++)this.replace(b[q],c[q],0,0,h,k,d);return t},createLayer:function(b,c,f,d){"undefined"==typeof c&&(c=this.game.width);"undefined"==typeof f&&(f=this.game.height);"undefined"==typeof d&&(d=this.game.world);var e=b;return"string"==typeof b&&(e=this.getLayerIndex(b)),null===e||e>this.layers.length?void console.warn("Tilemap.createLayer: Invalid layer ID given: "+e):d.add(new a.TilemapLayer(this.game,this,e,c,f))},
createBlankLayer:function(b,c,f,d,e,g){if("undefined"==typeof g&&(g=this.game.world),null!==this.getLayerIndex(b))return void console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");for(var h,k={name:b,x:0,y:0,width:c,height:f,widthInPixels:c*d,heightInPixels:f*e,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},m=[],t=0;f>t;t++){h=[];for(var q=0;c>q;q++)h.push(new a.Tile(k,-1,q,t,d,e));m.push(h)}k.data=m;this.layers.push(k);this.currentLayer=
this.layers.length-1;c=k.widthInPixels;k=k.heightInPixels;c>this.game.width&&(c=this.game.width);k>this.game.height&&(k=this.game.height);m=new a.TilemapLayer(this.game,this,this.layers.length-1,c,k);return m.name=b,g.add(m)},getIndex:function(a,c){for(var f=0;f<a.length;f++)if(a[f].name===c)return f;return null},getLayerIndex:function(a){return this.getIndex(this.layers,a)},getTilesetIndex:function(a){return this.getIndex(this.tilesets,a)},getImageIndex:function(a){return this.getIndex(this.images,
a)},getObjectIndex:function(a){return this.getIndex(this.objects,a)},setTileIndexCallback:function(a,c,f,d){if(d=this.getLayer(d),"number"==typeof a)this.layers[d].callbacks[a]={callback:c,callbackContext:f};else for(var e=0,g=a.length;g>e;e++)this.layers[d].callbacks[a[e]]={callback:c,callbackContext:f}},setTileLocationCallback:function(a,c,f,d,e,g,h){if(h=this.getLayer(h),this.copy(a,c,f,d,h),!(2>this._results.length))for(a=1;a<this._results.length;a++)this._results[a].setCollisionCallback(e,g)},
setCollision:function(a,c,f,d){if("undefined"==typeof c&&(c=!0),"undefined"==typeof d&&(d=!0),f=this.getLayer(f),"number"==typeof a)return this.setCollisionByIndex(a,c,f,!0);if(Array.isArray(a)){for(var e=0;e<a.length;e++)this.setCollisionByIndex(a[e],c,f,!1);d&&this.calculateFaces(f)}},setCollisionBetween:function(a,c,f,d,e){if("undefined"==typeof f&&(f=!0),"undefined"==typeof e&&(e=!0),d=this.getLayer(d),!(a>c)){for(;c>=a;a++)this.setCollisionByIndex(a,f,d,!1);e&&this.calculateFaces(d)}},setCollisionByExclusion:function(a,
c,f,d){"undefined"==typeof c&&(c=!0);"undefined"==typeof d&&(d=!0);f=this.getLayer(f);for(var e=0,g=this.tiles.length;g>e;e++)-1===a.indexOf(e)&&this.setCollisionByIndex(e,c,f,!1);d&&this.calculateFaces(f)},setCollisionByIndex:function(a,c,f,d){if("undefined"==typeof c&&(c=!0),"undefined"==typeof f&&(f=this.currentLayer),"undefined"==typeof d&&(d=!0),c)this.collideIndexes.push(a);else{var e=this.collideIndexes.indexOf(a);-1<e&&this.collideIndexes.splice(e,1)}for(e=0;e<this.layers[f].height;e++)for(var g=
0;g<this.layers[f].width;g++){var h=this.layers[f].data[e][g];h&&h.index===a&&(c?h.setCollision(!0,!0,!0,!0):h.resetCollision(),h.faceTop=c,h.faceBottom=c,h.faceLeft=c,h.faceRight=c)}return d&&this.calculateFaces(f),f},getLayer:function(b){return"undefined"==typeof b?b=this.currentLayer:"string"==typeof b?b=this.getLayerIndex(b):b instanceof a.TilemapLayer&&(b=b.index),b},setPreventRecalculate:function(a){if(!0===a&&!0!==this.preventingRecalculate&&(this.preventingRecalculate=!0,this.needToRecalculate=
{}),!1===a&&!0===this.preventingRecalculate){this.preventingRecalculate=!1;for(var c in this.needToRecalculate)this.calculateFaces(c);this.needToRecalculate=!1}},calculateFaces:function(a){if(this.preventingRecalculate)return void(this.needToRecalculate[a]=!0);for(var c=null,f=null,d=null,e=null,g=0,h=this.layers[a].height;h>g;g++)for(var k=0,m=this.layers[a].width;m>k;k++){var t=this.layers[a].data[g][k];t&&(c=this.getTileAbove(a,k,g),f=this.getTileBelow(a,k,g),d=this.getTileLeft(a,k,g),e=this.getTileRight(a,
k,g),t.collides&&(t.faceTop=!0,t.faceBottom=!0,t.faceLeft=!0,t.faceRight=!0),c&&c.collides&&(t.faceTop=!1),f&&f.collides&&(t.faceBottom=!1),d&&d.collides&&(t.faceLeft=!1),e&&e.collides&&(t.faceRight=!1))}},getTileAbove:function(a,c,f){return 0<f?this.layers[a].data[f-1][c]:null},getTileBelow:function(a,c,f){return f<this.layers[a].height-1?this.layers[a].data[f+1][c]:null},getTileLeft:function(a,c,f){return 0<c?this.layers[a].data[f][c-1]:null},getTileRight:function(a,c,f){return c<this.layers[a].width-
1?this.layers[a].data[f][c+1]:null},setLayer:function(a){a=this.getLayer(a);this.layers[a]&&(this.currentLayer=a)},hasTile:function(a,c,f){return f=this.getLayer(f),-1<this.layers[f].data[c][a].index},removeTile:function(b,c,f){if(f=this.getLayer(f),0<=b&&b<this.layers[f].width&&0<=c&&c<this.layers[f].height&&this.hasTile(b,c,f)){var d=this.layers[f].data[c][b];return this.layers[f].data[c][b]=new a.Tile(this.layers[f],-1,b,c,this.tileWidth,this.tileHeight),this.layers[f].dirty=!0,this.calculateFaces(f),
d}},removeTileWorldXY:function(a,c,f,d,e){return e=this.getLayer(e),a=this.game.math.snapToFloor(a,f)/f,c=this.game.math.snapToFloor(c,d)/d,this.removeTile(a,c,e)},putTile:function(b,c,f,d){if(null===b)return this.removeTile(c,f,d);if(d=this.getLayer(d),0<=c&&c<this.layers[d].width&&0<=f&&f<this.layers[d].height){var e;return b instanceof a.Tile?(e=b.index,this.hasTile(c,f,d)?this.layers[d].data[f][c].copy(b):this.layers[d].data[f][c]=new a.Tile(d,e,c,f,b.width,b.height)):(e=b,this.hasTile(c,f,d)?
this.layers[d].data[f][c].index=e:this.layers[d].data[f][c]=new a.Tile(this.layers[d],e,c,f,this.tileWidth,this.tileHeight)),-1<this.collideIndexes.indexOf(e)?this.layers[d].data[f][c].setCollision(!0,!0,!0,!0):this.layers[d].data[f][c].resetCollision(),this.layers[d].dirty=!0,this.calculateFaces(d),this.layers[d].data[f][c]}return null},putTileWorldXY:function(a,c,f,d,e,g){return g=this.getLayer(g),c=this.game.math.snapToFloor(c,d)/d,f=this.game.math.snapToFloor(f,e)/e,this.putTile(a,c,f,g)},searchTileIndex:function(a,
c,f,d){"undefined"==typeof c&&(c=0);"undefined"==typeof f&&(f=!1);d=this.getLayer(d);var e=0;if(f)for(f=this.layers[d].height-1;0<=f;f--)for(var g=this.layers[d].width-1;0<=g;g--){if(this.layers[d].data[f][g].index===a){if(e===c)return this.layers[d].data[f][g];e++}}else for(f=0;f<this.layers[d].height;f++)for(g=0;g<this.layers[d].width;g++)if(this.layers[d].data[f][g].index===a){if(e===c)return this.layers[d].data[f][g];e++}return null},getTile:function(a,c,f,d){return"undefined"==typeof d&&(d=!1),
f=this.getLayer(f),0<=a&&a<this.layers[f].width&&0<=c&&c<this.layers[f].height?-1===this.layers[f].data[c][a].index?d?this.layers[f].data[c][a]:null:this.layers[f].data[c][a]:null},getTileWorldXY:function(a,c,f,d,e){return"undefined"==typeof f&&(f=this.tileWidth),"undefined"==typeof d&&(d=this.tileHeight),e=this.getLayer(e),a=this.game.math.snapToFloor(a,f)/f,c=this.game.math.snapToFloor(c,d)/d,this.getTile(a,c,e)},copy:function(a,c,f,d,e){if(e=this.getLayer(e),!this.layers[e])return void(this._results.length=
0);"undefined"==typeof a&&(a=0);"undefined"==typeof c&&(c=0);"undefined"==typeof f&&(f=this.layers[e].width);"undefined"==typeof d&&(d=this.layers[e].height);0>a&&(a=0);0>c&&(c=0);f>this.layers[e].width&&(f=this.layers[e].width);d>this.layers[e].height&&(d=this.layers[e].height);this._results.length=0;this._results.push({x:a,y:c,width:f,height:d,layer:e});for(var g=c;c+d>g;g++)for(var h=a;a+f>h;h++)this._results.push(this.layers[e].data[g][h]);return this._results},paste:function(a,c,f,d){if("undefined"==
typeof a&&(a=0),"undefined"==typeof c&&(c=0),d=this.getLayer(d),f&&!(2>f.length)){a-=f[1].x;c-=f[1].y;for(var e=1;e<f.length;e++)this.layers[d].data[c+f[e].y][a+f[e].x].copy(f[e]);this.layers[d].dirty=!0;this.calculateFaces(d)}},swap:function(a,c,f,d,e,g,h){h=this.getLayer(h);this.copy(f,d,e,g,h);2>this._results.length||(this._tempA=a,this._tempB=c,this._results.forEach(this.swapHandler,this),this.paste(f,d,this._results,h))},swapHandler:function(a){a.index===this._tempA?a.index=this._tempB:a.index===
this._tempB&&(a.index=this._tempA)},forEach:function(a,c,f,d,e,g,h){h=this.getLayer(h);this.copy(f,d,e,g,h);2>this._results.length||(this._results.forEach(a,c),this.paste(f,d,this._results,h))},replace:function(a,c,f,d,e,g,h){if(h=this.getLayer(h),this.copy(f,d,e,g,h),!(2>this._results.length)){for(e=1;e<this._results.length;e++)this._results[e].index===a&&(this._results[e].index=c);this.paste(f,d,this._results,h)}},random:function(a,c,f,d,e){if(e=this.getLayer(e),this.copy(a,c,f,d,e),!(2>this._results.length)){f=
[];for(d=1;d<this._results.length;d++)if(this._results[d].index){var g=this._results[d].index;-1===f.indexOf(g)&&f.push(g)}for(d=1;d<this._results.length;d++)this._results[d].index=this.game.rnd.pick(f);this.paste(a,c,this._results,e)}},shuffle:function(b,c,f,d,e){if(e=this.getLayer(e),this.copy(b,c,f,d,e),!(2>this._results.length)){f=[];for(d=1;d<this._results.length;d++)this._results[d].index&&f.push(this._results[d].index);a.Utils.shuffle(f);for(d=1;d<this._results.length;d++)this._results[d].index=
f[d-1];this.paste(b,c,this._results,e)}},fill:function(a,c,f,d,e,g){if(g=this.getLayer(g),this.copy(c,f,d,e,g),!(2>this._results.length)){for(d=1;d<this._results.length;d++)this._results[d].index=a;this.paste(c,f,this._results,g)}},removeAllLayers:function(){this.currentLayer=this.layers.length=0},dump:function(){for(var a="",c=[""],f=0;f<this.layers[this.currentLayer].height;f++){for(var d=0;d<this.layers[this.currentLayer].width;d++)a+="%c  ",c.push(1<this.layers[this.currentLayer].data[f][d]?this.debugMap[this.layers[this.currentLayer].data[f][d]]?
"background: "+this.debugMap[this.layers[this.currentLayer].data[f][d]]:"background: #ffffff":"background: rgb(0, 0, 0)");a+="\n"}c[0]=a;console.log.apply(console,c)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};a.Tilemap.prototype.constructor=a.Tilemap;Object.defineProperty(a.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(a){a!==this.currentLayer&&this.setLayer(a)}});a.TilemapLayer=function(b,c,f,d,e){d|=0;e|=0;PIXI.Sprite.call(this,
PIXI.TextureCache.__default);a.Component.Core.init.call(this,b,0,0,null,null);this.map=c;this.index=f;this.layer=c.layers[f];this.canvas=a.Canvas.create(d,e);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new a.Frame(0,0,0,d,e,"tilemapLayer",b.rnd.uuid());this.physicsType=this.type=a.TILEMAPLAYER;this.renderSettings={enableScrollDelta:!0,overdrawRatio:.2,copyCanvas:null};this.debug=!1;this.exists=
!0;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorY=this.scrollFactorX=1;this.dirty=!0;this.rayStepRate=4;this._wrap=!1;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:c.tileWidth,tileHeight:c.tileHeight,cw:c.tileWidth,ch:c.tileHeight,tilesets:[]};this._scrollY=this._scrollX=0;this._results=[];b.device.canvasBitBltShift||
(this.renderSettings.copyCanvas=a.TilemapLayer.ensureSharedCopyCanvas());this.fixedToCamera=!0};a.TilemapLayer.prototype=Object.create(PIXI.Sprite.prototype);a.TilemapLayer.prototype.constructor=a.TilemapLayer;a.Component.Core.install.call(a.TilemapLayer.prototype,["Bounds","Destroy","FixedToCamera","Reset","Smoothed"]);a.TilemapLayer.sharedCopyCanvas=null;a.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=a.Canvas.create(2,2)),this.sharedCopyCanvas};
a.TilemapLayer.prototype.preUpdate=function(){return a.Component.Core.preUpdate.call(this),!0};a.TilemapLayer.prototype.postUpdate=function(){a.Component.Core.prototype.postUpdate.call(this);var b=this.game.camera;this.scrollX=b.x*this.scrollFactorX/this.scale.x;this.scrollY=b.y*this.scrollFactorY/this.scale.y;this.render()};a.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};a.TilemapLayer.prototype._fixX=
function(a){return 0>a&&(a=0),1===this.scrollFactorX?a:this._scrollX+(a-this._scrollX/this.scrollFactorX)};a.TilemapLayer.prototype._unfixX=function(a){return 1===this.scrollFactorX?a:this._scrollX/this.scrollFactorX+(a-this._scrollX)};a.TilemapLayer.prototype._fixY=function(a){return 0>a&&(a=0),1===this.scrollFactorY?a:this._scrollY+(a-this._scrollY/this.scrollFactorY)};a.TilemapLayer.prototype._unfixY=function(a){return 1===this.scrollFactorY?a:this._scrollY/this.scrollFactorY+(a-this._scrollY)};
a.TilemapLayer.prototype.getTileX=function(a){return Math.floor(this._fixX(a)/this._mc.tileWidth)};a.TilemapLayer.prototype.getTileY=function(a){return Math.floor(this._fixY(a)/this._mc.tileHeight)};a.TilemapLayer.prototype.getTileXY=function(a,c,f){return f.x=this.getTileX(a),f.y=this.getTileY(c),f};a.TilemapLayer.prototype.getRayCastTiles=function(a,c,f,d){c||(c=this.rayStepRate);"undefined"==typeof f&&(f=!1);"undefined"==typeof d&&(d=!1);f=this.getTiles(a.x,a.y,a.width,a.height,f,d);if(0===f.length)return[];
a=a.coordinatesOnLine(c);c=[];for(d=0;d<f.length;d++)for(var e=0;e<a.length;e++){var g=f[d],h=a[e];if(g.containsPoint(h[0],h[1])){c.push(g);break}}return c};a.TilemapLayer.prototype.getTiles=function(a,c,f,d,e,g){"undefined"==typeof e&&(e=!1);"undefined"==typeof g&&(g=!1);var h=!(e||g);a=this._fixX(a);c=this._fixY(c);var k=Math.floor(a/(this._mc.cw*this.scale.x)),m=Math.floor(c/(this._mc.ch*this.scale.y));a=Math.ceil((a+f)/(this._mc.cw*this.scale.x))-k;for(c=Math.ceil((c+d)/(this._mc.ch*this.scale.y))-
m;this._results.length;)this._results.pop();for(d=m;m+c>d;d++)for(f=k;k+a>f;f++){var t=this.layer.data[d];t&&t[f]&&(h||t[f].isInteresting(e,g))&&this._results.push(t[f])}return this._results.slice()};Object.defineProperty(a.TilemapLayer.prototype,"tileColor",{get:function(){return this.debugSettings.missingImageFill},set:function(a){this.debugSettings.missingImageFill=a}});Object.defineProperty(a.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(a){this._wrap=a;this.dirty=
!0}});a.TilemapLayer.prototype.resolveTileset=function(a){var c=this._mc.tilesets;if(2E3>a)for(;c.length<a;)c.push(void 0);var f=this.map.tiles[a]&&this.map.tiles[a][2];return null!=f&&(f=this.map.tilesets[f])&&f.containsTileIndex(a)?c[a]=f:c[a]=null};a.TilemapLayer.prototype.resetTilesetCache=function(){for(var a=this._mc.tilesets;a.length;)a.pop()};a.TilemapLayer.prototype.setScale=function(a,c){a=a||1;c=c||a;for(var f=0;f<this.layer.data.length;f++)for(var d=this.layer.data[f],e=0;e<d.length;e++){var g=
d[e];g.width=this.map.tileWidth*a;g.height=this.map.tileHeight*c;g.worldX=g.x*g.width;g.worldY=g.y*g.height}this.scale.setTo(a,c)};a.TilemapLayer.prototype.shiftCanvas=function(a,c,f){var d=a.canvas,e=d.width-Math.abs(c),g=d.height-Math.abs(f),h=0,k=0,m=c,t=f;0>c&&(h=-c,m=0);0>f&&(k=-f,t=0);(c=this.renderSettings.copyCanvas)?((c.width<e||c.height<g)&&(c.width=e,c.height=g),f=c.getContext("2d"),f.clearRect(0,0,e,g),f.drawImage(d,h,k,e,g,0,0,e,g),a.clearRect(m,t,e,g),a.drawImage(c,0,0,e,g,m,t,e,g)):
(a.save(),a.globalCompositeOperation="copy",a.drawImage(d,h,k,e,g,m,t,e,g),a.restore())};a.TilemapLayer.prototype.renderRegion=function(a,c,f,d,e,g){var h=this.context,k=this.layer.width,m=this.layer.height,t=this._mc.tileWidth,q=this._mc.tileHeight,u=this._mc.tilesets,z=0/0;this._wrap||(e>=f&&(f=Math.max(0,f),e=Math.min(k-1,e)),g>=d&&(d=Math.max(0,d),g=Math.min(m-1,g)));var x,r,w=f*t-a,G=(f+1048576*k)%k;h.fillStyle=this.tileColor;a=(d+1048576*m)%m;g-=d;for(d=d*q-c;0<=g;a++,g--,d+=q){a>=m&&(a-=m);
var B=this.layer.data[a];x=G;r=e-f;for(c=w;0<=r;x++,r--,c+=t){x>=k&&(x-=k);var F=B[x];if(F&&!(0>F.index)){var I=F.index,A=u[I];void 0===A&&(A=this.resolveTileset(I));F.alpha===z||this.debug||(h.globalAlpha=F.alpha,z=F.alpha);A?F.rotation||F.flipped?(h.save(),h.translate(c+F.centerX,d+F.centerY),h.rotate(F.rotation),F.flipped&&h.scale(-1,1),A.draw(h,-F.centerX,-F.centerY,I),h.restore()):A.draw(h,c,d,I):this.debugSettings.missingImageFill&&(h.fillStyle=this.debugSettings.missingImageFill,h.fillRect(c,
d,t,q));F.debug&&this.debugSettings.debuggedTileOverfill&&(h.fillStyle=this.debugSettings.debuggedTileOverfill,h.fillRect(c,d,t,q))}}}};a.TilemapLayer.prototype.renderDeltaScroll=function(a,c){var f=this._mc.scrollX,d=this._mc.scrollY,e=this.canvas.width,g=this.canvas.height,h=this._mc.tileWidth,k=this._mc.tileHeight,m=0,t=-h,q=0,u=-k;if(0>a?(m=e+a,t=e-1):0<a&&(t=a),0>c?(q=g+c,u=g-1):0<c&&(u=c),this.shiftCanvas(this.context,a,c),m=Math.floor((m+f)/h),t=Math.floor((t+f)/h),q=Math.floor((q+d)/k),u=
Math.floor((u+d)/k),t>=m)this.context.clearRect(m*h-f,0,(t-m+1)*h,g),this.renderRegion(f,d,m,Math.floor((0+d)/k),t,Math.floor((g-1+d)/k));u>=q&&(this.context.clearRect(0,q*k-d,e,(u-q+1)*k),this.renderRegion(f,d,Math.floor((0+f)/h),q,Math.floor((e-1+f)/h),u))};a.TilemapLayer.prototype.renderFull=function(){var a=this._mc.scrollX,c=this._mc.scrollY,f=this.canvas.width,d=this.canvas.height,e=this._mc.tileWidth,g=this._mc.tileHeight,h=Math.floor(a/e),e=Math.floor((f-1+a)/e),k=Math.floor(c/g),g=Math.floor((d-
1+c)/g);this.context.clearRect(0,0,f,d);this.renderRegion(a,c,h,k,e,g)};a.TilemapLayer.prototype.render=function(){var a=!1;if(this.visible){this.context.save();(this.dirty||this.layer.dirty)&&(this.layer.dirty=!1,a=!0);var c=this.canvas.width,f=this.canvas.height,d=0|this._scrollX,e=0|this._scrollY,g=this._mc,h=g.scrollX-d,k=g.scrollY-e;if(a||0!==h||0!==k||g.renderWidth!==c||g.renderHeight!==f)return g.scrollX=d,g.scrollY=e,(g.renderWidth!==c||g.renderHeight!==f)&&(g.renderWidth=c,g.renderHeight=
f),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(a=!0)),!a&&this.renderSettings.enableScrollDelta&&Math.abs(h)+Math.abs(k)<Math.min(c,f)?this.renderDeltaScroll(h,k):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}};a.TilemapLayer.prototype.renderDebug=function(){var a,c,f,d,e,g;d=this._mc.scrollX;a=this._mc.scrollY;var h=this.context,k=this.layer.width,
m=this.layer.height,t=this._mc.tileWidth,q=this._mc.tileHeight,u=Math.floor(d/t),z=Math.floor((this.canvas.width-1+d)/t);c=Math.floor(a/q);g=Math.floor((this.canvas.height-1+a)/q);var x=u*t-d,r=(u+1048576*k)%k;h.strokeStyle=this.debugSettings.facingEdgeStroke;d=(c+1048576*m)%m;g-=c;for(c=c*q-a;0<=g;d++,g--,c+=q){d>=m&&(d-=m);var w=this.layer.data[d];f=r;e=z-u;for(a=x;0<=e;f++,e--,a+=t){f>=k&&(f-=k);var G=w[f];!G||0>G.index||!G.collides||(this.debugSettings.collidingTileOverfill&&(h.fillStyle=this.debugSettings.collidingTileOverfill,
h.fillRect(a,c,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(h.beginPath(),G.faceTop&&(h.moveTo(a,c),h.lineTo(a+this._mc.cw,c)),G.faceBottom&&(h.moveTo(a,c+this._mc.ch),h.lineTo(a+this._mc.cw,c+this._mc.ch)),G.faceLeft&&(h.moveTo(a,c),h.lineTo(a,c+this._mc.ch)),G.faceRight&&(h.moveTo(a+this._mc.cw,c),h.lineTo(a+this._mc.cw,c+this._mc.ch)),h.stroke()))}}};Object.defineProperty(a.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(a){this._scrollX=a}});
Object.defineProperty(a.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(a){this._scrollY=a}});Object.defineProperty(a.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(a){this._mc.cw=0|a;this.dirty=!0}});Object.defineProperty(a.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(a){this._mc.ch=0|a;this.dirty=!0}});a.TilemapParser={parse:function(b,c,f,d,e,g){if("undefined"==typeof f&&(f=
32),"undefined"==typeof d&&(d=32),"undefined"==typeof e&&(e=10),"undefined"==typeof g&&(g=10),"undefined"==typeof c)return this.getEmptyData();if(null===c)return this.getEmptyData(f,d,e,g);if(b=b.cache.getTilemapData(c)){if(b.format===a.Tilemap.CSV)return this.parseCSV(c,b.data,f,d);if(!b.format||b.format===a.Tilemap.TILED_JSON)return this.parseTiledJSON(b.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+c)},parseCSV:function(b,c,e,d){var g=this.getEmptyData();c=c.trim();
var h=[];c=c.split("\n");for(var k=c.length,m=0,y=0;y<c.length;y++){h[y]=[];for(var t=c[y].split(","),q=0;q<t.length;q++)h[y][q]=new a.Tile(g.layers[0],parseInt(t[q],10),q,y,e,d);0===m&&(m=t.length)}return g.format=a.Tilemap.CSV,g.name=b,g.width=m,g.height=k,g.tileWidth=e,g.tileHeight=d,g.widthInPixels=m*e,g.heightInPixels=k*d,g.layers[0].width=m,g.layers[0].height=k,g.layers[0].widthInPixels=g.widthInPixels,g.layers[0].heightInPixels=g.heightInPixels,g.layers[0].data=h,g},getEmptyData:function(a,
c,e,d){var g={width:0,height:0,tileWidth:0,tileHeight:0};"undefined"!=typeof a&&null!==a&&(g.tileWidth=a);"undefined"!=typeof c&&null!==c&&(g.tileHeight=c);"undefined"!=typeof e&&null!==e&&(g.width=e);"undefined"!=typeof d&&null!==d&&(g.height=d);g.orientation="orthogonal";g.version="1";g.properties={};g.widthInPixels=0;g.heightInPixels=0;a=[];return a.push({name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}),
g.layers=a,g.images=[],g.objects={},g.collision={},g.tilesets=[],g.tiles=[],g},parseTiledJSON:function(b){function c(a,b){var c={},d;for(d in b){var e=b[d];a[e]&&(c[e]=a[e])}return c}if("orthogonal"!==b.orientation)return console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser"),null;var e={};e.width=b.width;e.height=b.height;e.tileWidth=b.tilewidth;e.tileHeight=b.tileheight;e.orientation=b.orientation;e.format=a.Tilemap.TILED_JSON;e.version=
b.version;e.properties=b.properties;e.widthInPixels=e.width*e.tileWidth;e.heightInPixels=e.height*e.tileHeight;for(var d=[],g=0;g<b.layers.length;g++)if("tilelayer"===b.layers[g].type){var h={name:b.layers[g].name,x:b.layers[g].x,y:b.layers[g].y,width:b.layers[g].width,height:b.layers[g].height,widthInPixels:b.layers[g].width*b.tilewidth,heightInPixels:b.layers[g].height*b.tileheight,alpha:b.layers[g].opacity,visible:b.layers[g].visible,properties:{},indexes:[],callbacks:[],bodies:[]};b.layers[g].properties&&
(h.properties=b.layers[g].properties);for(var k,m,y,t,q=0,u=[],z=[],x=0,r=b.layers[g].data.length;r>x;x++){if(k=0,m=!1,t=b.layers[g].data[x],536870912<t)switch(y=0,2147483648<t&&(t-=2147483648,y+=4),1073741824<t&&(t-=1073741824,y+=2),536870912<t&&(t-=536870912,y+=1),y){case 5:k=Math.PI/2;break;case 6:k=Math.PI;break;case 3:k=3*Math.PI/2;break;case 4:k=0;m=!0;break;case 7:k=Math.PI/2;m=!0;break;case 2:k=Math.PI;m=!0;break;case 1:k=3*Math.PI/2,m=!0}0<t?(u.push(new a.Tile(h,t,q,z.length,b.tilewidth,
b.tileheight)),u[u.length-1].rotation=k,u[u.length-1].flipped=m):u.push(new a.Tile(h,-1,q,z.length,b.tilewidth,b.tileheight));q++;q===b.layers[g].width&&(z.push(u),q=0,u=[])}h.data=z;d.push(h)}e.layers=d;r=[];for(g=0;g<b.layers.length;g++)"imagelayer"===b.layers[g].type&&(q={name:b.layers[g].name,image:b.layers[g].image,x:b.layers[g].x,y:b.layers[g].y,alpha:b.layers[g].opacity,visible:b.layers[g].visible,properties:{}},b.layers[g].properties&&(q.properties=b.layers[g].properties),r.push(q));e.images=
r;r=[];for(g=0;g<b.tilesets.length;g++){var w=b.tilesets[g];w.image?(q=new a.Tileset(w.name,w.firstgid,w.tilewidth,w.tileheight,w.margin,w.spacing,w.properties),w.tileproperties&&(q.tileProperties=w.tileproperties),q.updateTileData(w.imagewidth,w.imageheight),r.push(q)):console.warn("Phaser.TilemapParser - Image Collection Tilesets are not support")}e.tilesets=r;q={};x={};for(g=0;g<b.layers.length;g++)if("objectgroup"===b.layers[g].type)for(q[b.layers[g].name]=[],x[b.layers[g].name]=[],h=0,r=b.layers[g].objects.length;r>
h;h++){if(b.layers[g].objects[h].gid)u={gid:b.layers[g].objects[h].gid,name:b.layers[g].objects[h].name,type:b.layers[g].objects[h].hasOwnProperty("type")?b.layers[g].objects[h].type:"",x:b.layers[g].objects[h].x,y:b.layers[g].objects[h].y,visible:b.layers[g].objects[h].visible,properties:b.layers[g].objects[h].properties},b.layers[g].objects[h].rotation&&(u.rotation=b.layers[g].objects[h].rotation);else if(b.layers[g].objects[h].polyline){u={name:b.layers[g].objects[h].name,type:b.layers[g].objects[h].type,
x:b.layers[g].objects[h].x,y:b.layers[g].objects[h].y,width:b.layers[g].objects[h].width,height:b.layers[g].objects[h].height,visible:b.layers[g].objects[h].visible,properties:b.layers[g].objects[h].properties};b.layers[g].objects[h].rotation&&(u.rotation=b.layers[g].objects[h].rotation);u.polyline=[];for(d=0;d<b.layers[g].objects[h].polyline.length;d++)u.polyline.push([b.layers[g].objects[h].polyline[d].x,b.layers[g].objects[h].polyline[d].y]);x[b.layers[g].name].push(u)}else if(b.layers[g].objects[h].polygon)for(u=
c(b.layers[g].objects[h],"name type x y visible rotation properties".split(" ")),u.polygon=[],d=0;d<b.layers[g].objects[h].polygon.length;d++)u.polygon.push([b.layers[g].objects[h].polygon[d].x,b.layers[g].objects[h].polygon[d].y]);else b.layers[g].objects[h].ellipse?u=c(b.layers[g].objects[h],"name type ellipse x y width height visible rotation properties".split(" ")):(u=c(b.layers[g].objects[h],"name type x y width height visible rotation properties".split(" ")),u.rectangle=!0);q[b.layers[g].name].push(u)}e.objects=
q;e.collision=x;e.tiles=[];for(g=0;g<e.tilesets.length;g++)for(w=e.tilesets[g],b=q=w.tileMargin,u=h=r=0,x=w.firstgid;x<w.firstgid+w.total&&(e.tiles[x]=[q,b,g],q+=w.tileWidth+w.tileSpacing,r++,r!==w.total)&&(h++,h!==w.columns||(q=w.tileMargin,b+=w.tileHeight+w.tileSpacing,h=0,u++,u!==w.rows));x++);for(var G,g=0;g<e.layers.length;g++)for(h=e.layers[g],r=0;r<h.data.length;r++)for(u=h.data[r],q=0;q<u.length;q++)b=u[q],0>b.index||(G=e.tiles[b.index][2],w=e.tilesets[G],w.tileProperties&&w.tileProperties[b.index-
w.firstgid]&&(b.properties=a.Utils.mixin(w.tileProperties[b.index-w.firstgid],b.properties)));return e}};a.Tileset=function(a,c,e,d,g,h,k){("undefined"==typeof e||0>=e)&&(e=32);("undefined"==typeof d||0>=d)&&(d=32);"undefined"==typeof g&&(g=0);"undefined"==typeof h&&(h=0);this.name=a;this.firstgid=0|c;this.tileWidth=0|e;this.tileHeight=0|d;this.tileMargin=0|g;this.tileSpacing=0|h;this.properties=k||{};this.image=null;this.total=this.columns=this.rows=0;this.drawCoords=[]};a.Tileset.prototype={draw:function(a,
c,e,d){d=d-this.firstgid<<1;0<=d&&d+1<this.drawCoords.length&&a.drawImage(this.image,this.drawCoords[d],this.drawCoords[d+1],this.tileWidth,this.tileHeight,c,e,this.tileWidth,this.tileHeight)},containsTileIndex:function(a){return a>=this.firstgid&&a<this.firstgid+this.total},setImage:function(a){this.image=a;this.updateTileData(a.width,a.height)},setSpacing:function(a,c){this.tileMargin=0|a;this.tileSpacing=0|c;this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(a,
c){var e=(c-2*this.tileMargin+this.tileSpacing)/(this.tileHeight+this.tileSpacing),d=(a-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);0===e%1&&0===d%1||console.warn("Phaser.Tileset - image tile area is not an even multiple of tile size");e=Math.floor(e);d=Math.floor(d);(this.rows&&this.rows!==e||this.columns&&this.columns!==d)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ");this.rows=e;this.columns=d;this.total=e*d;this.drawCoords.length=
0;for(var d=e=this.tileMargin,g=0;g<this.rows;g++){for(var h=0;h<this.columns;h++)this.drawCoords.push(e),this.drawCoords.push(d),e+=this.tileWidth+this.tileSpacing;e=this.tileMargin;d+=this.tileHeight+this.tileSpacing}}};a.Tileset.prototype.constructor=a.Tileset;a.Particles=function(a){this.game=a;this.emitters={};this.ID=0};a.Particles.prototype={add:function(a){return this.emitters[a.name]=a,a},remove:function(a){delete this.emitters[a.name]},update:function(){for(var a in this.emitters)this.emitters[a].exists&&
this.emitters[a].update()}};a.Particles.prototype.constructor=a.Particles;a.Particles.Arcade={};a.Particles.Arcade.Emitter=function(b,c,e,d){this.maxParticles=d||50;a.Group.call(this,b);this.name="emitter"+this.game.particles.ID++;this.type=a.EMITTER;this.physicsType=a.GROUP;this.area=new a.Rectangle(c,e,1,1);this.minParticleSpeed=new a.Point(-100,-100);this.maxParticleSpeed=new a.Point(100,100);this.maxParticleScale=this.minParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=
360;this.maxParticleAlpha=this.minParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=a.Particle;this.particleDrag=new a.Point;this.angularDrag=0;this.frequency=100;this.lifespan=2E3;this.bounce=new a.Point;this.on=!1;this.particleAnchor=new a.Point(.5,.5);this.blendMode=a.blendModes.NORMAL;this.emitX=c;this.emitY=e;this.particleSendToBack=this.particleBringToTop=this.autoAlpha=this.autoScale=!1;this._minParticleScale=new a.Point(1,1);this._maxParticleScale=new a.Point(1,1);this._flowTotal=
this._flowQuantity=this._counter=this._timer=this._quantity=0;this._explode=!0;this._frames=null};a.Particles.Arcade.Emitter.prototype=Object.create(a.Group.prototype);a.Particles.Arcade.Emitter.prototype.constructor=a.Particles.Arcade.Emitter;a.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,0!==this._flowTotal)if(0<this._flowQuantity)for(var a=0;a<this._flowQuantity;a++){if(this.emitParticle()&&
(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,0<this._quantity&&this._counter>=this._quantity&&(this.on=!1));for(a=this.children.length;a--;)this.children[a].exists&&this.children[a].update()};a.Particles.Arcade.Emitter.prototype.makeParticles=function(a,c,e,d,g){"undefined"==typeof c&&(c=0);"undefined"==
typeof e&&(e=this.maxParticles);"undefined"==typeof d&&(d=!1);"undefined"==typeof g&&(g=!1);var h,k=0,m=a,y=c;this._frames=c;for(e>this.maxParticles&&(this.maxParticles=e);e>k;)Array.isArray(a)&&(m=this.game.rnd.pick(a)),Array.isArray(c)&&(y=this.game.rnd.pick(c)),h=new this.particleClass(this.game,0,0,m,y),this.game.physics.arcade.enable(h,!1),d?(h.body.checkCollision.any=!0,h.body.checkCollision.none=!1):h.body.checkCollision.none=!0,h.body.collideWorldBounds=g,h.body.skipQuadTree=!0,h.exists=!1,
h.visible=!1,h.anchor.copyFrom(this.particleAnchor),this.add(h),k++;return this};a.Particles.Arcade.Emitter.prototype.kill=function(){this.exists=this.alive=this.on=!1};a.Particles.Arcade.Emitter.prototype.revive=function(){this.exists=this.alive=!0};a.Particles.Arcade.Emitter.prototype.explode=function(a,c){this._flowTotal=0;this.start(!0,a,0,c,!1)};a.Particles.Arcade.Emitter.prototype.flow=function(a,c,e,d,g){"undefined"!=typeof e&&0!==e||(e=1);"undefined"==typeof d&&(d=-1);"undefined"==typeof g&&
(g=!0);e>this.maxParticles&&(e=this.maxParticles);this._counter=0;this._flowQuantity=e;this._flowTotal=d;g?(this.start(!0,a,c,e),this._counter+=e,this.on=!0,this._timer=this.game.time.time+c*this.game.time.slowMotion):this.start(!1,a,c,e)};a.Particles.Arcade.Emitter.prototype.start=function(a,c,e,d,g){if("undefined"==typeof a&&(a=!0),"undefined"==typeof c&&(c=0),("undefined"==typeof e||null===e)&&(e=250),"undefined"==typeof d&&(d=0),"undefined"==typeof g&&(g=!1),d>this.maxParticles&&(d=this.maxParticles),
this.revive(),this.visible=!0,this.lifespan=c,this.frequency=e,a||g)for(a=0;d>a;a++)this.emitParticle();else this.on=!0,this._quantity+=d,this._counter=0,this._timer=this.game.time.time+e*this.game.time.slowMotion};a.Particles.Arcade.Emitter.prototype.emitParticle=function(){var a=this.getFirstExists(!1);return null===a?!1:(1<this.width||1<this.height?a.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom)):a.reset(this.emitX,this.emitY),a.angle=
0,a.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(a):this.particleSendToBack&&this.sendToBack(a),this.autoScale?a.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?a.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale)):(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y)&&a.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,
this._maxParticleScale.y)),a.frame=Array.isArray("object"===this._frames)?this.game.rnd.pick(this._frames):this._frames,this.autoAlpha?a.setAlphaData(this.alphaData):a.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha),a.blendMode=this.blendMode,a.body.updateBounds(),a.body.bounce.setTo(this.bounce.x,this.bounce.y),a.body.velocity.x=this.game.rnd.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),a.body.velocity.y=this.game.rnd.between(this.minParticleSpeed.y,this.maxParticleSpeed.y),
a.body.angularVelocity=this.game.rnd.between(this.minRotation,this.maxRotation),a.body.gravity.y=this.gravity,a.body.drag.x=this.particleDrag.x,a.body.drag.y=this.particleDrag.y,a.body.angularDrag=this.angularDrag,a.onEmit(),!0)};a.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);a.Group.prototype.destroy.call(this,!0,!1)};a.Particles.Arcade.Emitter.prototype.setSize=function(a,c){this.area.width=a;this.area.height=c};a.Particles.Arcade.Emitter.prototype.setXSpeed=
function(a,c){this.minParticleSpeed.x=a||0;this.maxParticleSpeed.x=c||0};a.Particles.Arcade.Emitter.prototype.setYSpeed=function(a,c){this.minParticleSpeed.y=a||0;this.maxParticleSpeed.y=c||0};a.Particles.Arcade.Emitter.prototype.setRotation=function(a,c){this.minRotation=a||0;this.maxRotation=c||0};a.Particles.Arcade.Emitter.prototype.setAlpha=function(b,c,e,d,g){if("undefined"==typeof b&&(b=1),"undefined"==typeof c&&(c=1),"undefined"==typeof e&&(e=0),"undefined"==typeof d&&(d=a.Easing.Linear.None),
"undefined"==typeof g&&(g=!1),this.minParticleAlpha=b,this.maxParticleAlpha=c,this.autoAlpha=!1,0<e&&b!==c)b=this.game.make.tween({v:b}).to({v:c},e,d),b.yoyo(g),this.alphaData=b.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0};a.Particles.Arcade.Emitter.prototype.setScale=function(b,c,e,d,g,h,k){if("undefined"==typeof b&&(b=1),"undefined"==typeof c&&(c=1),"undefined"==typeof e&&(e=1),"undefined"==typeof d&&(d=1),"undefined"==typeof g&&(g=0),"undefined"==typeof h&&(h=a.Easing.Linear.None),
"undefined"==typeof k&&(k=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(b,e),this._maxParticleScale.set(c,d),this.autoScale=!1,0<g&&(b!==c||e!==d))b=this.game.make.tween({x:b,y:e}).to({x:c,y:d},g,h),b.yoyo(k),this.scaleData=b.generateData(60),this.scaleData.reverse(),this.autoScale=!0};a.Particles.Arcade.Emitter.prototype.at=function(a){a.center?(this.emitX=a.center.x,this.emitY=a.center.y):(this.emitX=a.world.x+a.anchor.x*a.width,this.emitY=a.world.y+a.anchor.y*a.height)};
Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(a){this.area.width=a}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(a){this.area.height=a}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(a){this.emitX=a}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},
set:function(a){this.emitY=a}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}});Object.defineProperty(a.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+
this.area.height/2)}});void 0===PIXI.blendModes&&(PIXI.blendModes=a.blendModes);void 0===PIXI.scaleModes&&(PIXI.scaleModes=a.scaleModes);void 0===PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture));void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new PIXI.Matrix);void 0===PIXI.RenderTexture.tempMatrix&&(PIXI.RenderTexture.tempMatrix=new PIXI.Matrix);void 0===PIXI.Graphics.POLY&&(PIXI.Graphics.POLY=a.POLYGON,PIXI.Graphics.RECT=a.RECTANGLE,
PIXI.Graphics.CIRC=a.CIRCLE,PIXI.Graphics.ELIP=a.ELLIPSE,PIXI.Graphics.RREC=a.ROUNDEDRECTANGLE);"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.Phaser=a):"undefined"!=typeof define&&define.amd?define("Phaser",this.Phaser=a):this.Phaser=a}).call(this);var Player=function(e,a,g,h,k,m){"undefined"===typeof m&&(m=a.world);Phaser.Sprite.call(this,a,g,h,k);a.physics.arcade.enable(this);m.add(this);this.mobType="player";this.body.setSize(16,64,26,16);this.body.customSeparateX=!0;this.body.customSeparateY=!0;this.body.allowGravity=!1;this.animations.add("standRight",[70]);this.animations.add("standLeft",[71]);this.animations.add("runRight",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);this.animations.add("runLeft",[39,38,37,36,35,34,33,32,31,30,
29,28,27,26,25,24,23,22,21,20]);this.animations.add("fallRight",[40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]);this.animations.add("fallLeft",[55,56,57,58,59,60,61,62,63,64,65,66,67,68,69]);this.animations.add("hurtLeft",[72,73]);this.animations.add("hurtRight",[74,75]);this.cursors=this.game.input.keyboard.createCursorKeys();this.keyboard=this.game.input.keyboard;this.sfx=this.game.add.audio("sfx");this.sfx.addMarker("land",4,.5,1,!1);this.sfx.addMarker("liftHit",0,.5,1,!1);this.sfx.addMarker("floaterHit",
3,.25,1,!1);this.sfx.addMarker("hit",3.5,.5,1,!1);this.steps=this.game.add.audio("sfx");this.steps.addMarker("walk",5,1.352,.5,!0);this.conflux=e;this.riding=null;this.cConstants={runSpeed:15*gridSize,maxJumpHeight:5*gridSize,minJumpHeight:1*gridSize,jumpSpeed:20*gridSize,maxJumpReduction:.7,fallSpeed:20*gridSize,hurtSpeed:20*gridSize,hurtHeight:3*gridSize,hurtWidth:6*gridSize,hurtTimeout:100,maxHurtReductionY:.7,animationPausedOffset:80};this.cState={jumping:!1,jumpStart:0,jumpHeight:0,jumpReduction:0,
jumpReady:!1,facing:1,flying:!1,hurt:!1,hurtStartX:0,hurtDeltaX:0,hurtReductionX:0,hurtAscending:!1,hurtDescending:!1,hurtTime:0,hurtTimeoutStarted:!1,justToggled:!1,outOfBounds:!1,inputDisabled:!1,paused:!1};this.against={left:null,top:null,bottom:null,right:null};this.resetAgainst=function(){this.against.left=null;this.against.top=null;this.against.right=null;this.against.bottom=null};this.resetWasDirections=function(){this.was={};this.was.below=!1;this.was.above=!1;this.was.left=!1;this.was.right=
!1};this.resetWasDirections();this.debugString=function(){return"Position: [x="+Math.floor(this.body.x)+"/px="+Math.floor(this.body.prev.x)+"] [y="+Math.floor(this.body.y)+"/px="+Math.floor(this.body.prev.y)+"]"};this.update=function(){this.body.velocity.x=0;this.body.velocity.y=0;this.cState.paused||(this.moveX(),this.moveY(),this.cState.hurt&&this.processHurtTimeout(),this.setAnimation(),this.resetAgainst(),this.riding=null);this.body.y>this.game.world.height&&(this.cState.outOfBounds=!0)};this.setAnimation=
function(){this.cState.hurt?0<this.cState.facing?this.animations.play("hurtRight",10):this.animations.play("hurtLeft",10):this.cState.inputDisabled||(this.against.bottom?0<this.cState.facing?this.cursors.right.isDown&&!this.cState.rightDisabled?(this.animations.play("runRight"),this.steps.isPlaying||this.steps.play("walk")):(this.animations.play("standRight"),this.steps.stop()):this.cursors.left.isDown&&!this.cState.leftDisabled?(this.animations.play("runLeft"),this.steps.isPlaying||this.steps.play("walk")):
(this.animations.play("standLeft"),this.steps.stop()):(0<this.cState.facing?this.animations.play("fallRight"):this.animations.play("fallLeft"),this.steps.stop()))};this.moveX=function(){animationToRun=0;if(this.cState.hurt)this.processHurtX();else if(!this.cState.inputDisabled){this.cursors.left.isDown&&!this.cState.leftDisabled?this.cState.facing=-1:this.cursors.right.isDown&&!this.cState.rightDisabled&&(this.cState.facing=1);if(this.cursors.left.isDown&&!this.cState.leftDisabled||this.cursors.right.isDown&&
!this.cState.rightDisabled)this.body.velocity.x=this.cConstants.runSpeed*this.cState.facing;null!=this.riding&&(this.body.velocity.x+=this.riding.body.velocity.x)}};this.moveY=function(){this.cState.flying&&!this.cState.hurt?this.cursors.up.isDown?this.body.velocity.y=-this.cConstants.runSpeed:this.cursors.down.isDown&&(this.body.velocity.y=this.cConstants.runSpeed):(this.cState.hurt?this.processHurtY():this.cState.jumping?this.processJump():!this.keyboard.isDown(32)||!this.cState.jumpReady||this.cState.hurt||
this.cState.inputDisabled||this.cState.jumpDisabled?this.body.velocity.y=this.cConstants.fallSpeed:this.startJump(),!this.against.bottom||this.keyboard.isDown(32)?this.cState.jumpReady=!1:this.against.bottom&&!this.keyboard.isDown(32)&&(this.cState.jumpReady=!0))};this.processJump=function(){this.cState.jumpHeight=this.cState.jumpStart-this.body.y;var a=this.cState.jumpHeight>=this.cConstants.maxJumpHeight,c=this.cState.jumpHeight>=this.cConstants.minJumpHeight,e=!this.keyboard.isDown(32)&&c;a||this.against.top||
e||this.cState.hurt?(this.cState.jumping=!1,this.body.velocity.y=0):(c?(this.cState.jumpReduction=(this.cState.jumpHeight-this.cConstants.minJumpHeight)/(this.cConstants.maxJumpHeight-this.cConstants.minJumpHeight),this.cState.jumpReduction=Math.min(this.cState.jumpReduction,this.cConstants.maxJumpReduction)):this.cState.jumpReduction=0,this.body.velocity.y=-1*(this.cConstants.jumpSpeed-this.cConstants.jumpSpeed*this.cState.jumpReduction))};this.reverseHurt=function(){this.cState.facing*=-1};this.processHurtX=
function(){this.body.velocity.x=this.against.bottom||this.against.left||this.against.right?0:-1*this.cState.facing*this.cConstants.hurtSpeed};this.processHurtY=function(){this.cState.hurtDeltaY=this.cState.hurtStartY-this.body.y;var a=this.cState.hurtDeltaY>=this.cConstants.hurtHeight;this.cState.hurtAscending&&(a||this.against.top)&&(this.cState.hurtAscending=!1,this.cState.hurtDescending=!0,this.body.velocity.y=0);this.cState.hurtDescending&&(this.cState.hurtStartY<this.body.y||this.against.bottom)&&
(this.cState.hurtDescending=!1);this.cState.hurtAscending?(this.cState.hurtReductionY=this.cState.hurtDeltaY/this.cConstants.hurtHeight,this.cState.hurtReductionY=Math.min(this.cState.hurtReductionY,this.cConstants.maxHurtReductionY),this.body.velocity.y=-1*(this.cConstants.hurtSpeed-this.cConstants.hurtSpeed*this.cState.hurtReductionY)):this.cState.hurtDescending?(this.cState.hurtReductionY=this.cState.hurtDeltaY/this.cConstants.hurtHeight,this.cState.hurtReductionY=Math.min(this.cState.hurtReductionY,
this.cConstants.maxHurtReductionY),this.body.velocity.y=this.cConstants.hurtSpeed-this.cConstants.hurtSpeed*this.cState.hurtReductionY):this.body.velocity.y=this.cConstants.hurtSpeed};this.processHurtTimeout=function(){this.cState.hurtTimeoutStarted?this.game.time.now>this.cState.hurtTime+this.cConstants.hurtTimeout&&this.cancelHurt():this.against.bottom&&(this.cState.hurtTimeoutStarted=!0,this.cState.hurtTime=this.game.time.now);this.against.bottom||(this.cState.hurtTimeoutStarted=!1)};this.startJump=
function(){this.cState.jumping=!0;this.cState.jumpStart=this.body.y;this.cState.jumpHeight=0;this.cState.jumpReduction=0;this.body.velocity.y=-this.cConstants.jumpSpeed};this.hit=function(){this.hurt();this.sfx.play("hit")};this.hurt=function(){this.cState.hurt=!0;this.cState.hurtAscending=!0;this.cState.hurtDescending=!1;this.cState.hurtStartY=this.body.y;this.cState.hurtDeltaY=0;this.cState.hurtReductionY=0;this.cState.hurtTimeoutStarted=!1;this.cState.hurtTime=0;this.cState.jumping=!1;this.steps.stop()};
this.cancelHurt=function(){this.cState.hurt=!1};this.tileContact=function(a){this.was.below=this.body.prev.y>=a.bottom;this.was.above=this.body.prev.y+this.body.height<=a.top;this.was.left=this.body.prev.x+this.body.width<=a.left;this.was.right=this.body.prev.x>=a.right;var c=this.body.position.x,c=this.body.position.y;this.was.above||this.was.below||!this.was.left&&!this.was.right?this.was.left||this.was.right||(0>this.body.overlapY?(this.body.blocked.top=!0,this.against.top=a,c=a.bottom+1,this.body.position.y=
c):0<this.body.overlapY&&(this.body.blocked.bottom=!0,this.against.bottom=a,c=a.top-this.body.height-1,this.body.position.y=c,this.body.prev.y<this.body.position.y&&this.sfx.play("land"))):(0>this.body.overlapX?(this.body.blocked.left=!0,this.against.left=a,c=a.right+1,this.body.position.x=c):0<this.body.overlapX&&(this.body.blocked.right=!0,this.against.right=a,c=a.left-this.body.width-1,this.body.position.x=c),this.cState.hurt&&this.reverseHurt());this.resetWasDirections()};this.mobContact=function(a){this.was.below=
this.body.prev.y>=a.body.prev.y+a.body.height;this.was.above=this.body.prev.y+this.body.height<=a.body.prev.y;this.was.left=this.body.prev.x+this.body.width<=a.body.prev.x;this.was.right=this.body.prev.x>=a.body.prev.x+a.body.width;var c=this.body.position.y;this.was.above||this.was.below||!this.was.left&&!this.was.right?0>this.body.overlapY?(this.hurt(),this.processSound(a),a.cState.paused&&!this.cState.paused&&a.setPause(!1)):0<this.body.overlapY&&(this.body.blocked.bottom=!0,this.riding=this.against.bottom=
a,a.cState.playerOnTop=!0,c=a.body.y-this.body.height-1,this.body.position.y=c,a.cState.paused&&!this.cState.paused&&a.setPause(!1),this.body.prev.y<this.body.position.y&&this.sfx.play("land")):(this.cState.facing=this.was.left?1:-1,this.hurt(),this.processSound(a),a.cState.paused&&!this.cState.paused&&a.setPause(!1));this.resetWasDirections()};this.setPause=function(a){this.sfx.stop();this.steps.stop();this.cState.paused!=a&&(this.animations.frame=a?this.animations.frame+this.cConstants.animationPausedOffset:
this.animations.frame-this.cConstants.animationPausedOffset,this.animations.paused=a,this.cState.paused=a)};this.processSound=function(a){"floater"==a.mobType?this.sfx.play("floaterHit"):"lift"==a.mobType?this.sfx.play("liftHit"):this.sfx.play("hit")}};Player.prototype=Object.create(Phaser.Sprite.prototype);Player.prototype.constructor=Player;SAGDX.Preloader=function(e){this.loadingText=this.SAlogo=this.preloadBar=this.loadBackground=null;this.ready=!1};
SAGDX.Preloader.prototype={preload:function(){this.preloadBar=this.add.sprite(209,356,"loadBar");this.SAlogo=this.add.sprite(384,156,"SAGDlogo");this.SAlogo.anchor.setTo(.5,.5);this.load.setPreloadSprite(this.preloadBar);this.game.load.tilemap("introForegroundLayerMap","data/levels/Intro/foregroundLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("introBackgroundLayerMap","data/levels/Intro/backgroundLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("introCollisionLayerMap",
"data/levels/Intro/collisionLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level1ForegroundLayerMap","data/levels/Act-1/foregroundLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level1BackgroundLayerMap","data/levels/Act-1/backgroundLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level1CollisionLayerMap","data/levels/Act-1/collisionLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level2ForegroundLayerMap","data/levels/Act-2/foregroundLayer.json",
null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level2BackgroundLayerMap","data/levels/Act-2/backgroundLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level2CollisionLayerMap","data/levels/Act-2/collisionLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level3ForegroundLayerMap","data/levels/Act-3/foregroundLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level3BackgroundLayerMap","data/levels/Act-3/backgroundLayer.json",null,Phaser.Tilemap.TILED_JSON);
this.game.load.tilemap("level3CollisionLayerMap","data/levels/Act-3/collisionLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level4ForegroundLayerMap","data/levels/Act-4/foregroundLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level4BackgroundLayerMap","data/levels/Act-4/backgroundLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.tilemap("level4CollisionLayerMap","data/levels/Act-4/collisionLayer.json",null,Phaser.Tilemap.TILED_JSON);this.game.load.image("tileset",
"assets/tileset.png");this.game.load.image("factoryDialogBox","assets/factoryDialogBox.png");this.game.load.image("unknownDialogBox","assets/unknownDialogBox.png");this.game.load.image("instructionbox","assets/instructionBox.png");this.game.load.spritesheet("factoryFace","assets/factoryFace.png",80,60);this.game.load.spritesheet("unknownFace","assets/unknownFace.png",80,60);this.game.load.image("title","assets/title.png");this.game.load.image("pausetext","assets/paused.png");this.game.load.text("level1Spawns",
"data/levels/Act-1/spawns.json");this.game.load.text("level1Events","data/levels/Act-1/events.json");this.game.load.text("level2Spawns","data/levels/Act-2/spawns.json");this.game.load.text("level2Events","data/levels/Act-2/events.json");this.game.load.text("level3Spawns","data/levels/Act-3/spawns.json");this.game.load.text("level3Events","data/levels/Act-3/events.json");this.game.load.text("level4Spawns","data/levels/Act-4/spawns.json");this.game.load.text("level4Events","data/levels/Act-4/events.json");
this.game.load.spritesheet("player","assets/player/spritesheet.png",64,80);this.game.load.spritesheet("suicide","assets/player/suicide_sheet.png",147,136);this.game.load.spritesheet("truck","assets/truck.png",64,48);this.game.load.spritesheet("carrier","assets/carrier.png",77,37);this.game.load.spritesheet("floater","assets/floater.png",52,59);this.game.load.spritesheet("lift","assets/lift.png",64,12);this.game.load.spritesheet("turret","assets/turret.png",52,74);this.game.load.spritesheet("bigblast",
"assets/bigblast.png",120,70);this.game.load.spritesheet("littleblast","assets/littleblast.png",92,34);this.game.load.spritesheet("floorbutton","assets/floorbutton.png",60,5);this.game.load.spritesheet("door","assets/door.png",64,92);this.game.load.spritesheet("parabackground1","assets/levels/act1/background1.png",768,512);this.game.load.spritesheet("parabackground1p","assets/levels/act1/background1paused.png",768,512);this.game.load.spritesheet("parabackground3","assets/levels/act1/background3.png",
768,512);this.game.load.spritesheet("parabackground3p","assets/levels/act1/background3paused.png",768,512);this.game.load.image("parabackgroundSky","assets/levels/act4/sky.jpg",768,512);this.game.load.image("parabackgroundSkyp","assets/levels/act4/skypause.jpg",768,512);this.game.load.image("overlay","assets/overlay.png",100,512);this.game.load.audio("music",["assets/music/Alan_Singley_-_Taking_Dark_Matter_Lightly.mp3"]);this.game.load.audio("ambience",["assets/sfx/ambience_loop.ogg"]);this.game.load.audio("sfx",
["assets/sfx/sfx.ogg"]);music=this.game.add.audio("music");ambience=this.game.add.audio("ambience");sfx=this.game.add.audio("sfx");sfx.addMarker("land",4,.5,1,!1);sfx.addMarker("suicide",6.5,.5,1,!1);this.game.load.spritesheet("tinroof","assets/tinroof.png",154,112);this.game.load.spritesheet("interstellaria","assets/interstellaria.png",154,112);this.game.load.spritesheet("showerwithdad","assets/showerwithdad.png",154,112);this.game.load.spritesheet("echo","assets/echo.png",27,25);this.game.load.spritesheet("trashpile",
"assets/trashpile.png",304,144);this.game.load.spritesheet("smalltrashpile","assets/smalltrashpile.png",103,39);this.game.load.spritesheet("trashtruck","assets/trashtruck.png",103,66);this.game.load.script("webfont","//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js")},create:function(){this.preloadBar.cropEnabled=!1},update:function(){this.cache.isSoundDecoded("music")&&0==this.ready&&(this.ready=!0,this.state.start("Level4"))}};var Truck=function(e,a,g,h,k,m,b,c){"undefined"===typeof k&&(k=a.world);"undefined"===typeof b&&(b=3);Phaser.Sprite.call(this,a,g,h,"truck");a.physics.arcade.enable(this);k.add(this);this.mobType="truck";this.conflux=e;this.animations.add("plain",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);this.animations.play("plain",20,!0);this.sfx=this.game.add.audio("sfx");this.sfx.addMarker("idle",9,.426,.05,!0);this.cConstants={groundSpeed:b*gridSize,fallSpeed:20*gridSize,animationPausedOffset:20};
this.cState={paused:!1,facing:m};this.update=function(){if(this.cState.paused)this.body.velocity.x=0,this.body.velocity.y=0,this.body.gravity.y=0;else if(this.sfx.isPlaying||this.sfx.play("idle"),this.body.gravity.y=40*gridSize,this.body.velocity.y>this.cConstants.fallSpeed&&(this.body.velocity.y=this.cConstants.fallSpeed),this.body.onFloor()||this.body.touching.down)this.body.velocity.x=this.cConstants.groundSpeed*this.cState.facing,this.y=Math.ceil(this.y)};this.hit=function(){this.setPause(!1)};
this.debugString=function(){return"[pos:"+Math.floor(this.x)+"/"+Math.floor(this.y)+"]"};this.setPause=function(a){this.sfx.stop();this.cState.paused!=a&&(this.animations.frame=a?this.animations.frame+this.cConstants.animationPausedOffset:this.animations.frame-this.cConstants.animationPausedOffset,this.animations.paused=a,this.cState.paused=a)};this.setPause(!!c)};Truck.prototype=Object.create(Phaser.Sprite.prototype);Truck.prototype.constructor=Truck;var Turret=function(e,a,g,h,k,m){"undefined"===typeof k&&(k=a.world);Phaser.Sprite.call(this,a,g,h,"turret");a.physics.arcade.enable(this);k.add(this);this.body.setSize(48,74,2,0);this.game.debugMode&&(g=(new Phaser.Graphics).beginFill(9013641).drawRect(0,0,48,74),a=a.add.sprite(2,0,g.generateTexture()),a.alpha=.5,this.addChild(a));this.mobType="turret";this.conflux=e;this.body.allowGravity=!1;this.animations.add("left",[0]);this.animations.add("right",[1]);-1==m.facing?this.animations.play("left"):
this.animations.play("right");this.cConstants={animationPausedOffset:2,actions:[],actionLoopIndex:m.loopTo};for(h=0;h<m.actions.length;h+=1)unitActionList=[],a=m.actions[h],g={},g.type=a.type,a.y&&(g.y=a.y*gridSize),a.x&&(g.x=a.x*gridSize),a.speed&&(g.speed=a.speed*gridSize),a.duration&&(g.duration=a.duration*e.timeMultiplier),g.activation=a.activation,this.cConstants.actions.push(g);this.cState={paused:!1,facing:m.facing};this.update=function(){this.cState.paused?this.body.velocity.y=0:this.processAction()};
this.nextAction=function(){this.body.velocity.y=0;var a=this.cState.currentAction;a?(a=a.index+1,a>=this.cConstants.actions.length&&(a=this.cConstants.actionLoopIndex)):a=0;var c=this.cConstants.actions[a];c.index=a;"moveTo"==c.type?c.direction=c.y<this.body.y?-1:1:"wait"==c.type?c.timeout=this.game.time.now+c.duration:"turn"==c.type?this.turn():"fire"==c.type&&this.fire(c.speed);this.cState.currentAction=c;this.processAction()};this.processAction=function(){var a=this.cState.currentAction;a?"moveTo"==
a.type?1==a.direction&&this.body.y>a.y||-1==a.direction&&this.body.y<a.y?this.nextAction():this.body.velocity.y=a.speed*a.direction:"wait"==a.type?a.timeout<this.game.time.now&&this.nextAction():"turn"!=a.type&&"fire"!=a.type||this.nextAction():this.nextAction()};this.turn=function(){this.cState.facing*=-1;-1==this.cState.facing?this.animations.play("left"):this.animations.play("right")};this.fire=function(a){new BigBlast(this.conflux,this.game,-1==this.cState.facing?this.body.x-110:this.body.right-
10,this.body.y-20,this.conflux.blasts,this.cState.facing,a/gridSize,!1)};this.debugString=function(){return"[pos:"+Math.floor(this.x)+"/"+Math.floor(this.y)+"]"};this.hit=function(){this.setPause(!1)};this.setPause=function(a){this.cState.paused!=a&&(this.animations.frame=a?this.animations.frame+this.cConstants.animationPausedOffset:this.animations.frame-this.cConstants.animationPausedOffset,this.animations.paused=a,this.cState.paused=a)};this.setPause(!!m.paused)};Turret.prototype=Object.create(Phaser.Sprite.prototype);
Turret.prototype.constructor=Turret;